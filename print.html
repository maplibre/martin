<!DOCTYPE HTML>
<html lang="en" class="light sidebar-visible" dir="ltr">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>Martin Tile Server Documentation</title>
        <meta name="robots" content="noindex">


        <!-- Custom HTML head -->

        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff">

        <link rel="icon" href="favicon-de23e50b.svg">
        <link rel="shortcut icon" href="favicon-8114d1fc.png">
        <link rel="stylesheet" href="css/variables-8adf115d.css">
        <link rel="stylesheet" href="css/general-2459343d.css">
        <link rel="stylesheet" href="css/chrome-ae938929.css">
        <link rel="stylesheet" href="css/print-9e4910d8.css" media="print">

        <!-- Fonts -->
        <link rel="stylesheet" href="fonts/fonts-9644e21d.css">

        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" id="mdbook-highlight-css" href="highlight-493f70e1.css">
        <link rel="stylesheet" id="mdbook-tomorrow-night-css" href="tomorrow-night-4c0ae647.css">
        <link rel="stylesheet" id="mdbook-ayu-highlight-css" href="ayu-highlight-3fdfc3ac.css">

        <!-- Custom theme stylesheets -->
        <link rel="stylesheet" href="theme/tabs-478bfc3b.css">


        <!-- Provide site root and default themes to javascript -->
        <script>
            const path_to_root = "";
            const default_light_theme = "light";
            const default_dark_theme = "navy";
            window.path_to_searchindex_js = "searchindex-c9ce49e5.js";
        </script>
        <!-- Start loading toc.js asap -->
        <script src="toc-da940ac3.js"></script>
    </head>
    <body>
    <div id="mdbook-help-container">
        <div id="mdbook-help-popup">
            <h2 class="mdbook-help-title">Keyboard shortcuts</h2>
            <div>
                <p>Press <kbd>←</kbd> or <kbd>→</kbd> to navigate between chapters</p>
                <p>Press <kbd>S</kbd> or <kbd>/</kbd> to search in the book</p>
                <p>Press <kbd>?</kbd> to show this help</p>
                <p>Press <kbd>Esc</kbd> to hide this help</p>
            </div>
        </div>
    </div>
    <div id="mdbook-body-container">
        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script>
            try {
                let theme = localStorage.getItem('mdbook-theme');
                let sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script>
            const default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? default_dark_theme : default_light_theme;
            let theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            const html = document.documentElement;
            html.classList.remove('light')
            html.classList.add(theme);
            html.classList.add("js");
        </script>

        <input type="checkbox" id="mdbook-sidebar-toggle-anchor" class="hidden">

        <!-- Hide / unhide sidebar before it is displayed -->
        <script>
            let sidebar = null;
            const sidebar_toggle = document.getElementById("mdbook-sidebar-toggle-anchor");
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            } else {
                sidebar = 'hidden';
                sidebar_toggle.checked = false;
            }
            if (sidebar === 'visible') {
                sidebar_toggle.checked = true;
            } else {
                html.classList.remove('sidebar-visible');
            }
        </script>

        <nav id="mdbook-sidebar" class="sidebar" aria-label="Table of contents">
            <!-- populated by js -->
            <mdbook-sidebar-scrollbox class="sidebar-scrollbox"></mdbook-sidebar-scrollbox>
            <noscript>
                <iframe class="sidebar-iframe-outer" src="toc.html"></iframe>
            </noscript>
            <div id="mdbook-sidebar-resize-handle" class="sidebar-resize-handle">
                <div class="sidebar-resize-indicator"></div>
            </div>
        </nav>

        <div id="mdbook-page-wrapper" class="page-wrapper">

            <div class="page">
                <div id="mdbook-menu-bar-hover-placeholder"></div>
                <div id="mdbook-menu-bar" class="menu-bar sticky">
                    <div class="left-buttons">
                        <label id="mdbook-sidebar-toggle" class="icon-button" for="mdbook-sidebar-toggle-anchor" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="mdbook-sidebar">
                            <span class=fa-svg><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc. --><path d="M0 96C0 78.3 14.3 64 32 64H416c17.7 0 32 14.3 32 32s-14.3 32-32 32H32C14.3 128 0 113.7 0 96zM0 256c0-17.7 14.3-32 32-32H416c17.7 0 32 14.3 32 32s-14.3 32-32 32H32c-17.7 0-32-14.3-32-32zM448 416c0 17.7-14.3 32-32 32H32c-17.7 0-32-14.3-32-32s14.3-32 32-32H416c17.7 0 32 14.3 32 32z"/></svg></span>
                        </label>
                        <button id="mdbook-theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="mdbook-theme-list">
                            <span class=fa-svg><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 576 512"><!--! Font Awesome Free 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc. --><path d="M371.3 367.1c27.3-3.9 51.9-19.4 67.2-42.9L600.2 74.1c12.6-19.5 9.4-45.3-7.6-61.2S549.7-4.4 531.1 9.6L294.4 187.2c-24 18-38.2 46.1-38.4 76.1L371.3 367.1zm-19.6 25.4l-116-104.4C175.9 290.3 128 339.6 128 400c0 3.9 .2 7.8 .6 11.6c1.8 17.5-10.2 36.4-27.8 36.4H96c-17.7 0-32 14.3-32 32s14.3 32 32 32H240c61.9 0 112-50.1 112-112c0-2.5-.1-5-.2-7.5z"/></svg></span>
                        </button>
                        <ul id="mdbook-theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="mdbook-theme-default_theme">Auto</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="mdbook-theme-light">Light</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="mdbook-theme-rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="mdbook-theme-coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="mdbook-theme-navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="mdbook-theme-ayu">Ayu</button></li>
                        </ul>
                        <button id="mdbook-search-toggle" class="icon-button" type="button" title="Search (`/`)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="/ s" aria-controls="mdbook-searchbar">
                            <span class=fa-svg><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!--! Font Awesome Free 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc. --><path d="M416 208c0 45.9-14.9 88.3-40 122.7L502.6 457.4c12.5 12.5 12.5 32.8 0 45.3s-32.8 12.5-45.3 0L330.7 376c-34.4 25.2-76.8 40-122.7 40C93.1 416 0 322.9 0 208S93.1 0 208 0S416 93.1 416 208zM208 352c79.5 0 144-64.5 144-144s-64.5-144-144-144S64 128.5 64 208s64.5 144 144 144z"/></svg></span>
                        </button>
                    </div>

                    <h1 class="menu-title">Martin Tile Server Documentation</h1>

                    <div class="right-buttons">
                        <a href="print.html" title="Print this book" aria-label="Print this book">
                            <span class=fa-svg id="print-button"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!--! Font Awesome Free 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc. --><path d="M128 0C92.7 0 64 28.7 64 64v96h64V64H354.7L384 93.3V160h64V93.3c0-17-6.7-33.3-18.7-45.3L400 18.7C388 6.7 371.7 0 354.7 0H128zM384 352v32 64H128V384 368 352H384zm64 32h32c17.7 0 32-14.3 32-32V256c0-35.3-28.7-64-64-64H64c-35.3 0-64 28.7-64 64v96c0 17.7 14.3 32 32 32H64v64c0 35.3 28.7 64 64 64H384c35.3 0 64-28.7 64-64V384zm-16-88c-13.3 0-24-10.7-24-24s10.7-24 24-24s24 10.7 24 24s-10.7 24-24 24z"/></svg></span>
                        </a>
                        <a href="https://github.com/maplibre/martin" title="Git repository" aria-label="Git repository">
                            <span class=fa-svg><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 496 512"><!--! Font Awesome Free 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc. --><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6 0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2z"/></svg></span>
                        </a>

                    </div>
                </div>

                <div id="mdbook-search-wrapper" class="hidden">
                    <form id="mdbook-searchbar-outer" class="searchbar-outer">
                        <div class="search-wrapper">
                            <input type="search" id="mdbook-searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="mdbook-searchresults-outer" aria-describedby="searchresults-header">
                            <div class="spinner-wrapper">
                                <span class=fa-svg id="fa-spin"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!--! Font Awesome Free 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc. --><path d="M304 48c0-26.5-21.5-48-48-48s-48 21.5-48 48s21.5 48 48 48s48-21.5 48-48zm0 416c0-26.5-21.5-48-48-48s-48 21.5-48 48s21.5 48 48 48s48-21.5 48-48zM48 304c26.5 0 48-21.5 48-48s-21.5-48-48-48s-48 21.5-48 48s21.5 48 48 48zm464-48c0-26.5-21.5-48-48-48s-48 21.5-48 48s21.5 48 48 48s48-21.5 48-48zM142.9 437c18.7-18.7 18.7-49.1 0-67.9s-49.1-18.7-67.9 0s-18.7 49.1 0 67.9s49.1 18.7 67.9 0zm0-294.2c18.7-18.7 18.7-49.1 0-67.9S93.7 56.2 75 75s-18.7 49.1 0 67.9s49.1 18.7 67.9 0zM369.1 437c18.7 18.7 49.1 18.7 67.9 0s18.7-49.1 0-67.9s-49.1-18.7-67.9 0s-18.7 49.1 0 67.9z"/></svg></span>
                            </div>
                        </div>
                    </form>
                    <div id="mdbook-searchresults-outer" class="searchresults-outer hidden">
                        <div id="mdbook-searchresults-header" class="searchresults-header"></div>
                        <ul id="mdbook-searchresults">
                        </ul>
                    </div>
                </div>

                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script>
                    document.getElementById('mdbook-sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('mdbook-sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#mdbook-sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="mdbook-content" class="content">
                    <main>
                        <h1 id="introduction"><a href="#introduction" class="header">Introduction</a></h1>
<p><img src="https://raw.githubusercontent.com/maplibre/martin/main/logo.png" alt="Martin"></p>
<p>Martin is a tile server able to generate and serve <a href="https://github.com/mapbox/vector-tile-spec">vector tiles</a> on the fly from large <a href="https://github.com/postgis/postgis">PostGIS</a> databases, <a href="https://protomaps.com/blog/pmtiles-v3-whats-new">PMTiles</a> (local or remote), and <a href="https://github.com/mapbox/mbtiles-spec">MBTiles</a> files, allowing multiple tile sources to be dynamically combined into one. Martin optimizes for speed and heavy traffic, and is written in <a href="https://github.com/rust-lang/rust">Rust</a>.</p>
<p>See also <a href="https://martin.maplibre.org/">Martin demo site</a></p>
<hr>
<p><a href="https://maplibre.org/martin"><img src="https://img.shields.io/badge/docs-Book-informational" alt="Book"></a>
<a href="https://docs.rs/martin"><img src="https://docs.rs/martin/badge.svg" alt="docs.rs docs"></a>
<a href="https://slack.openstreetmap.us/"><img src="https://img.shields.io/badge/Slack-%23maplibre--martin-blueviolet?logo=slack" alt=""></a>
<a href="https://github.com/maplibre/martin"><img src="https://img.shields.io/badge/github-maplibre/martin-8da0cb?logo=github" alt="GitHub"></a>
<a href="https://crates.io/crates/martin"><img src="https://img.shields.io/crates/v/martin.svg" alt="crates.io version"></a>
<a href="https://github.com/maplibre/martin/security"><img src="https://github.com/maplibre/martin/workflows/Security%20audit/badge.svg" alt="Security audit"></a>
<a href="https://github.com/maplibre/martin/actions"><img src="https://github.com/maplibre/martin/actions/workflows/ci.yml/badge.svg" alt="CI build"></a>
<a href="https://app.codecov.io/gh/maplibre/martin"><img src="https://img.shields.io/codecov/c/github/maplibre/martin" alt="Codecov"></a>
<a href="https://www.bestpractices.dev/projects/11613"><img src="https://www.bestpractices.dev/projects/11613/badge" alt="OpenSSF Best Practices"></a></p>
<div style="break-before: page; page-break-before: always;"></div>
<h1 id="quick-start-1"><a href="#quick-start-1" class="header">Quick Start</a></h1>
<h2 id="martin-quick-start-guide"><a class="header" href="#martin-quick-start-guide">Martin Quick Start Guide</a></h2>
<p>Choose your operating system to get started with Martin tile server</p>
<ul>
<li><a href="#on-linux">Linux</a></li>
<li><a href="#on-macos">macOS</a></li>
<li><a href="#on-windows">Windows</a></li>
</ul>
<div style="break-before: page; page-break-before: always;"></div>
<h1 id="on-linux"><a href="#on-linux" class="header">On Linux</a></h1>
<h2 id="quick-start-on-linux"><a class="header" href="#quick-start-on-linux">Quick start on Linux</a></h2>
<pre><code class="language-bash">mkdir martin
cd martin

# Download some sample data
curl -L -O https://github.com/maplibre/martin/raw/main/tests/fixtures/mbtiles/world_cities.sql

# Check if sqlite is installed
sqlite3 --version

# Initialize a database
sqlite3 world_cities.mbtiles &lt; world_cities.sql

# Download the latest version of Martin binary, extract it, and make it executable
curl -L -O https://github.com/maplibre/martin/releases/latest/download/martin-x86_64-unknown-linux-gnu.tar.gz
tar -xzf martin-x86_64-unknown-linux-gnu.tar.gz
chmod +x ./martin

# Show Martin help screen
./martin --help

# Run Martin with the sample data as the only tile source
./martin world_cities.mbtiles
</code></pre>
<h3 id="view-the-map"><a class="header" href="#view-the-map">View the map</a></h3>
<p>See <a href="#view-with-qgis">quick start with QGIS</a> for instructions on how to view the map.</p>
<div style="break-before: page; page-break-before: always;"></div>
<h1 id="on-macos"><a href="#on-macos" class="header">On macOS</a></h1>
<h2 id="quick-start-on-macos"><a class="header" href="#quick-start-on-macos">Quick start on macOS</a></h2>
<ol>
<li>
<p>Download some <a href="https://github.com/maplibre/martin/raw/main/tests/fixtures/mbtiles/world_cities.sql">demo tiles</a>.</p>
</li>
<li>
<p>Download the latest version of Martin from
the <a href="https://github.com/maplibre/martin/releases/latest">release page</a>.
Use <a href="https://support.apple.com/en-us/116943">about this Mac</a> to find your processors type.</p>
<ul>
<li>Use <a href="https://github.com/maplibre/martin/releases/latest/download/martin-x86_64-apple-darwin.tar.gz">martin-x86_64-apple-darwin.tar.gz</a> for Intel</li>
<li>Use <a href="https://github.com/maplibre/martin/releases/latest/download/martin-aarch64-apple-darwin.tar.gz">martin-aarch64-apple-darwin.tar.gz</a> for M1</li>
</ul>
</li>
<li>
<p>Extract content of both files and place them in a same directory.</p>
</li>
<li>
<p>Open the command prompt and navigate to the directory where <code>martin</code> and <code>world_cities.sql</code> are located.</p>
</li>
<li>
<p>Run the following command to start Martin with the demo data:</p>
</li>
</ol>
<pre><code class="language-bash"># Initialize a database
sqlite3 world_cities.mbtiles &lt; world_cities.sql

# Show Martin help screen
./martin --help

# Run Martin with the sample data as the only tile source
./martin world_cities.mbtiles
</code></pre>
<h3 id="view-the-map-1"><a class="header" href="#view-the-map-1">View the map</a></h3>
<p>See <a href="#view-with-qgis">quick start with QGIS</a> for instructions on how to view the map.</p>
<div style="break-before: page; page-break-before: always;"></div>
<h1 id="on-windows"><a href="#on-windows" class="header">On Windows</a></h1>
<h2 id="quick-start-on-windows"><a class="header" href="#quick-start-on-windows">Quick start on Windows</a></h2>
<ol>
<li>
<p>Download some <a href="https://github.com/maplibre/martin/raw/main/tests/fixtures/mbtiles/world_cities.sql">demo tiles</a>.</p>
</li>
<li>
<p>Download the latest Windows version of Martin from
the <a href="https://github.com/maplibre/martin/releases">release page</a>:  <a href="https://github.com/maplibre/martin/releases/latest/download/martin-x86_64-pc-windows-msvc.zip">martin-x86_64-pc-windows-msvc.zip</a></p>
</li>
<li>
<p>Extract content of both files and place them in a same directory.</p>
</li>
<li>
<p>Open the command prompt and navigate to the directory where <code>martin</code> and <code>world_cities.sql</code> are located.</p>
</li>
<li>
<p>Run the following command to start Martin with the demo data:</p>
</li>
</ol>
<pre><code class="language-bash"># Check if sqlite is installed
sqlite3 --version

# Initialize a database
sqlite3 world_cities.mbtiles &lt; world_cities.sql

# Show Martin help screen
martin --help

# Run Martin with the sample data as the only tile source
martin world_cities.mbtiles
</code></pre>
<h3 id="view-the-map-2"><a class="header" href="#view-the-map-2">View the map</a></h3>
<p>See <a href="#view-with-qgis">quick start with QGIS</a> for instructions on how to view the map.</p>
<div style="break-before: page; page-break-before: always;"></div>
<h1 id="view-with-qgis"><a href="#view-with-qgis" class="header">View with QGIS</a></h1>
<h3 id="view-map-with-qgis"><a class="header" href="#view-map-with-qgis">View map with QGIS</a></h3>
<ol>
<li>
<p>Download, install, and run <a href="https://qgis.org/en/site/forusers/download.html">QGIS</a> for your platform</p>
</li>
<li>
<p>Add a new <code>Vector Tiles</code> connection</p>
<blockquote>
<p><img src="images/qgis_add_vector_tile.png" alt="alt text"></p>
</blockquote>
</li>
<li>
<p>In the <code>Vector Tile Connection</code> dialog, give it some name and the URL of the Martin server,
e.g.  <code>http://localhost:3000/world_cities/{z}/{x}/{y}</code> and click <code>OK</code>.</p>
<blockquote>
<p><img src="images/qgis_add_vector_tile_options.png" alt="alt text"></p>
</blockquote>
</li>
<li>
<p>In the QGIS browser panel (left), double-click the newly added connection, or right-click it and click
on <code>Add Layer to Project</code>.</p>
<blockquote>
<p><img src="images/qgis_add_to_layers.png" alt="alt text"></p>
</blockquote>
</li>
<li>
<p>The map should now be visible in the QGIS map view.</p>
<blockquote>
<p><img src="images/qgis_shows_in_the_map.png" alt="alt text"></p>
</blockquote>
</li>
</ol>
<div style="break-before: page; page-break-before: always;"></div>
<h1 id="installation"><a href="#installation" class="header">Installation</a></h1>
<h3 id="prerequisites"><a class="header" href="#prerequisites">Prerequisites</a></h3>
<p>If using Martin with PostgreSQL database, you must install PostGIS with at least v3.0+. Postgis v3.1+ is recommended.</p>
<h3 id="docker"><a class="header" href="#docker">Docker</a></h3>
<p>Martin is also available as a <a href="https://ghcr.io/maplibre/martin">Docker image</a>. You could either share a configuration
file from the host with the container via the <code>-v</code> param, or you can let Martin auto-discover all sources e.g. by
passing <code>DATABASE_URL</code> or specifying the .mbtiles/.pmtiles files or URLs to .pmtiles.</p>
<pre><code class="language-bash">export PGPASSWORD=postgres  # secret!

docker run -p 3000:3000 \
           -e PGPASSWORD \
           -e DATABASE_URL=postgres://user@host:port/db \
           -v /path/to/config/dir:/config \
           ghcr.io/maplibre/martin:1.3.0 \
           --config /config/config.yaml
</code></pre>
<h3 id="from-binary-distributions-manually"><a class="header" href="#from-binary-distributions-manually">From Binary Distributions Manually</a></h3>
<p>You can download martin from <a href="https://github.com/maplibre/martin/releases">GitHub releases page</a>.</p>
<div class="table-wrapper">
<table>
<thead>
<tr><th>Platform</th><th>x64</th><th>ARM-64</th></tr>
</thead>
<tbody>
<tr><td>Linux</td><td><a href="https://github.com/maplibre/martin/releases/latest/download/martin-x86_64-unknown-linux-gnu.tar.gz">.tar.gz</a> (gnu)<br><a href="https://github.com/maplibre/martin/releases/latest/download/martin-x86_64-unknown-linux-musl.tar.gz">.tar.gz</a> (musl)<br><a href="https://github.com/maplibre/martin/releases/latest/download/martin-Debian-x86_64.deb">.deb</a></td><td><a href="https://github.com/maplibre/martin/releases/latest/download/martin-aarch64-unknown-linux-gnu.tar.gz">.tar.gz</a> (gnu)<br><a href="https://github.com/maplibre/martin/releases/latest/download/martin-aarch64-unknown-linux-musl.tar.gz">.tar.gz</a> (musl)</td></tr>
<tr><td>macOS</td><td><a href="https://github.com/maplibre/martin/releases/latest/download/martin-x86_64-apple-darwin.tar.gz">.tar.gz</a></td><td><a href="https://github.com/maplibre/martin/releases/latest/download/martin-aarch64-apple-darwin.tar.gz">.tar.gz</a></td></tr>
<tr><td>Windows</td><td><a href="https://github.com/maplibre/martin/releases/latest/download/martin-x86_64-pc-windows-msvc.zip">.zip</a></td><td></td></tr>
</tbody>
</table>
</div>
<p>Rust users can install pre-built martin binary
with <a href="https://github.com/cargo-bins/cargo-binstall">cargo-binstall</a> and <code>cargo</code>.</p>
<pre><code class="language-bash">cargo install cargo-binstall
cargo binstall martin
martin --help
</code></pre>
<h3 id="from-package"><a class="header" href="#from-package">From package</a></h3>
<p>To install with apt source and others, We need your help
to <a href="https://github.com/maplibre/martin/issues/578">improve packaging for various platforms</a>.</p>
<h4 id="homebrew"><a class="header" href="#homebrew">Homebrew</a></h4>
<p>If you are using macOS and <a href="https://brew.sh/">Homebrew</a> you can install martin using Homebrew tap.</p>
<pre><code class="language-bash">brew tap maplibre/martin
brew install martin
martin --help
</code></pre>
<h4 id="debian-packagesx86_64-manually"><a class="header" href="#debian-packagesx86_64-manually">Debian Packages(x86_64) manually</a></h4>
<pre><code class="language-bash">curl -O https://github.com/maplibre/martin/releases/latest/download/martin-Debian-x86_64.deb
sudo dpkg -i ./martin-Debian-x86_64.deb
martin --help
rm ./martin-Debian-x86_64.deb
</code></pre>
<h3 id="building-from-source"><a class="header" href="#building-from-source">Building From source</a></h3>
<p>If you <a href="https://www.rust-lang.org/tools/install">install Rust</a>, you can build martin from source with Cargo:</p>
<pre><code class="language-bash">cargo install martin --locked
martin --help
</code></pre>
<div style="break-before: page; page-break-before: always;"></div>
<h1 id="usage"><a class="header" href="#usage">Usage</a></h1>
<p>Martin requires at least one PostgreSQL <a href="#postgresql-connections-1">connection string</a> or a <a href="#mbtiles-and-pmtiles-file-sources-1">tile source file</a>
as a command-line argument. A PG connection string can also be passed via the <code>DATABASE_URL</code> environment variable.</p>
<pre><code class="language-bash">martin postgres://postgres@localhost/db
</code></pre>
<p>Martin provides <a href="https://github.com/mapbox/tilejson-spec">TileJSON</a> endpoint for
each <a href="https://postgis.net/docs/using_postgis_dbmanagement.html#geometry_columns">geospatial-enabled</a> table in your
database.</p>
<div style="break-before: page; page-break-before: always;"></div>
<h1 id="command-line-interface-1"><a href="#command-line-interface-1" class="header">Command Line Interface</a></h1>
<h2 id="command-line-interface"><a class="header" href="#command-line-interface">Command-line Interface</a></h2>
<p>You can configure Martin using command-line interface.
See <code>martin --help</code> or <code>cargo run -- --help</code> for more information:</p>
<pre><code class="language-text">Blazing fast and lightweight tile server with PostGIS, MBTiles, and PMTiles support

Usage: martin [OPTIONS] [CONNECTION]...

Arguments:
  [CONNECTION]...
          Connection strings, e.g. postgres://... or /path/to/files

Options:
  -c, --config &lt;CONFIG&gt;
          Path to config file. If set, no tile source-related parameters are allowed

      --save-config &lt;SAVE_CONFIG&gt;
          Save resulting config to a file or use "-" to print to stdout. By default, only print if sources are auto-detected

  -C, --cache-size &lt;CACHE_SIZE&gt;
          Main cache size (in MB)

  -s, --sprite &lt;SPRITE&gt;
          Export a directory with SVG files as a sprite source. Can be specified multiple times

  -f, --font &lt;FONT&gt;
          Export a font file or a directory with font files as a font source (recursive). Can be specified multiple times

  -S, --style &lt;STYLE&gt;
          Export a style file or a directory with style files as a style source (recursive). Can be specified multiple times

  -k, --keep-alive &lt;KEEP_ALIVE&gt;
          Connection keep alive timeout. [DEFAULT: 75]

  -l, --listen-addresses &lt;LISTEN_ADDRESSES&gt;
          The socket address to bind. [DEFAULT: 0.0.0.0:3000]

      --base-path &lt;BASE_PATH&gt;
          Set TileJSON URL path prefix.

          This overrides the default of respecting the X-Rewrite-URL header. Only modifies the JSON (TileJSON) returned, martins' API-URLs remain unchanged. If you need to rewrite URLs, please use a reverse proxy. Must begin with a /.

          Examples: /, /tiles

  -W, --workers &lt;WORKERS&gt;
          Number of web server workers

      --preferred-encoding &lt;PREFERRED_ENCODING&gt;
          Martin server preferred tile encoding. [DEFAULT: gzip]

          If the client accepts multiple compression formats, and the tile source is not pre-compressed, which compression should be used. gzip is faster, but brotli is smaller, and may be faster with caching.

          [possible values: brotli, gzip]

  -u, --webui &lt;WEB_UI&gt;
          Control Martin web UI. [DEFAULT: disabled]

          Possible values:
          - disable:        Disable Web UI interface. This is the default, but once implemented, the default will be enabled for localhost.
          - enable-for-all: Enable Web UI interface on all connections

  -b, --auto-bounds &lt;AUTO_BOUNDS&gt;
          Specify how bounds should be computed for the spatial PG tables. [DEFAULT: quick]

          Possible values:
          - quick: Compute table geometry bounds, but abort if it takes longer than 5 seconds
          - calc:  Compute table geometry bounds. The startup time may be significant. Make sure all GEO columns have indexes
          - skip:  Skip bounds calculation. The bounds will be set to the whole world

      --ca-root-file &lt;CA_ROOT_FILE&gt;
          Loads trusted root certificates from a file. The file should contain a sequence of PEM-formatted CA certificates

  -d, --default-srid &lt;DEFAULT_SRID&gt;
          If a spatial PG table has SRID 0, then this default SRID will be used as a fallback

  -p, --pool-size &lt;POOL_SIZE&gt;
          Maximum Postgres connections pool size [DEFAULT: 20]

  -m, --max-feature-count &lt;MAX_FEATURE_COUNT&gt;
          Limit the number of geo features per tile.

          If the source table has more features than set here, they will not be included in the tile and the result will look "cut off"/incomplete. This feature allows to put a maximum latency bound on tiles with extreme amount of detail at the cost of
          not returning all data. It is sensible to set this limit if you have user generated/untrusted geodata, e.g. a lot of data points at Null Island.

          Can be either a positive integer or unlimited if omitted.

  -h, --help
          Print help (see a summary with '-h')

  -V, --version
          Print version

Use RUST_LOG environment variable to control logging level, e.g. RUST_LOG=debug or RUST_LOG=martin=debug. See https://docs.rs/env_logger/latest/env_logger/index.html#enabling-logging for more information.
</code></pre>
<div style="break-before: page; page-break-before: always;"></div>
<h1 id="environment-variables-1"><a href="#environment-variables-1" class="header">Environment Variables</a></h1>
<h2 id="environment-variables"><a class="header" href="#environment-variables">Environment Variables</a></h2>
<p>You can configure Martin using environment variables, but only if the configuration file is not used.
The configuration file itself can use environment variables if needed.
See <a href="#configuration-file">configuration section</a> on how to use environment variables with config files.
See also <a href="#postgresql-ssl-connections">SSL configuration</a> section below.</p>
<div class="table-wrapper">
<table>
<thead>
<tr><th>Environment var <br /> Config File key</th><th>Example</th><th>Description</th></tr>
</thead>
<tbody>
<tr><td><code>DATABASE_URL</code> <br /> <code>connection_string</code></td><td><code>postgres://</code><br /><code>postgres@localhost/db</code></td><td>Postgres database connection</td></tr>
<tr><td><code>DEFAULT_SRID</code> <br /> <code>default_srid</code></td><td><code>4326</code></td><td>If a PostgreSQL table has a geometry column with SRID=0, use this value instead</td></tr>
<tr><td><code>PGSSLCERT</code> <br /> <code>ssl_cert</code></td><td><code>./postgresql.crt</code></td><td>A file with a client SSL certificate. <a href="https://www.postgresql.org/docs/current/libpq-connect.html#LIBPQ-CONNECT-SSLCERT">docs</a></td></tr>
<tr><td><code>PGSSLKEY</code> <br /> <code>ssl_key</code></td><td><code>./postgresql.key</code></td><td>A file with the key for the client SSL certificate. <a href="https://www.postgresql.org/docs/current/libpq-connect.html#LIBPQ-CONNECT-SSLKEY">docs</a></td></tr>
<tr><td><code>PGSSLROOTCERT</code> <br /> <code>ssl_root_cert</code></td><td><code>./root.crt</code></td><td>A file with trusted root certificate(s). The file should contain a sequence of PEM-formatted CA certificates. <a href="https://www.postgresql.org/docs/current/libpq-connect.html#LIBPQ-CONNECT-SSLROOTCERT">docs</a></td></tr>
<tr><td><code>AWS_LAMBDA_RUNTIME_API</code> <br /> -</td><td></td><td>If defined, connect to AWS Lambda to handle requests. The regular HTTP server is not used. See <a href="#aws-lambda">Running in AWS Lambda</a></td></tr>
</tbody>
</table>
</div>
<div style="break-before: page; page-break-before: always;"></div>
<h1 id="hosting-environmentspecific-guides"><a class="header" href="#hosting-environmentspecific-guides">Hosting Environment–specific Guides</a></h1>
<p>To help with common runtimes, we have written the following guides:</p>
<ul>
<li><a href="#docker-2">Docker</a></li>
<li><a href="#docker-compose">Docker-compose</a></li>
<li><a href="#aws-lambda">AWS Lambda</a></li>
</ul>
<div style="break-before: page; page-break-before: always;"></div>
<h1 id="docker-2"><a href="#docker-2" class="header">Docker</a></h1>
<h2 id="running-with-docker"><a class="header" href="#running-with-docker">Running with Docker</a></h2>
<p>You can use official Docker image <a href="https://ghcr.io/maplibre/martin"><code>ghcr.io/maplibre/martin</code></a></p>
<h3 id="using-non-local-postgresql"><a class="header" href="#using-non-local-postgresql">Using Non-Local PostgreSQL</a></h3>
<pre><code class="language-bash">docker run \
  -p 3000:3000 \
  -e DATABASE_URL=postgres://postgres@postgres.example.org/db \
  ghcr.io/maplibre/martin:1.3.0
</code></pre>
<h3 id="exposing-local-files"><a class="header" href="#exposing-local-files">Exposing Local Files</a></h3>
<p>You can expose local files to the Docker container using the <code>-v</code> flag.</p>
<pre><code class="language-bash">docker run \
  -p 3000:3000 \
  -v /path/to/local/files:/files \
  ghcr.io/maplibre/martin:1.3.0 \
  /files
</code></pre>
<h3 id="accessing-local-postgresql-on-linux"><a class="header" href="#accessing-local-postgresql-on-linux">Accessing Local PostgreSQL on Linux</a></h3>
<p>If you are running PostgreSQL instance on <code>localhost</code>, you have to change network settings to allow the Docker container
to access the <code>localhost</code> network.</p>
<p>For Linux, add the <code>--net=host</code> flag to access the <code>localhost</code> PostgreSQL service. You would not need to export ports
with <code>-p</code> because the container is already using the host network.</p>
<pre><code class="language-bash">docker run \
  --net=host \
  -e DATABASE_URL=postgres://postgres@localhost/db \
  ghcr.io/maplibre/martin:1.3.0
</code></pre>
<h3 id="accessing-local-postgresql-on-macos"><a class="header" href="#accessing-local-postgresql-on-macos">Accessing Local PostgreSQL on macOS</a></h3>
<p>For macOS, use <code>host.docker.internal</code> as hostname to access the <code>localhost</code> PostgreSQL service.</p>
<pre><code class="language-bash">docker run \
  -p 3000:3000 \
  -e DATABASE_URL=postgres://postgres@host.docker.internal/db \
  ghcr.io/maplibre/martin:1.3.0
</code></pre>
<h3 id="accessing-local-postgresql-on-windows"><a class="header" href="#accessing-local-postgresql-on-windows">Accessing Local PostgreSQL on Windows</a></h3>
<p>For Windows, use <code>docker.for.win.localhost</code> as hostname to access the <code>localhost</code> PostgreSQL service.</p>
<pre><code class="language-bash">docker run \
  -p 3000:3000 \
  -e DATABASE_URL=postgres://postgres@docker.for.win.localhost/db \
  ghcr.io/maplibre/martin:1.3.0
</code></pre>
<div style="break-before: page; page-break-before: always;"></div>
<h1 id="docker-compose"><a href="#docker-compose" class="header">Docker Compose</a></h1>
<h2 id="running-with-docker-compose"><a class="header" href="#running-with-docker-compose">Running with Docker Compose</a></h2>
<p>You can use example <a href="https://raw.githubusercontent.com/maplibre/martin/main/docker-compose.yml"><code>docker-compose.yml</code></a>
file as a reference</p>
<pre><code class="language-yml">services:
  martin:
    image: ghcr.io/maplibre/martin:1.3.0
    restart: unless-stopped
    ports:
      - "3000:3000"
    environment:
      - DATABASE_URL=postgres://postgres:password@db/db
    depends_on:
      - db

  db:
    image: postgis/postgis:17-3.5-alpine
    restart: unless-stopped
    environment:
      - POSTGRES_DB=db
      - POSTGRES_USER=postgres
      - POSTGRES_PASSWORD=password
    volumes:
      # persist PostgreSQL data in a local directory outside of the docker container
      - ./pg_data:/var/lib/postgresql/data
</code></pre>
<p>First, you need to start <code>db</code> service</p>
<pre><code class="language-bash">docker compose up -d db
</code></pre>
<p>Then, after <code>db</code> service is ready to accept connections, you can start <code>martin</code></p>
<pre><code class="language-bash">docker compose up -d martin
</code></pre>
<p>By default, Martin will be available at <a href="http://localhost:3000/">localhost:3000</a></p>
<p>Official Docker image includes a <code>HEALTHCHECK</code> instruction which will be used by Docker Compose. Note that Compose won’t restart unhealthy containers. To monitor and restart unhealthy containers you can use <a href="https://github.com/willfarrell/docker-autoheal">Docker Autoheal</a>.</p>
<div style="break-before: page; page-break-before: always;"></div>
<h1 id="aws-lambda"><a href="#aws-lambda" class="header">AWS Lambda</a></h1>
<h2 id="using-with-aws-lambda---v014"><a class="header" href="#using-with-aws-lambda---v014">Using with AWS Lambda - v0.14+</a></h2>
<p>Martin can run in AWS Lambda. This is useful if you want to serve tiles from a serverless environment, while accessing “nearby” data from a PostgreSQL database or PMTiles file in S3, without exposing the raw file to the world to prevent download abuse and improve performance.</p>
<p>Lambda has two deployment models: zip file and container-based. When using zip file deployment, there is an online code editor to edit the yaml configuration. When using container-based deployment, we can pass our configuration on the command line or environment variables.</p>
<p>Everything can be performed via AWS CloudShell, or you can install the AWS CLI and the AWS SAM CLI, and configure authentication. The CloudShell also runs in a particular AWS region.</p>
<h3 id="container-deployment"><a class="header" href="#container-deployment">Container deployment</a></h3>
<p>Lambda images must come from a public or private ECR registry. Pull the image from GHCR and push it to ECR.</p>
<pre><code class="language-bash">$ docker pull ghcr.io/maplibre/martin:1.3.0 --platform linux/arm64
$ aws ecr create-repository --repository-name martin
[…]
        "repositoryUri": "493749042871.dkr.ecr.us-east-2.amazonaws.com/martin",

# Read the repositoryUri which includes your account number
$ docker tag ghcr.io/maplibre/martin:1.3.0 493749042871.dkr.ecr.us-east-2.amazonaws.com/martin:latest
$ aws ecr get-login-password --region us-east-2 \
  | docker login --username AWS --password-stdin 493749042871.dkr.ecr.us-east-2.amazonaws.com
$ docker push 493749042871.dkr.ecr.us-east-2.amazonaws.com/martin:latest
</code></pre>
<p>Open <a href="https://console.aws.amazon.com/lambda">Lambda console</a> and create your function:</p>
<ol>
<li>Click “Create function”.</li>
<li>Choose “Container image”.</li>
<li>Put something in “Function name”.
<ul>
<li><strong>Note</strong>: This is an internal identifier, not exposed in the function URL.</li>
</ul>
</li>
<li>Click “Browse images”, and select your repository and the tag.
<ul>
<li>If you cannot find it, see if you are in the same region?</li>
</ul>
</li>
<li>Expand “Container image overrides”, and under CMD put the URL of a <code>.pmtiles</code> file.</li>
<li>Set “Architecture” to <code>arm64</code> to match the platform that we pulled. Lambda has better ARM CPUs than x86.</li>
<li>Click “Create function”.</li>
<li>Find the “Configuration” tab, select “Function URL”, “Create function URL”.</li>
<li>Set “Auth type” to <code>NONE</code>
<ul>
<li>Do not enable <code>CORS</code>. Martin already has <code>CORS</code> support, so it will create incorrect duplicate headers.</li>
</ul>
</li>
<li>Click on the “Function URL”.</li>
<li>To debug an issue, open the “Monitor” tab, “View CloudWatch logs”, find the most recent Log stream.</li>
</ol>
<h3 id="zip-deployment"><a class="header" href="#zip-deployment">Zip deployment</a></h3>
<p>It’s possible to deploy the entire codebase from the AWS console, but we will use Serverless Application Model. Our function will consist of a “Layer”, containing the Martin binary, and our function itself will contain the configuration in yaml format.</p>
<h4 id="the-layer"><a class="header" href="#the-layer">The layer</a></h4>
<p>Download the binary and place it in your staging directory. The <code>bin</code> directory of your Layer will be added to the PATH.</p>
<pre><code class="language-bash">mkdir -p martin_layer/src/bin/
cd martin_layer
curl -OL https://github.com/maplibre/martin/releases/latest/download/martin-aarch64-unknown-linux-musl.tar.gz
tar -C src/bin/ -xzf martin-aarch64-unknown-linux-musl.tar.gz martin
</code></pre>
<p>Every zip-based Lambda function runs a file called <code>bootstrap</code>.</p>
<pre><code class="language-bash">cat &lt;&lt;EOF &gt;src/bootstrap
#!/bin/sh
set -eu
exec martin --config \${_HANDLER}.yaml
EOF
</code></pre>
<p>Write the SAM template.</p>
<pre><code class="language-yaml">cat &lt;&lt;EOF &gt;template.yaml
AWSTemplateFormatVersion: 2010-09-09
Transform: 'AWS::Serverless-2016-10-31'
Resources:
  MartinLayer:
    Type: 'AWS::Serverless::LayerVersion'
    DeletionPolicy: Delete
    Properties:
      ContentUri: src
      CompatibleRuntimes:
      - provided.al2023
      CompatibleArchitectures:
      - arm64
Outputs:
  LayerArn:
    Value: !Ref MartinLayer
    Export:
      Name: !Sub "${AWS::StackName}-LayerArn"
EOF
</code></pre>
<p>Run <code>sam deploy --guided</code>.</p>
<ol>
<li>Stack Name: Name your CloudFormation stack something like <code>martin-layer</code>.</li>
<li>Press enter for everything else</li>
<li>The settings are saved to <code>samconfig.toml</code>, so you can later do <code>sam deploy</code> to update the version, or <code>sam delete</code>.</li>
</ol>
<p>Now if you visit the <a href="https://console.aws.amazon.com/lambda/home">Lambda console</a> and select “Layers”, you should see your layer.</p>
<h4 id="the-function"><a class="header" href="#the-function">The function</a></h4>
<ol>
<li>Select “Functions”, “Create function”.</li>
<li>Put something in “Function name”.</li>
<li>Set “Runtime” to “Amazon Linux 2023”.</li>
<li>Set “Architecture” to “arm64”.</li>
<li>Under “Advanced settings”, choose “Enable function URL” with “Auth type” of “NONE”.</li>
<li>Click “Create function”.</li>
</ol>
<p>Add your layer:</p>
<ol>
<li>Click “add a layer” (green banner at the top, or the very bottom).</li>
<li>Choose “Custom layers”, and select your layer and its version.</li>
<li>Click “Add”.</li>
</ol>
<p>Add your configuration file in the function source code:</p>
<ol>
<li>
<p>Code tab, File, New File: <code>hello.handler.yaml</code>.</p>
<pre><code class="language-yaml">pmtiles:
  sources:
    demotiles: &lt;url to a pmtiles file&gt;
</code></pre>
</li>
<li>
<p>Click Deploy, wait for the success banner, and visit your function URL.</p>
</li>
</ol>
<h3 id="todo"><a class="header" href="#todo">TODO</a></h3>
<p>AWS Lambda support is preliminary; there are features to add to Martin, configuration to tweak, and documentation to improve.  Your help is welcome.</p>
<ul>
<li>Lambda has a default timeout of 3 seconds, and 128 MB of memory, maybe this is suboptimal.</li>
<li>Document how to connect to a PostgreSQL database on RDS.</li>
<li>Set up a CloudFront CDN, this is a whole thing, but explain the motivation and the basics.</li>
<li>Grant the execution role permission to read objects from an S3 bucket, and teach Martin how to make authenticated requests to S3.</li>
<li>Teach Martin how to serve all PMTiles files from an S3 bucket rather than having to list them at startup.</li>
<li>Teach Martin how to set the Cache-Control and Etag headers for better defaults.</li>
</ul>
<div style="break-before: page; page-break-before: always;"></div>
<h1 id="reverse-proxies"><a class="header" href="#reverse-proxies">Reverse Proxies</a></h1>
<p>Martin can run without a reverse proxy.</p>
<p>Doing so has a few downsides:</p>
<ul>
<li>Martin does not support HTTPS connections (TLS termination).</li>
<li>We do not check <code>HOST</code>-headers - we just serve on a port.
This means anybody can point their dns record to your server and serve to all requests going to the port Martin is running on.
Using a reverse proxy makes this abuse obvious.</li>
<li>Martin only supports a simple in-memory caching.
If you need more advanced caching options, you can use a reverse proxy like <a href="https://nginx.org/">Nginx</a>, <a href="https://varnish-cache.org/">Varnish</a>, or <a href="https://httpd.apache.org/">Apache</a> with custom rules.
For example, you may choose to only cache zoom 0..10.</li>
<li>You may need to host more than just tiles at a single domain name.</li>
<li>Martin has a fixed public API, but your site may require a different structure, e.g. serving tiles with from a sub-path like <code>/tiles/source/z/x/y</code>.</li>
</ul>
<div style="break-before: page; page-break-before: always;"></div>
<h1 id="nginx"><a href="#nginx" class="header">NGINX</a></h1>
<h2 id="using-with-nginx"><a class="header" href="#using-with-nginx">Using with NGINX</a></h2>
<p>You can run Martin behind NGINX proxy, so you can cache frequently accessed tiles with custom logic.
Here is an example <code>docker-compose.yml</code> file that runs Martin with NGINX and PostgreSQL.</p>
<pre><code class="language-yml">version: '3'

services:
  nginx:
    image: nginx:alpine
    restart: unless-stopped
    ports:
      - "80:80"
    volumes:
      - ./cache:/var/cache/nginx
      - ./nginx.conf:/etc/nginx/nginx.conf:ro
    depends_on:
      - martin

  martin:
    image: maplibre/martin:v0.7.0
    restart: unless-stopped
    environment:
      - DATABASE_URL=postgres://postgres:password@db/db
    depends_on:
      - db

  db:
    image: postgis/postgis:14-3.3-alpine
    restart: unless-stopped
    environment:
      - POSTGRES_DB=db
      - POSTGRES_USER=postgres
      - POSTGRES_PASSWORD=password
    volumes:
      - ./pg_data:/var/lib/postgresql/data
</code></pre>
<p>You can <a href="https://github.com/maplibre/martin/blob/main/demo/frontend/nginx.conf">find an example NGINX configuration file here</a>.</p>
<h3 id="rewriting-urls"><a class="header" href="#rewriting-urls">Rewriting URLs</a></h3>
<p>If you are running Martin behind NGINX proxy, you may want to rewrite the request URL to properly handle tile URLs in <a href="#source-tilejson">TileJSON</a>.</p>
<pre><code class="language-nginx">location ~ /tiles/(?&lt;fwd_path&gt;.*) {
    proxy_set_header  X-Rewrite-URL $uri;
    proxy_set_header  X-Forwarded-Host $host:$server_port;
    proxy_set_header  X-Forwarded-Proto $scheme;
    proxy_redirect    off;

    proxy_pass        http://martin:3000/$fwd_path$is_args$args;
}
</code></pre>
<h3 id="caching-tiles"><a class="header" href="#caching-tiles">Caching tiles</a></h3>
<p>You can also use NGINX to cache tiles. In the example, the maximum cache size is set to 10GB, and caching time is set to 1 hour for responses with codes 200, 204, and 302 and 1 minute for responses with code 404.</p>
<pre><code class="language-nginx">http {
  ...
  proxy_cache_path  /var/cache/nginx/
                    levels=1:2
                    max_size=10g
                    use_temp_path=off
                    keys_zone=tiles_cache:10m;

  server {
    ...
    location ~ /tiles/(?&lt;fwd_path&gt;.*) {
        proxy_set_header        X-Rewrite-URL $uri;
        proxy_set_header        X-Forwarded-Host $host:$server_port;
        proxy_set_header        X-Forwarded-Proto $scheme;
        proxy_redirect          off;

        proxy_cache             tiles_cache;
        proxy_cache_lock        on;
        proxy_cache_revalidate  on;

        # Set caching time for responses
        proxy_cache_valid       200 204 302 1h;
        proxy_cache_valid       404 1m;

        proxy_cache_use_stale   error timeout http_500 http_502 http_503 http_504;
        add_header              X-Cache-Status $upstream_cache_status;

        proxy_pass              http://martin:3000/$fwd_path$is_args$args;
    }
  }
}
</code></pre>
<p>You can <a href="https://github.com/maplibre/martin/blob/main/demo/frontend/nginx.conf">find an example NGINX configuration file here</a>.</p>
<div style="break-before: page; page-break-before: always;"></div>
<h1 id="apache"><a href="#apache" class="header">Apache</a></h1>
<h2 id="using-with-apache"><a class="header" href="#using-with-apache">Using with Apache</a></h2>
<p>You can run Martin behind Apache “kind of” proxy, so you can use HTTPs with it. Here is an example of the configuration file that runs Martin with Apache.</p>
<p>First you have to setup a virtual host that is working on the port 443.</p>
<h3 id="enable-necessary-modules"><a class="header" href="#enable-necessary-modules">Enable necessary modules</a></h3>
<p>Ensure the required modules are enabled:</p>
<pre><code class="language-bash">
sudo a2enmod proxy
sudo a2enmod proxy_http
sudo a2enmod headers
sudo a2enmod rewrite

</code></pre>
<h3 id="modify-your-vhost-configuration"><a class="header" href="#modify-your-vhost-configuration">Modify your VHOST configuration</a></h3>
<p>Open your VHOST configuration file for the domaine you’re using, mydomain.tld :</p>
<pre><code class="language-bash">
sudo nano /etc/apache2/sites-available/mydomain.tld.conf

</code></pre>
<h3 id="update-the-configuration"><a class="header" href="#update-the-configuration">Update the configuration</a></h3>
<pre><code class="language-apache">
&lt;VirtualHost *:443&gt;
    ServerName mydomain.tld
    ServerAdmin webmaster@localhost
    DocumentRoot /var/www/mydomain
    ProxyPreserveHost On

    RewriteEngine on
    RewriteCond %{REQUEST_URI} ^/tiles/(.*)$
    RewriteRule ^/tiles/(.*)$ http://localhost:3000/tiles/$1 [P,L]

    &lt;IfModule mod_headers.c&gt;
        RequestHeader set X-Forwarded-Proto "https"
    &lt;/IfModule&gt;

    ProxyPass / http://localhost:3000/
    ProxyPassReverse / http://localhost:3000/
&lt;/VirtualHost&gt;

</code></pre>
<h3 id="check-configuration--verify-the-apache-configuration-for-syntax-errors"><a class="header" href="#check-configuration--verify-the-apache-configuration-for-syntax-errors">Check Configuration:  Verify the Apache configuration for syntax errors</a></h3>
<pre><code class="language-bash">
sudo apache2ctl configtest

</code></pre>
<h3 id="restart-apache-if-the-configuration-is-correct-restart-apache-to-apply-the-changes"><a class="header" href="#restart-apache-if-the-configuration-is-correct-restart-apache-to-apply-the-changes">Restart Apache: If the configuration is correct, restart Apache to apply the changes</a></h3>
<pre><code class="language-bash">
sudo systemctl restart apache2

</code></pre>
<div style="break-before: page; page-break-before: always;"></div>
<h1 id="troubleshooting-2"><a href="#troubleshooting-2" class="header">Troubleshooting</a></h1>
<h2 id="troubleshooting"><a class="header" href="#troubleshooting">Troubleshooting</a></h2>
<p>Log levels are controlled on a per-module basis, and by default all logging is disabled except for errors.
Logging is controlled via the <code>RUST_LOG</code> environment variable.
The value of this environment variable is a comma-separated list of logging directives.</p>
<p>This will enable debug logging for all modules:</p>
<pre><code class="language-bash">export RUST_LOG=debug
export RUST_LOG_FORMAT=pretty
martin postgres://postgres@localhost/db
</code></pre>
<p>While this will only enable verbose logging for the <code>actix_web</code> module and enable debug logging for the <code>martin</code>
and <code>tokio_postgres</code> modules:</p>
<pre><code class="language-bash">export RUST_LOG=actix_web=info,martin=debug,tokio_postgres=debug
export RUST_LOG_FORMAT=pretty
martin postgres://postgres@localhost/db
</code></pre>
<p>We also allow you to control the format of the logs via the <code>RUST_LOG_FORMAT</code> environment variable.
For troubleshooting, <code>pretty</code> or <code>full</code> are likely the most useful formats.</p>
<div style="break-before: page; page-break-before: always;"></div>
<h1 id="configuration-file"><a class="header" href="#configuration-file">Configuration File</a></h1>
<p>If you don’t want to expose all of your tables and functions, you can list your sources in a configuration file. To
start Martin with a configuration file you need to pass a path to a file with a <code>--config</code> argument. Config files may
contain environment variables, which will be expanded before parsing. For example, to use <code>MY_DATABASE_URL</code> in your
config file: <code>connection_string: ${MY_DATABASE_URL}</code>, or with a
default <code>connection_string: ${MY_DATABASE_URL:-postgres://postgres@localhost/db}</code></p>
<pre><code class="language-bash">martin --config config.yaml
</code></pre>
<p>You may wish to auto-generate a config file with <code>--save-config</code> argument. This will generate a config yaml file with
all of your configuration, which you can edit to remove any sources you don’t want to expose.</p>
<pre><code class="language-bash">martin  ... ... ...  --save-config config.yaml
</code></pre>
<h2 id="config-example"><a class="header" href="#config-example">Config Example</a></h2>
<pre><code class="language-yaml"># Connection keep alive timeout [default: 75]
keep_alive: 75

# The socket address to bind [default: 0.0.0.0:3000]
listen_addresses: "0.0.0.0:3000"

# Set the URL path prefix for all API routes.
# When set, Martin will serve all endpoints under this path prefix.
# This allows Martin to be served under a subpath when behind a reverse proxy (e.g., Traefik).
# Must begin with a `/`.
# Examples: `/tiles`, `/api/v1/tiles`
route_prefix: null

# Set TileJSON URL path prefix.
# This overrides the default path prefix for URLs in TileJSON responses.
# If both `route_prefix` and `base_path` are set, `base_path` takes priority for TileJSON URLs.
# If neither is set, the X-Rewrite-URL header is respected.
# Must begin with a `/`.
# Examples: `/`, `/tiles`
base_path: null

# Number of web server workers
worker_processes: 8

# Amount of memory (in MB) to use for caching [default: 512, 0 to disable]
#
# This is the total amount of cache we use.
# By default, this is split up between:
# - Tiles 50% -&gt; 256 MB
# - Pmtiles' directories 25% -&gt; 128 MB
# - Fonts 12.5% -&gt; 64 MB
# - Sprites 12.5% -&gt; 64 MB
#
# How the cache works internally is unstable and may change to improve performance/efficiency.
# For example, we may change the split between sources to improve efficiency.
#
# Specify each cache size individually for finer cache size control:
# - Tiles: `tile_cache_size_mb`
# - Pmtiles: `pmtiles.directory_cache_size_mb`
# - Fonts: `fonts.cache_size_mb`
# - Sprites: `sprites.cache_size_mb`
cache_size_mb: 512

# Allows overriding the size of the tile cache.
# Defaults to `cache_size_mb` / 2
tile_cache_size_mb: 256

# Which compression should be used if the
# - client accepts multiple compression formats, and
# - tile source is not pre-compressed.
#
# `gzip` is faster, but `brotli` is smaller, and may be faster with caching.
# Default could be different depending on Martin version.
preferred_encoding: gzip

# Enable or disable Martin web UI. [default: disable]
#
# At the moment, only allows `enable-for-all`, which enables the web UI for all connections.
# This may be undesirable in a production environment
web_ui: disable

# The policy for handling invalid sources during startup. [default: abort]
#
# Invalid sources are those that are missing (file not found, table doesn't exist, ...),
# reference columns that don't exist, and so on.
# Currently limited to tile sources; broader rollout is planned.
#
# Options:
# - `warn`: log warning messages
# - `abort`: log warnings as error messages, abort startup
on_invalid: abort

# Advanced monitoring options
observability:
  # Configure metrics reported under `/_/metrics`
  metrics:
    # Add these labels to every metric
    # Example: `{ env: prod, server: martin }`
    add_labels: {}

# CORS Configuration
#
# Defaults to `cors: true`, which allows all origins.
# Sending/Acting on CORS headers can be completely disabled via `cors: false`
cors:
  # Sets the `Access-Control-Allow-Origin` header [default: *]
  # '*' will use the requests `ORIGIN` header
  origin:
    - https://example.org
  # Sets `Access-Control-Max-Age` Header. [default: null]
  # null means not setting the header for preflight requests
  max_age: 3600

# Database configuration. This can also be a list of PG configs.
postgres:
  # Database connection string.
  #
  # You can use environment variables too, for example:
  # connection_string: $DATABASE_URL
  # connection_string: ${DATABASE_URL:-postgres://postgres@localhost/db}
  connection_string: "postgres://postgres@localhost:5432/db"

  # Same as PGSSLCERT for psql
  ssl_cert: "./postgresql.crt"
  # Same as PGSSLKEY for psql
  ssl_key: "./postgresql.key"
  # Same as PGSSLROOTCERT for psql
  ssl_root_cert: "./root.crt"

  # If a spatial table has SRID 0, then this SRID will be used as a fallback
  default_srid: 4326

  # Maximum Postgres connections pool size [default: 20]
  pool_size: 20

  # Limit the number of geo features per tile.
  #
  # If the source table has more features than set here, they will not be
  # included in the tile and the result will look "cut off"/incomplete.
  # This feature allows you to put a maximum latency bound on tiles with an
  # extreme amount of detail at the cost of not returning all data.
  # It is sensible to set this limit if you have user generated/untrusted
  # geodata, e.g. a lot of data points at [Null Island]
  # (https://en.wikipedia.org/wiki/Null_Island).
  max_feature_count: null # either a positive integer, or null=unlimited (default)

  # Specify how bounds should be computed for the spatial PG tables [default: quick]
  #
  # Options:
  # - `calc` compute table geometry bounds on startup.
  # - `quick` same as 'calc', but the calculation will be aborted after 5 seconds.
  # - `skip` does not compute table geometry bounds on startup.
  auto_bounds: quick

  # Enable automatic discovery of tables and functions. [default: null]
  #
  # Options:
  # - `true`: run automatic discovery (`true` may be omitted if further configuration is provided)
  # - `false`: disable automatic discovery
  # - null: run automatic discovery if postgres.tables is null and postgres.functions is null
  auto_publish:
    # Optionally limit to just these schemas
    from_schemas:
      - public
      - my_schema
    # Here we enable both tables and functions auto discovery.
    # You can also enable just one of them by not mentioning the other, or
    # setting it to false. Setting one to true disables the other one as well.
    # E.g. `tables: false` enables just the functions auto-discovery.
    tables:
      # Optionally set how source ID should be generated based on the table's name,
      # schema, and geometry column
      source_id_format: "table.{schema}.{table}.{column}"
      # Add more schemas to the ones listed above
      from_schemas: my_other_schema
      # A table column to use as the feature ID
      # If a table has no column with this name, `id_column` will not be set for
      # that table.
      # If a list of strings is given, the first found column will be treated as a
      # feature ID.
      id_columns: feature_id
      # Controls if geometries should be clipped or encoded as is [default: true]
      clip_geom: true
      # Buffer distance in tile coordinate space to optionally clip geometries,
      # optional, default to 64
      buffer: 64
      # Tile extent in tile coordinate space, optional, default to 4096
      extent: 4096
    functions:
      # Optionally limit to just these schemas
      from_schemas:
        - public
        - my_schema
      # Optionally set how source ID should be generated based on the function's
      # name and schema
      source_id_format: "{schema}.{function}"

  # Associative arrays of table sources
  tables:
    table_source_id:
      # ID of the MVT layer (optional, defaults to table name)
      layer_id: table_source

      # Table schema (required)
      schema: public

      # Table name (required)
      table: table_source

      # Geometry SRID (required)
      srid: 4326

      # Geometry column name (required)
      geometry_column: geom

      # Feature id column name
      id_column: ~

      # An integer specifying the minimum zoom level
      minzoom: 0

      # An integer specifying the maximum zoom level. MUST be &gt;= minzoom
      maxzoom: 30

      # The maximum extent of available map tiles. Bounds MUST define an area
      # covered by all zoom levels. The bounds are represented in WGS:84 latitude
      # and longitude values, in the order left, bottom, right, top. Values may
      # be integers or floating point numbers.
      bounds: [-180.0, -90.0, 180.0, 90.0]

      # Tile extent in tile coordinate space
      extent: 4096

      # Buffer distance in tile coordinate space to optionally clip geometries
      buffer: 64

      # Boolean to control if geometries should be clipped or encoded as is
      clip_geom: true

      # Geometry type
      geometry_type: GEOMETRY

      # List of columns, that should be encoded as tile properties (required)
      #
      # Keys and values are the names and descriptions of attributes available in this layer.
      # Each value (description) must be a string that describes the underlying data.
      # If no fields (=just the geometry) should be encoded, an empty object is allowed.
      properties:
        gid: int4

  # Associative arrays of function sources
  functions:
    function_source_id:
      # Schema name (required)
      schema: public

      # Function name (required)
      function: function_zxy_query

      # An integer specifying the minimum zoom level
      minzoom: 0

      # An integer specifying the maximum zoom level. MUST be &gt;= minzoom
      maxzoom: 30

      # The maximum extent of available map tiles. Bounds MUST define an area
      # covered by all zoom levels. The bounds are represented in WGS:84
      # latitude and longitude values, in the order left, bottom, right, top.
      # Values may be integers or floating point numbers.
      bounds: [-180.0, -90.0, 180.0, 90.0]

# Publish PMTiles files from local disk or proxy to a web server
pmtiles:
  # Size of the directory cache (in MB).
  # Defaults to cache_size_mb / 4
  #
  # Note:
  # Tile and directory caching are complementary.
  # For good performance, you want
  # - directory caching (to not resolve the directory on each request) and
  # - tile caching (for high access tiles)
  directory_cache_size_mb: 128

  # You can pass options for pmtiles files located on remote storages here.
  #
  # The avaliable options are documented here:
  # - local file sources don't have options
  # - Http(s) Source: https://docs.rs/object_store/latest/object_store/http/struct.HttpBuilder.html
  # - Amazon S3: https://docs.rs/object_store/latest/object_store/aws/struct.AmazonS3Builder.html
  # - Google Cloud Storage: https://docs.rs/object_store/latest/object_store/gcp/struct.GoogleCloudStorageBuilder.html
  # - Microsoft Azure: https://docs.rs/object_store/latest/object_store/azure/struct.MicrosoftAzureBuilder.html
  #
  # Example for configuring a source to allow http
  allow_http: true

  paths:
    # scan this whole dir, matching all *.pmtiles files
    - /dir-path
    # specific pmtiles file will be published as a pmt source (filename without extension)
    - /path/to/pmt.pmtiles
    # A web server with a PMTiles file that supports range requests
    - https://example.org/path/tiles.pmtiles
  sources:
    # named source matching source name to a single file
    pm-src1: /path/to/pmt.pmtiles
    # A named source to a web server with a PMTiles file that supports range requests
    pm-web2: https://example.org/path/tiles.pmtiles

# Publish MBTiles files
mbtiles:
  paths:
    # scan this whole dir, matching all *.mbtiles files
    - /dir-path
    # specific mbtiles file will be published as mbtiles2 source
    - /path/to/mbtiles.mbtiles
  sources:
    # named source matching source name to a single file
    mb-src1: /path/to/mbtiles1.mbtiles

# Sprite configuration
sprites:
  # Size of the sprite cache (in MB).
  # Defaults to cache_size_mb / 8
  cache_size_mb: 64

  paths:
    # all SVG files in this dir will be published as a "my_images" sprite source
    - /path/to/my_images
  sources:
    # SVG images in this directory will be published as a "my_sprites" sprite source
    my_sprites: /path/to/some_dir

# Font configuration
fonts:
  # Size of the sprite cache (in MB).
  # Defaults to cache_size_mb / 4
  cache_size_mb: 64

  # A list of *.otf, *.ttf, and *.ttc font files and dirs to search recursively.
  paths:
    - /path/to/font/file.ttf
    - /path/to/font_dir

# Publish MapLibre style files
# In the future, the style files will be used for the server-side rendering as well
styles:
  paths:
    # publish all *.json files in this directory
    # The name of the file will be used as the style name
    - /path/to/styles_dir
    # publish a single file - here `maplibre_style` will be the style name
    - /path/to/maplibre_style.json
  sources:
    # publish a JSON file found at this path as `some_style_name`
    #
    # Contrairy to paths, if directories are specified, Martin will print a
    # warning and ignore them.
    # To serve a style-directory, use the `paths` section above or name each
    # style individually. This prevents footguns with names being unclear.
    some_style_name: /path/to/this/style.json
    #  Publish specific file as `other_style_name`
    other_style_name: /path/to/other_style.json

# If set, the version of the tileset (as specified in the MBTiles or PMTiles metadata)
# will be embedded in the TileJSON `tiles` URL, with the set identifier.
# This is useful to give clients a better way to cache-bust a CDN:
# 1. maplibre requests tilejson, tilejson contains the tiles URL. This is always up-to-date.
# 2. maplibre requests each tile it requires, with the tiles URL in the tilejson.
# 3. Add `Control: public, max-age=..., immutable` on the tile responses
#    optimize browser/CDN cache hit rates, while also making sure that
#    old tiles aren't served when a new tileset is deployed.
#
# The CDN must handle query parameters for caching to work correctly.
# Many CDNs ignore them by default.
#
# For example, if
# - the setting here is `version`, and
# - the PMTiles tileset version is `1.0.0`, the
# TileJSON will be:
# { ..., "tiles": [".../{z}/{x}/{y}?version=1.0.0"], ... }
tilejson_url_version_param: null # a string, such as `version` or `v`
</code></pre>
<div style="break-before: page; page-break-before: always;"></div>
<h1 id="tile-sources"><a class="header" href="#tile-sources">Tile Sources</a></h1>
<p>Martin supports multiple tile sources</p>
<ul>
<li><a href="#mbtiles-and-pmtiles-file-sources-1">MBTiles Sources</a> Local Sqlite database containing pre-generated vector or raster tiles.</li>
<li><a href="#mbtiles-and-pmtiles-file-sources-1">PMTiles Sources</a> A local file or a web-accessible HTTP source with the pre-generated raster or vector tiles.</li>
<li><a href="#postgresql-connections-1">PostgreSQL Connections</a> with
<ul>
<li><a href="#postgresql-table-sources">Table Sources</a></li>
<li><a href="#postgresql-function-sources-1">Function Sources</a></li>
</ul>
</li>
</ul>
<p>The difference between tile archives (<em><a href="#mbtiles-and-pmtiles-file-sources-1">MBTiles/PMTiles</a></em>) and a database (<a href="#postgresql-table-sources">PG-Table</a>/<a href="#postgresql-function-sources-1">PG-Function</a>) is that</p>
<ul>
<li><strong>database</strong> are more flexible and may (depending on how you fill it) be updated in <strong>real-time</strong>.</li>
<li><strong>Tile archives</strong> on the other hand may (depending on the data) be more <strong>compact, memory efficient and exhibit better performance</strong> for tile-serving.</li>
</ul>
<p>=&gt; For most usecases, you may want a mix of both. We support this via <a href="#composite-sources-1">Composite Sources</a>
=&gt; For some usecases, you want the flexibility of a database, but you don’t want to pay the runtime-price. We offer the <a href="#generating-tiles-in-bulk"><code>martin-cp</code></a> utility to render all tiles into a tile archive. This can also be used to provide offline maps via <a href="#diffing-mbtiles">diffing and syncing <code>mbtiles</code></a></p>
<p>The difference between MBTiles and PMTiles is that:</p>
<ul>
<li><strong>MBTiles</strong> require the entire archive to be on the same machine. <strong>PMTiles</strong> can utilise a remote HTTP-Range request supporting server or a local file.</li>
<li>Performance wise, <strong>MBTiles</strong> is slightly faster than <strong>PMTiles</strong>, but with caching this is negligible.</li>
<li>Disk size wise, <strong>MBTiles</strong> is slightly (10-15%) higher than <strong>PMTiles</strong>.</li>
<li><strong>PMTiles</strong> requires less memory in extreme cases as sqlite has a small in-memory cache.</li>
</ul>
<p>The choice depends on your specific usecase and requirements.</p>
<div style="break-before: page; page-break-before: always;"></div>
<h1 id="mbtiles-and-pmtiles-file-sources-1"><a href="#mbtiles-and-pmtiles-file-sources-1" class="header">MBTiles and PMTiles File Sources</a></h1>
<h2 id="mbtiles-and-pmtiles-file-sources"><a class="header" href="#mbtiles-and-pmtiles-file-sources">MBTiles and PMTiles File Sources</a></h2>
<p>Martin can serve any type of tiles from <a href="https://protomaps.com/blog/pmtiles-v3-whats-new">PMTile</a>
and <a href="https://github.com/mapbox/mbtiles-spec">MBTile</a> files. To serve a file from CLI, simply put the path to the file or
the directory with <code>*.mbtiles</code> or <code>*.pmtiles</code> files. A path to PMTiles file may be a URL. For example:</p>
<pre><code class="language-bash">martin  /path/to/mbtiles/file.mbtiles  /path/to/directory   https://example.org/path/tiles.pmtiles
</code></pre>
<p>You may also want to generate a <a href="#configuration-file">config file</a> using the <code>--save-config my-config.yaml</code>, and later edit
it and use it with <code>--config my-config.yaml</code> option.</p>
<blockquote class="blockquote-tag blockquote-tag-tip">
<p class="blockquote-tag-title"><svg viewbox="0 0 16 16" width="18" height="18"><path d="M8 1.5c-2.363 0-4 1.69-4 3.75 0 .984.424 1.625.984 2.304l.214.253c.223.264.47.556.673.848.284.411.537.896.621 1.49a.75.75 0 0 1-1.484.211c-.04-.282-.163-.547-.37-.847a8.456 8.456 0 0 0-.542-.68c-.084-.1-.173-.205-.268-.32C3.201 7.75 2.5 6.766 2.5 5.25 2.5 2.31 4.863 0 8 0s5.5 2.31 5.5 5.25c0 1.516-.701 2.5-1.328 3.259-.095.115-.184.22-.268.319-.207.245-.383.453-.541.681-.208.3-.33.565-.37.847a.751.751 0 0 1-1.485-.212c.084-.593.337-1.078.621-1.489.203-.292.45-.584.673-.848.075-.088.147-.173.213-.253.561-.679.985-1.32.985-2.304 0-2.06-1.637-3.75-4-3.75ZM5.75 12h4.5a.75.75 0 0 1 0 1.5h-4.5a.75.75 0 0 1 0-1.5ZM6 15.25a.75.75 0 0 1 .75-.75h2.5a.75.75 0 0 1 0 1.5h-2.5a.75.75 0 0 1-.75-.75Z"></path></svg>Tip</p>
<p>See <a href="#tile-sources">our tile sources explanation</a> for a more detailed explanation on the difference between our available data sources.</p>
</blockquote>
<h3 id="autodiscovery"><a class="header" href="#autodiscovery">Autodiscovery</a></h3>
<p>For mbtiles or local pmtiles files, we support auto discovering at startup.
This means that the following will discover all mbtiles and pmtiles files in the directory:</p>
<pre><code class="language-bash">martin  /path/to/directory
</code></pre>
<blockquote class="blockquote-tag blockquote-tag-warning">
<p class="blockquote-tag-title"><svg viewbox="0 0 16 16" width="18" height="18"><path d="M6.457 1.047c.659-1.234 2.427-1.234 3.086 0l6.082 11.378A1.75 1.75 0 0 1 14.082 15H1.918a1.75 1.75 0 0 1-1.543-2.575Zm1.763.707a.25.25 0 0 0-.44 0L1.698 13.132a.25.25 0 0 0 .22.368h12.164a.25.25 0 0 0 .22-.368Zm.53 3.996v2.5a.75.75 0 0 1-1.5 0v-2.5a.75.75 0 0 1 1.5 0ZM9 11a1 1 0 1 1-2 0 1 1 0 0 1 2 0Z"></path></svg>Warning</p>
<p>For remote PMTiles, we don’t currently support auto-discovery.
If you want to implement this feature, please see <a href="https://github.com/maplibre/martin/issues/2180">https://github.com/maplibre/martin/issues/2180</a></p>
<p>We also don’t currently support refreshing the catalog at runtime.
If you want to implement this feature, please see <a href="https://github.com/maplibre/martin/issues/288">https://github.com/maplibre/martin/issues/288</a> instead.</p>
</blockquote>
<h3 id="serving-pmtiles-from-local-file-systems-http-or-object-storage"><a class="header" href="#serving-pmtiles-from-local-file-systems-http-or-object-storage">Serving PMTiles from local file systems, http or Object Storage</a></h3>
<p>The settings avaliable for a PMTiles source depend on the backend:</p>
<div class="mdbook-tabs-container">
<nav class="mdbook-tabs">
<button class="mdbook-tab active" data-tabname="local file system">local file system</button>
<button class="mdbook-tab" data-tabname="Http(s)">Http(s)</button>
<button class="mdbook-tab" data-tabname="Amazon S3">Amazon S3</button>
<button class="mdbook-tab" data-tabname="Google Cloud Storage">Google Cloud Storage</button>
<button class="mdbook-tab" data-tabname="Microsoft Azure">Microsoft Azure</button>
</nav>
<div class="mdbook-tab-content" data-tabname="local file system">
<p>For local sources, you need to provide the path or URL.
For example:</p>
<pre><code class="language-bash">martin  path/to/tiles.pmtiles
</code></pre>
<p>The available schemes are:</p>
<ul>
<li><code>file:///path/to/my/file.pmtiles</code></li>
<li><code>path/to/my/file.pmtiles</code></li>
</ul>
<p>You can also configure this via the configuration file:</p>
<pre><code class="language-yaml">pmtiles:
  sources:
    tiles: file:///path/to/my/file.pmtiles
</code></pre>
</div>

<div class="mdbook-tab-content hidden" data-tabname="Http(s)">
<p>For HTTP(s), you need to provide the url.
For example:</p>
<pre><code class="language-bash">martin  https://example.com/tiles.pmtiles
</code></pre>
<p>The available url schemes are:</p>
<ul>
<li><code>http://example.com/path.pmtiles</code></li>
<li><code>https://example.com/path.pmtiles</code></li>
</ul>
<p>If you want more control over your requests, you can configure additional options here as such:</p>
<pre><code class="language-yaml">pmtiles:
  allow_http: true
  sources:
    tiles: s3://bucket/path/to/tiles.pmtiles
</code></pre>
<h3 id="available-http-client-settings"><a class="header" href="#available-http-client-settings">Available http client settings</a></h3>
<h4 id="security-options"><a class="header" href="#security-options">Security options</a></h4>
<div class="table-wrapper">
<table>
<thead>
<tr><th>configuration</th><th>description</th><th>example</th></tr>
</thead>
<tbody>
<tr><td><code>allow_http</code></td><td>Allow non-TLS, i.e. non-HTTPS connections<br><br><strong>Security warning:</strong><br>If you enable this option, attackers may be able to read the data you request</td><td><code>true</code></td></tr>
<tr><td><code>allow_invalid_certificates</code></td><td>Skip certificate validation on https connections<br><br><strong>Security warning:</strong><br>You should think very carefully before using this method. If invalid certificates are trusted, any certificate for any site will be trusted for use. This includes expired certificates. This introduces significant vulnerabilities, and should only be used as a last resort or for testing</td><td><code>true</code></td></tr>
</tbody>
</table>
</div>
<h4 id="connection-options"><a class="header" href="#connection-options">Connection options</a></h4>
<div class="table-wrapper">
<table>
<thead>
<tr><th>configuration</th><th>description</th><th>example</th></tr>
</thead>
<tbody>
<tr><td><code>user_agent</code></td><td>User-Agent header to be used by this client</td><td><code>martin 1.0.0</code></td></tr>
<tr><td><code>randomize_addresses</code></td><td>Randomize order addresses that the DNS resolution yields.<br>This will spread the connections across more servers.</td><td><code>true</code></td></tr>
<tr><td><code>connect_timeout</code></td><td>Timeout for only the connect phase of a Client</td><td><code>5s</code></td></tr>
<tr><td><code>timeout</code></td><td>The timeout is applied from when the request starts connecting until the response body has finished</td><td><code>10s</code></td></tr>
<tr><td><code>pool_idle_timeout</code></td><td>The pool max idle timeout</td><td><code>5m</code></td></tr>
<tr><td><code>pool_max_idle_per_host</code></td><td>maximum number of idle connections per host</td><td><code>10</code></td></tr>
<tr><td><code>http1_only</code></td><td>Only use http1 connections</td><td><code>false</code></td></tr>
<tr><td><code>http2_only</code></td><td>Only use http2 connections</td><td><code>false</code></td></tr>
<tr><td><code>http2_keep_alive_interval</code></td><td>Interval for HTTP2 Ping frames should be sent to keep a connection alive.</td><td><code>15s</code></td></tr>
<tr><td><code>http2_keep_alive_timeout</code></td><td>Timeout for receiving an acknowledgement of the keep-alive ping.</td><td><code>15s</code></td></tr>
<tr><td><code>http2_keep_alive_while_idle</code></td><td>Enable HTTP2 keep alive pings for idle connections</td><td><code>true</code></td></tr>
<tr><td><code>http2_max_frame_size</code></td><td>Sets the maximum frame size to use for HTTP2.</td><td></td></tr>
</tbody>
</table>
</div>
<h4 id="proxy-settings"><a class="header" href="#proxy-settings">Proxy settings</a></h4>
<div class="table-wrapper">
<table>
<thead>
<tr><th>configuration</th><th>description</th><th>example</th></tr>
</thead>
<tbody>
<tr><td><code>proxy_url</code></td><td>HTTP proxy to use for requests</td><td><code>http://proxy.example.com:8080</code></td></tr>
<tr><td><code>proxy_ca_certificate</code></td><td>PEM-formatted CA certificate for proxy connections</td><td><code>-----BEGIN CERTIFICATE-----</code><br>…<br><code>-----END CERTIFICATE-----</code></td></tr>
<tr><td><code>proxy_excludes</code></td><td>List of hosts that bypass proxy</td><td><code>example.com</code>, <code>maplibre.org</code></td></tr>
</tbody>
</table>
</div>
</div>

<div class="mdbook-tab-content hidden" data-tabname="Amazon S3">
<blockquote class="blockquote-tag blockquote-tag-important">
<p class="blockquote-tag-title"><svg viewbox="0 0 16 16" width="18" height="18"><path d="M0 1.75C0 .784.784 0 1.75 0h12.5C15.216 0 16 .784 16 1.75v9.5A1.75 1.75 0 0 1 14.25 13H8.06l-2.573 2.573A1.458 1.458 0 0 1 3 14.543V13H1.75A1.75 1.75 0 0 1 0 11.25Zm1.75-.25a.25.25 0 0 0-.25.25v9.5c0 .138.112.25.25.25h2a.75.75 0 0 1 .75.75v2.19l2.72-2.72a.749.749 0 0 1 .53-.22h6.5a.25.25 0 0 0 .25-.25v-9.5a.25.25 0 0 0-.25-.25Zm7 2.25v2.5a.75.75 0 0 1-1.5 0v-2.5a.75.75 0 0 1 1.5 0ZM9 9a1 1 0 1 1-2 0 1 1 0 0 1 2 0Z"></path></svg>Important</p>
<p>Even though we name this section <code>Amazon S3</code>, it also works with other providers that support the S3 API, such as <a href="https://www.min.io/">MinIO</a>, <a href="https://docs.ceph.com/en/latest/radosgw/s3/">Ceph</a>, <a href="https://developers.cloudflare.com/r2/">Cloudflare R2</a>, <a href="https://www.hetzner.com/de/storage/object-storage/">hetzner object storage</a> and many more.</p>
</blockquote>
<p>For AWS, you need to provide the bucket name and the prefix of the object key.
For example:</p>
<pre><code class="language-bash">martin  s3://my-bucket/tiles.pmtiles
</code></pre>
<p>The available url schemes are:</p>
<ul>
<li><code>s3://&lt;bucket&gt;/&lt;path&gt;</code></li>
<li><code>s3a://&lt;bucket&gt;/&lt;path&gt;</code></li>
<li><code>https://s3.&lt;region&gt;.amazonaws.com/&lt;bucket&gt;</code></li>
<li><code>https://&lt;bucket&gt;.s3.&lt;region&gt;.amazonaws.com</code></li>
<li><code>https://ACCOUNT_ID.r2.cloudflarestorage.com/bucket</code></li>
</ul>
<p>If you want more control over your requests, you can configure additional options here as such:</p>
<pre><code class="language-yaml">pmtiles:
  allow_http: true
  sources:
    tiles: s3://bucket/path/to/tiles.pmtiles
</code></pre>
<blockquote class="blockquote-tag blockquote-tag-tip">
<p class="blockquote-tag-title"><svg viewbox="0 0 16 16" width="18" height="18"><path d="M8 1.5c-2.363 0-4 1.69-4 3.75 0 .984.424 1.625.984 2.304l.214.253c.223.264.47.556.673.848.284.411.537.896.621 1.49a.75.75 0 0 1-1.484.211c-.04-.282-.163-.547-.37-.847a8.456 8.456 0 0 0-.542-.68c-.084-.1-.173-.205-.268-.32C3.201 7.75 2.5 6.766 2.5 5.25 2.5 2.31 4.863 0 8 0s5.5 2.31 5.5 5.25c0 1.516-.701 2.5-1.328 3.259-.095.115-.184.22-.268.319-.207.245-.383.453-.541.681-.208.3-.33.565-.37.847a.751.751 0 0 1-1.485-.212c.084-.593.337-1.078.621-1.489.203-.292.45-.584.673-.848.075-.088.147-.173.213-.253.561-.679.985-1.32.985-2.304 0-2.06-1.637-3.75-4-3.75ZM5.75 12h4.5a.75.75 0 0 1 0 1.5h-4.5a.75.75 0 0 1 0-1.5ZM6 15.25a.75.75 0 0 1 .75-.75h2.5a.75.75 0 0 1 0 1.5h-2.5a.75.75 0 0 1-.75-.75Z"></path></svg>Tip</p>
<p>All settings are also available under the <code>aws_</code> prefix.
This can be useful if you want to have different cloud providers.</p>
</blockquote>
<h3 id="available-aws-s3-settings"><a class="header" href="#available-aws-s3-settings">Available AWS S3 settings</a></h3>
<h4 id="aws-specific-authentication--credentials"><a class="header" href="#aws-specific-authentication--credentials">AWS specific Authentication &amp; Credentials</a></h4>
<div class="table-wrapper">
<table>
<thead>
<tr><th>configuration</th><th>description</th><th>example</th></tr>
</thead>
<tbody>
<tr><td><code>access_key_id</code></td><td>AWS Access Key</td><td><code>AKIAIOSFODNN7EXAMPLE</code></td></tr>
<tr><td><code>secret_access_key</code></td><td>Secret Access Key</td><td><code>wJalrXUtnFEMI/K7MDENG/bPxRfiCYEXAMPLEKEY</code></td></tr>
<tr><td><code>session_token</code><br><code>token</code></td><td>AWS session token used for temporary credentials</td><td><code>IQoJb3JpZ2luX2VjEOr...</code></td></tr>
<tr><td><code>web_identity_token_file</code></td><td>Web identity token file path for AssumeRoleWithWebIdentity</td><td><code>/var/run/secrets/eks.amazonaws.com/serviceaccount/token</code></td></tr>
<tr><td><code>role_arn</code></td><td>Role ARN to assume with web identity token</td><td><code>arn:aws:iam::123456789012:role/MyWebIdentityRole</code></td></tr>
<tr><td><code>role_session_name</code></td><td>Session name for web identity assumption</td><td><code>my-session</code></td></tr>
<tr><td><code>endpoint_url_sts</code></td><td>Custom STS endpoint for web identity token exchange</td><td><code>https://sts.amazonaws.com</code></td></tr>
</tbody>
</table>
</div>
<h4 id="aws-specific-connection--endpoint-configuration"><a class="header" href="#aws-specific-connection--endpoint-configuration">AWS specific Connection &amp; Endpoint Configuration</a></h4>
<div class="table-wrapper">
<table>
<thead>
<tr><th>configuration</th><th>description</th><th>example</th></tr>
</thead>
<tbody>
<tr><td><code>region</code></td><td>AWS region<br>Defaults to <code>us-east-1</code></td><td><code>us-west-2</code></td></tr>
<tr><td><code>bucket</code><br><code>bucket_name</code></td><td>Bucket name</td><td><code>my-app-bucket</code></td></tr>
<tr><td><code>endpoint</code><br><code>endpoint_url</code></td><td>Custom S3 endpoint<br>Defaults to regional endpoint<br>Ensure consistency with <code>virtual_hosted_style_request</code><br>By default, <strong>only HTTPS schemes are enabled</strong>; enabling HTTP can expose sensitive data<br>Local testing example: <code>"http://localhost:4566"</code></td><td><code>https://s3.us-west-2.amazonaws.com</code></td></tr>
<tr><td><code>metadata_endpoint</code></td><td>Instance metadata endpoint (IPv4 default <code>http://169.254.169.254</code>)<br>IPv6 alternative: <code>http://fd00:ec2::254</code></td><td><code>http://169.254.169.254</code></td></tr>
<tr><td><code>container_credentials_relative_uri</code></td><td>ECS container credentials relative URI</td><td><code>/v2/credentials/12345678-1234-1234-1234-123456789012</code></td></tr>
<tr><td><code>container_credentials_full_uri</code></td><td>EKS container credentials full URI</td><td><code>http://169.254.170.2/v2/credentials/abc123</code></td></tr>
<tr><td><code>container_authorization_token_file</code></td><td>Authorization token file for EKS container creds</td><td><code>/var/run/secrets/eks.amazonaws.com/serviceaccount/token</code></td></tr>
</tbody>
</table>
</div>
<h4 id="aws-specific-request-behavior--fallbacks"><a class="header" href="#aws-specific-request-behavior--fallbacks">AWS specific Request Behavior &amp; Fallbacks</a></h4>
<div class="table-wrapper">
<table>
<thead>
<tr><th>configuration</th><th>description</th><th>example</th></tr>
</thead>
<tbody>
<tr><td><code>imdsv1_fallback</code></td><td>Fall back to IMDSv1 if IMDSv2 is <strong>not supported</strong> (useful for older kube2iam deployments)<br><strong>Security note:</strong> AWS recommends IMDSv2 only; IMDSv1 is vulnerable to <a href="https://aws.amazon.com/blogs/security/defense-in-depth-open-firewalls-reverse-proxies-ssrf-vulnerabilities-ec2-instance-metadata-service/">SSRF attacks</a><br>Has no effect if not using instance credentials</td><td><code>true</code></td></tr>
<tr><td><code>virtual_hosted_style_request</code></td><td>Use virtual-hosted-style requests instead of path-style<br>Endpoint must match the style<br>Ensures correct bucket addressing for security and routing</td><td><code>true</code></td></tr>
<tr><td><code>skip_signature</code></td><td>Skip signing request<br><strong>Security warning:</strong> Unsigned requests may expose credentials or allow tampering if endpoint is public</td><td><code>true</code></td></tr>
<tr><td><code>unsigned_payload</code></td><td>Use unsigned payload option (<code>UNSIGNED-PAYLOAD</code>) instead of signed<br><strong>Impact:</strong> Checksums for request body are not computed in canonical requests, which can reduce integrity guarantees<br>Default is signed payload with checksum</td><td><code>true</code></td></tr>
<tr><td><code>disable_tagging</code></td><td>Disable tagging objects (useful if unsupported by backend)</td><td><code>true</code></td></tr>
<tr><td><code>s3_express</code></td><td>Enable S3 Express One Zone</td><td><code>true</code></td></tr>
<tr><td><code>request_payer</code></td><td>Enable S3 Requester Pays</td><td><code>true</code></td></tr>
</tbody>
</table>
</div>
<h4 id="aws-specific-object-integrity--encryption"><a class="header" href="#aws-specific-object-integrity--encryption">AWS Specific Object Integrity &amp; Encryption</a></h4>
<div class="table-wrapper">
<table>
<thead>
<tr><th>configuration</th><th>description</th><th>example</th></tr>
</thead>
<tbody>
<tr><td><code>checksum</code></td><td>Checksum algorithm for uploads</td><td><code>SHA256</code></td></tr>
<tr><td><code>server_side_encryption</code></td><td>Type of server-side encryption:<br><code>AES256</code> (SSE-S3)<br><code>aws:kms</code> (SSE-KMS)<br><code>aws:kms:dsse</code> (DSSE-KMS)<br><code>sse-c</code></td><td><code>AES256</code></td></tr>
<tr><td><code>kms_key_id</code></td><td>KMS Key ID for SSE-KMS or DSSE-KMS</td><td><code>arn:aws:kms:us-east-1:123456789012:key/abcd-1234-efgh-5678</code></td></tr>
<tr><td><code>bucket_key_enabled</code></td><td>Use bucket’s default KMS key (<code>true</code>/<code>false</code>)</td><td><code>true</code></td></tr>
<tr><td><code>customer_encryption_key</code></td><td>Base64-encoded 256-bit key for SSE-C</td><td><code>MDEyMzQ1Njc4OUFCQ0RFRjAxMjM0NTY3ODlBQkNERUY=</code></td></tr>
</tbody>
</table>
</div>
<h4 id="security-options-1"><a class="header" href="#security-options-1">Security options</a></h4>
<div class="table-wrapper">
<table>
<thead>
<tr><th>configuration</th><th>description</th><th>example</th></tr>
</thead>
<tbody>
<tr><td><code>allow_http</code></td><td>Allow non-TLS, i.e. non-HTTPS connections<br><br><strong>Security warning:</strong><br>If you enable this option, attackers may be able to read the data you request</td><td><code>true</code></td></tr>
<tr><td><code>allow_invalid_certificates</code></td><td>Skip certificate validation on https connections<br><br><strong>Security warning:</strong><br>You should think very carefully before using this method. If invalid certificates are trusted, any certificate for any site will be trusted for use. This includes expired certificates. This introduces significant vulnerabilities, and should only be used as a last resort or for testing</td><td><code>true</code></td></tr>
</tbody>
</table>
</div>
<h4 id="connection-options-1"><a class="header" href="#connection-options-1">Connection options</a></h4>
<div class="table-wrapper">
<table>
<thead>
<tr><th>configuration</th><th>description</th><th>example</th></tr>
</thead>
<tbody>
<tr><td><code>user_agent</code></td><td>User-Agent header to be used by this client</td><td><code>martin 1.0.0</code></td></tr>
<tr><td><code>randomize_addresses</code></td><td>Randomize order addresses that the DNS resolution yields.<br>This will spread the connections across more servers.</td><td><code>true</code></td></tr>
<tr><td><code>connect_timeout</code></td><td>Timeout for only the connect phase of a Client</td><td><code>5s</code></td></tr>
<tr><td><code>timeout</code></td><td>The timeout is applied from when the request starts connecting until the response body has finished</td><td><code>10s</code></td></tr>
<tr><td><code>pool_idle_timeout</code></td><td>The pool max idle timeout</td><td><code>5m</code></td></tr>
<tr><td><code>pool_max_idle_per_host</code></td><td>maximum number of idle connections per host</td><td><code>10</code></td></tr>
<tr><td><code>http1_only</code></td><td>Only use http1 connections</td><td><code>false</code></td></tr>
<tr><td><code>http2_only</code></td><td>Only use http2 connections</td><td><code>false</code></td></tr>
<tr><td><code>http2_keep_alive_interval</code></td><td>Interval for HTTP2 Ping frames should be sent to keep a connection alive.</td><td><code>15s</code></td></tr>
<tr><td><code>http2_keep_alive_timeout</code></td><td>Timeout for receiving an acknowledgement of the keep-alive ping.</td><td><code>15s</code></td></tr>
<tr><td><code>http2_keep_alive_while_idle</code></td><td>Enable HTTP2 keep alive pings for idle connections</td><td><code>true</code></td></tr>
<tr><td><code>http2_max_frame_size</code></td><td>Sets the maximum frame size to use for HTTP2.</td><td></td></tr>
</tbody>
</table>
</div>
<h4 id="proxy-settings-1"><a class="header" href="#proxy-settings-1">Proxy settings</a></h4>
<div class="table-wrapper">
<table>
<thead>
<tr><th>configuration</th><th>description</th><th>example</th></tr>
</thead>
<tbody>
<tr><td><code>proxy_url</code></td><td>HTTP proxy to use for requests</td><td><code>http://proxy.example.com:8080</code></td></tr>
<tr><td><code>proxy_ca_certificate</code></td><td>PEM-formatted CA certificate for proxy connections</td><td><code>-----BEGIN CERTIFICATE-----</code><br>…<br><code>-----END CERTIFICATE-----</code></td></tr>
<tr><td><code>proxy_excludes</code></td><td>List of hosts that bypass proxy</td><td><code>example.com</code>, <code>maplibre.org</code></td></tr>
</tbody>
</table>
</div>
</div>

<div class="mdbook-tab-content hidden" data-tabname="Google Cloud Storage">
<p>For Google Cloud, you need to provide the bucket name and the prefix of the object key.
For example:</p>
<pre><code class="language-bash">martin  gs://my-bucket/tiles.pmtiles
</code></pre>
<p>The available url scheme is:</p>
<ul>
<li><code>gs://bucket/path</code></li>
</ul>
<p>If you want more control over your requests, you can configure additional options here as such:</p>
<pre><code class="language-yaml">pmtiles:
  allow_http: true
  sources:
    tiles: gs://bucket/path/to/tiles.pmtiles
</code></pre>
<blockquote class="blockquote-tag blockquote-tag-tip">
<p class="blockquote-tag-title"><svg viewbox="0 0 16 16" width="18" height="18"><path d="M8 1.5c-2.363 0-4 1.69-4 3.75 0 .984.424 1.625.984 2.304l.214.253c.223.264.47.556.673.848.284.411.537.896.621 1.49a.75.75 0 0 1-1.484.211c-.04-.282-.163-.547-.37-.847a8.456 8.456 0 0 0-.542-.68c-.084-.1-.173-.205-.268-.32C3.201 7.75 2.5 6.766 2.5 5.25 2.5 2.31 4.863 0 8 0s5.5 2.31 5.5 5.25c0 1.516-.701 2.5-1.328 3.259-.095.115-.184.22-.268.319-.207.245-.383.453-.541.681-.208.3-.33.565-.37.847a.751.751 0 0 1-1.485-.212c.084-.593.337-1.078.621-1.489.203-.292.45-.584.673-.848.075-.088.147-.173.213-.253.561-.679.985-1.32.985-2.304 0-2.06-1.637-3.75-4-3.75ZM5.75 12h4.5a.75.75 0 0 1 0 1.5h-4.5a.75.75 0 0 1 0-1.5ZM6 15.25a.75.75 0 0 1 .75-.75h2.5a.75.75 0 0 1 0 1.5h-2.5a.75.75 0 0 1-.75-.75Z"></path></svg>Tip</p>
<p>All settings are also available under the <code>google_</code> prefix.
This can be useful if you want to have different cloud providers.</p>
</blockquote>
<h3 id="available-google-settings"><a class="header" href="#available-google-settings">Available google settings</a></h3>
<h4 id="google-specific-configuration"><a class="header" href="#google-specific-configuration">Google specific configuration</a></h4>
<div class="table-wrapper">
<table>
<thead>
<tr><th>configuration</th><th>description</th><th>example</th></tr>
</thead>
<tbody>
<tr><td><code>base_url</code></td><td>Sets the base URL for communicating with GCS.<br>If not explicitly set, it will be:<br>1. Derived from the service account credentials, if provided<br>2. Otherwise, uses the default GCS endpoint</td><td><code>https://storage.googleapis.com</code></td></tr>
<tr><td><code>service_account</code><br><code>service_account_path</code></td><td>Path to the service account file</td><td><code>some/path/to/file</code></td></tr>
<tr><td><code>service_account_key</code></td><td>The serialized service account key</td><td><code>{"private_key": "private_key", "private_key_id": "private_key_id", "client_email":"client_email", "disable_oauth":true}</code></td></tr>
<tr><td><code>bucket</code><br><code>bucket_name</code></td><td>Bucket name</td><td><code>foobar-abc</code></td></tr>
<tr><td><code>application_credentials</code></td><td>Set the path to the <a href="https://cloud.google.com/docs/authentication/provide-credentials-adc">application credentials file</a></td><td><code>some/path/to/file</code></td></tr>
<tr><td><code>skip_signature</code></td><td>Skip signing request</td><td><code>true</code></td></tr>
</tbody>
</table>
</div>
<h4 id="security-options-2"><a class="header" href="#security-options-2">Security options</a></h4>
<div class="table-wrapper">
<table>
<thead>
<tr><th>configuration</th><th>description</th><th>example</th></tr>
</thead>
<tbody>
<tr><td><code>allow_http</code></td><td>Allow non-TLS, i.e. non-HTTPS connections<br><br><strong>Security warning:</strong><br>If you enable this option, attackers may be able to read the data you request</td><td><code>true</code></td></tr>
<tr><td><code>allow_invalid_certificates</code></td><td>Skip certificate validation on https connections<br><br><strong>Security warning:</strong><br>You should think very carefully before using this method. If invalid certificates are trusted, any certificate for any site will be trusted for use. This includes expired certificates. This introduces significant vulnerabilities, and should only be used as a last resort or for testing</td><td><code>true</code></td></tr>
</tbody>
</table>
</div>
<h4 id="connection-options-2"><a class="header" href="#connection-options-2">Connection options</a></h4>
<div class="table-wrapper">
<table>
<thead>
<tr><th>configuration</th><th>description</th><th>example</th></tr>
</thead>
<tbody>
<tr><td><code>user_agent</code></td><td>User-Agent header to be used by this client</td><td><code>martin 1.0.0</code></td></tr>
<tr><td><code>randomize_addresses</code></td><td>Randomize order addresses that the DNS resolution yields.<br>This will spread the connections across more servers.</td><td><code>true</code></td></tr>
<tr><td><code>connect_timeout</code></td><td>Timeout for only the connect phase of a Client</td><td><code>5s</code></td></tr>
<tr><td><code>timeout</code></td><td>The timeout is applied from when the request starts connecting until the response body has finished</td><td><code>10s</code></td></tr>
<tr><td><code>pool_idle_timeout</code></td><td>The pool max idle timeout</td><td><code>5m</code></td></tr>
<tr><td><code>pool_max_idle_per_host</code></td><td>maximum number of idle connections per host</td><td><code>10</code></td></tr>
<tr><td><code>http1_only</code></td><td>Only use http1 connections</td><td><code>false</code></td></tr>
<tr><td><code>http2_only</code></td><td>Only use http2 connections</td><td><code>false</code></td></tr>
<tr><td><code>http2_keep_alive_interval</code></td><td>Interval for HTTP2 Ping frames should be sent to keep a connection alive.</td><td><code>15s</code></td></tr>
<tr><td><code>http2_keep_alive_timeout</code></td><td>Timeout for receiving an acknowledgement of the keep-alive ping.</td><td><code>15s</code></td></tr>
<tr><td><code>http2_keep_alive_while_idle</code></td><td>Enable HTTP2 keep alive pings for idle connections</td><td><code>true</code></td></tr>
<tr><td><code>http2_max_frame_size</code></td><td>Sets the maximum frame size to use for HTTP2.</td><td></td></tr>
</tbody>
</table>
</div>
<h4 id="proxy-settings-2"><a class="header" href="#proxy-settings-2">Proxy settings</a></h4>
<div class="table-wrapper">
<table>
<thead>
<tr><th>configuration</th><th>description</th><th>example</th></tr>
</thead>
<tbody>
<tr><td><code>proxy_url</code></td><td>HTTP proxy to use for requests</td><td><code>http://proxy.example.com:8080</code></td></tr>
<tr><td><code>proxy_ca_certificate</code></td><td>PEM-formatted CA certificate for proxy connections</td><td><code>-----BEGIN CERTIFICATE-----</code><br>…<br><code>-----END CERTIFICATE-----</code></td></tr>
<tr><td><code>proxy_excludes</code></td><td>List of hosts that bypass proxy</td><td><code>example.com</code>, <code>maplibre.org</code></td></tr>
</tbody>
</table>
</div>
</div>

<div class="mdbook-tab-content hidden" data-tabname="Microsoft Azure">
<p>For Azure, you need to provide the account name, container and path.
For example:</p>
<pre><code class="language-bash">martin  az://my-container/tiles.pmtiles
</code></pre>
<p>The available url schemes are:</p>
<ul>
<li><code>abfs[s]://&lt;container&gt;/&lt;path&gt;</code> (according to <a href="https://github.com/fsspec/adlfs">fsspec</a>)</li>
<li><code>abfs[s]://&lt;file_system&gt;@&lt;account_name&gt;.dfs.core.windows.net/&lt;path&gt;</code></li>
<li><code>abfs[s]://&lt;file_system&gt;@&lt;account_name&gt;.dfs.fabric.microsoft.com/&lt;path&gt;</code></li>
<li><code>az://&lt;container&gt;/&lt;path&gt;</code> (according to <a href="https://github.com/fsspec/adlfs">fsspec</a>)</li>
<li><code>adl://&lt;container&gt;/&lt;path&gt;</code> (according to <a href="https://github.com/fsspec/adlfs">fsspec</a>)</li>
<li><code>azure://&lt;container&gt;/&lt;path&gt;</code> (custom)</li>
<li><code>https://&lt;account&gt;.dfs.core.windows.net</code></li>
<li><code>https://&lt;account&gt;.blob.core.windows.net</code></li>
<li><code>https://&lt;account&gt;.blob.core.windows.net/&lt;container&gt;</code></li>
<li><code>https://&lt;account&gt;.dfs.fabric.microsoft.com</code></li>
<li><code>https://&lt;account&gt;.dfs.fabric.microsoft.com/&lt;container&gt;</code></li>
<li><code>https://&lt;account&gt;.blob.fabric.microsoft.com</code></li>
<li><code>https://&lt;account&gt;.blob.fabric.microsoft.com/&lt;container&gt;</code></li>
</ul>
<p>If you want more control over your requests, you can configure additional options here as such:</p>
<pre><code class="language-yaml">pmtiles:
  allow_http: true
  sources:
    tiles: az://my-container/tiles.pmtiles
</code></pre>
<blockquote class="blockquote-tag blockquote-tag-tip">
<p class="blockquote-tag-title"><svg viewbox="0 0 16 16" width="18" height="18"><path d="M8 1.5c-2.363 0-4 1.69-4 3.75 0 .984.424 1.625.984 2.304l.214.253c.223.264.47.556.673.848.284.411.537.896.621 1.49a.75.75 0 0 1-1.484.211c-.04-.282-.163-.547-.37-.847a8.456 8.456 0 0 0-.542-.68c-.084-.1-.173-.205-.268-.32C3.201 7.75 2.5 6.766 2.5 5.25 2.5 2.31 4.863 0 8 0s5.5 2.31 5.5 5.25c0 1.516-.701 2.5-1.328 3.259-.095.115-.184.22-.268.319-.207.245-.383.453-.541.681-.208.3-.33.565-.37.847a.751.751 0 0 1-1.485-.212c.084-.593.337-1.078.621-1.489.203-.292.45-.584.673-.848.075-.088.147-.173.213-.253.561-.679.985-1.32.985-2.304 0-2.06-1.637-3.75-4-3.75ZM5.75 12h4.5a.75.75 0 0 1 0 1.5h-4.5a.75.75 0 0 1 0-1.5ZM6 15.25a.75.75 0 0 1 .75-.75h2.5a.75.75 0 0 1 0 1.5h-2.5a.75.75 0 0 1-.75-.75Z"></path></svg>Tip</p>
<p>All settings are also available under the <code>azure_</code> prefix.
This can be useful if you want to have different cloud providers.</p>
</blockquote>
<h3 id="available-azure-settings"><a class="header" href="#available-azure-settings">Available azure settings</a></h3>
<h4 id="azure-specific-authentication--credentials"><a class="header" href="#azure-specific-authentication--credentials">Azure specific Authentication &amp; Credentials</a></h4>
<div class="table-wrapper">
<table>
<thead>
<tr><th>configuration</th><th>description</th><th>example</th></tr>
</thead>
<tbody>
<tr><td><code>account_name</code></td><td>Name of the Azure Storage account</td><td><code>myaccount</code></td></tr>
<tr><td><code>access_key</code><br><code>account_key</code><br><code>master_key</code></td><td>Master key for accessing the storage account<br><br><strong>Security note:</strong><br> Keep this key secret; anyone with access can read/write all data in the account</td><td><code>abcd1234efgh5678ijkl9012mnop3456qrst7890uvwx1234yzab5678cdef9012</code></td></tr>
<tr><td><code>client_id</code></td><td>Service principal client ID for OAuth authorization</td><td><code>12345678-90ab-cdef-1234-567890abcdef</code></td></tr>
<tr><td><code>client_secret</code></td><td>Service principal client secret for OAuth authorization<br><strong>Security note:</strong> Must be kept confidential</td><td><code>s3cr3tV@lu3!</code></td></tr>
<tr><td><code>tenant_id</code><br><code>authority_id</code></td><td>Tenant ID used in OAuth flows</td><td><code>abcdef12-3456-7890-abcd-ef1234567890</code></td></tr>
<tr><td><code>authority_host</code></td><td>Authority host used in OAuth flows</td><td><code>https://login.microsoftonline.com/</code></td></tr>
<tr><td><code>sas_key</code><br><code>sas_token</code></td><td>Shared Access Signature (percent-encoded)<br><br><strong>Security note:</strong><br> Grants scoped access; treat as sensitive credentials</td><td><code>sv=2021-06-08&amp;ss=b&amp;srt=sco&amp;sp=rwdl</code><br><code>&amp;se=2025-12-31T23:59:00Z&amp;sig=ABCDEF1234567890</code></td></tr>
<tr><td><code>bearer_token</code><br><code>token</code></td><td>Bearer token for requests<br><br><strong>Security note:</strong><br> Token must be protected; use HTTPS</td><td><code>eyJ0eXAiOiJKV1QiLCJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...</code></td></tr>
<tr><td><code>identity_endpoint</code><br><code>msi_endpoint</code></td><td>Endpoint to request a managed identity token</td><td><code>http://169.254.169.254/metadata/identity/oauth2/token</code></td></tr>
<tr><td><code>object_id</code></td><td>Object ID for use with managed identity authentication</td><td><code>12345678-90ab-cdef-1234-567890abcdef</code></td></tr>
<tr><td><code>msi_resource_id</code></td><td>Resource ID for managed identity authentication</td><td><code>/subscriptions/12345678-90ab-cdef-1234-567890abcdef/</code><br><code>resourcegroups/myrg/providers/Microsoft.ManagedIdentity/</code><br><code>userAssignedIdentities/myidentity</code></td></tr>
<tr><td><code>federated_token_file</code></td><td>File containing token for Azure AD workload identity federation</td><td><code>/var/run/secrets/azure/federated-token</code></td></tr>
<tr><td><code>use_azure_cli</code></td><td>Use Azure CLI for acquiring access token</td><td><code>true</code></td></tr>
</tbody>
</table>
</div>
<h4 id="azure-specific-connection--endpoint-configuration"><a class="header" href="#azure-specific-connection--endpoint-configuration">Azure specific Connection &amp; Endpoint Configuration</a></h4>
<div class="table-wrapper">
<table>
<thead>
<tr><th>configuration</th><th>description</th><th>example</th></tr>
</thead>
<tbody>
<tr><td><code>endpoint</code></td><td>Override endpoint used to communicate with blob storage</td><td><code>https://myaccount.blob.core.windows.net</code></td></tr>
<tr><td><code>object_store_use_emulator</code><br><code>use_emulator</code></td><td>Use Azurite storage emulator</td><td><code>true</code></td></tr>
<tr><td><code>use_fabric_endpoint</code></td><td>Use Azure Fabric endpoint (account.dfs.fabric.microsoft.com)</td><td><code>true</code></td></tr>
<tr><td><code>container_name</code></td><td>Container name in the storage account</td><td><code>mycontainer</code></td></tr>
</tbody>
</table>
</div>
<h4 id="azure-specific-request-behavior--security-options"><a class="header" href="#azure-specific-request-behavior--security-options">Azure specific Request Behavior &amp; Security Options</a></h4>
<div class="table-wrapper">
<table>
<thead>
<tr><th>configuration</th><th>description</th><th>example</th></tr>
</thead>
<tbody>
<tr><td><code>skip_signature</code></td><td>Skip signing requests<br><br><strong>Security warning:</strong><br> Unsigned requests may expose sensitive data or allow tampering; use only in secure or local environments</td><td><code>true</code></td></tr>
<tr><td><code>disable_tagging</code></td><td>Disable object tagging (useful if backend does not support it)</td><td><code>true</code></td></tr>
<tr><td><code>fabric_token_service_url</code></td><td>URL of Fabric token service</td><td><code>https://fabric-token.mycompany.com</code></td></tr>
<tr><td><code>fabric_workload_host</code></td><td>Host for Fabric workload</td><td><code>https://workload.fabric.mycompany.com</code></td></tr>
<tr><td><code>fabric_session_token</code></td><td>Session token for Fabric<br><br><strong>Security note:</strong> Must be protected; use HTTPS</td><td><code>eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...</code></td></tr>
<tr><td><code>fabric_cluster_identifier</code></td><td>Identifier for Fabric cluster</td><td><code>fabric-cluster-01</code></td></tr>
</tbody>
</table>
</div>
<h4 id="security-options-3"><a class="header" href="#security-options-3">Security options</a></h4>
<div class="table-wrapper">
<table>
<thead>
<tr><th>configuration</th><th>description</th><th>example</th></tr>
</thead>
<tbody>
<tr><td><code>allow_http</code></td><td>Allow non-TLS, i.e. non-HTTPS connections<br><br><strong>Security warning:</strong><br>If you enable this option, attackers may be able to read the data you request</td><td><code>true</code></td></tr>
<tr><td><code>allow_invalid_certificates</code></td><td>Skip certificate validation on https connections<br><br><strong>Security warning:</strong><br>You should think very carefully before using this method. If invalid certificates are trusted, any certificate for any site will be trusted for use. This includes expired certificates. This introduces significant vulnerabilities, and should only be used as a last resort or for testing</td><td><code>true</code></td></tr>
</tbody>
</table>
</div>
<h4 id="connection-options-3"><a class="header" href="#connection-options-3">Connection options</a></h4>
<div class="table-wrapper">
<table>
<thead>
<tr><th>configuration</th><th>description</th><th>example</th></tr>
</thead>
<tbody>
<tr><td><code>user_agent</code></td><td>User-Agent header to be used by this client</td><td><code>martin 1.0.0</code></td></tr>
<tr><td><code>randomize_addresses</code></td><td>Randomize order addresses that the DNS resolution yields.<br>This will spread the connections across more servers.</td><td><code>true</code></td></tr>
<tr><td><code>connect_timeout</code></td><td>Timeout for only the connect phase of a Client</td><td><code>5s</code></td></tr>
<tr><td><code>timeout</code></td><td>The timeout is applied from when the request starts connecting until the response body has finished</td><td><code>10s</code></td></tr>
<tr><td><code>pool_idle_timeout</code></td><td>The pool max idle timeout</td><td><code>5m</code></td></tr>
<tr><td><code>pool_max_idle_per_host</code></td><td>maximum number of idle connections per host</td><td><code>10</code></td></tr>
<tr><td><code>http1_only</code></td><td>Only use http1 connections</td><td><code>false</code></td></tr>
<tr><td><code>http2_only</code></td><td>Only use http2 connections</td><td><code>false</code></td></tr>
<tr><td><code>http2_keep_alive_interval</code></td><td>Interval for HTTP2 Ping frames should be sent to keep a connection alive.</td><td><code>15s</code></td></tr>
<tr><td><code>http2_keep_alive_timeout</code></td><td>Timeout for receiving an acknowledgement of the keep-alive ping.</td><td><code>15s</code></td></tr>
<tr><td><code>http2_keep_alive_while_idle</code></td><td>Enable HTTP2 keep alive pings for idle connections</td><td><code>true</code></td></tr>
<tr><td><code>http2_max_frame_size</code></td><td>Sets the maximum frame size to use for HTTP2.</td><td></td></tr>
</tbody>
</table>
</div>
<h4 id="proxy-settings-3"><a class="header" href="#proxy-settings-3">Proxy settings</a></h4>
<div class="table-wrapper">
<table>
<thead>
<tr><th>configuration</th><th>description</th><th>example</th></tr>
</thead>
<tbody>
<tr><td><code>proxy_url</code></td><td>HTTP proxy to use for requests</td><td><code>http://proxy.example.com:8080</code></td></tr>
<tr><td><code>proxy_ca_certificate</code></td><td>PEM-formatted CA certificate for proxy connections</td><td><code>-----BEGIN CERTIFICATE-----</code><br>…<br><code>-----END CERTIFICATE-----</code></td></tr>
<tr><td><code>proxy_excludes</code></td><td>List of hosts that bypass proxy</td><td><code>example.com</code>, <code>maplibre.org</code></td></tr>
</tbody>
</table>
</div>
</div>

</div>

<div style="break-before: page; page-break-before: always;"></div>
<h1 id="postgresql-connections-1"><a href="#postgresql-connections-1" class="header">PostgreSQL Connections</a></h1>
<h2 id="postgresql-connections"><a class="header" href="#postgresql-connections">PostgreSQL Connections</a></h2>
<p>Martin supports standard PostgreSQL connection string settings including <code>host</code>, <code>port</code>, <code>user</code>, <code>password</code>, <code>dbname</code>, <code>sslmode</code>, <code>connect_timeout</code>, <code>keepalives</code>, <code>keepalives_idle</code>, etc.
See the <a href="https://www.postgresql.org/docs/current/libpq-connect.html#LIBPQ-CONNSTRING">PostgreSQL docs</a> for more details.</p>
<h3 id="ssl-connections"><a class="header" href="#ssl-connections">SSL Connections</a></h3>
<p>Martin supports PostgreSQL <code>sslmode</code> settings: <code>disable</code>, <code>prefer</code>, <code>require</code>, <code>verify-ca</code> and <code>verify-full</code>.
See the <a href="https://www.postgresql.org/docs/current/libpq-ssl.html">PostgreSQL docs</a> for mode descriptions.
Certificates can be provided in the configuration file or via environment variables (same as <code>psql</code>).
Environment variables apply to all PostgreSQL connections.
See <a href="#environment-variables-1">environment vars</a> for details.</p>
<p>By default, <code>sslmode</code> is <code>prefer</code> - encrypt (don’t check certificates) if the server supports it, but the connection proceeds without SSL if not supported.
This matches <code>psql</code> default behavior.</p>
<p>If you require guarnatees regarding <a href="https://en.wikipedia.org/wiki/Eavesdropping">eavesdropping</a> or <a href="https://en.wikipedia.org/wiki/Man-in-the-middle_attack">MITM protection</a>, you need a different option.
Use the <code>sslmode</code> parameter to specify a different mode:</p>
<pre><code class="language-bash">martin postgres://user:password@host/db?sslmode=verify-full
</code></pre>
<p>For a practical walkthrough of SSL certificate setup — including creation, configuration, and troubleshooting — see our <a href="#postgresql-ssl-certificates">PostgreSQL SSL Certificates Recipe</a>.</p>
<div style="break-before: page; page-break-before: always;"></div>
<h1 id="postgresql-table-sources"><a class="header" href="#postgresql-table-sources">PostgreSQL Table Sources</a></h1>
<p>Table Source is a database table which can be used to query <a href="https://github.com/mapbox/vector-tile-spec">vector tiles</a>. If a <a href="#postgresql-connections-1">PostgreSQL connection string</a> is given, Martin will publish all tables as data sources if they have at least one geometry column. If geometry column SRID is 0, a default SRID must be set, or else that geo-column/table will be ignored. All non-geometry table columns will be published as vector tile feature tags (properties).</p>
<h2 id="modifying-tilejson"><a class="header" href="#modifying-tilejson">Modifying Tilejson</a></h2>
<p>Martin will automatically generate a <code>TileJSON</code> manifest for each table source. It will contain the <code>name</code>, <code>description</code>, <code>minzoom</code>, <code>maxzoom</code>, <code>bounds</code> and <code>vector_layer</code> information.
For example, if there is a table <code>public.table_source</code>:
the default <code>TileJSON</code> might look like this (note that URL will be automatically adjusted to match the request host):</p>
<p>The table:</p>
<pre><code class="language-sql">CREATE TABLE "public"."table_source" (
  "gid" int4 NOT NULL,
  "geom" "public"."geometry"
);
</code></pre>
<p>The TileJSON:</p>
<pre><code class="language-json">{
    "tilejson": "3.0.0",
    "tiles": [
        "http://localhost:3000/table_source/{z}/{x}/{y}"
    ],
    "vector_layers": [
        {
            "id": "table_source",
            "fields": {
                "gid": "int4"
            }
        }
    ],
    "bounds": [
        -2.0,
        -1.0,
        142.84131509869133,
        45.0
    ],
    "description": "public.table_source.geom",
    "name": "table_source"
}
</code></pre>
<p>By default the <code>description</code> and <code>name</code> is database identifies about this table, and the bounds is queried from database. You can fine tune these by adjusting <code>auto_publish</code> section in <a href="https://maplibre.org/martin/config-file.html#config-example">configuration file</a>.</p>
<h2 id="tilejson-in-sql-comments"><a class="header" href="#tilejson-in-sql-comments">TileJSON in SQL Comments</a></h2>
<p>Other than adjusting <code>auto_publish</code> section in configuration file, you can fine tune the <code>TileJSON</code> on the database side directly: Add a valid JSON as an SQL comment on the table.</p>
<p>Martin will merge table comment into the generated TileJSON using JSON Merge patch. The following example update description and adds attribution, version, foo(even a nested DIY field) fields to the TileJSON.</p>
<pre><code class="language-sql">DO $do$ BEGIN
    EXECUTE 'COMMENT ON TABLE table_source IS $tj$' || $$
    {
        "version": "1.2.3",
        "attribution": "osm",
        "description": "a description from table comment",
        "foo": {"bar": "foo"}
    }
    $$::json || '$tj$';
END $do$;
</code></pre>
<div style="break-before: page; page-break-before: always;"></div>
<h1 id="postgresql-function-sources-1"><a href="#postgresql-function-sources-1" class="header">PostgreSQL Function Sources</a></h1>
<h2 id="postgresql-function-sources"><a class="header" href="#postgresql-function-sources">PostgreSQL Function Sources</a></h2>
<p>Function Source is a database function which can be used to
query <a href="https://github.com/mapbox/vector-tile-spec">vector tiles</a>. When started, Martin will look for the functions with
a suitable signature.</p>
<p>A function can be used as a Function Source if it returns either a <code>bytea</code> value, or a record with <code>bytea</code> and a <code>text</code> values.  The <code>text</code> value is expected to be a user-defined hash, e.g. an MD5 value, and it will eventually be used as an <a href="https://developer.mozilla.org/de/docs/Web/HTTP/Reference/Headers/ETag">ETag</a>.</p>
<p>A valid function must also have these arguments:</p>
<div class="table-wrapper">
<table>
<thead>
<tr><th>Argument</th><th>Type</th><th>Description</th></tr>
</thead>
<tbody>
<tr><td><code>z</code> (or <code>zoom</code>)</td><td>integer</td><td>Tile zoom parameter</td></tr>
<tr><td><code>x</code></td><td>integer</td><td>Tile x parameter</td></tr>
<tr><td><code>y</code></td><td>integer</td><td>Tile y parameter</td></tr>
<tr><td><code>query</code> (optional, any name)</td><td>json</td><td>Query string parameters</td></tr>
</tbody>
</table>
</div>
<h3 id="simple-function-with-coordinate-projection"><a class="header" href="#simple-function-with-coordinate-projection">Simple Function with coordinate projection</a></h3>
<p>For example, if you have a table with arbitrary geometry <code>table_source</code> in WGS84 (<code>4326</code> SRID).
If we need the tables’ row <code>field_color</code> and geometry <code>geom</code> as a function source, then it can be written as:</p>
<pre><code class="language-sql ignore">CREATE OR REPLACE
    FUNCTION function_zxy(z integer, x integer, y integer)
    RETURNS bytea AS $$
DECLARE
  mvt bytea;
BEGIN
  SELECT INTO mvt ST_AsMVT(tile, 'function_zxy', 4096, 'geom') FROM (
    SELECT
      ST_AsMVTGeom(
          ST_Transform(ST_CurveToLine(geom), 3857),
          ST_TileEnvelope(z, x, y),
          4096, 64, true) AS geom,
        field_color AS color
    FROM table_source
    WHERE geom &amp;&amp; ST_Transform(ST_TileEnvelope(z, x, y), 4326)
  ) as tile WHERE geom IS NOT NULL;

  RETURN mvt;
END
$$ LANGUAGE plpgsql IMMUTABLE STRICT PARALLEL SAFE;
</code></pre>
<blockquote class="blockquote-tag blockquote-tag-tip">
<p class="blockquote-tag-title"><svg viewbox="0 0 16 16" width="18" height="18"><path d="M8 1.5c-2.363 0-4 1.69-4 3.75 0 .984.424 1.625.984 2.304l.214.253c.223.264.47.556.673.848.284.411.537.896.621 1.49a.75.75 0 0 1-1.484.211c-.04-.282-.163-.547-.37-.847a8.456 8.456 0 0 0-.542-.68c-.084-.1-.173-.205-.268-.32C3.201 7.75 2.5 6.766 2.5 5.25 2.5 2.31 4.863 0 8 0s5.5 2.31 5.5 5.25c0 1.516-.701 2.5-1.328 3.259-.095.115-.184.22-.268.319-.207.245-.383.453-.541.681-.208.3-.33.565-.37.847a.751.751 0 0 1-1.485-.212c.084-.593.337-1.078.621-1.489.203-.292.45-.584.673-.848.075-.088.147-.173.213-.253.561-.679.985-1.32.985-2.304 0-2.06-1.637-3.75-4-3.75ZM5.75 12h4.5a.75.75 0 0 1 0 1.5h-4.5a.75.75 0 0 1 0-1.5ZM6 15.25a.75.75 0 0 1 .75-.75h2.5a.75.75 0 0 1 0 1.5h-2.5a.75.75 0 0 1-.75-.75Z"></path></svg>Tip</p>
<p>By default, <a href="https://postgis.net/docs/ST_TileEnvelope.html"><code>ST_TileEnvelope</code></a> produces <code>3857</code> SRID and <a href="https://postgis.net/docs/ST_AsMVTGeom.html"><code>ST_AsMVTGeom</code></a> consumes <code>3857</code> SRID.
Many tooling (for example <a href="https://osm2pgsql.org/"><code>osm2pgsql</code></a>) thus directly store their data in <code>3857</code> SRID for lower processing overhead.
If your data is in <code>3857</code> SRID, you can remove the two <code>ST_Transform</code> calls.</p>
</blockquote>
<p>Lets explain a few of the aspects of the function:</p>
<p><code>ST_Transform(ST_CurveToLine(geom), 3857)</code></p>
<ul>
<li>Since the table in the example can contain arbitrary geometries, we need to transform <code>CIRCULARSTRING</code> geometry types.
Concretely, we use <code>ST_CurveToLine</code> to convert a
<ul>
<li>CIRCULAR STRING to regular LINESTRING,</li>
<li>CURVEPOLYGON to POLYGON or</li>
<li>MULTISURFACE to MULTIPOLYGON.</li>
</ul>
</li>
<li><code>ST_Transform</code> is necessary as <code>ST_CurveToLine</code> returns a geometry in <code>4326</code> SRID, which is the SRID of stored geometry in the example.</li>
</ul>
<p><code>WHERE geom &amp;&amp; ST_Transform(ST_TileEnvelope(z, x, y), 4326)</code></p>
<ul>
<li><code>&amp;&amp;</code> is the spatial intersection operator. Thus it checks if the geometry intersects with the tile envelope and uses spatial indexes.</li>
<li><code>ST_Transform</code> is used to transform the tile envelope from <code>3857</code> SRID to <code>4326</code> SRID, as <code>geom</code> in our example is in <code>4326</code> SRID.</li>
</ul>
<blockquote class="blockquote-tag blockquote-tag-note">
<p class="blockquote-tag-title"><svg viewbox="0 0 16 16" width="18" height="18"><path d="M0 8a8 8 0 1 1 16 0A8 8 0 0 1 0 8Zm8-6.5a6.5 6.5 0 1 0 0 13 6.5 6.5 0 0 0 0-13ZM6.5 7.75A.75.75 0 0 1 7.25 7h1a.75.75 0 0 1 .75.75v2.75h.25a.75.75 0 0 1 0 1.5h-2a.75.75 0 0 1 0-1.5h.25v-2h-.25a.75.75 0 0 1-.75-.75ZM8 6a1 1 0 1 1 0-2 1 1 0 0 1 0 2Z"></path></svg>Note</p>
<p>The planning mode <code>IMMUTABLE STRICT PARALLEL SAFE</code> allows postgres further freedom to optimize our function.
Your function is likely to be the same category as the example, but be careful to not cause unexpected behavior.</p>
<ul>
<li>
<p><a href="https://www.postgresql.org/docs/current/sql-createfunction.html#:~:text=existing%20function%20definition.-,IMMUTABLE,-STABLE%0AVOLATILE"><code>IMMUTABLE</code></a>
The function does not have side effects.</p>
<blockquote>
<p>Indicates that the function cannot modify the database and always returns the same result when given the same argument values;
that is, it does not do database lookups or otherwise use information not directly present in its argument list.
If this option is given, any call of the function with all-constant arguments can be immediately replaced with the function value.</p>
</blockquote>
</li>
<li>
<p><code>STRICT</code>: Our function will not be called if any of the arguments are <code>NULL</code>.</p>
</li>
<li>
<p><a href="https://www.postgresql.org/docs/current/parallel-safety.html"><code>PARALLEL SAFE</code></a>:
Our function is safe to call in parallel as it does not modify the database, nor use randomness or temporary tables.</p>
<blockquote>
<p>Functions should be labeled parallel unsafe if they</p>
<ul>
<li>modify any database state,</li>
<li>change the transaction state (other than by using a subtransaction for error recovery),</li>
<li>access sequences (e.g., by calling currval) or</li>
<li>make persistent changes to settings.</li>
</ul>
<p>They should be labeled parallel restricted if they</p>
<ul>
<li>access temporary tables,</li>
<li>client connection state,</li>
<li>cursors,</li>
<li>prepared statements, or</li>
<li>miscellaneous backend-local state which the system cannot synchronize in parallel mode
(e.g., setseed cannot be executed other than by the group leader because a change made by another process
would not be reflected in the leader).</li>
</ul>
<p>In general, if a function is labeled as being safe when it is restricted or unsafe, or if it is labeled as being restricted
when it is in fact unsafe, it may throw errors or produce wrong answers when used in a parallel query.
C-language functions could in theory exhibit totally undefined behavior if mislabeled, since there is no way for the system
to protect itself against arbitrary C code, but in most likely cases the result will be no worse than for any other function.
If in doubt, functions should be labeled as UNSAFE, which is the default.</p>
</blockquote>
</li>
</ul>
</blockquote>
<h3 id="function-with-query-parameters"><a class="header" href="#function-with-query-parameters">Function with Query Parameters</a></h3>
<p>Users may add a <code>query</code> parameter to pass additional parameters to the function.</p>
<p>The <code>query_params</code> argument is a JSON representation of the tile request query params. Query params could be passed as
simple query values, e.g.</p>
<pre><code class="language-bash">curl localhost:3000/function_zxy_query/0/0/0?answer=42
</code></pre>
<p>You can also
use <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/encodeURIComponent">urlencoded</a>
params to encode complex values:</p>
<pre><code class="language-bash">curl \
  --data-urlencode 'arrayParam=[1, 2, 3]' \
  --data-urlencode 'numberParam=42' \
  --data-urlencode 'stringParam=value' \
  --data-urlencode 'booleanParam=true' \
  --data-urlencode 'objectParam={"answer" : 42}' \
  --get localhost:3000/function_zxy_query/0/0/0
</code></pre>
<p>then <code>query_params</code> will be parsed as:</p>
<pre><code class="language-json">{
  "arrayParam": [1, 2, 3],
  "numberParam": 42,
  "stringParam": "value",
  "booleanParam": true,
  "objectParam": { "answer": 42 }
}
</code></pre>
<p>You can access this params using <a href="https://www.postgresql.org/docs/current/functions-json.html">json operators</a>:</p>
<pre><code class="language-sql ignore">...WHERE answer = (query_params-&gt;'objectParam'-&gt;&gt;'answer')::int;
</code></pre>
<p>As an example, our <code>table_source</code> in WGS84 (<code>4326</code> SRID) has a column <code>answer</code> of type <code>integer</code>.
The function <code>function_zxy_query</code> will return a MVT tile with the <code>answer</code> column as a property.</p>
<pre><code class="language-sql ignore">CREATE OR REPLACE
    FUNCTION function_zxy_query(z integer, x integer, y integer, query_params json)
    RETURNS bytea AS $$
DECLARE
  mvt bytea;
BEGIN
  SELECT INTO mvt ST_AsMVT(tile, 'function_zxy_query', 4096, 'geom') FROM (
    SELECT
      ST_AsMVTGeom(
          ST_Transform(ST_CurveToLine(geom), 3857),
          ST_TileEnvelope(z, x, y),
          4096, 64, true) AS geom
    FROM table_source
    WHERE geom &amp;&amp; ST_Transform(ST_TileEnvelope(z, x, y), 4326) AND
          answer = (query_params-&gt;&gt;'answer')::int
  ) as tile WHERE geom IS NOT NULL;

  RETURN mvt;
END
$$ LANGUAGE plpgsql IMMUTABLE STRICT PARALLEL SAFE;
</code></pre>
<h3 id="modifying-tilejson-1"><a class="header" href="#modifying-tilejson-1">Modifying TileJSON</a></h3>
<p>Martin will automatically generate a basic <a href="https://github.com/mapbox/tilejson-spec">TileJSON</a> manifest for each
function source.
This will contain the <code>name</code> and <code>description</code> of the function, plus optionally <code>minzoom</code>, <code>maxzoom</code>, and <code>bounds</code>
(if they were specified via one of the configuration methods).</p>
<p>For example, if there is a function <code>public.function_zxy_query_jsonb</code>, the default <code>TileJSON</code> might look like this:</p>
<pre><code class="language-json">{
  "tilejson": "3.0.0",
  "tiles": [
    "http://localhost:3111/function_zxy_query_jsonb/{z}/{x}/{y}"
  ],
  "name": "function_zxy_query_jsonb",
  "description": "public.function_zxy_query_jsonb"
}
</code></pre>
<blockquote class="blockquote-tag blockquote-tag-note">
<p class="blockquote-tag-title"><svg viewbox="0 0 16 16" width="18" height="18"><path d="M0 8a8 8 0 1 1 16 0A8 8 0 0 1 0 8Zm8-6.5a6.5 6.5 0 1 0 0 13 6.5 6.5 0 0 0 0-13ZM6.5 7.75A.75.75 0 0 1 7.25 7h1a.75.75 0 0 1 .75.75v2.75h.25a.75.75 0 0 1 0 1.5h-2a.75.75 0 0 1 0-1.5h.25v-2h-.25a.75.75 0 0 1-.75-.75ZM8 6a1 1 0 1 1 0-2 1 1 0 0 1 0 2Z"></path></svg>Note</p>
<p>The URL will be automatically adjusted to match the request host</p>
</blockquote>
<h4 id="tilejson-in-sql-comments-1"><a class="header" href="#tilejson-in-sql-comments-1">TileJSON in SQL Comments</a></h4>
<p>To modify automatically generated <code>TileJSON</code>, you can add a valid JSON as an SQL comment on the function.
Martin will merge function comment into the generated <code>TileJSON</code> using <a href="https://www.rfc-editor.org/rfc/rfc7386">JSON Merge patch</a>.
The following example adds <code>attribution</code> and <code>version</code> fields to the <code>TileJSON</code>.</p>
<blockquote class="blockquote-tag blockquote-tag-note">
<p class="blockquote-tag-title"><svg viewbox="0 0 16 16" width="18" height="18"><path d="M0 8a8 8 0 1 1 16 0A8 8 0 0 1 0 8Zm8-6.5a6.5 6.5 0 1 0 0 13 6.5 6.5 0 0 0 0-13ZM6.5 7.75A.75.75 0 0 1 7.25 7h1a.75.75 0 0 1 .75.75v2.75h.25a.75.75 0 0 1 0 1.5h-2a.75.75 0 0 1 0-1.5h.25v-2h-.25a.75.75 0 0 1-.75-.75ZM8 6a1 1 0 1 1 0-2 1 1 0 0 1 0 2Z"></path></svg>Note</p>
<p>This example uses <code>EXECUTE</code> to ensure that the comment is a valid JSON
(or else PostgreSQL will throw an error).
You can use other methods of creating SQL comments.</p>
</blockquote>
<pre><code class="language-sql">DO $do$ BEGIN
    EXECUTE 'COMMENT ON FUNCTION my_function_name IS $tj$' || $$
    {
        "description": "my new description",
        "attribution": "my attribution",
        "vector_layers": [
            {
                "id": "my_layer_id",
                "fields": {
                    "field1": "String",
                    "field2": "Number"
                }
            }
        ]
    }
    $$::json || '$tj$';
END $do$;
</code></pre>
<div style="break-before: page; page-break-before: always;"></div>
<h1 id="cloud-optimized-geotiff-file-sources"><a class="header" href="#cloud-optimized-geotiff-file-sources">Cloud Optimized GeoTIFF File Sources</a></h1>
<blockquote class="blockquote-tag blockquote-tag-warning">
<p class="blockquote-tag-title"><svg viewbox="0 0 16 16" width="18" height="18"><path d="M6.457 1.047c.659-1.234 2.427-1.234 3.086 0l6.082 11.378A1.75 1.75 0 0 1 14.082 15H1.918a1.75 1.75 0 0 1-1.543-2.575Zm1.763.707a.25.25 0 0 0-.44 0L1.698 13.132a.25.25 0 0 0 .22.368h12.164a.25.25 0 0 0 .22-.368Zm.53 3.996v2.5a.75.75 0 0 1-1.5 0v-2.5a.75.75 0 0 1 1.5 0ZM9 11a1 1 0 1 1-2 0 1 1 0 0 1 2 0Z"></path></svg>Warning</p>
<p>This feature is currently unstable and thus not included in the default build.
Its behaviour may change in patch releases.</p>
<p>To experiment with it, <a href="https://rust-lang.org/tools/install/">install Rust</a>, and run this to download, compile, and install martin with the unstable feature:</p>
<pre><code class="language-bash">cargo install martin --features=unstable-cog
</code></pre>
<p>It is unstable due to the limitations of our current implementation:</p>
<ul>
<li><a href="https://epsg.io/3857"><code>EPSG:3857</code></a> is not yet supported =&gt; <a href="https://github.com/maplibre/martin/pull/1893">https://github.com/maplibre/martin/pull/1893</a></li>
</ul>
<p>We welcome contributions to help stabilise this feature!</p>
</blockquote>
<p>Martin supports serving raster sources like local <a href="https://cogeo.org/">COG(Cloud Optimized GeoTIFF)</a> files.</p>
<blockquote class="blockquote-tag blockquote-tag-note">
<p class="blockquote-tag-title"><svg viewbox="0 0 16 16" width="18" height="18"><path d="M0 8a8 8 0 1 1 16 0A8 8 0 0 1 0 8Zm8-6.5a6.5 6.5 0 1 0 0 13 6.5 6.5 0 0 0 0-13ZM6.5 7.75A.75.75 0 0 1 7.25 7h1a.75.75 0 0 1 .75.75v2.75h.25a.75.75 0 0 1 0 1.5h-2a.75.75 0 0 1 0-1.5h.25v-2h-.25a.75.75 0 0 1-.75-.75ZM8 6a1 1 0 1 1 0-2 1 1 0 0 1 0 2Z"></path></svg>Note</p>
<p>For cog on remote storage like S3 and other improvements, you could track them on <a href="https://github.com/maplibre/martin/issues/875">issue 875</a>.
We welcome any assistance.</p>
</blockquote>
<h2 id="supported-colortype-and-bits-per-sample"><a class="header" href="#supported-colortype-and-bits-per-sample">Supported colortype and bits per sample</a></h2>
<div class="table-wrapper">
<table>
<thead>
<tr><th>colory type</th><th>bits per sample</th><th>supported</th><th>status</th></tr>
</thead>
<tbody>
<tr><td>rgb/rgba</td><td>8</td><td>✅</td><td></td></tr>
<tr><td>rgb/rgba</td><td>16/32…</td><td>🛠️</td><td>working on</td></tr>
<tr><td>gray</td><td>8/16/32…</td><td>🛠️</td><td>working on</td></tr>
</tbody>
</table>
</div>
<h2 id="supported-compression"><a class="header" href="#supported-compression">Supported compression</a></h2>
<ul>
<li>None</li>
<li>LZW</li>
<li>Deflate</li>
<li>PackBits</li>
</ul>
<h2 id="run-martin-with-cli-to-serve-cog-files"><a class="header" href="#run-martin-with-cli-to-serve-cog-files">Run Martin with CLI to serve cog files</a></h2>
<pre><code class="language-bash"># Configured with a directory containing `*.tif` or `*.tiff` TIFF files.
martin /with/tiff/dir1 /with/tiff/dir2
# Configured with dedicated TIFF file
martin /path/to/target1.tif /path/to/target2.tiff
# Configured with a combination of directories and dedicated TIFF files.
martin /with/tiff/files /path/to/target1.tif /path/to/target2.tiff
</code></pre>
<h2 id="run-martin-with-configuration-file"><a class="header" href="#run-martin-with-configuration-file">Run Martin with configuration file</a></h2>
<p>To add a COG in martin, simply add</p>
<pre><code class="language-yml"># Cloud Optimized GeoTIFF File Sources
cog:
  paths:
    # scan this whole dir, matching all *.tif and *.tiff files
    - /dir-path
    # specific TIFF file will be published as a cog source
    - /path/to/cog_file1.tif
    - /path/to/cog_file2.tiff
  sources:
    # named source matching source name to a single file
     cog-src1: /path/to/cog1.tif
     cog-src2: /path/to/cog2.tif
</code></pre>
<h2 id="about-cog"><a class="header" href="#about-cog">About COG</a></h2>
<p><a href="https://cogeo.org/">COG</a> is just Cloud Optimized GeoTIFF file.</p>
<p>TIFF is an image file format. TIFF tags are something like key-value pairs inside to describe the metadata about a TIFF file, ike <code>ImageWidth</code>, <code>ImageLength</code>, etc.</p>
<p>GeoTIFF is a valid TIFF file with a set of TIFF tags to describe the ‘Cartographic’ information associated with it.</p>
<p>COG is a valid GeoTIFF file with some requirements for efficient reading. That is, all COG files are valid GeoTIFF files, but not all GeoTIFF files are valid COG files. For quick access to tiles in TIFF files, Martin relies on the requirements/recommendations(like the <a href="https://docs.ogc.org/is/21-026/21-026.html#_requirement_reduced_resolution_subfiles">requirement about Reduced-Resolution Subfiles</a> and <a href="https://docs.ogc.org/is/21-026/21-026.html#_tiles">the content dividing strategy</a>) so we use the term <code>COG</code> over <code>GeoTIFF</code> in our documentation and configuration files.</p>
<p>You may want to visit these specs:</p>
<ul>
<li><a href="https://www.itu.int/itudoc/itu-t/com16/tiff-fx/docs/tiff6.pdf">TIFF 6.0</a></li>
<li><a href="https://docs.ogc.org/is/19-008r4/19-008r4.html">GeoTIFF</a></li>
<li><a href="https://docs.ogc.org/is/21-026/21-026.html">Cloud Optimized GeoTIFF</a></li>
</ul>
<h3 id="cog-generation-with-gdal"><a class="header" href="#cog-generation-with-gdal">COG generation with GDAL</a></h3>
<p>You could generate cog with <code>gdal_translate</code> or <code>gdalwarp</code>. See more details in <a href="https://gdal.org/en/latest/drivers/raster/cog.html">gdal doc</a>.</p>
<pre><code class="language-bash"># gdal-bin installation
# sudo apt update
# sudo apt install gdal-bin

# gdalwarp
gdalwarp src1.tif src2.tif out.tif -of COG

# or gdal_translate
gdal_translate input.tif output_cog.tif -of COG
</code></pre>
<h3 id="the-mapping-from-zxy-to-tiff-chunk"><a class="header" href="#the-mapping-from-zxy-to-tiff-chunk">The mapping from ZXY to tiff chunk</a></h3>
<ul>
<li>A single TIFF file could contains many sub-file about same spatial area, each has different resolution</li>
<li>A sub file is organized with many tiles</li>
</ul>
<p>So basically there’s a mapping from zxy to tile of sub-file of TIFF.</p>
<div class="table-wrapper">
<table>
<thead>
<tr><th>zxy</th><th>mapping to</th></tr>
</thead>
<tbody>
<tr><td>Zoom level</td><td>which sub-file in TIFF file</td></tr>
<tr><td>X and Y</td><td>which tile in subfile</td></tr>
</tbody>
</table>
</div>
<p>Clients could read only the header part of COG to figure out the mapping from zxy to the chunk number and the subfile number. Martin get tile to frontend by this mapping.</p>
<div style="break-before: page; page-break-before: always;"></div>
<h1 id="composite-sources-1"><a href="#composite-sources-1" class="header">Composite Sources</a></h1>
<h2 id="composite-sources"><a class="header" href="#composite-sources">Composite Sources</a></h2>
<p>Composite Sources allows combining multiple sources into one. Composite Source consists of multiple sources separated by
comma <code>{source1},...,{sourceN}</code></p>
<p>Each source in a composite source can be accessed with its <code>{source_name}</code> as a <code>source-layer</code> property.</p>
<p>Composite source <a href="https://github.com/mapbox/tilejson-spec">TileJSON</a> endpoint is available
at <code>/{source1},...,{sourceN}</code>, and tiles are available at <code>/{source1},...,{sourceN}/{z}/{x}/{y}</code>.</p>
<p>For example, composite source combining <code>points</code> and <code>lines</code> sources will be available at <code>/points,lines/{z}/{x}/{y}</code></p>
<pre><code class="language-bash"># TileJSON
curl localhost:3000/points,lines

# Whole world as a single tile
curl localhost:3000/points,lines/0/0/0
</code></pre>
<div style="break-before: page; page-break-before: always;"></div>
<h1 id="supporting-resources"><a class="header" href="#supporting-resources">Supporting Resources</a></h1>
<p>Data alone is not enough to show an interactive map.
A map requires data, but it also requires fonts, sprites (sometimes called glyphs) and (dependent on the rendering engine) a style.</p>
<div style="break-before: page; page-break-before: always;"></div>
<h1 id="sprites"><a href="#sprites" class="header">Sprites</a></h1>
<h2 id="sprite-sources"><a class="header" href="#sprite-sources">Sprite Sources</a></h2>
<p>Given a directory with SVG images, Martin will generate a sprite – a JSON index and a PNG image, for both low and highresolution displays.
The SVG filenames without extension will be used as the sprites’ image IDs (remember that one sprite and thus <code>sprite_id</code> contains multiple images).
The images are searched recursively in the given directory, so subdirectory names will be used as prefixes for the image IDs.
For example <code>icons/bicycle.svg</code> will be available as <code>icons/bicycle</code> sprite image.</p>
<p>The spritesheet generation is cached and the size of this cache can be configured via <code>sprites.cache_size_mb</code> in the config file.</p>
<h3 id="api"><a class="header" href="#api">API</a></h3>
<p>Martin uses <a href="https://maplibre.org/maplibre-style-spec/sprite/">MapLibre sprites API</a> specification to serve sprites via
several endpoints. The sprite image and index are generated on the fly, so if the sprite directory is updated, the
changes will be reflected immediately.</p>
<p>You can use the <code>/catalog</code> api to see all the <code>&lt;sprite_id&gt;</code>s with their contained sprites.</p>
<h5 id="sprite-png"><a class="header" href="#sprite-png">Sprite PNG</a></h5>
<p><img src="images/sources-sprites.png" alt="sprite"></p>
<p><code>GET /sprite/&lt;sprite_id&gt;.png</code> endpoint contains a single PNG sprite image that combines all sources images.
Additionally, there is a high DPI version available at <code>GET /sprite/&lt;sprite_id&gt;@2x.png</code>.</p>
<h5 id="sprite-index"><a class="header" href="#sprite-index">Sprite index</a></h5>
<p><code>/sprite/&lt;sprite_id&gt;.json</code> metadata index describing the position and size of each image inside the sprite. Just like
the PNG, there is a high DPI version available at <code>/sprite/&lt;sprite_id&gt;@2x.json</code>.</p>
<pre><code class="language-json">{
  "bicycle": {
    "height": 15,
    "pixelRatio": 1,
    "width": 15,
    "x": 20,
    "y": 16
  },
  ...
}
</code></pre>
<h5 id="coloring-at-runtime-via-signed-distance-fields-sdfs"><a class="header" href="#coloring-at-runtime-via-signed-distance-fields-sdfs">Coloring at runtime via Signed Distance Fields (SDFs)</a></h5>
<p>If you want to set the color of a sprite at runtime, you will need use the <a href="https://steamcdn-a.akamaihd.net/apps/valve/2007/SIGGRAPH2007_AlphaTestedMagnification.pdf">Signed Distance Fields (SDFs)</a>-endpoints.
For example, maplibre does support the image being modified via the <a href="https://maplibre.org/maplibre-style-spec/layers/#icon-color"><code>icon-color</code></a> and <a href="https://maplibre.org/maplibre-style-spec/layers/#icon-halo-color"><code>icon-halo-color</code></a> properties if using SDFs.</p>
<p>SDFs have the significant <strong>downside of only allowing one color</strong>.
If you want multiple colors, you will need to layer icons on top of each other.</p>
<p>The following APIs are available:</p>
<ul>
<li><code>/sdf_sprite/&lt;sprite_id&gt;.json</code> for getting a sprite index as SDF and</li>
<li><code>/sdf_sprite/&lt;sprite_id&gt;.png</code> for getting sprite PNGs as SDF</li>
</ul>
<h4 id="combining-multiple-sprites"><a class="header" href="#combining-multiple-sprites">Combining Multiple Sprites</a></h4>
<p>Multiple <code>sprite_id</code> values can be combined into one sprite with the same pattern as for tile
joining:  <code>/sprite/&lt;sprite_id1&gt;,&lt;sprite_id2&gt;,...,&lt;sprite_idN&gt;</code>. No ID renaming is done, so identical sprite names will
override one another.</p>
<h3 id="configuring-from-cli"><a class="header" href="#configuring-from-cli">Configuring from CLI</a></h3>
<p>A sprite directory can be configured from the CLI with the <code>--sprite</code> flag. The flag can be used multiple times to
configure multiple sprite directories. The <code>sprite_id</code> of the sprite will be the name of the directory – in the example below,
the sprites will be available at <code>/sprite/sprite_a</code> and <code>/sprite/sprite_b</code>. Use <code>--save-config</code> to save the
configuration to the config file.</p>
<pre><code class="language-bash">martin --sprite /path/to/sprite_a --sprite /path/to/other/sprite_b
</code></pre>
<h3 id="configuring-with-config-file"><a class="header" href="#configuring-with-config-file">Configuring with Config File</a></h3>
<p>A sprite directory can be configured from the config file with the <code>sprite</code> key, similar to
how <a href="#configuration-file">MBTiles and PMTiles</a> are configured.</p>
<pre><code class="language-yaml"># Sprite configuration
sprites:
  paths:
    # all SVG files in this directory will be published under the sprite_id "my_images"
    - /path/to/my_images
  sources:
    # SVG images in this directory will be published under the sprite_id "my_sprites"
    my_sprites: /path/to/some_dir
</code></pre>
<p>The sprites are now available at <code>/sprite/my_images,some_dir.png</code>/ …</p>
<div style="break-before: page; page-break-before: always;"></div>
<h1 id="styles"><a href="#styles" class="header">Styles</a></h1>
<h2 id="style-sources"><a class="header" href="#style-sources">Style Sources</a></h2>
<p>Martin will serve your styles as needed by MapLibre rendering libraries.</p>
<p>To edit these styles, we recommend using <a href="https://maputnik.github.io/editor/">https://maputnik.github.io/editor/</a>.</p>
<h3 id="api-1"><a class="header" href="#api-1">API</a></h3>
<p>Martin can serve <a href="https://maplibre.org/maplibre-style-spec/">MapLibre Style Spec</a>.
Currently, Martin will use any valid <a href="https://json.org"><code>JSON</code></a> file as a style,
but in the future, we may optimise Martin which may result in additional restrictions.</p>
<p>Use the <code>/catalog</code> API to see all the <code>&lt;style_id&gt;</code>s.</p>
<h3 id="map-style"><a class="header" href="#map-style">Map Style</a></h3>
<p>Use the <code>/style/&lt;style_id&gt;</code> API to get a <code>&lt;style_id&gt;</code>’s JSON content.</p>
<p>Changes or removals of styles are reflected immediately, but additions are not.
A restart of Martin is required to see new styles.</p>
<h3 id="server-side-raster-tile-rendering"><a class="header" href="#server-side-raster-tile-rendering">Server-side raster tile rendering</a></h3>
<blockquote class="blockquote-tag blockquote-tag-warning">
<p class="blockquote-tag-title"><svg viewbox="0 0 16 16" width="18" height="18"><path d="M6.457 1.047c.659-1.234 2.427-1.234 3.086 0l6.082 11.378A1.75 1.75 0 0 1 14.082 15H1.918a1.75 1.75 0 0 1-1.543-2.575Zm1.763.707a.25.25 0 0 0-.44 0L1.698 13.132a.25.25 0 0 0 .22.368h12.164a.25.25 0 0 0 .22-.368Zm.53 3.996v2.5a.75.75 0 0 1-1.5 0v-2.5a.75.75 0 0 1 1.5 0ZM9 11a1 1 0 1 1-2 0 1 1 0 0 1 2 0Z"></path></svg>Warning</p>
<p>This feature is currently unstable and thus not included in the default build.
Its behaviour may change in patch releases.</p>
<p>To experiment with it, <a href="https://rust-lang.org/tools/install/">install Rust</a> and run <code>just install-dependencies</code>.
With these installed, run the following command to install martin with the unstable feature:</p>
<pre><code class="language-bash">cargo build --features=unstable-rendering
</code></pre>
<p>It is unstable due to the limitations of our current implementation:</p>
<ul>
<li>Rendering support is currently only available on Linux.
To add support for macOS/Windows, please see <a href="https://github.com/maplibre/maplibre-native-rs">https://github.com/maplibre/maplibre-native-rs</a>.</li>
<li>Currently, martin does not cache style rendered requests and</li>
<li>does not support concurrency for this feature.</li>
</ul>
<p>We welcome contributions to help stabilise this feature!</p>
</blockquote>
<p>We support generating a rasterised image for an XYZ tile of a given style.</p>
<p>To do so, you need to enable the feature in the configuration file:</p>
<pre><code class="language-yaml">styles:
    rendering: true
</code></pre>
<p>After doing so, you can use the <code>/style/&lt;style_id&gt;/{z}/{x}/{y}.{filetype}</code> API to get a <code>&lt;style_id&gt;</code>’s rendered png/jpeg content.</p>
<h3 id="static-image-prepraration"><a class="header" href="#static-image-prepraration">Static image prepraration</a></h3>
<p>We currently do not have the same <a href="https://tileserver.readthedocs.io/en/latest/endpoints.html#static-images">capabilites as Tileserver-GL</a> to layout images.
We are working on adding this feature and are very open to contributions.</p>
<div style="break-before: page; page-break-before: always;"></div>
<h1 id="fonts"><a href="#fonts" class="header">Fonts</a></h1>
<h2 id="font-sources"><a class="header" href="#font-sources">Font Sources</a></h2>
<p>Martin can serve glyph ranges from <code>otf</code>, <code>ttf</code>, and <code>ttc</code> fonts as needed by MapLibre text rendering. Martin will
generate them dynamically on the fly.
The glyph range generation is cached and the size of this cache can be configured via <code>fonts.cache_size_mb</code> in the config file.</p>
<h2 id="api-2"><a class="header" href="#api-2">API</a></h2>
<p>Fonts ranges are available either for a single font, or a combination of multiple fonts. The font names are
case-sensitive and should match the font name in the font file as published in the catalog. Make sure to URL-escape font
names as they usually contain spaces.</p>
<div class="table-wrapper">
<table>
<thead>
<tr><th></th><th>Font Request</th></tr>
</thead>
<tbody>
<tr><td>Pattern</td><td><code>/font/{name}/{start}-{end}</code></td></tr>
<tr><td>Example</td><td><code>/font/Overpass%20Mono%20Bold/0-255</code></td></tr>
</tbody>
</table>
</div>
<h3 id="composite-font-request"><a class="header" href="#composite-font-request">Composite Font Request</a></h3>
<p>When combining multiple fonts, the glyph range will contain glyphs from the first listed font if available, and fallback
to the next font if the glyph is not available in the first font, etc. The glyph range will be empty if none of the
fonts contain the glyph.</p>
<div class="table-wrapper">
<table>
<thead>
<tr><th></th><th>Composite Font Request with fallbacks</th></tr>
</thead>
<tbody>
<tr><td>Pattern</td><td><code>/font/{name1},…,{nameN}/{start}-{end}</code></td></tr>
<tr><td>Example</td><td><code>/font/Overpass%20Mono%20Bold,Overpass%20Mono%20Light/0-255</code></td></tr>
</tbody>
</table>
</div>
<h3 id="catalog"><a class="header" href="#catalog">Catalog</a></h3>
<p>Martin will show all available fonts at the <code>/catalog</code> endpoint.</p>
<pre><code class="language-bash">curl http://127.0.0.1:3000/catalog
{
  "fonts": {
    "Overpass Mono Bold": {
      "family": "Overpass Mono",
      "style": "Bold",
      "glyphs": 931,
      "start": 0,
      "end": 64258
    },
    "Overpass Mono Light": {
      "family": "Overpass Mono",
      "style": "Light",
      "glyphs": 931,
      "start": 0,
      "end": 64258
    },
    "Overpass Mono SemiBold": {
      "family": "Overpass Mono",
      "style": "SemiBold",
      "glyphs": 931,
      "start": 0,
      "end": 64258
    }
  }
}
</code></pre>
<h2 id="using-from-cli"><a class="header" href="#using-from-cli">Using from CLI</a></h2>
<p>A font file or directory can be configured from the <a href="#command-line-interface-1">CLI</a> with one or more <code>--font</code> parameters.</p>
<pre><code class="language-bash">martin --font /path/to/font/file.ttf --font /path/to/font_dir
</code></pre>
<h2 id="configuring-from-config-file"><a class="header" href="#configuring-from-config-file">Configuring from Config File</a></h2>
<p>A font directory can be configured from the config file with the <code>fonts</code> key.</p>
<pre><code class="language-yaml"># Fonts configuration
fonts:
  # A list of *.otf, *.ttf, and *.ttc font files and dirs to search recursively.
  - /path/to/font/file.ttf
  - /path/to/font_dir
</code></pre>
<div style="break-before: page; page-break-before: always;"></div>
<h1 id="available-api-endpoints"><a href="#available-api-endpoints" class="header">Available API Endpoints</a></h1>
<h2 id="martin-endpoints"><a class="header" href="#martin-endpoints">Martin Endpoints</a></h2>
<p>Martin data is available via the HTTP <code>GET</code> endpoints:</p>
<div class="table-wrapper">
<table>
<thead>
<tr><th>URL</th><th>Description</th></tr>
</thead>
<tbody>
<tr><td><code>/</code></td><td>Web UI</td></tr>
<tr><td><code>/catalog</code></td><td><a href="#catalog-1">List of all sources</a></td></tr>
<tr><td><code>/{sourceID}</code></td><td><a href="#source-tilejson">Source TileJSON</a></td></tr>
<tr><td><code>/{sourceID}/{z}/{x}/{y}</code></td><td>Map Tiles</td></tr>
<tr><td><code>/{source1},…,{sourceN}</code></td><td><a href="#source-tilejson">Composite Source TileJSON</a></td></tr>
<tr><td><code>/{source1},…,{sourceN}/{z}/{x}/{y}</code></td><td><a href="#composite-sources-1">Composite Source Tiles</a></td></tr>
<tr><td><code>/sprite/{spriteID}[@2x].{json,png}</code></td><td><a href="#sprites">Sprite sources</a></td></tr>
<tr><td><code>/sdf_sprite/{spriteID}[@2x].{json,png}</code></td><td><a href="#sprites">SDF Sprite sources</a></td></tr>
<tr><td><code>/font/{font}/{start}-{end}</code></td><td><a href="#fonts">Font source</a></td></tr>
<tr><td><code>/font/{font1},…,{fontN}/{start}-{end}</code></td><td><a href="#fonts">Composite Font source</a></td></tr>
<tr><td><code>/style/{style}</code></td><td><a href="#styles">Style source</a></td></tr>
<tr><td><code>/health</code></td><td>Martin server health check: returns 200 <code>OK</code></td></tr>
<tr><td><code>/_/metrics</code></td><td>Martin server Prometheus metrics</td></tr>
</tbody>
</table>
</div>
<h3 id="duplicate-source-id"><a class="header" href="#duplicate-source-id">Duplicate Source ID</a></h3>
<p>In case there is more than one source that has the same name, e.g. a PG function is available in two
schemas/connections, or a table has more than one geometry columns, sources will be assigned unique IDs such
as <code>/points</code>, <code>/points.1</code>, etc.</p>
<h3 id="reserved-source-ids"><a class="header" href="#reserved-source-ids">Reserved Source IDs</a></h3>
<p>Some source IDs are reserved for internal use. If you try to use them, they will be automatically renamed to a unique ID
the same way as duplicate source IDs are handled, e.g. a <code>catalog</code> source will become <code>catalog.1</code>.</p>
<p>Some of the reserved IDs: <code>_</code>, <code>catalog</code>, <code>config</code>, <code>font</code>, <code>health</code>, <code>help</code>, <code>index</code>, <code>manifest</code>, <code>metrics</code>, <code>refresh</code>,
<code>reload</code>, <code>sprite</code>, <code>status</code>.</p>
<h3 id="catalog-1"><a class="header" href="#catalog-1">Catalog</a></h3>
<p>A list of all available sources is available via catalogue endpoint:</p>
<pre><code class="language-bash">curl localhost:3000/catalog | jq
</code></pre>
<pre><code class="language-yaml">{
  "tiles" {
    "function_zxy_query": {
      "name": "public.function_zxy_query",
      "content_type": "application/x-protobuf"
    },
    "points1": {
      "name": "public.points1.geom",
      "content_type": "image/webp"
    },
    ...
  },
  "sprites": {
    "cool_icons": {
      "images": [
        "bicycle",
        "bear",
      ]
    },
    ...
  },
  "fonts": {
    "Noto Mono Regular": {
      "family": "Noto Mono",
      "style": "Regular",
      "glyphs": 875,
      "start": 0,
      "end": 65533
    },
    ...
  },
  "styles": {
    "maplibre_demo": {
      "path": "path/to/maplibre_demo.json",
    },
  },
}
</code></pre>
<h3 id="source-tilejson"><a class="header" href="#source-tilejson">Source TileJSON</a></h3>
<p>All tile sources have a <a href="https://github.com/mapbox/tilejson-spec">TileJSON</a> endpoint available at the <code>/{SourceID}</code>.</p>
<p>For example, a <code>points</code> function or a table will be available as <code>/points</code>. Composite source combining <code>points</code>
and <code>lines</code> sources will be available at <code>/points,lines</code> endpoint.</p>
<pre><code class="language-bash">curl localhost:3000/points | jq
curl localhost:3000/points,lines | jq
</code></pre>
<div style="break-before: page; page-break-before: always;"></div>
<h1 id="guides"><a class="header" href="#guides">Guides</a></h1>
<p>This section of the docs’ site is dedicated to some examples and tutorials.
If you have something you would like to share with the community that is not straightforward and might be beneficial to others, this is the place!</p>
<p>The process of adding examples or guides is pretty straightforward, see our <code>docs</code> folder in the <a href="https://github.com/maplibre/martin">Martin repository</a> for more information.</p>
<div style="break-before: page; page-break-before: always;"></div>
<h1 id="map-renderer-specific"><a class="header" href="#map-renderer-specific">Map renderer specific</a></h1>
<p>Martin is mostly a general purpose tileserver.
It can thus be used in conjunction with renderers that are not <a href="https://maplibre.org">maplibre</a>.</p>
<blockquote class="blockquote-tag blockquote-tag-warning">
<p class="blockquote-tag-title"><svg viewbox="0 0 16 16" width="18" height="18"><path d="M6.457 1.047c.659-1.234 2.427-1.234 3.086 0l6.082 11.378A1.75 1.75 0 0 1 14.082 15H1.918a1.75 1.75 0 0 1-1.543-2.575Zm1.763.707a.25.25 0 0 0-.44 0L1.698 13.132a.25.25 0 0 0 .22.368h12.164a.25.25 0 0 0 .22-.368Zm.53 3.996v2.5a.75.75 0 0 1-1.5 0v-2.5a.75.75 0 0 1 1.5 0ZM9 11a1 1 0 1 1-2 0 1 1 0 0 1 2 0Z"></path></svg>Warning</p>
<p>Style serving, as it is specific to <a href="https://maplibre.org">maplibre</a>.</p>
</blockquote>
<div style="break-before: page; page-break-before: always;"></div>
<h1 id="maplibre"><a href="#maplibre" class="header">MapLibre</a></h1>
<h2 id="using-with-maplibre"><a class="header" href="#using-with-maplibre">Using with MapLibre</a></h2>
<p><a href="https://maplibre.org/maplibre-gl-js/docs/">MapLibre</a> is an Open-source JavaScript library for showing maps on a
website. MapLibre can accept <a href="https://github.com/mapbox/vector-tile-spec">MVT vector tiles</a> generated by Martin, and
applies <a href="https://maplibre.org/maplibre-style-spec/">a style</a> to them to draw a map using Web GL.</p>
<p>You can add a layer to the map and specify Martin <a href="https://github.com/mapbox/tilejson-spec">TileJSON</a> endpoint as a
vector source URL. You should also specify a <code>source-layer</code> property. For <a href="#postgresql-table-sources">Table Sources</a> it
is <code>{table_name}</code> by default.</p>
<pre><code class="language-js">map.addLayer({
    id: 'points',
    type: 'circle',
    source: {
        type: 'vector',
        url: 'http://localhost:3000/points'
    },
    'source-layer': 'points',
    paint: {
        'circle-color': 'red'
    },
});
</code></pre>
<pre><code class="language-js">map.addSource('rpc', {
    type: 'vector',
    url: `http://localhost:3000/function_zxy_query`
});
map.addLayer({
    id: 'points',
    type: 'circle',
    source: 'rpc',
    'source-layer': 'function_zxy_query',
    paint: {
        'circle-color': 'blue'
    },
});
</code></pre>
<p>You can also combine multiple sources into one source with <a href="#composite-sources-1">Composite Sources</a>. Each source in a
composite source can be accessed with its <code>{source_name}</code> as a <code>source-layer</code> property.</p>
<pre><code class="language-js">map.addSource('points', {
    type: 'vector',
    url: `http://0.0.0.0:3000/points1,points2`
});

map.addLayer({
    id: 'red_points',
    type: 'circle',
    source: 'points',
    'source-layer': 'points1',
    paint: {
        'circle-color': 'red'
    }
});

map.addLayer({
    id: 'blue_points',
    type: 'circle',
    source: 'points',
    'source-layer': 'points2',
    paint: {
        'circle-color': 'blue'
    }
});
</code></pre>
<div style="break-before: page; page-break-before: always;"></div>
<h1 id="leaflet"><a href="#leaflet" class="header">Leaflet</a></h1>
<h2 id="using-with-leaflet"><a class="header" href="#using-with-leaflet">Using with Leaflet</a></h2>
<p><a href="https://github.com/Leaflet/Leaflet">Leaflet</a> is the leading open-source JavaScript library for mobile-friendly interactive maps.</p>
<p>You can add vector tiles using <a href="https://github.com/Leaflet/Leaflet.VectorGrid">Leaflet.VectorGrid</a> plugin. You must initialize a <a href="https://leaflet.github.io/Leaflet.VectorGrid/vectorgrid-api-docs.html#vectorgrid-protobuf">VectorGrid.Protobuf</a> with a URL template, just like in L.TileLayers. The difference is that you should define the styling for all the features.</p>
<pre><code class="language-js">L.vectorGrid
  .protobuf('http://localhost:3000/points/{z}/{x}/{y}', {
    vectorTileLayerStyles: {
      'points': {
        color: 'red',
        fill: true
      }
    }
  })
  .addTo(map);
</code></pre>
<div style="break-before: page; page-break-before: always;"></div>
<h1 id="deckgl"><a href="#deckgl" class="header">deck.gl</a></h1>
<h2 id="using-with-deckgl"><a class="header" href="#using-with-deckgl">Using with deck.gl</a></h2>
<p><a href="https://deck.gl/">deck.gl</a> is a WebGL-powered framework for visual exploratory data analysis of large datasets.</p>
<p>You can add vector tiles using <a href="https://deck.gl/docs/api-reference/geo-layers/mvt-layer">MVTLayer</a>. MVTLayer <code>data</code> property defines the remote data for the MVT layer. It can be</p>
<ul>
<li><code>String</code>: Either a URL template or a <a href="https://github.com/mapbox/tilejson-spec">TileJSON</a> URL.</li>
<li><code>Array</code>: an array of URL templates. It allows to balance the requests across different tile endpoints. For example, if you define an array with 4 urls and 16 tiles need to be loaded, each endpoint is responsible to server 16/4 tiles.</li>
<li><code>JSON</code>: A valid <a href="https://github.com/mapbox/tilejson-spec/tree/master/2.2.0">TileJSON object</a>.</li>
</ul>
<pre><code class="language-js">const pointsLayer = new MVTLayer({
  data: 'http://localhost:3000/points',
  pointRadiusUnits: 'pixels',
  getRadius: 5,
  getFillColor: [230, 0, 0]
});

const deckgl = new DeckGL({
  container: 'map',
  mapStyle: 'https://basemaps.cartocdn.com/gl/dark-matter-gl-style/style.json',
  initialViewState: {
    latitude: 0,
    longitude: 0,
    zoom: 1
  },
  layers: [pointsLayer]
});
</code></pre>
<div style="break-before: page; page-break-before: always;"></div>
<h1 id="mapbox"><a href="#mapbox" class="header">Mapbox</a></h1>
<h2 id="using-with-mapbox"><a class="header" href="#using-with-mapbox">Using with Mapbox</a></h2>
<p><a href="https://github.com/mapbox/mapbox-gl-js">Mapbox GL JS</a> is a JavaScript library for interactive, customizable vector maps on the web.
Mapbox GL JS v1.x was open source, and it was forked as MapLibre, so <a href="#maplibre">using Martin with Mapbox is similar to MapLibre</a>.
Mapbox GL JS can accept <a href="https://github.com/mapbox/vector-tile-spec">MVT vector tiles</a> generated by Martin, and applies <a href="https://maplibre.org/maplibre-style-spec/">a style</a> to them to draw a map using Web GL.</p>
<p>You can add a layer to the map and specify Martin TileJSON endpoint as a vector source URL.
You should also specify a <code>source-layer</code> property.
For <a href="#postgresql-table-sources">Table Sources</a> it is <code>{table_name}</code> by default.</p>
<pre><code class="language-js">map.addLayer({
    id: 'points',
    type: 'circle',
    source: {
        type: 'vector',
        url: 'http://localhost:3000/points'
    },
    'source-layer': 'points',
    paint: {
        'circle-color': 'red'
    }
});
</code></pre>
<div style="break-before: page; page-break-before: always;"></div>
<h1 id="openlayers"><a href="#openlayers" class="header">OpenLayers</a></h1>
<h2 id="using-with-openlayers"><a class="header" href="#using-with-openlayers">Using with OpenLayers</a></h2>
<p><a href="https://github.com/openlayers/openlayers">OpenLayers</a> is an open source library for creating interactive maps on the web. Similar to <a href="https://maplibre.org/">MapLibre GL JS</a>, it can also display image and vector map tiles served by Martin Tile Server.</p>
<p>You can integrate tile services from <code>martin</code> and <code>OpenLayers</code> with its <a href="https://openlayers.org/en/latest/apidoc/module-ol_layer_VectorTile-VectorTileLayer.html">VectorTileLayer</a>. Here is an example to add <code>MixPoints</code> vector tile source to an OpenLayers map.</p>
<pre><code class="language-js">const layer = new VectorTileLayer({
    source: new VectorTileSource({
        format: new MVT(),
        url: 'http://0.0.0.0:3000/MixPoints/{z}/{x}/{y}',
        maxZoom: 14,
    }),
});
map.addLayer(layer);
</code></pre>
<div style="break-before: page; page-break-before: always;"></div>
<h1 id="tile-source-specific"><a class="header" href="#tile-source-specific">Tile source specific</a></h1>
<p>Some sources for tiles are harder to setup than others.
Below, we provide setup instructions for some common data sources:</p>
<ul>
<li><a href="#hosted-postgresql">Hosted PostgreSQL</a></li>
<li><a href="#setting-up-a-basemap-and-overlaying-points-from-postgis">Setting up a basemap and overlaying data</a></li>
</ul>
<div style="break-before: page; page-break-before: always;"></div>
<h1 id="hosted-postgresql"><a class="header" href="#hosted-postgresql">Hosted PostgreSQL</a></h1>
<p>Some providers of PostgreSQL databases require additional configuration to work with Martin.
We try to provide a guide for each provider, but we may not cover all of them.</p>
<h2 id="using-with-digitalocean-postgresql"><a class="header" href="#using-with-digitalocean-postgresql">Using with DigitalOcean PostgreSQL</a></h2>
<p>You can use Martin with <a href="https://www.digitalocean.com/products/managed-databases-postgresql/">Managed PostgreSQL from DigitalOcean</a> with PostGIS extension</p>
<p>First, you need to download the CA certificate and get your cluster connection string from the <a href="https://cloud.digitalocean.com/databases">dashboard</a>.
After that, you can use the connection string and the CA certificate to connect to the database</p>
<pre><code class="language-bash">martin --ca-root-file ./ca-certificate.crt \
       postgres://user:password@host:port/db?sslmode=require
</code></pre>
<h2 id="using-with-heroku-postgresql"><a class="header" href="#using-with-heroku-postgresql">Using with Heroku PostgreSQL</a></h2>
<p>You can use Martin with <a href="https://www.heroku.com/postgres">Managed PostgreSQL from Heroku</a> with the PostGIS extension</p>
<pre><code class="language-bash">heroku pg:psql -a APP_NAME -c 'create extension postgis'
</code></pre>
<p>Use the same environment variables as Heroku <a href="https://devcenter.heroku.com/articles/heroku-postgres-via-mtls#step-2-configure-environment-variables">suggests for psql</a>.</p>
<pre><code class="language-bash">export DATABASE_URL=$(heroku config:get DATABASE_URL -a APP_NAME)
export PGSSLCERT=DIRECTORY/PREFIXpostgresql.crt
export PGSSLKEY=DIRECTORY/PREFIXpostgresql.key
export PGSSLROOTCERT=DIRECTORY/PREFIXroot.crt

martin
</code></pre>
<p>You may also be able to validate SSL certificate with an explicit sslmode, e.g.</p>
<pre><code class="language-bash">export DATABASE_URL="$(heroku config:get DATABASE_URL -a APP_NAME)?sslmode=verify-ca"
</code></pre>
<div style="break-before: page; page-break-before: always;"></div>
<h1 id="setting-up-a-basemap-and-overlaying-points-from-postgis"><a class="header" href="#setting-up-a-basemap-and-overlaying-points-from-postgis">Setting up a Basemap and Overlaying Points from PostGIS</a></h1>
<p>You commonly have some semi-proprietary datasource which you want to overlay onto another.
This guide shows how to generate a basemap using <a href="https://github.com/onthegomap/planetiler/">Planetiler</a> from <a href="https://osm.org">OSM</a> and overlay custom points from a <a href="https://postgis.net/">PostGIS</a> database.
See here for a discussion on the <a href="#tile-sources">pros and cons of this/alternative data sources</a>.</p>
<h2 id="prerequisites-1"><a class="header" href="#prerequisites-1">Prerequisites</a></h2>
<p>We expect you have the following already installed:</p>
<ul>
<li><a href="https://docker.io">Docker</a></li>
<li><a href="#installation">Martin binary</a></li>
</ul>
<h2 id="generate-an-mbtiles-basemap-with-planetiler"><a class="header" href="#generate-an-mbtiles-basemap-with-planetiler">Generate an MBTiles basemap with Planetiler</a></h2>
<p>There are multiple ways to generate a tile archive.
For semi-static tile archives, we think using <a href="https://github.com/onthegomap/planetiler/">Planetiler</a> to build MBtiles archives using  <a href="https://openmaptiles.org/">OpenMapTiles</a> is a good starting point.</p>
<details><summary>🤔 <i>Why do I need a tool to convert OSM to mbtiles in the first place?</i> (click to expand)</summary>
<p>The reason you need a tool to build vector tilesets from OpenStreetMap is that the data in OpenStreetMap is</p>
<ul>
<li>not following a specific schema,</li>
<li>nor pre-tiled into <code>x</code>/<code>y</code>/<code>z</code> chunks.</li>
</ul>
</details>
<details><summary>🤔 <i>What is up with MBtiles and OpenMapTiles</i> (click to expand)</summary>
<p>Good question.</p>
<p>MBtiles is the archive format. Think of a sqlite database storing the data you need a chunk (<code>x</code>/<code>y</code>/<code>z</code>) of the world.
See our comparison <a href="#tile-sources">pmtiles vs. mbtiles</a> for discussions on the pros and cons of this/alternative formats.</p>
<p>But how does the data in the archive look like?
This is where the vector tile schema comes in:
<a href="https://openmaptiles.org/">OpenMapTiles</a> defines which layers are included in the served data and how they are aggregated.
<a href="https://openmaptiles.org/">OpenMapTiles</a> does have an attribution requirement. You will need to have <a href="https://openmaptiles.org/"><code>© OpenMapTiles</code></a> at the bottom of your map.</p>
<p>See <a href="https://shortbread-tiles.org/">Shortbread</a> for a newer, but less mature alternative if you want to read more.</p>
</details>
<p>Below command downloads a tile archive at <code>data/monaco.mbtiles</code> for monaco.</p>
<p>Please refer to <a href="https://github.com/onthegomap/planetiler/">Planetilers documentation</a> on different download options.</p>
<pre><code class="language-bash">mkdir --parents data
docker run \
  --user=$UID \
  -e JAVA_TOOL_OPTIONS="-Xmx1g" \
  -v "$(pwd)/data":/data \
  --rm \
  ghcr.io/onthegomap/planetiler:latest \
  --download \
  --minzoom=0 \
  --maxzoom=14 \
  --tile_compression=none \
  --area=monaco \
  --output /data/monaco.mbtiles
</code></pre>
<h2 id="loading-data-into-a-postgis-database"><a class="header" href="#loading-data-into-a-postgis-database">Loading data into a PostGIS database</a></h2>
<h3 id="run-postgis"><a class="header" href="#run-postgis">Run PostGIS</a></h3>
<p>First, you need a running <a href="https://postgis.net">postGIS</a> instance.</p>
<pre><code class="language-bash">docker run \
  --name some-postgis \
  --env POSTGRES_PASSWORD=mypass \
  --publish 5432:5432 \
  --detach \
  postgis/postgis
</code></pre>
<h3 id="import-points-into-postgis"><a class="header" href="#import-points-into-postgis">Import Points into PostGIS</a></h3>
<p>Then you need to add geometries to the PostGIS database.
This is possible via multiple ways, such as <a href="https://osm2pgsql.org/"><code>osm2pgsql</code> for adding specific, updatable OSM data</a> or in the programming language of your choice via postgres’ various database connectors.</p>
<pre><code class="language-bash">docker exec some-postgis psql --dbname postgres --username postgres --command \
  "CREATE TABLE where_yachts_can_be_looked_at ("\
  "  title TEXT NOT NULL, "\
  "  subtitle TEXT NOT NULL, "\
  "  location GEOMETRY(Point, 4326) NOT NULL);"

docker exec some-postgis psql --dbname postgres --username postgres --command \
  "INSERT INTO where_yachts_can_be_looked_at (title, subtitle, location) VALUES ( "\
  "  'Port Hercules', "\
  "  'Great view of superyachts docked in the iconic harbor.', "\
  "  ST_SetSRID(ST_MakePoint(7.424789, 43.735217), 4326));"
</code></pre>
<h2 id="serving-tiles-with-martin"><a class="header" href="#serving-tiles-with-martin">Serving tiles with Martin</a></h2>
<p>Now we will serve the content of <a href="#mbtiles-and-pmtiles-file-sources-1">mbtiles</a> and the <a href="#postgresql-connections-1">postgis database</a>.</p>
<p>If you want more precise options what things are published how, please see the <a href="#configuration-file">configuration file</a> or <a href="#command-line-interface-1">cli documentation</a>.
By default, we will share every servable postgres <a href="#postgresql-table-sources">table, view</a> and <a href="#postgresql-function-sources-1">function</a>.</p>
<pre><code class="language-bash">martin data/monaco.mbtiles postgres://postgres:mypass@localhost:5432/postgres
</code></pre>
<p>You can now see the catalog of available things here: <a href="http://localhost:3000/catalog"><code>http://localhost:3000/catalog</code></a>
The tilejson endpoint of both tilesets is <a href="http://localhost:3000/monaco,where_yachts_can_be_looked_at"><code>http://localhost:3000/monaco,where_yachts_can_be_looked_at</code></a></p>
<h2 id="using-in-maputnik-to-style-a-map"><a class="header" href="#using-in-maputnik-to-style-a-map">Using in Maputnik to style a map</a></h2>
<p>Due to CORS, we CANNOT use the website <a href="https://maplibre.org/maputnik/">https://maplibre.org/maputnik/</a> without further setup.
Once the tiles are deployed behind https, this can be used.</p>
<p>To get a local version of maputnik, run</p>
<pre><code class="language-bash">docker run -it --rm -p 8888:80 ghcr.io/maplibre/maputnik:main
</code></pre>
<p>Maputnik is now online, so lets load martins tiles into it.</p>
<ol>
<li>Visit <a href="http://localhost:8888"><code>http://localhost:8888</code></a></li>
<li>You first need a style:
<ul>
<li>Click <code>Open</code>
<img src="images/maputnik-open.png" alt="where in the UI the “Open” button can be found"></li>
<li>Select a style you like (we are going to choose <code>Maptiler Basic</code>)
<img src="images/maputnik-select-style.png" alt="how to select a style"></li>
</ul>
</li>
<li>You now have a style using Maptilers’ (<strong>NOT martins</strong>) data. You need to change its datasource to use the tiles we just published:
<ul>
<li>Click <code>Data Sources</code>
<img src="images/maputnik-change-datasource.png" alt="how to change the datasource"></li>
<li>And add the tilejson from above <code>http://localhost:3000/monaco,where_yachts_can_be_looked_at</code>:
<img src="images/maputnik-add-tilejson.png" alt="how to add the tilejson"></li>
</ul>
</li>
<li>Now, lets zoom into monaco:
<img src="images/maputnik-zoom-into-monaco.png" alt="where monaco is on a map"></li>
<li>And finally, lets add a circle layer for our yachts:
<ul>
<li>
<p>Click <code>Add Layer</code>
<img src="images/maputnik-add-layer.png" alt="add a circle layer"></p>
</li>
<li>
<p>Configure the layer as follows:
<img src="images/maputnik-configure-layer.png" alt="add a circle layer"></p>
</li>
<li>
<p>And style it as:
<img src="images/maputnik-add-yachts-layer.png" alt="add a circle layer"></p>
<details><summary>json configuration (click to expand)</summary>
<pre><code class="language-json">{
  "id": "where_yachts_can_be_looked_at",
  "type": "circle",
  "source": "openmaptiles",
  "source-layer": "where_yachts_can_be_looked_at",
  "paint": {
    "circle-color": "rgba(255, 7, 103, 1)",
    "circle-blur": 0.2,
    "circle-radius": {
      "stops": [
        [13, 1],
        [15, 300],
        [20, 2000]
      ]
    },
    "circle-opacity": {
      "stops": [[13.5, 0], [14, 0.4]]
    }
  },
  "minzoom": 13
}
</code></pre>
</details>
</li>
</ul>
</li>
</ol>
<div style="break-before: page; page-break-before: always;"></div>
<h1 id="postgresql-ssl-certificates"><a class="header" href="#postgresql-ssl-certificates">PostgreSQL SSL Certificates</a></h1>
<p>Martin supports SSL certificate authentication for PostgreSQL connections. This guide covers certificate generation, PostgreSQL configuration, and Martin setup.</p>
<h2 id="when-to-use-ssl-certificates"><a class="header" href="#when-to-use-ssl-certificates">When to Use SSL Certificates</a></h2>
<p>Use SSL certificates for:</p>
<ul>
<li>Deployments where martin and Postgis are on separate machines</li>
<li>Compliance requirements (PCI DSS, HIPAA, etc.)</li>
<li>Cloud PostgreSQL deployments</li>
<li>High-security environments requiring certificate-based authentication</li>
</ul>
<h2 id="ssl-modes"><a class="header" href="#ssl-modes">SSL Modes</a></h2>
<div class="table-wrapper">
<table>
<thead>
<tr><th>sslmode</th><th>Eaves-<br />dropping<br />protection</th><th>MITM <br />protection</th><th>Statement</th></tr>
</thead>
<tbody>
<tr><td><code>disable</code></td><td>⛔</td><td>⛔</td><td>I don’t care about security, and I don’t want to pay the overhead of encryption.</td></tr>
<tr><td><code>allow</code></td><td>🤷</td><td>⛔</td><td>I don’t care about security, but I will pay the overhead of encryption if the server insists on it.</td></tr>
<tr><td><code>prefer</code></td><td>🤷</td><td>⛔</td><td>I don’t care about encryption, but I wish to pay the overhead of encryption if the server supports it.</td></tr>
<tr><td><code>require</code></td><td>✅</td><td>⛔</td><td>I want my data to be encrypted, and I accept the overhead. I trust that the network will make sure I always connect to the server I want.</td></tr>
<tr><td><code>verify-ca</code></td><td>✅</td><td>Depends <br /> on CA policy</td><td>I want my data encrypted, and I accept the overhead. I want to be sure that I connect to a server that I trust.</td></tr>
<tr><td><code>verify-full</code></td><td>✅</td><td>✅</td><td>I want my data encrypted, and I accept the overhead. I want to be sure that I connect to a server I trust, and that it’s the one I specify.</td></tr>
</tbody>
</table>
</div>
<p>Our recommendation: <strong><code>verify-full</code> or <code>allow</code></strong>.
There are not many cases where anything in between makes sense.</p>
<p>In particular, the default mode (<code>prefer</code>) does not make much sense.
From the postgres documentation:</p>
<blockquote>
<p>As is shown in the table, this makes no sense from a security point of view, and it only promises performance overhead if possible.
It is only provided as the default for backward compatibility, and is not recommended in secure deployments.</p>
</blockquote>
<p>For a fuller explanation of the different tradeoffs, refer to the <a href="https://www.postgresql.org/docs/current/libpq-ssl.html#LIBPQ-SSL-CONFIG">PostgreSQL SSL Certificates documentation</a>.</p>
<h2 id="generating-certificates"><a class="header" href="#generating-certificates">Generating Certificates</a></h2>
<p>For basic SSL encryption, you need:</p>
<ul>
<li><code>server-cert.pem</code> - PostgreSQL server certificate</li>
<li><code>server-key.pem</code> - PostgreSQL server private key</li>
<li><code>ca-cert.pem</code> - Certificate Authority certificate</li>
</ul>
<pre><code class="language-raw">┌─────────────────┐    SSL/TLS     ┌─────────────────┐
│     Martin      │◄─────────────►│   PostgreSQL    │
└─────────────────┘   verify-full  └─────────────────┘
         │                                   │
    ┌─────────┐                        ┌─────────────┐
    │ CA Cert │                        │ Server Cert │
    │         │                        │ Server Key  │
    └─────────┘                        └─────────────┘
</code></pre>
<h3 id="self-signed-certificates"><a class="header" href="#self-signed-certificates">Self-Signed Certificates</a></h3>
<p>To generate certificates as a CA, you will need a private key.
To verify the certificate, you will need the CA certificate.</p>
<pre><code class="language-bash"># Generate CA private key
openssl genrsa -out ca-key.pem 3072

# Generate CA certificate
openssl req -new -x509 -days 365 -key ca-key.pem -out ca-cert.pem \
    -subj "/C=US/ST=State/L=City/O=Organization/CN=Test CA"
</code></pre>
<p>You can then generate a server certificates:</p>
<pre><code class="language-bash"># Generate server private key
openssl genrsa -out server-key.pem 3072

# Generate server certificate signing request with SAN extension
openssl req -new -key server-key.pem -out server-csr.pem \
    -subj "/C=US/ST=State/L=City/O=Organization/CN=localhost" \
    -addext "subjectAltName = DNS:localhost"

# Generate server certificate signed by CA with SAN extension
openssl x509 -req -days 365 -in server-csr.pem \
    -CA ca-cert.pem -CAkey ca-key.pem \
    -CAcreateserial -out server-cert.pem -extensions v3_req \
    -extfile &lt;(printf "[v3_req]\nsubjectAltName = DNS:localhost")

# Set permissions
chmod 400 *-key.pem
chmod 444 *-cert.pem ca-cert.pem
</code></pre>
<h3 id="production-certificates"><a class="header" href="#production-certificates">Production Certificates</a></h3>
<p>For production, use certificates from:</p>
<ul>
<li>Regular Certificate Authorities (Let’s Encrypt, DigiCert, GlobalSign)</li>
<li>Cloud provider managed Certificate Authorities</li>
<li>Organization-Internal Certificate Authority</li>
</ul>
<h2 id="postgresql-configuration"><a class="header" href="#postgresql-configuration">PostgreSQL Configuration</a></h2>
<pre><code class="language-yaml">services:
  db:
    image: postgis/postgis:17-3.5
    environment:
      POSTGRES_USER: postgres
      POSTGRES_PASSWORD: password
    ports:
      - "5432:5432"
    volumes:
      - ./server-cert.pem:/var/lib/postgresql/server.crt:ro
      - ./server-key.pem:/var/lib/postgresql/server.key:ro
    command:
      - -c
      - ssl=on
      - -c
      - ssl_cert_file=/var/lib/postgresql/server.crt
      - -c
      - ssl_key_file=/var/lib/postgresql/server.key
</code></pre>
<pre><code class="language-bash">docker compose up
</code></pre>
<blockquote class="blockquote-tag blockquote-tag-tip">
<p class="blockquote-tag-title"><svg viewbox="0 0 16 16" width="18" height="18"><path d="M8 1.5c-2.363 0-4 1.69-4 3.75 0 .984.424 1.625.984 2.304l.214.253c.223.264.47.556.673.848.284.411.537.896.621 1.49a.75.75 0 0 1-1.484.211c-.04-.282-.163-.547-.37-.847a8.456 8.456 0 0 0-.542-.68c-.084-.1-.173-.205-.268-.32C3.201 7.75 2.5 6.766 2.5 5.25 2.5 2.31 4.863 0 8 0s5.5 2.31 5.5 5.25c0 1.516-.701 2.5-1.328 3.259-.095.115-.184.22-.268.319-.207.245-.383.453-.541.681-.208.3-.33.565-.37.847a.751.751 0 0 1-1.485-.212c.084-.593.337-1.078.621-1.489.203-.292.45-.584.673-.848.075-.088.147-.173.213-.253.561-.679.985-1.32.985-2.304 0-2.06-1.637-3.75-4-3.75ZM5.75 12h4.5a.75.75 0 0 1 0 1.5h-4.5a.75.75 0 0 1 0-1.5ZM6 15.25a.75.75 0 0 1 .75-.75h2.5a.75.75 0 0 1 0 1.5h-2.5a.75.75 0 0 1-.75-.75Z"></path></svg>Tip</p>
<p>Postgres requires specific file permissions and ownership for SSL certificates.
In docker this can be a bit tricky:</p>
<p>alpine images have <code>70:70</code> as the default <code>user:group</code>
debian images have <code>999:999</code> as the default <code>user:group</code></p>
<p>You can change this by running the following commands:</p>
<pre><code class="language-bash">chown 999:999 *.pem
chmod 400 *.pem
</code></pre>
</blockquote>
<h2 id="testing-with-psql"><a class="header" href="#testing-with-psql">Testing with psql</a></h2>
<p>Test SSL Connection via</p>
<pre><code class="language-bash">export PGSSLROOTCERT=ca-cert.pem
psql "postgres://postgres:password@localhost:5432/postgres?sslmode=verify-full"
</code></pre>
<blockquote class="blockquote-tag blockquote-tag-tip">
<p class="blockquote-tag-title"><svg viewbox="0 0 16 16" width="18" height="18"><path d="M8 1.5c-2.363 0-4 1.69-4 3.75 0 .984.424 1.625.984 2.304l.214.253c.223.264.47.556.673.848.284.411.537.896.621 1.49a.75.75 0 0 1-1.484.211c-.04-.282-.163-.547-.37-.847a8.456 8.456 0 0 0-.542-.68c-.084-.1-.173-.205-.268-.32C3.201 7.75 2.5 6.766 2.5 5.25 2.5 2.31 4.863 0 8 0s5.5 2.31 5.5 5.25c0 1.516-.701 2.5-1.328 3.259-.095.115-.184.22-.268.319-.207.245-.383.453-.541.681-.208.3-.33.565-.37.847a.751.751 0 0 1-1.485-.212c.084-.593.337-1.078.621-1.489.203-.292.45-.584.673-.848.075-.088.147-.173.213-.253.561-.679.985-1.32.985-2.304 0-2.06-1.637-3.75-4-3.75ZM5.75 12h4.5a.75.75 0 0 1 0 1.5h-4.5a.75.75 0 0 1 0-1.5ZM6 15.25a.75.75 0 0 1 .75-.75h2.5a.75.75 0 0 1 0 1.5h-2.5a.75.75 0 0 1-.75-.75Z"></path></svg>Tip</p>
<p>If you get file permission errors, make sure the current user can access the files.
The previous step may set them to not readable by the current user.</p>
</blockquote>
<p>Then, verify SSL Status by</p>
<pre><code class="language-sql">-- Enable SSL info extension (required for ssl_is_used function)
CREATE EXTENSION IF NOT EXISTS sslinfo;

-- Check SSL status
SELECT ssl_is_used();

-- SSL connection details
SELECT * FROM pg_stat_ssl WHERE pid = pg_backend_pid();
</code></pre>
<h2 id="martin-configuration"><a class="header" href="#martin-configuration">Martin Configuration</a></h2>
<p>Martin can be configured using environment variables, the CLI, or the configuration file.
Which of them you choose is up to you.
You do not need to configure things twice.</p>
<ul>
<li><details>
<summary>Environment Variables (click to expand)</summary>
<pre><code class="language-bash">export PGSSLROOTCERT=./ca-cert.pem
export DATABASE_URL="postgres://postgres:password@localhost:5432/postgres?sslmode=verify-full"
martin
</code></pre>
</details>
</li>
<li><details>
<summary>Configuration File (click to expand)</summary>
<pre><code class="language-yaml">postgres:
  ssl_root_cert: './ca-cert.pem'
  connection_string: 'postgres://postgres:password@localhost:5432/postgres?sslmode=verify-full'
</code></pre>
</details>
</li>
<li><details>
<summary>Command Line (click to expand)</summary>
<pre><code class="language-bash">martin --ca-root-file ./ca-cert.pem \
      "postgres://postgres:password@localhost:5432/postgres?sslmode=verify-full"
</code></pre>
</details>
</li>
</ul>
<h2 id="troubleshooting-1"><a class="header" href="#troubleshooting-1">Troubleshooting</a></h2>
<p>You can get more context via the following commands:</p>
<pre><code class="language-bash">export PGSSLMODE=verify-full
export PGSSLROOTCERT=./ca-cert.pem
# Verbose psql
psql -h localhost -U postgres -d postgres -v

# Debug Martin
RUST_LOG=debug RUST_LOG_FORMAT=pretty martin postgres://...
</code></pre>
<p>These are the errors that can occur:</p>
<ul>
<li><details>
<summary>Certificate verification failed (click to expand)</summary>
<ul>
<li>Check server certificate is signed by the CA</li>
<li>Verify CA certificate path in <code>PGSSLROOTCERT</code></li>
<li>Ensure certificate files are readable</li>
</ul>
</details>
</li>
<li><details>
<summary>Hostname verification failed (click to expand)</summary>
<ul>
<li>Server certificate CN/SAN must match hostname</li>
<li>Use <code>verify-ca</code> instead of <code>verify-full</code> if hostname doesn’t match</li>
</ul>
</details>
</li>
<li><details>
<summary>Permission denied (click to expand)</summary>
<ul>
<li>Check certificate file permissions</li>
<li>Private keys should be <code>chmod 400</code> and readable by the user running the application</li>
</ul>
</details>
</li>
<li><details>
<summary>Connection refused (click to expand)</summary>
<ul>
<li>Verify PostgreSQL accepts SSL connections</li>
<li>Check <code>pg_hba.conf</code> allows SSL from your IP</li>
</ul>
</details>
</li>
</ul>
<h2 id="security-best-practices-if-using-postgres-via-ssl"><a class="header" href="#security-best-practices-if-using-postgres-via-ssl">Security Best Practices if using postgres via SSL</a></h2>
<ul>
<li>Use at least 3072-bit RSA keys</li>
<li>Protect private keys with restricted permissions (<code>chmod 400</code>)</li>
<li>Rotate certificates before expiration</li>
<li>Use <code>verify-full</code> in production</li>
<li>Monitor certificate expiration</li>
<li>Store <code>ca-key.pem</code> securely (only needed for certificate management)</li>
<li>Use secure secret management for production certificates</li>
</ul>
<div style="break-before: page; page-break-before: always;"></div>
<h1 id="generating-tiles-in-bulk"><a class="header" href="#generating-tiles-in-bulk">Generating Tiles in Bulk</a></h1>
<p>We offer the <code>martin-cp</code> tool for generating tiles in bulk, from any source(s) supported by Martin, and save retrieved tiles into a new or an existing MBTiles file.</p>
<p><code>martin-cp</code> can be used to generate tiles for a large area or multiple areas (bounding boxes).
If multiple areas overlap, it will ensure each tile is generated only once
<code>martin-cp</code> supports the same configuration file and CLI arguments as Martin server, so it can support all sources and even combining sources.</p>
<p>After copying, <code>martin-cp</code> will update the <code>agg_tiles_hash</code> metadata value unless <code>--skip-agg-tiles-hash</code> is specified.
This allows the MBTiles file to be <a href="#aggregate-content-validation">validated</a> using <code>mbtiles validate</code> command.</p>
<h2 id="usage-1"><a class="header" href="#usage-1">Usage</a></h2>
<p>This copies tiles from a PostGIS table <code>my_table</code> into an MBTiles file <code>tileset.mbtiles</code> using <a href="#normalized">normalized</a> schema, with zoom levels from 0 to 10, and xyz-compliant tile bounds of the whole world.</p>
<pre><code class="language-bash">martin-cp  --output-file tileset.mbtiles                         \
           --mbtiles-type normalized                             \
           "--bbox=-180,-85.05112877980659,180,85.0511287798066" \
           --min-zoom 0                                          \
           --max-zoom 10                                         \
           --source source_name                                  \
           postgres://postgres@localhost:5432/db
</code></pre>
<blockquote class="blockquote-tag blockquote-tag-tip">
<p class="blockquote-tag-title"><svg viewbox="0 0 16 16" width="18" height="18"><path d="M8 1.5c-2.363 0-4 1.69-4 3.75 0 .984.424 1.625.984 2.304l.214.253c.223.264.47.556.673.848.284.411.537.896.621 1.49a.75.75 0 0 1-1.484.211c-.04-.282-.163-.547-.37-.847a8.456 8.456 0 0 0-.542-.68c-.084-.1-.173-.205-.268-.32C3.201 7.75 2.5 6.766 2.5 5.25 2.5 2.31 4.863 0 8 0s5.5 2.31 5.5 5.25c0 1.516-.701 2.5-1.328 3.259-.095.115-.184.22-.268.319-.207.245-.383.453-.541.681-.208.3-.33.565-.37.847a.751.751 0 0 1-1.485-.212c.084-.593.337-1.078.621-1.489.203-.292.45-.584.673-.848.075-.088.147-.173.213-.253.561-.679.985-1.32.985-2.304 0-2.06-1.637-3.75-4-3.75ZM5.75 12h4.5a.75.75 0 0 1 0 1.5h-4.5a.75.75 0 0 1 0-1.5ZM6 15.25a.75.75 0 0 1 .75-.75h2.5a.75.75 0 0 1 0 1.5h-2.5a.75.75 0 0 1-.75-.75Z"></path></svg>Tip</p>
<p>Next to regular sorces, <code>--source &lt;SOURCE&gt;</code> does support <a href="#composite-sources-1">composite sources</a>.
This means <code>martin-cp</code> can be used to merge two different sources into one <code>mbtiles</code> archive.</p>
</blockquote>
<p>If performance is a concern, you should also consider</p>
<blockquote class="blockquote-tag blockquote-tag-tip">
<p class="blockquote-tag-title"><svg viewbox="0 0 16 16" width="18" height="18"><path d="M8 1.5c-2.363 0-4 1.69-4 3.75 0 .984.424 1.625.984 2.304l.214.253c.223.264.47.556.673.848.284.411.537.896.621 1.49a.75.75 0 0 1-1.484.211c-.04-.282-.163-.547-.37-.847a8.456 8.456 0 0 0-.542-.68c-.084-.1-.173-.205-.268-.32C3.201 7.75 2.5 6.766 2.5 5.25 2.5 2.31 4.863 0 8 0s5.5 2.31 5.5 5.25c0 1.516-.701 2.5-1.328 3.259-.095.115-.184.22-.268.319-.207.245-.383.453-.541.681-.208.3-.33.565-.37.847a.751.751 0 0 1-1.485-.212c.084-.593.337-1.078.621-1.489.203-.292.45-.584.673-.848.075-.088.147-.173.213-.253.561-.679.985-1.32.985-2.304 0-2.06-1.637-3.75-4-3.75ZM5.75 12h4.5a.75.75 0 0 1 0 1.5h-4.5a.75.75 0 0 1 0-1.5ZM6 15.25a.75.75 0 0 1 .75-.75h2.5a.75.75 0 0 1 0 1.5h-2.5a.75.75 0 0 1-.75-.75Z"></path></svg>Tip</p>
<p><code>--concurrency &lt;CONCURRENCY&gt;</code> and <code>--pool-size &lt;POOL_SIZE&gt;</code> can be used to control the number of concurrent requests and the pool size for postgres sources respectively.</p>
<p>The optimal setting depends on:</p>
<ul>
<li>the source(s) performance characteristics</li>
<li>how much load is allowed, for example in a multi-tenant environment</li>
<li>how to compress tiles stored in the output file</li>
</ul>
</blockquote>
<p>You should also consider</p>
<blockquote class="blockquote-tag blockquote-tag-tip">
<p class="blockquote-tag-title"><svg viewbox="0 0 16 16" width="18" height="18"><path d="M8 1.5c-2.363 0-4 1.69-4 3.75 0 .984.424 1.625.984 2.304l.214.253c.223.264.47.556.673.848.284.411.537.896.621 1.49a.75.75 0 0 1-1.484.211c-.04-.282-.163-.547-.37-.847a8.456 8.456 0 0 0-.542-.68c-.084-.1-.173-.205-.268-.32C3.201 7.75 2.5 6.766 2.5 5.25 2.5 2.31 4.863 0 8 0s5.5 2.31 5.5 5.25c0 1.516-.701 2.5-1.328 3.259-.095.115-.184.22-.268.319-.207.245-.383.453-.541.681-.208.3-.33.565-.37.847a.751.751 0 0 1-1.485-.212c.084-.593.337-1.078.621-1.489.203-.292.45-.584.673-.848.075-.088.147-.173.213-.253.561-.679.985-1.32.985-2.304 0-2.06-1.637-3.75-4-3.75ZM5.75 12h4.5a.75.75 0 0 1 0 1.5h-4.5a.75.75 0 0 1 0-1.5ZM6 15.25a.75.75 0 0 1 .75-.75h2.5a.75.75 0 0 1 0 1.5h-2.5a.75.75 0 0 1-.75-.75Z"></path></svg>Tip</p>
<p><code>--encoding &lt;ENCODING&gt;</code> can be used to reduce the final size of the MBTiles file or decrease the amount of processing <code>martin-cp</code> does.</p>
<p>The default <code>gzip</code> should be a reasonable choice for most use cases, but if you prefer a different encoding, you can specify it here.
If set to multiple values like <code>'gzip,br'</code>, <code>martin-cp</code> will use the first encoding, or re-encode if the tile is already encoded and that encoding is not listed.
Use <code>identity</code> to disable compression.
Ignored for non-encodable tiles like PNG and JPEG.</p>
</blockquote>
<h2 id="arguments"><a class="header" href="#arguments">Arguments</a></h2>
<p>Use <code>martin-cp --help</code> to see a list of available options:</p>
<pre><code class="language-text">A tool to bulk copy tiles from any Martin-supported sources into an mbtiles file

Usage: martin-cp [OPTIONS] --output-file &lt;OUTPUT_FILE&gt; [CONNECTION]...

Arguments:
  [CONNECTION]...
          Connection strings, e.g. postgres://... or /path/to/files

Options:
  -s, --source &lt;SOURCE&gt;
          Name of the source to copy from. Not required if there is only one source

  -o, --output-file &lt;OUTPUT_FILE&gt;
          Path to the mbtiles file to copy to

      --mbtiles-type &lt;SCHEMA&gt;
          Output format of the new destination file. Ignored if the file exists. [DEFAULT: normalized]

          [possible values: flat, flat-with-hash, normalized]

      --url-query &lt;URL_QUERY&gt;
          Optional query parameter (in URL query format) for the sources that support it (e.g. Postgres functions).

      --encoding &lt;ENCODING&gt;
          Optional accepted encoding parameter as if the browser sent it in the HTTP request.

          If set to multiple values like gzip,br, martin-cp will use the first encoding, or re-encode if the tile is already encoded and that encoding is not listed. Use identity to disable compression. Ignored for non-encodable tiles like PNG and JPEG.

          [default: gzip]

      --on-duplicate &lt;ON_DUPLICATE&gt;
          Allow copying to existing files, and indicate what to do if a tile with the same Z/X/Y already exists.

          [possible values: override, ignore, abort]

      --concurrency &lt;CONCURRENCY&gt;
          Number of concurrent connections to use

          [default: 1]

      --bbox &lt;BBOX&gt;
          Bounds to copy, in the format min_lon,min_lat,max_lon,max_lat. Can be specified multiple times with overlapping bounds being handled correctly. Maximum bounds follows mbtiles specification for xyz-compliant tile bounds

          If omitted, will first default to configured source bounds if present. Otherwise, will default to global xyz-compliant tile bounds.

          [default: -180,-85.05112877980659,180,85.0511287798066]

      --min-zoom &lt;MIN_ZOOM&gt;
          Minimum zoom level to copy

      --max-zoom &lt;MAX_ZOOM&gt;
          Maximum zoom level to copy

  -z, --zoom-levels &lt;ZOOM_LEVELS&gt;
          List of zoom levels to copy

      --skip-agg-tiles-hash
          Skip generating a global hash for mbtiles validation. By default, martin-cp will compute and update agg_tiles_hash metadata value

      --set-meta &lt;KEY=VALUE&gt;
          Set additional metadata values. Must be set as "key=value" pairs. Can be specified multiple times

  -c, --config &lt;CONFIG&gt;
          Path to config file. If set, no tile source-related parameters are allowed

      --save-config &lt;SAVE_CONFIG&gt;
          Save resulting config to a file or use "-" to print to stdout. By default, only print if sources are auto-detected

  -b, --auto-bounds &lt;AUTO_BOUNDS&gt;
          Specify how bounds should be computed for the spatial PG tables. [DEFAULT: quick]

          Possible values:
          - quick: Compute table geometry bounds, but abort if it takes longer than 5 seconds
          - calc:  Compute table geometry bounds. The startup time may be significant. Make sure all GEO columns have indexes
          - skip:  Skip bounds calculation. The bounds will be set to the whole world

      --ca-root-file &lt;CA_ROOT_FILE&gt;
          Loads trusted root certificates from a file. The file should contain a sequence of PEM-formatted CA certificates

  -d, --default-srid &lt;DEFAULT_SRID&gt;
          If a spatial PG table has SRID 0, then this default SRID will be used as a fallback

  -p, --pool-size &lt;POOL_SIZE&gt;
          Maximum Postgres connections pool size [DEFAULT: 20]

  -m, --max-feature-count &lt;MAX_FEATURE_COUNT&gt;
          Limit the number of geo features per tile.

          If the source table has more features than set here, they will not be included in the tile and the result will look "cut off"/incomplete. This feature allows to put a maximum latency bound on tiles with extreme amount of detail at the cost of
          not returning all data. It is sensible to set this limit if you have user generated/untrusted geodata, e.g. a lot of data points at Null Island.

          Can be either a positive integer or unlimited if omitted.

  -h, --help
          Print help (see a summary with '-h')

  -V, --version
          Print version

Use RUST_LOG environment variable to control logging level, e.g. RUST_LOG=debug or RUST_LOG=martin_cp=debug. See https://docs.rs/env_logger/latest/env_logger/index.html#enabling-logging for more information.
</code></pre>
<div style="break-before: page; page-break-before: always;"></div>
<h1 id="working-with-mbtiles-archives"><a class="header" href="#working-with-mbtiles-archives">Working with MBTiles archives</a></h1>
<p>Martin includes <code>mbtiles</code> utility to interact with the <a href="#mbtiles-schemas"><code>*.mbtiles</code> files</a> from the command line.
It allows users to <a href="#mbtiles-information-and-metadata">examine</a>, <a href="#copying-diffing-and-patching-mbtiles">copy</a>, <a href="#mbtiles-validation">validate</a> or <a href="#diffing-mbtiles">compare and apply diffs between them</a>.</p>
<p>This tool can be installed by compiling the latest released version with <code>cargo install mbtiles --locked</code>, or by downloading a pre-built binary from the <a href="https://github.com/maplibre/martin/releases/latest">releases page</a>.</p>
<p>Use <code>mbtiles --help</code> to see a list of available commands:</p>
<pre><code class="language-text">A utility to work with .mbtiles file content

Usage: mbtiles &lt;COMMAND&gt;

Commands:
  summary      Show MBTiles file summary statistics
  meta-all     Prints all values in the metadata table in a free-style, unstable YAML format
  meta-get     Gets a single value from the MBTiles metadata table
  meta-set     Sets a single value in the MBTiles metadata table or deletes it if no value
  diff         Compare two files A and B, and generate a new diff file. If the diff file is applied to A, it will produce B
  copy         Copy tiles from one mbtiles file to another
  apply-patch  Apply diff file generated from 'copy' command
  meta-update  Update metadata to match the content of the file
  validate     Validate tile data if hash of tile data exists in file
  help         Print this message or the help of the given subcommand(s)

Options:
  -h, --help     Print help
  -V, --version  Print version

Use RUST_LOG environment variable to control logging level, e.g. RUST_LOG=debug or RUST_LOG=mbtiles=debug. See https://docs.rs/env_logger/latest/env_logger/index.html#enabling-logging for more information.
</code></pre>
<p>And <code>mbtiles &lt;command&gt; --help</code> to see help for a specific command.
Example for <code>mbtiles validate --help</code>:</p>
<pre><code class="language-text">Validate tile data if hash of tile data exists in file

Usage: mbtiles validate [OPTIONS] &lt;FILE&gt;

Arguments:
  &lt;FILE&gt;
          MBTiles file to validate

Options:
      --integrity-check &lt;INTEGRITY_CHECK&gt;
          Value to specify the extent of the SQLite integrity check performed

          [default: quick]
          [possible values: quick, full, off]

      --agg-hash &lt;AGG_HASH&gt;
          How should the aggregate tiles hash be checked or updated

          Possible values:
          - verify: Verify that the aggregate tiles hash value in the metadata table matches the computed value. Used by default
          - update: Update the aggregate tiles hash value in the metadata table
          - off:    Do not check the aggregate tiles hash value

  -h, --help
          Print help (see a summary with '-h')
</code></pre>
<div style="break-before: page; page-break-before: always;"></div>
<h1 id="mbtiles-schemas"><a class="header" href="#mbtiles-schemas">MBTiles Schemas</a></h1>
<p>The <code>mbtiles</code> tool builds on top of the original <a href="https://github.com/mapbox/mbtiles-spec#readme">MBTiles specification</a> by specifying three different kinds of schema for <code>tiles</code> data: <code>flat</code>, <code>flat-with-hash</code>, and <code>normalized</code>. The <code>mbtiles</code> tool can convert between these schemas, and can also generate a diff between two files of any schemas, as well as merge multiple schema files into one file.</p>
<h2 id="flat"><a class="header" href="#flat">flat</a></h2>
<p>Flat schema is the closest to the original MBTiles specification. It stores all tiles in a single table. This schema is the most efficient when the tileset contains no duplicate tiles.</p>
<pre><code class="language-sql ignore">CREATE TABLE tiles (
    zoom_level INTEGER,
    tile_column INTEGER,
    tile_row INTEGER,
    tile_data BLOB
);

CREATE UNIQUE INDEX tile_index ON tiles (
    zoom_level, tile_column, tile_row
);
</code></pre>
<h2 id="flat-with-hash"><a class="header" href="#flat-with-hash">flat-with-hash</a></h2>
<p>Similar to the <code>flat</code> schema, but also includes a <code>tile_hash</code> column that contains a hash value of the <code>tile_data</code> column. Use this schema when the tileset has no duplicate tiles, but you still want to be able to validate the content of each tile individually.</p>
<pre><code class="language-sql ignore">CREATE TABLE tiles_with_hash (
    zoom_level INTEGER NOT NULL,
    tile_column INTEGER NOT NULL,
    tile_row INTEGER NOT NULL,
    tile_data BLOB,
    tile_hash TEXT
);

CREATE UNIQUE INDEX tiles_with_hash_index ON tiles_with_hash (
    zoom_level, tile_column, tile_row
);

CREATE VIEW tiles AS
SELECT
    zoom_level,
    tile_column,
    tile_row,
    tile_data
FROM tiles_with_hash;
</code></pre>
<h2 id="normalized"><a class="header" href="#normalized">normalized</a></h2>
<p>Normalized schema is the most efficient when the tileset contains duplicate tiles. It stores all tile blobs in the <code>images</code> table, and stores the tile Z,X,Y coordinates in a <code>map</code> table. The <code>map</code> table contains a <code>tile_id</code> column that is a foreign key to the <code>images</code> table. The <code>tile_id</code> column is a hash of the <code>tile_data</code> column, making it possible to both validate each individual tile like in the <code>flat-with-hash</code> schema, and also to optimize storage by storing each unique tile only once.</p>
<pre><code class="language-sql ignore">CREATE TABLE map (
    zoom_level INTEGER,
    tile_column INTEGER,
    tile_row INTEGER,
    tile_id TEXT
);

CREATE TABLE images (
    tile_id TEXT,
    tile_data BLOB
);

CREATE UNIQUE INDEX map_index ON map (
    zoom_level, tile_column, tile_row
);
CREATE UNIQUE INDEX images_id ON images (
    tile_id
);

CREATE VIEW tiles AS
SELECT
    map.zoom_level,
    map.tile_column,
    map.tile_row,
    images.tile_data
FROM
    map INNER JOIN images
    ON map.tile_id = images.tile_id;

CREATE VIEW tiles_with_hash AS
SELECT
    map.zoom_level,
    map.tile_column,
    map.tile_row,
    images.tile_data,
    images.tile_id AS tile_hash
FROM
    map INNER JOIN images
    ON map.tile_id = images.tile_id;
</code></pre>
<p>Optionally, <code>.mbtiles</code> files with <code>normalized</code> schema can include a <code>tiles_with_hash</code> view. All <code>normalized</code> files created by the <code>mbtiles</code> tool will contain this view.</p>
<pre><code class="language-sql ignore">FROM
    map INNER JOIN images
    ON map.tile_id = images.tile_id;

CREATE VIEW tiles_with_hash AS
SELECT
    map.zoom_level,
    map.tile_column,
    map.tile_row,
    images.tile_data,
    images.tile_id AS tile_hash
FROM
    map INNER JOIN images
    ON map.tile_id = images.tile_id;
</code></pre>
<div style="break-before: page; page-break-before: always;"></div>
<h1 id="mbtiles-information-and-metadata"><a class="header" href="#mbtiles-information-and-metadata">MBTiles information and metadata</a></h1>
<h2 id="summary"><a class="header" href="#summary">summary</a></h2>
<p>Use <code>mbtiles summary</code> to get a summary of the contents of an MBTiles file. The command will print a table with the
number of tiles per zoom level, the size of the smallest and largest tiles, and the average size of tiles at each zoom
level. The command will also print the bounding box of the covered area per zoom level.</p>
<pre><code class="language-bash"># Create a sample .mbtiles file in some dir
sqlite3 target/world_cities.mbtiles &lt; tests/fixtures/mbtiles/world_cities.sql
# Get mbtiles summary
mbtiles summary target/world_cities.mbtiles

MBTiles file summary for tests/fixtures/mbtiles/world_cities.mbtiles
Schema: flat
File size: 48.00kB
Page size: 4.00kB
Page count: 12

 Zoom |   Count   | Smallest  |  Largest  |  Average  | Bounding Box
    0 |         1 |     1.0kB |     1.0kB |    1.0kB | -180,-85,180,85
    1 |         4 |      160B |      650B |      366B | -180,-85,180,85
    2 |         7 |      137B |      495B |      239B | -180,-67,180,67
    3 |        17 |       67B |      246B |      134B | -135,-41,180,67
    4 |        38 |       64B |      175B |       86B | -135,-41,180,67
    5 |        57 |       64B |      107B |       72B | -124,-41,180,62
    6 |        72 |       64B |       97B |       68B | -124,-41,180,62
  all |       196 |       64B |     1.0kB |       96B | -180,-85,180,85
</code></pre>
<h2 id="meta-all"><a class="header" href="#meta-all">meta-all</a></h2>
<p>Print all metadata values to stdout, as well as the results of tile detection. The format of the values printed is not
stable, and should only be used for visual inspection.</p>
<pre><code class="language-bash">mbtiles meta-all my_file.mbtiles
</code></pre>
<h2 id="meta-get"><a class="header" href="#meta-get">meta-get</a></h2>
<p>Retrieve raw metadata value by its name. The value is printed to stdout without any modifications. For example, to get
the <code>description</code> value from an mbtiles file:</p>
<pre><code class="language-bash">mbtiles meta-get my_file.mbtiles description
</code></pre>
<h2 id="meta-set"><a class="header" href="#meta-set">meta-set</a></h2>
<p>Set metadata value by its name, or delete the key if no value is supplied. For example, to set the <code>description</code> value
to <code>A vector tile dataset</code>:</p>
<pre><code class="language-bash">mbtiles meta-set my_file.mbtiles description "A vector tile dataset"
</code></pre>
<div style="break-before: page; page-break-before: always;"></div>
<h1 id="copying-diffing-and-patching-mbtiles"><a class="header" href="#copying-diffing-and-patching-mbtiles">Copying, Diffing, and Patching MBTiles</a></h1>
<h2 id="mbtiles-copy"><a class="header" href="#mbtiles-copy"><code>mbtiles copy</code></a></h2>
<p>Copy command copies an mbtiles file, optionally filtering its content by zoom levels.</p>
<pre><code class="language-bash">mbtiles copy src_file.mbtiles dst_file.mbtiles \
        --min-zoom 0 --max-zoom 10
</code></pre>
<p>This command can also be used to generate files of different <a href="#mbtiles-schemas">supported schema</a>.</p>
<pre><code class="language-bash">mbtiles copy normalized.mbtiles dst.mbtiles \
         --dst-type flat-with-hash
</code></pre>
<h2 id="mbtiles-copy---diff-with-file"><a class="header" href="#mbtiles-copy---diff-with-file"><code>mbtiles copy --diff-with-file</code></a></h2>
<p>This option is identical to using <a href="#diffing-mbtiles"><code>mbtiles diff ...</code></a>. The following commands two are equivalent:</p>
<pre><code class="language-bash">mbtiles diff file1.mbtiles file2.mbtiles diff.mbtiles

mbtiles copy file1.mbtiles diff.mbtiles \
        --diff-with-file file2.mbtiles
</code></pre>
<h2 id="mbtiles-copy---apply-patch"><a class="header" href="#mbtiles-copy---apply-patch"><code>mbtiles copy --apply-patch</code></a></h2>
<p>Copy a source file to destination while also applying the diff file generated by <code>copy --diff-with-file</code> command above
to the destination mbtiles file. This allows safer application of the diff file, as the source file is not modified.</p>
<pre><code class="language-bash">mbtiles copy src_file.mbtiles dst_file.mbtiles \
        --apply-patch diff.mbtiles
</code></pre>
<div style="break-before: page; page-break-before: always;"></div>
<h1 id="diffing-mbtiles"><a class="header" href="#diffing-mbtiles">Diffing MBTiles</a></h1>
<h2 id="mbtiles-diff"><a class="header" href="#mbtiles-diff"><code>mbtiles diff</code></a></h2>
<p>Copy command can also be used to compare two mbtiles files and generate a delta (diff) file. The diff file can
be <a href="#mbtiles-apply-patch">applied</a> to the <code>src_file.mbtiles</code> elsewhere, to avoid copying/transmitting the entire
modified dataset. The delta file will contain all tiles that are different between the two files (modifications,
insertions, and deletions as <code>NULL</code> values), for both the tile and metadata tables.</p>
<pre><code class="language-bash"># This command will compare `file1.mbtiles` and `file2.mbtiles`,
# and generate a new diff file `diff.mbtiles`.
mbtiles diff file1.mbtiles file2.mbtiles diff.mbtiles

# If diff.mbtiles is applied to file1.mbtiles, it will produce file2.mbtiles
mbtiles apply-patch file1.mbtiles diff.mbtiles file2a.mbtiles

# file2.mbtiles and file2a.mbtiles should now be the same
# Validate both files and see that their hash values are identical
mbtiles validate file2.mbtiles
[INFO ] The agg_tiles_hashes=E95C1081447FB25674DCC1EB97F60C26 has been verified for file2.mbtiles

mbtiles validate file2a.mbtiles
[INFO ] The agg_tiles_hashes=E95C1081447FB25674DCC1EB97F60C26 has been verified for file2a.mbtiles
</code></pre>
<h3 id="delta-file-metadata"><a class="header" href="#delta-file-metadata">Delta file metadata</a></h3>
<p>All metadata from <code>file2.mbtiles</code> will be copied to the diff file.</p>
<p>There are two exceptions to this. The first is that the <code>agg_tiles_hash</code> value will be renamed to <code>agg_tiles_hash_after_apply</code>. A
new <code>agg_tiles_hash</code> will be generated for the diff file itself. This is done to avoid confusion when applying the diff
file to the original file, as the <code>agg_tiles_hash</code> value will be different after the diff is applied. The <code>apply-patch</code>
command will automatically rename the <code>agg_tiles_hash_after_apply</code> value back to <code>agg_tiles_hash</code> when applying the
diff.</p>
<p>The second exception is that a new metadata value <code>agg_tiles_hash_before_apply</code> will be added to the diff file, which contains the
<code>agg_tiles_hash</code> value from <code>file1.mbtiles</code>. This will be used to verify that the diff file is being applied to the correct source file.</p>
<h2 id="mbtiles-apply-patch"><a class="header" href="#mbtiles-apply-patch"><code>mbtiles apply-patch</code></a></h2>
<p>Apply the diff file generated with the <code>mbtiles diff</code> command above to an MBTiles file. The diff file can be applied to
the <code>src_file.mbtiles</code> that has been previously downloaded to avoid copying/transmitting the entire modified dataset
again. The <code>src_file.mbtiles</code> will modified in-place. It is also possible to apply the diff file while copying the
source file to a new destination file, by using
the <a href="#mbtiles-copy---apply-patch"><code>mbtiles copy --apply-patch</code></a> command.</p>
<p>Note that the <code>agg_tiles_hash_after_apply</code> metadata value will be renamed to <code>agg_tiles_hash</code> when applying the diff.
This is done to avoid confusion when applying the diff file to the original file, as the <code>agg_tiles_hash</code> value will be
different after the diff is applied.</p>
<pre><code class="language-bash">mbtiles apply-patch src_file.mbtiles diff_file.mbtiles
</code></pre>
<h4 id="applying-diff-with-sqlite"><a class="header" href="#applying-diff-with-sqlite">Applying diff with SQLite</a></h4>
<p>Another way to apply the diff is to use the <code>sqlite3</code> command line tool directly. This SQL will delete all tiles
from <code>src_file.mbtiles</code> that are set to <code>NULL</code> in <code>diff_file.mbtiles</code>, and then insert or update all new tiles
from <code>diff_file.mbtiles</code> into <code>src_file.mbtiles</code>, where both files are of <code>flat</code> type. The name of the diff file is
passed as a query parameter to the sqlite3 command line tool, and then used in the SQL statements. Note that this does
not update the <code>agg_tiles_hash</code> metadata value, so it will be incorrect after the diff is applied.</p>
<pre><code class="language-bash">sqlite3 src_file.mbtiles \
  -bail \
  -cmd ".parameter set @diffDbFilename diff_file.mbtiles "\
  "ATTACH DATABASE @diffDbFilename AS diffDb; "\
  "DELETE FROM tiles "\
  "  WHERE (zoom_level, tile_column, tile_row) IN ( "\
  "    SELECT zoom_level, tile_column, tile_row "\
  "    FROM diffDb.tiles "\
  "    WHERE tile_data ISNULL); "\
  "INSERT OR REPLACE INTO tiles (zoom_level, tile_column, tile_row, tile_data) "\
  "  SELECT * FROM diffDb.tiles WHERE tile_data NOTNULL;"
</code></pre>
<div style="break-before: page; page-break-before: always;"></div>
<h1 id="mbtiles-validation"><a class="header" href="#mbtiles-validation">MBTiles Validation</a></h1>
<p>The original <a href="https://github.com/mapbox/mbtiles-spec#readme">MBTiles specification</a> does not provide any guarantees for
the content of the tile data in MBTiles. <code>mbtiles validate</code> assumes a few additional conventions and uses them to ensure
that the content of the tile data is valid performing several validation steps. If the file is not valid, the command
will print an error message and exit with a non-zero exit code.</p>
<pre><code class="language-bash">mbtiles validate src_file.mbtiles
</code></pre>
<h2 id="sqlite-integrity-check"><a class="header" href="#sqlite-integrity-check">SQLite Integrity check</a></h2>
<p>The <code>validate</code> command will run <code>PRAGMA integrity_check</code> on the file, and will fail if the result is not <code>ok</code>.
The <code>--integrity-check</code> flag can be used to disable this check, or to make it more thorough with <code>full</code> value. Default
is <code>quick</code>.</p>
<h2 id="schema-check"><a class="header" href="#schema-check">Schema check</a></h2>
<p>The <code>validate</code> command will verify that the <code>tiles</code> table/view exists, and that it has the expected columns and indexes.
It will also verify that the <code>metadata</code> table/view exists, and that it has the expected columns and indexes.</p>
<h2 id="per-tile-validation"><a class="header" href="#per-tile-validation">Per-tile validation</a></h2>
<p>If the <code>.mbtiles</code> file uses <a href="#flat-with-hash">flat_with_hash</a>
or <a href="#normalized">normalized</a> schema, the <code>validate</code> command will verify that the MD5 hash of
the <code>tile_data</code> column matches the  <code>tile_hash</code> or <code>tile_id</code> columns (depending on the schema).</p>
<p>A typical Normalized schema generated by tools like <a href="https://github.com/mapbox/TileLive#bintilelive-copy">tilelive-copy</a>
use MD5 hash in the <code>tile_id</code> column. The Martin’s <code>mbtiles</code> tool can use this hash to verify the content of each tile.
We also define a new <a href="#flat-with-hash">flat-with-hash</a> schema that stores the hash and tile data in the
same table, allowing per-tile validation without the multiple table layout.</p>
<p>Per-tile validation is not available for the <code>flat</code> schema, and will be skipped.</p>
<h2 id="aggregate-content-validation"><a class="header" href="#aggregate-content-validation">Aggregate Content Validation</a></h2>
<p>Per-tile validation will catch individual tile corruption, but it will not detect overall datastore corruption such as
missing tiles, tiles that should not exist, or tiles with incorrect z/x/y values. For that, the <code>mbtiles</code> tool defines a
new metadata value called <code>agg_tiles_hash</code>.</p>
<p>The value is computed by hashing the combined value for all rows in the <code>tiles</code> table/view, ordered by z,x,y. The value
is computed using the following SQL expression, which uses a custom <code>md5_concat_hex</code> function
from <a href="https://crates.io/crates/sqlite-hashes">sqlite-hashes crate</a>:</p>
<pre><code class="language-sql ignore">md5_concat_hex(
    CAST(zoom_level  AS TEXT),
    CAST(tile_column AS TEXT),
    CAST(tile_row    AS TEXT),
    tile_data)
</code></pre>
<p>In case there are no rows or all are NULL, the hash value of an empty string is used. Note that SQLite allows any value
type to be stored as in any column, so if <code>tile_data</code> accidentally contains non-blob/text/null value, validation will
fail.</p>
<p>The <code>mbtiles</code> tool will compute <code>agg_tiles_hash</code> value when copying or validating mbtiles files. Use <code>--agg-hash update</code>
to force the value to be updated, even if it is incorrect or does not exist.</p>
<div style="break-before: page; page-break-before: always;"></div>
<h1 id="architecture"><a class="header" href="#architecture">Architecture</a></h1>
<p>This document provides a high-level overview of Martin’s architecture, describing its major components, how they interact, and the rationale behind key design decisions.</p>
<h2 id="overview"><a class="header" href="#overview">Overview</a></h2>
<p>Martin is a blazing fast tile server written in Rust that generates and serves vector tiles on the fly from multiple data sources. It is designed to handle heavy traffic and optimize for speed while maintaining a clean separation of concerns.</p>
<p><svg id="mermaid-diagram-7506884357259863448" width="100%" xmlns="http://www.w3.org/2000/svg" class="flowchart" style="max-width: 1476.0703125px;" viewbox="0 0 1476.0703125 1124.7288818359375" role="graphics-document document" aria-roledescription="flowchart-v2"><style>#mermaid-diagram-7506884357259863448{font-family:“trebuchet ms”,verdana,arial,sans-serif;font-size:16px;fill:#333;}@keyframes edge-animation-frame{from{stroke-dashoffset:0;}}@keyframes dash{to{stroke-dashoffset:0;}}#mermaid-diagram-7506884357259863448 .edge-animation-slow{stroke-dasharray:9,5!important;stroke-dashoffset:900;animation:dash 50s linear infinite;stroke-linecap:round;}#mermaid-diagram-7506884357259863448 .edge-animation-fast{stroke-dasharray:9,5!important;stroke-dashoffset:900;animation:dash 20s linear infinite;stroke-linecap:round;}#mermaid-diagram-7506884357259863448 .error-icon{fill:#552222;}#mermaid-diagram-7506884357259863448 .error-text{fill:#552222;stroke:#552222;}#mermaid-diagram-7506884357259863448 .edge-thickness-normal{stroke-width:1px;}#mermaid-diagram-7506884357259863448 .edge-thickness-thick{stroke-width:3.5px;}#mermaid-diagram-7506884357259863448 .edge-pattern-solid{stroke-dasharray:0;}#mermaid-diagram-7506884357259863448 .edge-thickness-invisible{stroke-width:0;fill:none;}#mermaid-diagram-7506884357259863448 .edge-pattern-dashed{stroke-dasharray:3;}#mermaid-diagram-7506884357259863448 .edge-pattern-dotted{stroke-dasharray:2;}#mermaid-diagram-7506884357259863448 .marker{fill:#333333;stroke:#333333;}#mermaid-diagram-7506884357259863448 .marker.cross{stroke:#333333;}#mermaid-diagram-7506884357259863448 svg{font-family:“trebuchet ms”,verdana,arial,sans-serif;font-size:16px;}#mermaid-diagram-7506884357259863448 p{margin:0;}#mermaid-diagram-7506884357259863448 .label{font-family:“trebuchet ms”,verdana,arial,sans-serif;color:#333;}#mermaid-diagram-7506884357259863448 .cluster-label text{fill:#333;}#mermaid-diagram-7506884357259863448 .cluster-label span{color:#333;}#mermaid-diagram-7506884357259863448 .cluster-label span p{background-color:transparent;}#mermaid-diagram-7506884357259863448 .label text,#mermaid-diagram-7506884357259863448 span{fill:#333;color:#333;}#mermaid-diagram-7506884357259863448 .node rect,#mermaid-diagram-7506884357259863448 .node circle,#mermaid-diagram-7506884357259863448 .node ellipse,#mermaid-diagram-7506884357259863448 .node polygon,#mermaid-diagram-7506884357259863448 .node path{fill:#ECECFF;stroke:#9370DB;stroke-width:1px;}#mermaid-diagram-7506884357259863448 .rough-node .label text,#mermaid-diagram-7506884357259863448 .node .label text,#mermaid-diagram-7506884357259863448 .image-shape .label,#mermaid-diagram-7506884357259863448 .icon-shape .label{text-anchor:middle;}#mermaid-diagram-7506884357259863448 .node .katex path{fill:#000;stroke:#000;stroke-width:1px;}#mermaid-diagram-7506884357259863448 .rough-node .label,#mermaid-diagram-7506884357259863448 .node .label,#mermaid-diagram-7506884357259863448 .image-shape .label,#mermaid-diagram-7506884357259863448 .icon-shape .label{text-align:center;}#mermaid-diagram-7506884357259863448 .node.clickable{cursor:pointer;}#mermaid-diagram-7506884357259863448 .root .anchor path{fill:#333333!important;stroke-width:0;stroke:#333333;}#mermaid-diagram-7506884357259863448 .arrowheadPath{fill:#333333;}#mermaid-diagram-7506884357259863448 .edgePath .path{stroke:#333333;stroke-width:2.0px;}#mermaid-diagram-7506884357259863448 .flowchart-link{stroke:#333333;fill:none;}#mermaid-diagram-7506884357259863448 .edgeLabel{background-color:rgba(232,232,232, 0.8);text-align:center;}#mermaid-diagram-7506884357259863448 .edgeLabel p{background-color:rgba(232,232,232, 0.8);}#mermaid-diagram-7506884357259863448 .edgeLabel rect{opacity:0.5;background-color:rgba(232,232,232, 0.8);fill:rgba(232,232,232, 0.8);}#mermaid-diagram-7506884357259863448 .labelBkg{background-color:rgba(232, 232, 232, 0.5);}#mermaid-diagram-7506884357259863448 .cluster rect{fill:#ffffde;stroke:#aaaa33;stroke-width:1px;}#mermaid-diagram-7506884357259863448 .cluster text{fill:#333;}#mermaid-diagram-7506884357259863448 .cluster span{color:#333;}#mermaid-diagram-7506884357259863448 div.mermaidTooltip{position:absolute;text-align:center;max-width:200px;padding:2px;font-family:“trebuchet ms”,verdana,arial,sans-serif;font-size:12px;background:hsl(80, 100%, 96.2745098039%);border:1px solid #aaaa33;border-radius:2px;pointer-events:none;z-index:100;}#mermaid-diagram-7506884357259863448 .flowchartTitleText{text-anchor:middle;font-size:18px;fill:#333;}#mermaid-diagram-7506884357259863448 rect.text{fill:none;stroke-width:0;}#mermaid-diagram-7506884357259863448 .icon-shape,#mermaid-diagram-7506884357259863448 .image-shape{background-color:rgba(232,232,232, 0.8);text-align:center;}#mermaid-diagram-7506884357259863448 .icon-shape p,#mermaid-diagram-7506884357259863448 .image-shape p{background-color:rgba(232,232,232, 0.8);padding:2px;}#mermaid-diagram-7506884357259863448 .icon-shape rect,#mermaid-diagram-7506884357259863448 .image-shape rect{opacity:0.5;background-color:rgba(232,232,232, 0.8);fill:rgba(232,232,232, 0.8);}#mermaid-diagram-7506884357259863448 .label-icon{display:inline-block;height:1em;overflow:visible;vertical-align:-0.125em;}#mermaid-diagram-7506884357259863448 .node .label-icon path{fill:currentColor;stroke:revert;stroke-width:revert;}#mermaid-diagram-7506884357259863448 :root{–mermaid-font-family:“trebuchet ms”,verdana,arial,sans-serif;}</style><g><marker id="mermaid-diagram-7506884357259863448_flowchart-v2-pointEnd" class="marker flowchart-v2" viewbox="0 0 10 10" refx="5" refy="5" markerunits="userSpaceOnUse" markerwidth="8" markerheight="8" orient="auto"><path d="M 0 0 L 10 5 L 0 10 z" class="arrowMarkerPath" style="stroke-width: 1; stroke-dasharray: 1, 0;"></path></marker><marker id="mermaid-diagram-7506884357259863448_flowchart-v2-pointStart" class="marker flowchart-v2" viewbox="0 0 10 10" refx="4.5" refy="5" markerunits="userSpaceOnUse" markerwidth="8" markerheight="8" orient="auto"><path d="M 0 5 L 10 10 L 10 0 z" class="arrowMarkerPath" style="stroke-width: 1; stroke-dasharray: 1, 0;"></path></marker><marker id="mermaid-diagram-7506884357259863448_flowchart-v2-circleEnd" class="marker flowchart-v2" viewbox="0 0 10 10" refx="11" refy="5" markerunits="userSpaceOnUse" markerwidth="11" markerheight="11" orient="auto"><circle cx="5" cy="5" r="5" class="arrowMarkerPath" style="stroke-width: 1; stroke-dasharray: 1, 0;"></circle></marker><marker id="mermaid-diagram-7506884357259863448_flowchart-v2-circleStart" class="marker flowchart-v2" viewbox="0 0 10 10" refx="-1" refy="5" markerunits="userSpaceOnUse" markerwidth="11" markerheight="11" orient="auto"><circle cx="5" cy="5" r="5" class="arrowMarkerPath" style="stroke-width: 1; stroke-dasharray: 1, 0;"></circle></marker><marker id="mermaid-diagram-7506884357259863448_flowchart-v2-crossEnd" class="marker cross flowchart-v2" viewbox="0 0 11 11" refx="12" refy="5.2" markerunits="userSpaceOnUse" markerwidth="11" markerheight="11" orient="auto"><path d="M 1,1 l 9,9 M 10,1 l -9,9" class="arrowMarkerPath" style="stroke-width: 2; stroke-dasharray: 1, 0;"></path></marker><marker id="mermaid-diagram-7506884357259863448_flowchart-v2-crossStart" class="marker cross flowchart-v2" viewbox="0 0 11 11" refx="-1" refy="5.2" markerunits="userSpaceOnUse" markerwidth="11" markerheight="11" orient="auto"><path d="M 1,1 l 9,9 M 10,1 l -9,9" class="arrowMarkerPath" style="stroke-width: 2; stroke-dasharray: 1, 0;"></path></marker><g class="root"><g class="clusters"><g class="cluster" id="Storage" data-look="classic"><rect style="" x="354.2421875" y="970" width="880.4453125" height="146.72885131835938"></rect><g class="cluster-label" transform="translate(747.32421875, 970)"><foreignobject width="94.28125" height="24">
<div xmlns="http://www.w3.org/1999/xhtml" style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;"><span class="nodeLabel">
<p>Data Storage</p>
</span></div>
</foreignobject></g></g><g class="cluster" id="Martin" data-look="classic"><rect style="" x="8" y="160" width="1460.0703125" height="760"></rect><g class="cluster-label" transform="translate(675.34765625, 160)"><foreignobject width="125.375" height="24">
<div xmlns="http://www.w3.org/1999/xhtml" style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;"><span class="nodeLabel">
<p>Martin Tile Server</p>
</span></div>
</foreignobject></g></g><g class="cluster" id="Sources" data-look="classic"><rect style="" x="307.7265625" y="767" width="922.734375" height="128"></rect><g class="cluster-label" transform="translate(724.9296875, 767)"><foreignobject width="88.328125" height="24">
<div xmlns="http://www.w3.org/1999/xhtml" style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;"><span class="nodeLabel">
<p>Tile Sources</p>
</span></div>
</foreignobject></g></g></g><g class="edgePaths"><path d="M500.036,86L490.084,92.167C480.131,98.333,460.226,110.667,450.273,123C440.32,135.333,440.32,147.667,440.32,157.333C440.32,167,440.32,174,440.32,177.5L440.32,181" id="L_Client_Server_0" class="edge-thickness-normal edge-pattern-solid edge-thickness-normal edge-pattern-solid flowchart-link" style=";" data-edge="true" data-et="edge" data-id="L_Client_Server_0" data-points="W3sieCI6NTAwLjAzNjQ0MTIwMDY1NzksInkiOjg2fSx7IngiOjQ0MC4zMjAzMTI1LCJ5IjoxMjN9LHsieCI6NDQwLjMyMDMxMjUsInkiOjE2MH0seyJ4Ijo0NDAuMzIwMzEyNSwieSI6MTg1fV0=" marker-end="url(#mermaid-diagram-7506884357259863448_flowchart-v2-pointEnd)"></path><path d="M440.32,263L440.32,267.167C440.32,271.333,440.32,279.667,440.32,314.5C440.32,349.333,440.32,410.667,440.32,441.333L440.32,472" id="L_Server_Catalog_0" class="edge-thickness-normal edge-pattern-solid edge-thickness-normal edge-pattern-solid flowchart-link" style=";" data-edge="true" data-et="edge" data-id="L_Server_Catalog_0" data-points="W3sieCI6NDQwLjMyMDMxMjUsInkiOjI2M30seyJ4Ijo0NDAuMzIwMzEyNSwieSI6Mjg4fSx7IngiOjQ0MC4zMjAzMTI1LCJ5Ijo0NzZ9XQ==" marker-end="url(#mermaid-diagram-7506884357259863448_flowchart-v2-pointEnd)"></path><path d="M516.852,234.832L579.458,243.693C642.065,252.555,767.279,270.277,845.14,309.875C923.001,349.472,953.51,410.945,968.764,441.681L984.018,472.417" id="L_Server_Cache_0" class="edge-thickness-normal edge-pattern-solid edge-thickness-normal edge-pattern-solid flowchart-link" style=";" data-edge="true" data-et="edge" data-id="L_Server_Cache_0" data-points="W3sieCI6NTE2Ljg1MTU2MjUsInkiOjIzNC44MzIxNjQyMDc0NzA5fSx7IngiOjg5Mi40OTIxODc1LCJ5IjoyODh9LHsieCI6OTg1Ljc5NjYzNDA4NTkwMzEsInkiOjQ3Nn1d" marker-end="url(#mermaid-diagram-7506884357259863448_flowchart-v2-pointEnd)"></path><path d="M440.32,870L440.32,874.167C440.32,878.333,440.32,886.667,440.32,895C440.32,903.333,440.32,911.667,440.32,920C440.32,928.333,440.32,936.667,440.32,945C440.32,953.333,440.32,961.667,440.32,969.333C440.32,977,440.32,984,440.32,987.5L440.32,991" id="L_PG_DB_0" class="edge-thickness-normal edge-pattern-solid edge-thickness-normal edge-pattern-solid flowchart-link" style=";" data-edge="true" data-et="edge" data-id="L_PG_DB_0" data-points="W3sieCI6NDQwLjMyMDMxMjUsInkiOjg3MH0seyJ4Ijo0NDAuMzIwMzEyNSwieSI6ODk1fSx7IngiOjQ0MC4zMjAzMTI1LCJ5Ijo5MjB9LHsieCI6NDQwLjMyMDMxMjUsInkiOjk0NX0seyJ4Ijo0NDAuMzIwMzEyNSwieSI6OTcwfSx7IngiOjQ0MC4zMjAzMTI1LCJ5Ijo5OTV9XQ==" marker-end="url(#mermaid-diagram-7506884357259863448_flowchart-v2-pointEnd)"></path><path d="M665.625,858L665.625,864.167C665.625,870.333,665.625,882.667,665.625,893C665.625,903.333,665.625,911.667,665.625,920C665.625,928.333,665.625,936.667,665.625,945C665.625,953.333,665.625,961.667,667.715,970.944C669.804,980.221,673.984,990.441,676.074,995.552L678.163,1000.662" id="L_MBT_Files_0" class="edge-thickness-normal edge-pattern-solid edge-thickness-normal edge-pattern-solid flowchart-link" style=";" data-edge="true" data-et="edge" data-id="L_MBT_Files_0" data-points="W3sieCI6NjY1LjYyNSwieSI6ODU4fSx7IngiOjY2NS42MjUsInkiOjg5NX0seyJ4Ijo2NjUuNjI1LCJ5Ijo5MjB9LHsieCI6NjY1LjYyNSwieSI6OTQ1fSx7IngiOjY2NS42MjUsInkiOjk3MH0seyJ4Ijo2NzkuNjc3MjE2MTg2NjkzNCwieSI6MTAwNC4zNjQ0MjU2NTkxNzk3fV0=" marker-end="url(#mermaid-diagram-7506884357259863448_flowchart-v2-pointEnd)"></path><path d="M820.956,870L814.62,874.167C808.284,878.333,795.613,886.667,789.277,895C782.941,903.333,782.941,911.667,782.941,920C782.941,928.333,782.941,936.667,782.941,945C782.941,953.333,782.941,961.667,776.635,971.132C770.329,980.597,757.717,991.194,751.41,996.493L745.104,1001.791" id="L_PMT_Files_0" class="edge-thickness-normal edge-pattern-solid edge-thickness-normal edge-pattern-solid flowchart-link" style=";" data-edge="true" data-et="edge" data-id="L_PMT_Files_0" data-points="W3sieCI6ODIwLjk1NTYyNzQ0MTQwNjIsInkiOjg3MH0seyJ4Ijo3ODIuOTQxNDA2MjUsInkiOjg5NX0seyJ4Ijo3ODIuOTQxNDA2MjUsInkiOjkyMH0seyJ4Ijo3ODIuOTQxNDA2MjUsInkiOjk0NX0seyJ4Ijo3ODIuOTQxNDA2MjUsInkiOjk3MH0seyJ4Ijo3NDIuMDQxNzcyMzQwOTk1MSwieSI6MTAwNC4zNjQ0MjU2NTkxNzk3fV0=" marker-end="url(#mermaid-diagram-7506884357259863448_flowchart-v2-pointEnd)"></path><path d="M955.23,870L963.24,874.167C971.25,878.333,987.269,886.667,995.279,895C1003.289,903.333,1003.289,911.667,1003.289,920C1003.289,928.333,1003.289,936.667,1003.289,945C1003.289,953.333,1003.289,961.667,1011.554,971.198C1019.819,980.729,1036.349,991.458,1044.614,996.822L1052.879,1002.187" id="L_PMT_S3_0" class="edge-thickness-normal edge-pattern-solid edge-thickness-normal edge-pattern-solid flowchart-link" style=";" data-edge="true" data-et="edge" data-id="L_PMT_S3_0" data-points="W3sieCI6OTU1LjIyOTk4MDQ2ODc1LCJ5Ijo4NzB9LHsieCI6MTAwMy4yODkwNjI1LCJ5Ijo4OTV9LHsieCI6MTAwMy4yODkwNjI1LCJ5Ijo5MjB9LHsieCI6MTAwMy4yODkwNjI1LCJ5Ijo5NDV9LHsieCI6MTAwMy4yODkwNjI1LCJ5Ijo5NzB9LHsieCI6MTA1Ni4yMzM3MTQ1Mjg0MDY0LCJ5IjoxMDA0LjM2NDQyNTY1OTE3OTd9XQ==" marker-end="url(#mermaid-diagram-7506884357259863448_flowchart-v2-pointEnd)"></path><path d="M1017.18,859.476L998.645,865.396C980.111,871.317,943.042,883.159,924.507,893.246C905.973,903.333,905.973,911.667,905.973,920C905.973,928.333,905.973,936.667,905.973,945C905.973,953.333,905.973,961.667,886.447,972.644C866.92,983.621,827.868,997.241,808.342,1004.051L788.816,1010.862" id="L_COG_Files_0" class="edge-thickness-normal edge-pattern-solid edge-thickness-normal edge-pattern-solid flowchart-link" style=";" data-edge="true" data-et="edge" data-id="L_COG_Files_0" data-points="W3sieCI6MTAxNy4xNzk2ODc1LCJ5Ijo4NTkuNDc1NTAxNTY5NTM3M30seyJ4Ijo5MDUuOTcyNjU2MjUsInkiOjg5NX0seyJ4Ijo5MDUuOTcyNjU2MjUsInkiOjkyMH0seyJ4Ijo5MDUuOTcyNjU2MjUsInkiOjk0NX0seyJ4Ijo5MDUuOTcyNjU2MjUsInkiOjk3MH0seyJ4Ijo3ODUuMDM5MDYyNSwieSI6MTAxMi4xNzg4NTY2OTE1MzY1fV0=" marker-end="url(#mermaid-diagram-7506884357259863448_flowchart-v2-pointEnd)"></path><path d="M1138.051,870L1141.441,874.167C1144.831,878.333,1151.611,886.667,1155.001,895C1158.391,903.333,1158.391,911.667,1158.391,920C1158.391,928.333,1158.391,936.667,1158.391,945C1158.391,953.333,1158.391,961.667,1155.438,970.982C1152.485,980.298,1146.58,990.596,1143.627,995.745L1140.674,1000.894" id="L_COG_S3_0" class="edge-thickness-normal edge-pattern-solid edge-thickness-normal edge-pattern-solid flowchart-link" style=";" data-edge="true" data-et="edge" data-id="L_COG_S3_0" data-points="W3sieCI6MTEzOC4wNTA2NTkxNzk2ODc1LCJ5Ijo4NzB9LHsieCI6MTE1OC4zOTA2MjUsInkiOjg5NX0seyJ4IjoxMTU4LjM5MDYyNSwieSI6OTIwfSx7IngiOjExNTguMzkwNjI1LCJ5Ijo5NDV9LHsieCI6MTE1OC4zOTA2MjUsInkiOjk3MH0seyJ4IjoxMTM4LjY4NDU4NzQ1Njk0MTcsInkiOjEwMDQuMzY0NDI1NjU5MTc5N31d" marker-end="url(#mermaid-diagram-7506884357259863448_flowchart-v2-pointEnd)"></path><path d="M1008.305,476L1010.837,444.667C1013.37,413.333,1018.435,350.667,1020.967,308.667C1023.5,266.667,1023.5,245.333,1023.5,224C1023.5,202.667,1023.5,181.333,1023.5,164.5C1023.5,147.667,1023.5,135.333,965.597,119.611C907.694,103.888,791.889,84.777,733.986,75.221L676.083,65.665" id="L_Cache_Client_0" class="edge-thickness-normal edge-pattern-dotted edge-thickness-normal edge-pattern-solid flowchart-link" style=";" data-edge="true" data-et="edge" data-id="L_Cache_Client_0" data-points="W3sieCI6MTAwOC4zMDQ1ODQyNTExMDEzLCJ5Ijo0NzZ9LHsieCI6MTAyMy41LCJ5IjoyODh9LHsieCI6MTAyMy41LCJ5IjoyMjR9LHsieCI6MTAyMy41LCJ5IjoxNjB9LHsieCI6MTAyMy41LCJ5IjoxMjN9LHsieCI6NjcyLjEzNjcxODc1LCJ5Ijo2NS4wMTQxNjUzODcyNTc5M31d" marker-end="url(#mermaid-diagram-7506884357259863448_flowchart-v2-pointEnd)"></path><path d="M440.32,554L440.32,585.333C440.32,616.667,440.32,679.333,440.32,714.167C440.32,749,440.32,756,440.32,759.5L440.32,763" id="L_Catalog_Sources_0" class="edge-thickness-normal edge-pattern-solid edge-thickness-normal edge-pattern-solid flowchart-link" style=";" data-edge="true" data-et="edge" data-id="L_Catalog_Sources_0" data-points="W3sieCI6NDQwLjMyMDMxMjUsInkiOjU1NH0seyJ4Ijo0NDAuMzIwMzEyNSwieSI6NzQyfSx7IngiOjQ0MC4zMjAzMTI1LCJ5Ijo3Njd9LHsieCI6NDQwLjMyMDMxMjUsInkiOjc5Mn1d" marker-end="url(#mermaid-diagram-7506884357259863448_flowchart-v2-pointEnd)"></path><path d="M363.789,242.337L332.025,249.947C300.26,257.558,236.732,272.779,204.967,283.889C173.203,295,173.203,302,173.203,305.5L173.203,309" id="L_Server_Resources_0" class="edge-thickness-normal edge-pattern-solid edge-thickness-normal edge-pattern-solid flowchart-link" style=";" data-edge="true" data-et="edge" data-id="L_Server_Resources_0" data-points="W3sieCI6MzYzLjc4OTA2MjUsInkiOjI0Mi4zMzY1MjEzMDY3NzY2M30seyJ4IjoxNzMuMjAzMTI1LCJ5IjoyODh9LHsieCI6MTczLjIwMzEyNSwieSI6MzEzfV0=" marker-end="url(#mermaid-diagram-7506884357259863448_flowchart-v2-pointEnd)"></path></g><g class="edgeLabels"><g class="edgeLabel" transform="translate(440.3203125, 123)"><g class="label" data-id="L_Client_Server_0" transform="translate(-56.765625, -12)"><foreignobject width="113.53125" height="24">
<div xmlns="http://www.w3.org/1999/xhtml" class="labelBkg" style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;"><span class="edgeLabel">
<p>HTTP Requests</p>
</span></div>
</foreignobject></g></g><g class="edgeLabel"><g class="label" data-id="L_Server_Catalog_0" transform="translate(0, 0)"><foreignobject width="0" height="0">
<div xmlns="http://www.w3.org/1999/xhtml" class="labelBkg" style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;"><span class="edgeLabel"></span></div>
</foreignobject></g></g><g class="edgeLabel"><g class="label" data-id="L_Server_Cache_0" transform="translate(0, 0)"><foreignobject width="0" height="0">
<div xmlns="http://www.w3.org/1999/xhtml" class="labelBkg" style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;"><span class="edgeLabel"></span></div>
</foreignobject></g></g><g class="edgeLabel"><g class="label" data-id="L_PG_DB_0" transform="translate(0, 0)"><foreignobject width="0" height="0">
<div xmlns="http://www.w3.org/1999/xhtml" class="labelBkg" style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;"><span class="edgeLabel"></span></div>
</foreignobject></g></g><g class="edgeLabel"><g class="label" data-id="L_MBT_Files_0" transform="translate(0, 0)"><foreignobject width="0" height="0">
<div xmlns="http://www.w3.org/1999/xhtml" class="labelBkg" style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;"><span class="edgeLabel"></span></div>
</foreignobject></g></g><g class="edgeLabel"><g class="label" data-id="L_PMT_Files_0" transform="translate(0, 0)"><foreignobject width="0" height="0">
<div xmlns="http://www.w3.org/1999/xhtml" class="labelBkg" style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;"><span class="edgeLabel"></span></div>
</foreignobject></g></g><g class="edgeLabel"><g class="label" data-id="L_PMT_S3_0" transform="translate(0, 0)"><foreignobject width="0" height="0">
<div xmlns="http://www.w3.org/1999/xhtml" class="labelBkg" style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;"><span class="edgeLabel"></span></div>
</foreignobject></g></g><g class="edgeLabel"><g class="label" data-id="L_COG_Files_0" transform="translate(0, 0)"><foreignobject width="0" height="0">
<div xmlns="http://www.w3.org/1999/xhtml" class="labelBkg" style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;"><span class="edgeLabel"></span></div>
</foreignobject></g></g><g class="edgeLabel"><g class="label" data-id="L_COG_S3_0" transform="translate(0, 0)"><foreignobject width="0" height="0">
<div xmlns="http://www.w3.org/1999/xhtml" class="labelBkg" style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;"><span class="edgeLabel"></span></div>
</foreignobject></g></g><g class="edgeLabel" transform="translate(1023.5, 224)"><g class="label" data-id="L_Cache_Client_0" transform="translate(-86.7109375, -12)"><foreignobject width="173.421875" height="24">
<div xmlns="http://www.w3.org/1999/xhtml" class="labelBkg" style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;"><span class="edgeLabel">
<p>Cached Tiles/Resources</p>
</span></div>
</foreignobject></g></g><g class="edgeLabel"><g class="label" data-id="L_Catalog_Sources_0" transform="translate(0, 0)"><foreignobject width="0" height="0">
<div xmlns="http://www.w3.org/1999/xhtml" class="labelBkg" style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;"><span class="edgeLabel"></span></div>
</foreignobject></g></g><g class="edgeLabel"><g class="label" data-id="L_Server_Resources_0" transform="translate(0, 0)"><foreignobject width="0" height="0">
<div xmlns="http://www.w3.org/1999/xhtml" class="labelBkg" style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;"><span class="edgeLabel"></span></div>
</foreignobject></g></g></g><g class="nodes"><g class="root" transform="translate(35, 305)"><g class="clusters"><g class="cluster" id="Resources" data-look="classic"><rect style="" x="8" y="8" width="260.40625" height="404"></rect><g class="cluster-label" transform="translate(59.046875, 8)"><foreignobject width="158.3125" height="24">
<div xmlns="http://www.w3.org/1999/xhtml" style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;"><span class="nodeLabel">
<p>Supporting Resources</p>
</span></div>
</foreignobject></g></g></g><g class="edgePaths"></g><g class="edgeLabels"></g><g class="nodes"><g class="node default" id="flowchart-Sprites-7" transform="translate(138.203125, 82)"><rect class="basic label-container" style="" x="-92.703125" y="-39" width="185.40625" height="78"></rect><g class="label" style="" transform="translate(-62.703125, -24)"><rect></rect><foreignobject width="125.40625" height="48">
<div xmlns="http://www.w3.org/1999/xhtml" style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;"><span class="nodeLabel">
<p>Sprite Generation<br>SVG to PNG</p>
</span></div>
</foreignobject></g></g><g class="node default" id="flowchart-Fonts-8" transform="translate(138.203125, 210)"><rect class="basic label-container" style="" x="-73.1328125" y="-39" width="146.265625" height="78"></rect><g class="label" style="" transform="translate(-43.1328125, -24)"><rect></rect><foreignobject width="86.265625" height="48">
<div xmlns="http://www.w3.org/1999/xhtml" style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;"><span class="nodeLabel">
<p>Font Glyphs<br>PBF Format</p>
</span></div>
</foreignobject></g></g><g class="node default" id="flowchart-Styles-9" transform="translate(138.203125, 338)"><rect class="basic label-container" style="" x="-87.359375" y="-39" width="174.71875" height="78"></rect><g class="label" style="" transform="translate(-57.359375, -24)"><rect></rect><foreignobject width="114.71875" height="48">
<div xmlns="http://www.w3.org/1999/xhtml" style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;"><span class="nodeLabel">
<p>MapLibre Styles<br>JSON</p>
</span></div>
</foreignobject></g></g></g></g><g class="node default" id="flowchart-Client-0" transform="translate(562.98046875, 47)"><rect class="basic label-container" style="" x="-109.15625" y="-39" width="218.3125" height="78"></rect><g class="label" style="" transform="translate(-79.15625, -24)"><rect></rect><foreignobject width="158.3125" height="48">
<div xmlns="http://www.w3.org/1999/xhtml" style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;"><span class="nodeLabel">
<p>Map Client<br>MapLibre, Leaflet, etc.</p>
</span></div>
</foreignobject></g></g><g class="node default" id="flowchart-CLI-1" transform="translate(1349.265625, 831)"><rect class="basic label-container" style="" x="-83.8046875" y="-39" width="167.609375" height="78"></rect><g class="label" style="" transform="translate(-53.8046875, -24)"><rect></rect><foreignobject width="107.609375" height="48">
<div xmlns="http://www.w3.org/1999/xhtml" style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;"><span class="nodeLabel">
<p>CLI Entry Point<br>martin binary</p>
</span></div>
</foreignobject></g></g><g class="node default" id="flowchart-Server-2" transform="translate(440.3203125, 224)"><rect class="basic label-container" style="" x="-76.53125" y="-39" width="153.0625" height="78"></rect><g class="label" style="" transform="translate(-46.53125, -24)"><rect></rect><foreignobject width="93.0625" height="48">
<div xmlns="http://www.w3.org/1999/xhtml" style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;"><span class="nodeLabel">
<p>HTTP Server<br>Actix-Web</p>
</span></div>
</foreignobject></g></g><g class="node default" id="flowchart-PG-3" transform="translate(440.3203125, 831)"><rect class="basic label-container" style="" x="-97.59375" y="-39" width="195.1875" height="78"></rect><g class="label" style="" transform="translate(-67.59375, -24)"><rect></rect><foreignobject width="135.1875" height="48">
<div xmlns="http://www.w3.org/1999/xhtml" style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;"><span class="nodeLabel">
<p>PostgreSQL<br>Tables &amp; Functions</p>
</span></div>
</foreignobject></g></g><g class="node default" id="flowchart-MBT-4" transform="translate(665.625, 831)"><rect class="basic label-container" style="" x="-77.7109375" y="-27" width="155.421875" height="54"></rect><g class="label" style="" transform="translate(-47.7109375, -12)"><rect></rect><foreignobject width="95.421875" height="24">
<div xmlns="http://www.w3.org/1999/xhtml" style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;"><span class="nodeLabel">
<p>MBTiles Files</p>
</span></div>
</foreignobject></g></g><g class="node default" id="flowchart-PMT-5" transform="translate(880.2578125, 831)"><rect class="basic label-container" style="" x="-86.921875" y="-39" width="173.84375" height="78"></rect><g class="label" style="" transform="translate(-56.921875, -24)"><rect></rect><foreignobject width="113.84375" height="48">
<div xmlns="http://www.w3.org/1999/xhtml" style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;"><span class="nodeLabel">
<p>PMTiles Files<br>Local &amp; Remote</p>
</span></div>
</foreignobject></g></g><g class="node default" id="flowchart-COG-6" transform="translate(1106.3203125, 831)"><rect class="basic label-container" style="" x="-89.140625" y="-39" width="178.28125" height="78"></rect><g class="label" style="" transform="translate(-59.140625, -24)"><rect></rect><foreignobject width="118.28125" height="48">
<div xmlns="http://www.w3.org/1999/xhtml" style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;"><span class="nodeLabel">
<p>Cloud Optimized<br>GeoTIFF</p>
</span></div>
</foreignobject></g></g><g class="node default" id="flowchart-Catalog-10" transform="translate(440.3203125, 515)"><rect class="basic label-container" style="" x="-86.9140625" y="-39" width="173.828125" height="78"></rect><g class="label" style="" transform="translate(-56.9140625, -24)"><rect></rect><foreignobject width="113.828125" height="48">
<div xmlns="http://www.w3.org/1999/xhtml" style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;"><span class="nodeLabel">
<p>Tile Catalog<br>Source Registry</p>
</span></div>
</foreignobject></g></g><g class="node default" id="flowchart-Cache-11" transform="translate(1005.15234375, 515)"><rect class="basic label-container" style="" x="-108.40625" y="-39" width="216.8125" height="78"></rect><g class="label" style="" transform="translate(-78.40625, -24)"><rect></rect><foreignobject width="156.8125" height="48">
<div xmlns="http://www.w3.org/1999/xhtml" style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;"><span class="nodeLabel">
<p>Tile/Resources Cache<br>Moka</p>
</span></div>
</foreignobject></g></g><g class="node default" id="flowchart-DB-12" transform="translate(440.3203125, 1043.3644256591797)"><path d="M0,11.242949511624708 a51.078125,11.242949511624708 0,0,0 102.15625,0 a51.078125,11.242949511624708 0,0,0 -102.15625,0 l0,74.24294951162472 a51.078125,11.242949511624708 0,0,0 102.15625,0 l0,-74.24294951162472" class="basic label-container" style="" transform="translate(-51.078125, -48.364424267437066)"></path><g class="label" style="" transform="translate(-43.578125, -14)"><rect></rect><foreignobject width="87.15625" height="48">
<div xmlns="http://www.w3.org/1999/xhtml" style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;"><span class="nodeLabel">
<p>PostgreSQL<br>PostGIS</p>
</span></div>
</foreignobject></g></g><g class="node default" id="flowchart-Files-13" transform="translate(695.625, 1043.3644256591797)"><rect class="basic label-container" style="" x="-89.4140625" y="-39" width="178.828125" height="78"></rect><g class="label" style="" transform="translate(-59.4140625, -24)"><rect></rect><foreignobject width="118.828125" height="48">
<div xmlns="http://www.w3.org/1999/xhtml" style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;"><span class="nodeLabel">
<p>File System<br>MBTiles/PMTiles</p>
</span></div>
</foreignobject></g></g><g class="node default" id="flowchart-S3-14" transform="translate(1116.3203125, 1043.3644256591797)"><rect class="basic label-container" style="" x="-83.3671875" y="-39" width="166.734375" height="78"></rect><g class="label" style="" transform="translate(-53.3671875, -24)"><rect></rect><foreignobject width="106.734375" height="48">
<div xmlns="http://www.w3.org/1999/xhtml" style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;"><span class="nodeLabel">
<p>Object Storage<br>S3/Azure/GCP</p>
</span></div>
</foreignobject></g></g></g></g></g></svg></p>
<h2 id="core-components"><a class="header" href="#core-components">Core Components</a></h2>
<p>Martin’s architecture is organized into four main Rust crates, each with distinct responsibilities:</p>
<div class="mdbook-tabs-container">
<nav class="mdbook-tabs">
<button class="mdbook-tab active" data-tabname="martin (Main Server)">martin (Main Server)</button>
<button class="mdbook-tab" data-tabname="martin-core (Library)">martin-core (Library)</button>
<button class="mdbook-tab" data-tabname="mbtiles (Library &amp; CLI)">mbtiles (Library &amp; CLI)</button>
<button class="mdbook-tab" data-tabname="martin-tile-utils">martin-tile-utils</button>
</nav>
<div class="mdbook-tab-content" data-tabname="martin (Main Server)">
<p><strong>Purpose</strong>: The main tile server binary and HTTP service layer.</p>
<p><strong>Location</strong>: <code>/martin</code></p>
<p><strong>Key Responsibilities</strong>:</p>
<ul>
<li>HTTP server using Actix-Web framework</li>
<li>Request routing and endpoint handling</li>
<li>Configuration parsing (CLI args, env vars, config files)</li>
<li>Tile source discovery and initialization</li>
<li>Serving the Web UI for tile inspection</li>
</ul>
<p><strong>Main Modules</strong>:</p>
<ul>
<li><code>src/bin/martin.rs</code> - Server entry point</li>
<li><code>src/bin/martin-cp.rs</code> - Bulk tile copying tool</li>
<li><code>src/srv/</code> - HTTP service handlers
<ul>
<li><code>server.rs</code> - Main server setup and routing</li>
<li><code>tiles/</code> - Tile serving endpoints</li>
<li><code>fonts.rs</code> - Font glyph serving</li>
<li><code>sprites.rs</code> - Sprite serving</li>
<li><code>styles.rs</code> - Style serving</li>
</ul>
</li>
<li><code>src/config/</code> - Configuration management
<ul>
<li><code>args/</code> - CLI argument parsing</li>
<li><code>file/</code> - Config file parsing</li>
</ul>
</li>
<li><code>martin-ui/</code> - React-based web interface</li>
</ul>
</div>

<div class="mdbook-tab-content hidden" data-tabname="martin-core (Library)">
<p><strong>Purpose</strong>: Core abstractions and implementations for tile sources and supporting resources.</p>
<p><strong>Location</strong>: <code>/martin-core</code></p>
<p><strong>Key Responsibilities</strong>:</p>
<ul>
<li>Abstract tile source traits and implementations</li>
<li>PostgreSQL connection pooling and query execution</li>
<li>MBTiles and PMTiles reading</li>
<li>Cloud Optimized GeoTIFF (COG) tile extraction</li>
<li>Sprite, font, and style resource generation</li>
<li>Tile format handling (MVT protocol buffers)</li>
</ul>
<p><strong>Main Modules</strong>:</p>
<ul>
<li><code>src/tiles/</code> - Tile source implementations
<ul>
<li><code>postgres/</code> - PostGIS table and function sources</li>
<li><code>mbtiles/</code> - MBTiles file source</li>
<li><code>pmtiles/</code> - PMTiles file source</li>
<li><code>cog/</code> - Cloud Optimized GeoTIFF source</li>
<li><code>catalog.rs</code> - Source registry and management</li>
</ul>
</li>
<li><code>src/resources/</code> - Supporting resources
<ul>
<li><code>sprites/</code> - SVG sprite generation</li>
<li><code>fonts/</code> - Font glyph generation</li>
<li><code>styles/</code> - MapLibre style handling</li>
</ul>
</li>
</ul>
</div>

<div class="mdbook-tab-content hidden" data-tabname="mbtiles (Library &amp; CLI)">
<p><strong>Purpose</strong>: MBTiles format support and manipulation tools.</p>
<p><strong>Location</strong>: <code>/mbtiles</code></p>
<p><strong>Key Responsibilities</strong>:</p>
<ul>
<li>SQLite-based MBTiles reading and writing</li>
<li>Metadata management</li>
<li>Tile compression (gzip, brotli)</li>
<li>Validation and integrity checking</li>
<li>Diff/patch operations between MBTiles files</li>
<li>Schema management</li>
</ul>
<p><strong>Main Modules</strong>:</p>
<ul>
<li><code>src/lib.rs</code> - Core MBTiles library</li>
<li><code>src/bin/mbtiles.rs</code> - CLI tool</li>
<li><code>sql/</code> - SQL schema and migrations</li>
</ul>
</div>

<div class="mdbook-tab-content hidden" data-tabname="martin-tile-utils">
<p><strong>Purpose</strong>: Low-level tile manipulation and conversion utilities.</p>
<p><strong>Location</strong>: <code>/martin-tile-utils</code></p>
<p><strong>Key Responsibilities</strong>:</p>
<ul>
<li>Tile coordinate system conversions</li>
<li>Tile encoding/decoding</li>
<li>Tile format utilities</li>
<li>Bounding box calculations</li>
</ul>
</div>

</div>

<h2 id="data-flow"><a class="header" href="#data-flow">Data Flow</a></h2>
<div class="mdbook-tabs-container">
<nav class="mdbook-tabs">
<button class="mdbook-tab active" data-tabname="Tile Request Flow">Tile Request Flow</button>
<button class="mdbook-tab" data-tabname="Configuration and Initialization Flow">Configuration and Initialization Flow</button>
<button class="mdbook-tab" data-tabname="Resource Generation Flow">Resource Generation Flow</button>
</nav>
<div class="mdbook-tab-content" data-tabname="Tile Request Flow">
<p><svg id="mermaid-diagram-14409696993191337115" width="100%" xmlns="http://www.w3.org/2000/svg" style="max-width: 1260px;" viewbox="-50 -10 1260 885" role="graphics-document document" aria-roledescription="sequence"><g><rect x="1010" y="799" fill="#eaeaea" stroke="#666" width="150" height="65" name="DB" rx="3" ry="3" class="actor actor-bottom"></rect><text x="1085" y="831.5" dominant-baseline="central" alignment-baseline="central" class="actor actor-box" style="text-anchor: middle; font-size: 16px; font-weight: 400;"><tspan x="1085" dy="0">Data Store</tspan></text></g><g><rect x="810" y="799" fill="#eaeaea" stroke="#666" width="150" height="65" name="Source" rx="3" ry="3" class="actor actor-bottom"></rect><text x="885" y="831.5" dominant-baseline="central" alignment-baseline="central" class="actor actor-box" style="text-anchor: middle; font-size: 16px; font-weight: 400;"><tspan x="885" dy="0">Tile Source</tspan></text></g><g><rect x="610" y="799" fill="#eaeaea" stroke="#666" width="150" height="65" name="Cache" rx="3" ry="3" class="actor actor-bottom"></rect><text x="685" y="831.5" dominant-baseline="central" alignment-baseline="central" class="actor actor-box" style="text-anchor: middle; font-size: 16px; font-weight: 400;"><tspan x="685" dy="0">Cache</tspan></text></g><g><rect x="410" y="799" fill="#eaeaea" stroke="#666" width="150" height="65" name="Catalog" rx="3" ry="3" class="actor actor-bottom"></rect><text x="485" y="831.5" dominant-baseline="central" alignment-baseline="central" class="actor actor-box" style="text-anchor: middle; font-size: 16px; font-weight: 400;"><tspan x="485" dy="0">Catalog</tspan></text></g><g><rect x="208" y="799" fill="#eaeaea" stroke="#666" width="150" height="65" name="Server" rx="3" ry="3" class="actor actor-bottom"></rect><text x="283" y="831.5" dominant-baseline="central" alignment-baseline="central" class="actor actor-box" style="text-anchor: middle; font-size: 16px; font-weight: 400;"><tspan x="283" dy="0">HTTP Server</tspan></text></g><g><rect x="0" y="799" fill="#eaeaea" stroke="#666" width="150" height="65" name="Client" rx="3" ry="3" class="actor actor-bottom"></rect><text x="75" y="831.5" dominant-baseline="central" alignment-baseline="central" class="actor actor-box" style="text-anchor: middle; font-size: 16px; font-weight: 400;"><tspan x="75" dy="0">Client</tspan></text></g><g><line id="actor5" x1="1085" y1="65" x2="1085" y2="799" class="actor-line 200" stroke-width="0.5px" stroke="#999" name="DB"></line><g id="root-5"><rect x="1010" y="0" fill="#eaeaea" stroke="#666" width="150" height="65" name="DB" rx="3" ry="3" class="actor actor-top"></rect><text x="1085" y="32.5" dominant-baseline="central" alignment-baseline="central" class="actor actor-box" style="text-anchor: middle; font-size: 16px; font-weight: 400;"><tspan x="1085" dy="0">Data Store</tspan></text></g></g><g><line id="actor4" x1="885" y1="65" x2="885" y2="799" class="actor-line 200" stroke-width="0.5px" stroke="#999" name="Source"></line><g id="root-4"><rect x="810" y="0" fill="#eaeaea" stroke="#666" width="150" height="65" name="Source" rx="3" ry="3" class="actor actor-top"></rect><text x="885" y="32.5" dominant-baseline="central" alignment-baseline="central" class="actor actor-box" style="text-anchor: middle; font-size: 16px; font-weight: 400;"><tspan x="885" dy="0">Tile Source</tspan></text></g></g><g><line id="actor3" x1="685" y1="65" x2="685" y2="799" class="actor-line 200" stroke-width="0.5px" stroke="#999" name="Cache"></line><g id="root-3"><rect x="610" y="0" fill="#eaeaea" stroke="#666" width="150" height="65" name="Cache" rx="3" ry="3" class="actor actor-top"></rect><text x="685" y="32.5" dominant-baseline="central" alignment-baseline="central" class="actor actor-box" style="text-anchor: middle; font-size: 16px; font-weight: 400;"><tspan x="685" dy="0">Cache</tspan></text></g></g><g><line id="actor2" x1="485" y1="65" x2="485" y2="799" class="actor-line 200" stroke-width="0.5px" stroke="#999" name="Catalog"></line><g id="root-2"><rect x="410" y="0" fill="#eaeaea" stroke="#666" width="150" height="65" name="Catalog" rx="3" ry="3" class="actor actor-top"></rect><text x="485" y="32.5" dominant-baseline="central" alignment-baseline="central" class="actor actor-box" style="text-anchor: middle; font-size: 16px; font-weight: 400;"><tspan x="485" dy="0">Catalog</tspan></text></g></g><g><line id="actor1" x1="283" y1="65" x2="283" y2="799" class="actor-line 200" stroke-width="0.5px" stroke="#999" name="Server"></line><g id="root-1"><rect x="208" y="0" fill="#eaeaea" stroke="#666" width="150" height="65" name="Server" rx="3" ry="3" class="actor actor-top"></rect><text x="283" y="32.5" dominant-baseline="central" alignment-baseline="central" class="actor actor-box" style="text-anchor: middle; font-size: 16px; font-weight: 400;"><tspan x="283" dy="0">HTTP Server</tspan></text></g></g><g><line id="actor0" x1="75" y1="65" x2="75" y2="799" class="actor-line 200" stroke-width="0.5px" stroke="#999" name="Client"></line><g id="root-0"><rect x="0" y="0" fill="#eaeaea" stroke="#666" width="150" height="65" name="Client" rx="3" ry="3" class="actor actor-top"></rect><text x="75" y="32.5" dominant-baseline="central" alignment-baseline="central" class="actor actor-box" style="text-anchor: middle; font-size: 16px; font-weight: 400;"><tspan x="75" dy="0">Client</tspan></text></g></g><style>#mermaid-diagram-14409696993191337115{font-family:“trebuchet ms”,verdana,arial,sans-serif;font-size:16px;fill:#333;}@keyframes edge-animation-frame{from{stroke-dashoffset:0;}}@keyframes dash{to{stroke-dashoffset:0;}}#mermaid-diagram-14409696993191337115 .edge-animation-slow{stroke-dasharray:9,5!important;stroke-dashoffset:900;animation:dash 50s linear infinite;stroke-linecap:round;}#mermaid-diagram-14409696993191337115 .edge-animation-fast{stroke-dasharray:9,5!important;stroke-dashoffset:900;animation:dash 20s linear infinite;stroke-linecap:round;}#mermaid-diagram-14409696993191337115 .error-icon{fill:#552222;}#mermaid-diagram-14409696993191337115 .error-text{fill:#552222;stroke:#552222;}#mermaid-diagram-14409696993191337115 .edge-thickness-normal{stroke-width:1px;}#mermaid-diagram-14409696993191337115 .edge-thickness-thick{stroke-width:3.5px;}#mermaid-diagram-14409696993191337115 .edge-pattern-solid{stroke-dasharray:0;}#mermaid-diagram-14409696993191337115 .edge-thickness-invisible{stroke-width:0;fill:none;}#mermaid-diagram-14409696993191337115 .edge-pattern-dashed{stroke-dasharray:3;}#mermaid-diagram-14409696993191337115 .edge-pattern-dotted{stroke-dasharray:2;}#mermaid-diagram-14409696993191337115 .marker{fill:#333333;stroke:#333333;}#mermaid-diagram-14409696993191337115 .marker.cross{stroke:#333333;}#mermaid-diagram-14409696993191337115 svg{font-family:“trebuchet ms”,verdana,arial,sans-serif;font-size:16px;}#mermaid-diagram-14409696993191337115 p{margin:0;}#mermaid-diagram-14409696993191337115 .actor{stroke:hsl(259.6261682243, 59.7765363128%, 87.9019607843%);fill:#ECECFF;}#mermaid-diagram-14409696993191337115 text.actor&gt;tspan{fill:black;stroke:none;}#mermaid-diagram-14409696993191337115 .actor-line{stroke:hsl(259.6261682243, 59.7765363128%, 87.9019607843%);}#mermaid-diagram-14409696993191337115 .innerArc{stroke-width:1.5;stroke-dasharray:none;}#mermaid-diagram-14409696993191337115 .messageLine0{stroke-width:1.5;stroke-dasharray:none;stroke:#333;}#mermaid-diagram-14409696993191337115 .messageLine1{stroke-width:1.5;stroke-dasharray:2,2;stroke:#333;}#mermaid-diagram-14409696993191337115 #arrowhead path{fill:#333;stroke:#333;}#mermaid-diagram-14409696993191337115 .sequenceNumber{fill:white;}#mermaid-diagram-14409696993191337115 #sequencenumber{fill:#333;}#mermaid-diagram-14409696993191337115 #crosshead path{fill:#333;stroke:#333;}#mermaid-diagram-14409696993191337115 .messageText{fill:#333;stroke:none;}#mermaid-diagram-14409696993191337115 .labelBox{stroke:hsl(259.6261682243, 59.7765363128%, 87.9019607843%);fill:#ECECFF;}#mermaid-diagram-14409696993191337115 .labelText,#mermaid-diagram-14409696993191337115 .labelText&gt;tspan{fill:black;stroke:none;}#mermaid-diagram-14409696993191337115 .loopText,#mermaid-diagram-14409696993191337115 .loopText&gt;tspan{fill:black;stroke:none;}#mermaid-diagram-14409696993191337115 .loopLine{stroke-width:2px;stroke-dasharray:2,2;stroke:hsl(259.6261682243, 59.7765363128%, 87.9019607843%);fill:hsl(259.6261682243, 59.7765363128%, 87.9019607843%);}#mermaid-diagram-14409696993191337115 .note{stroke:#aaaa33;fill:#fff5ad;}#mermaid-diagram-14409696993191337115 .noteText,#mermaid-diagram-14409696993191337115 .noteText&gt;tspan{fill:black;stroke:none;}#mermaid-diagram-14409696993191337115 .activation0{fill:#f4f4f4;stroke:#666;}#mermaid-diagram-14409696993191337115 .activation1{fill:#f4f4f4;stroke:#666;}#mermaid-diagram-14409696993191337115 .activation2{fill:#f4f4f4;stroke:#666;}#mermaid-diagram-14409696993191337115 .actorPopupMenu{position:absolute;}#mermaid-diagram-14409696993191337115 .actorPopupMenuPanel{position:absolute;fill:#ECECFF;box-shadow:0px 8px 16px 0px rgba(0,0,0,0.2);filter:drop-shadow(3px 5px 2px rgb(0 0 0 / 0.4));}#mermaid-diagram-14409696993191337115 .actor-man line{stroke:hsl(259.6261682243, 59.7765363128%, 87.9019607843%);fill:#ECECFF;}#mermaid-diagram-14409696993191337115 .actor-man circle,#mermaid-diagram-14409696993191337115 line{stroke:hsl(259.6261682243, 59.7765363128%, 87.9019607843%);fill:#ECECFF;stroke-width:2px;}#mermaid-diagram-14409696993191337115 :root{–mermaid-font-family:“trebuchet ms”,verdana,arial,sans-serif;}</style><g></g><defs><symbol id="computer" width="24" height="24"><path transform="scale(.5)" d="M2 2v13h20v-13h-20zm18 11h-16v-9h16v9zm-10.228 6l.466-1h3.524l.467 1h-4.457zm14.228 3h-24l2-6h2.104l-1.33 4h18.45l-1.297-4h2.073l2 6zm-5-10h-14v-7h14v7z"></path></symbol></defs><defs><symbol id="database" fill-rule="evenodd" clip-rule="evenodd"><path transform="scale(.5)" d="M12.258.001l.256.004.255.005.253.008.251.01.249.012.247.015.246.016.242.019.241.02.239.023.236.024.233.027.231.028.229.031.225.032.223.034.22.036.217.038.214.04.211.041.208.043.205.045.201.046.198.048.194.05.191.051.187.053.183.054.18.056.175.057.172.059.168.06.163.061.16.063.155.064.15.066.074.033.073.033.071.034.07.034.069.035.068.035.067.035.066.035.064.036.064.036.062.036.06.036.06.037.058.037.058.037.055.038.055.038.053.038.052.038.051.039.05.039.048.039.047.039.045.04.044.04.043.04.041.04.04.041.039.041.037.041.036.041.034.041.033.042.032.042.03.042.029.042.027.042.026.043.024.043.023.043.021.043.02.043.018.044.017.043.015.044.013.044.012.044.011.045.009.044.007.045.006.045.004.045.002.045.001.045v17l-.001.045-.002.045-.004.045-.006.045-.007.045-.009.044-.011.045-.012.044-.013.044-.015.044-.017.043-.018.044-.02.043-.021.043-.023.043-.024.043-.026.043-.027.042-.029.042-.03.042-.032.042-.033.042-.034.041-.036.041-.037.041-.039.041-.04.041-.041.04-.043.04-.044.04-.045.04-.047.039-.048.039-.05.039-.051.039-.052.038-.053.038-.055.038-.055.038-.058.037-.058.037-.06.037-.06.036-.062.036-.064.036-.064.036-.066.035-.067.035-.068.035-.069.035-.07.034-.071.034-.073.033-.074.033-.15.066-.155.064-.16.063-.163.061-.168.06-.172.059-.175.057-.18.056-.183.054-.187.053-.191.051-.194.05-.198.048-.201.046-.205.045-.208.043-.211.041-.214.04-.217.038-.22.036-.223.034-.225.032-.229.031-.231.028-.233.027-.236.024-.239.023-.241.02-.242.019-.246.016-.247.015-.249.012-.251.01-.253.008-.255.005-.256.004-.258.001-.258-.001-.256-.004-.255-.005-.253-.008-.251-.01-.249-.012-.247-.015-.245-.016-.243-.019-.241-.02-.238-.023-.236-.024-.234-.027-.231-.028-.228-.031-.226-.032-.223-.034-.22-.036-.217-.038-.214-.04-.211-.041-.208-.043-.204-.045-.201-.046-.198-.048-.195-.05-.19-.051-.187-.053-.184-.054-.179-.056-.176-.057-.172-.059-.167-.06-.164-.061-.159-.063-.155-.064-.151-.066-.074-.033-.072-.033-.072-.034-.07-.034-.069-.035-.068-.035-.067-.035-.066-.035-.064-.036-.063-.036-.062-.036-.061-.036-.06-.037-.058-.037-.057-.037-.056-.038-.055-.038-.053-.038-.052-.038-.051-.039-.049-.039-.049-.039-.046-.039-.046-.04-.044-.04-.043-.04-.041-.04-.04-.041-.039-.041-.037-.041-.036-.041-.034-.041-.033-.042-.032-.042-.03-.042-.029-.042-.027-.042-.026-.043-.024-.043-.023-.043-.021-.043-.02-.043-.018-.044-.017-.043-.015-.044-.013-.044-.012-.044-.011-.045-.009-.044-.007-.045-.006-.045-.004-.045-.002-.045-.001-.045v-17l.001-.045.002-.045.004-.045.006-.045.007-.045.009-.044.011-.045.012-.044.013-.044.015-.044.017-.043.018-.044.02-.043.021-.043.023-.043.024-.043.026-.043.027-.042.029-.042.03-.042.032-.042.033-.042.034-.041.036-.041.037-.041.039-.041.04-.041.041-.04.043-.04.044-.04.046-.04.046-.039.049-.039.049-.039.051-.039.052-.038.053-.038.055-.038.056-.038.057-.037.058-.037.06-.037.061-.036.062-.036.063-.036.064-.036.066-.035.067-.035.068-.035.069-.035.07-.034.072-.034.072-.033.074-.033.151-.066.155-.064.159-.063.164-.061.167-.06.172-.059.176-.057.179-.056.184-.054.187-.053.19-.051.195-.05.198-.048.201-.046.204-.045.208-.043.211-.041.214-.04.217-.038.22-.036.223-.034.226-.032.228-.031.231-.028.234-.027.236-.024.238-.023.241-.02.243-.019.245-.016.247-.015.249-.012.251-.01.253-.008.255-.005.256-.004.258-.001.258.001zm-9.258 20.499v.01l.001.021.003.021.004.022.005.021.006.022.007.022.009.023.01.022.011.023.012.023.013.023.015.023.016.024.017.023.018.024.019.024.021.024.022.025.023.024.024.025.052.049.056.05.061.051.066.051.07.051.075.051.079.052.084.052.088.052.092.052.097.052.102.051.105.052.11.052.114.051.119.051.123.051.127.05.131.05.135.05.139.048.144.049.147.047.152.047.155.047.16.045.163.045.167.043.171.043.176.041.178.041.183.039.187.039.19.037.194.035.197.035.202.033.204.031.209.03.212.029.216.027.219.025.222.024.226.021.23.02.233.018.236.016.24.015.243.012.246.01.249.008.253.005.256.004.259.001.26-.001.257-.004.254-.005.25-.008.247-.011.244-.012.241-.014.237-.016.233-.018.231-.021.226-.021.224-.024.22-.026.216-.027.212-.028.21-.031.205-.031.202-.034.198-.034.194-.036.191-.037.187-.039.183-.04.179-.04.175-.042.172-.043.168-.044.163-.045.16-.046.155-.046.152-.047.148-.048.143-.049.139-.049.136-.05.131-.05.126-.05.123-.051.118-.052.114-.051.11-.052.106-.052.101-.052.096-.052.092-.052.088-.053.083-.051.079-.052.074-.052.07-.051.065-.051.06-.051.056-.05.051-.05.023-.024.023-.025.021-.024.02-.024.019-.024.018-.024.017-.024.015-.023.014-.024.013-.023.012-.023.01-.023.01-.022.008-.022.006-.022.006-.022.004-.022.004-.021.001-.021.001-.021v-4.127l-.077.055-.08.053-.083.054-.085.053-.087.052-.09.052-.093.051-.095.05-.097.05-.1.049-.102.049-.105.048-.106.047-.109.047-.111.046-.114.045-.115.045-.118.044-.12.043-.122.042-.124.042-.126.041-.128.04-.13.04-.132.038-.134.038-.135.037-.138.037-.139.035-.142.035-.143.034-.144.033-.147.032-.148.031-.15.03-.151.03-.153.029-.154.027-.156.027-.158.026-.159.025-.161.024-.162.023-.163.022-.165.021-.166.02-.167.019-.169.018-.169.017-.171.016-.173.015-.173.014-.175.013-.175.012-.177.011-.178.01-.179.008-.179.008-.181.006-.182.005-.182.004-.184.003-.184.002h-.37l-.184-.002-.184-.003-.182-.004-.182-.005-.181-.006-.179-.008-.179-.008-.178-.01-.176-.011-.176-.012-.175-.013-.173-.014-.172-.015-.171-.016-.17-.017-.169-.018-.167-.019-.166-.02-.165-.021-.163-.022-.162-.023-.161-.024-.159-.025-.157-.026-.156-.027-.155-.027-.153-.029-.151-.03-.15-.03-.148-.031-.146-.032-.145-.033-.143-.034-.141-.035-.14-.035-.137-.037-.136-.037-.134-.038-.132-.038-.13-.04-.128-.04-.126-.041-.124-.042-.122-.042-.12-.044-.117-.043-.116-.045-.113-.045-.112-.046-.109-.047-.106-.047-.105-.048-.102-.049-.1-.049-.097-.05-.095-.05-.093-.052-.09-.051-.087-.052-.085-.053-.083-.054-.08-.054-.077-.054v4.127zm0-5.654v.011l.001.021.003.021.004.021.005.022.006.022.007.022.009.022.01.022.011.023.012.023.013.023.015.024.016.023.017.024.018.024.019.024.021.024.022.024.023.025.024.024.052.05.056.05.061.05.066.051.07.051.075.052.079.051.084.052.088.052.092.052.097.052.102.052.105.052.11.051.114.051.119.052.123.05.127.051.131.05.135.049.139.049.144.048.147.048.152.047.155.046.16.045.163.045.167.044.171.042.176.042.178.04.183.04.187.038.19.037.194.036.197.034.202.033.204.032.209.03.212.028.216.027.219.025.222.024.226.022.23.02.233.018.236.016.24.014.243.012.246.01.249.008.253.006.256.003.259.001.26-.001.257-.003.254-.006.25-.008.247-.01.244-.012.241-.015.237-.016.233-.018.231-.02.226-.022.224-.024.22-.025.216-.027.212-.029.21-.03.205-.032.202-.033.198-.035.194-.036.191-.037.187-.039.183-.039.179-.041.175-.042.172-.043.168-.044.163-.045.16-.045.155-.047.152-.047.148-.048.143-.048.139-.05.136-.049.131-.05.126-.051.123-.051.118-.051.114-.052.11-.052.106-.052.101-.052.096-.052.092-.052.088-.052.083-.052.079-.052.074-.051.07-.052.065-.051.06-.05.056-.051.051-.049.023-.025.023-.024.021-.025.02-.024.019-.024.018-.024.017-.024.015-.023.014-.023.013-.024.012-.022.01-.023.01-.023.008-.022.006-.022.006-.022.004-.021.004-.022.001-.021.001-.021v-4.139l-.077.054-.08.054-.083.054-.085.052-.087.053-.09.051-.093.051-.095.051-.097.05-.1.049-.102.049-.105.048-.106.047-.109.047-.111.046-.114.045-.115.044-.118.044-.12.044-.122.042-.124.042-.126.041-.128.04-.13.039-.132.039-.134.038-.135.037-.138.036-.139.036-.142.035-.143.033-.144.033-.147.033-.148.031-.15.03-.151.03-.153.028-.154.028-.156.027-.158.026-.159.025-.161.024-.162.023-.163.022-.165.021-.166.02-.167.019-.169.018-.169.017-.171.016-.173.015-.173.014-.175.013-.175.012-.177.011-.178.009-.179.009-.179.007-.181.007-.182.005-.182.004-.184.003-.184.002h-.37l-.184-.002-.184-.003-.182-.004-.182-.005-.181-.007-.179-.007-.179-.009-.178-.009-.176-.011-.176-.012-.175-.013-.173-.014-.172-.015-.171-.016-.17-.017-.169-.018-.167-.019-.166-.02-.165-.021-.163-.022-.162-.023-.161-.024-.159-.025-.157-.026-.156-.027-.155-.028-.153-.028-.151-.03-.15-.03-.148-.031-.146-.033-.145-.033-.143-.033-.141-.035-.14-.036-.137-.036-.136-.037-.134-.038-.132-.039-.13-.039-.128-.04-.126-.041-.124-.042-.122-.043-.12-.043-.117-.044-.116-.044-.113-.046-.112-.046-.109-.046-.106-.047-.105-.048-.102-.049-.1-.049-.097-.05-.095-.051-.093-.051-.09-.051-.087-.053-.085-.052-.083-.054-.08-.054-.077-.054v4.139zm0-5.666v.011l.001.02.003.022.004.021.005.022.006.021.007.022.009.023.01.022.011.023.012.023.013.023.015.023.016.024.017.024.018.023.019.024.021.025.022.024.023.024.024.025.052.05.056.05.061.05.066.051.07.051.075.052.079.051.084.052.088.052.092.052.097.052.102.052.105.051.11.052.114.051.119.051.123.051.127.05.131.05.135.05.139.049.144.048.147.048.152.047.155.046.16.045.163.045.167.043.171.043.176.042.178.04.183.04.187.038.19.037.194.036.197.034.202.033.204.032.209.03.212.028.216.027.219.025.222.024.226.021.23.02.233.018.236.017.24.014.243.012.246.01.249.008.253.006.256.003.259.001.26-.001.257-.003.254-.006.25-.008.247-.01.244-.013.241-.014.237-.016.233-.018.231-.02.226-.022.224-.024.22-.025.216-.027.212-.029.21-.03.205-.032.202-.033.198-.035.194-.036.191-.037.187-.039.183-.039.179-.041.175-.042.172-.043.168-.044.163-.045.16-.045.155-.047.152-.047.148-.048.143-.049.139-.049.136-.049.131-.051.126-.05.123-.051.118-.052.114-.051.11-.052.106-.052.101-.052.096-.052.092-.052.088-.052.083-.052.079-.052.074-.052.07-.051.065-.051.06-.051.056-.05.051-.049.023-.025.023-.025.021-.024.02-.024.019-.024.018-.024.017-.024.015-.023.014-.024.013-.023.012-.023.01-.022.01-.023.008-.022.006-.022.006-.022.004-.022.004-.021.001-.021.001-.021v-4.153l-.077.054-.08.054-.083.053-.085.053-.087.053-.09.051-.093.051-.095.051-.097.05-.1.049-.102.048-.105.048-.106.048-.109.046-.111.046-.114.046-.115.044-.118.044-.12.043-.122.043-.124.042-.126.041-.128.04-.13.039-.132.039-.134.038-.135.037-.138.036-.139.036-.142.034-.143.034-.144.033-.147.032-.148.032-.15.03-.151.03-.153.028-.154.028-.156.027-.158.026-.159.024-.161.024-.162.023-.163.023-.165.021-.166.02-.167.019-.169.018-.169.017-.171.016-.173.015-.173.014-.175.013-.175.012-.177.01-.178.01-.179.009-.179.007-.181.006-.182.006-.182.004-.184.003-.184.001-.185.001-.185-.001-.184-.001-.184-.003-.182-.004-.182-.006-.181-.006-.179-.007-.179-.009-.178-.01-.176-.01-.176-.012-.175-.013-.173-.014-.172-.015-.171-.016-.17-.017-.169-.018-.167-.019-.166-.02-.165-.021-.163-.023-.162-.023-.161-.024-.159-.024-.157-.026-.156-.027-.155-.028-.153-.028-.151-.03-.15-.03-.148-.032-.146-.032-.145-.033-.143-.034-.141-.034-.14-.036-.137-.036-.136-.037-.134-.038-.132-.039-.13-.039-.128-.041-.126-.041-.124-.041-.122-.043-.12-.043-.117-.044-.116-.044-.113-.046-.112-.046-.109-.046-.106-.048-.105-.048-.102-.048-.1-.05-.097-.049-.095-.051-.093-.051-.09-.052-.087-.052-.085-.053-.083-.053-.08-.054-.077-.054v4.153zm8.74-8.179l-.257.004-.254.005-.25.008-.247.011-.244.012-.241.014-.237.016-.233.018-.231.021-.226.022-.224.023-.22.026-.216.027-.212.028-.21.031-.205.032-.202.033-.198.034-.194.036-.191.038-.187.038-.183.04-.179.041-.175.042-.172.043-.168.043-.163.045-.16.046-.155.046-.152.048-.148.048-.143.048-.139.049-.136.05-.131.05-.126.051-.123.051-.118.051-.114.052-.11.052-.106.052-.101.052-.096.052-.092.052-.088.052-.083.052-.079.052-.074.051-.07.052-.065.051-.06.05-.056.05-.051.05-.023.025-.023.024-.021.024-.02.025-.019.024-.018.024-.017.023-.015.024-.014.023-.013.023-.012.023-.01.023-.01.022-.008.022-.006.023-.006.021-.004.022-.004.021-.001.021-.001.021.001.021.001.021.004.021.004.022.006.021.006.023.008.022.01.022.01.023.012.023.013.023.014.023.015.024.017.023.018.024.019.024.02.025.021.024.023.024.023.025.051.05.056.05.06.05.065.051.07.052.074.051.079.052.083.052.088.052.092.052.096.052.101.052.106.052.11.052.114.052.118.051.123.051.126.051.131.05.136.05.139.049.143.048.148.048.152.048.155.046.16.046.163.045.168.043.172.043.175.042.179.041.183.04.187.038.191.038.194.036.198.034.202.033.205.032.21.031.212.028.216.027.22.026.224.023.226.022.231.021.233.018.237.016.241.014.244.012.247.011.25.008.254.005.257.004.26.001.26-.001.257-.004.254-.005.25-.008.247-.011.244-.012.241-.014.237-.016.233-.018.231-.021.226-.022.224-.023.22-.026.216-.027.212-.028.21-.031.205-.032.202-.033.198-.034.194-.036.191-.038.187-.038.183-.04.179-.041.175-.042.172-.043.168-.043.163-.045.16-.046.155-.046.152-.048.148-.048.143-.048.139-.049.136-.05.131-.05.126-.051.123-.051.118-.051.114-.052.11-.052.106-.052.101-.052.096-.052.092-.052.088-.052.083-.052.079-.052.074-.051.07-.052.065-.051.06-.05.056-.05.051-.05.023-.025.023-.024.021-.024.02-.025.019-.024.018-.024.017-.023.015-.024.014-.023.013-.023.012-.023.01-.023.01-.022.008-.022.006-.023.006-.021.004-.022.004-.021.001-.021.001-.021-.001-.021-.001-.021-.004-.021-.004-.022-.006-.021-.006-.023-.008-.022-.01-.022-.01-.023-.012-.023-.013-.023-.014-.023-.015-.024-.017-.023-.018-.024-.019-.024-.02-.025-.021-.024-.023-.024-.023-.025-.051-.05-.056-.05-.06-.05-.065-.051-.07-.052-.074-.051-.079-.052-.083-.052-.088-.052-.092-.052-.096-.052-.101-.052-.106-.052-.11-.052-.114-.052-.118-.051-.123-.051-.126-.051-.131-.05-.136-.05-.139-.049-.143-.048-.148-.048-.152-.048-.155-.046-.16-.046-.163-.045-.168-.043-.172-.043-.175-.042-.179-.041-.183-.04-.187-.038-.191-.038-.194-.036-.198-.034-.202-.033-.205-.032-.21-.031-.212-.028-.216-.027-.22-.026-.224-.023-.226-.022-.231-.021-.233-.018-.237-.016-.241-.014-.244-.012-.247-.011-.25-.008-.254-.005-.257-.004-.26-.001-.26.001z"></path></symbol></defs><defs><symbol id="clock" width="24" height="24"><path transform="scale(.5)" d="M12 2c5.514 0 10 4.486 10 10s-4.486 10-10 10-10-4.486-10-10 4.486-10 10-10zm0-2c-6.627 0-12 5.373-12 12s5.373 12 12 12 12-5.373 12-12-5.373-12-12-12zm5.848 12.459c.202.038.202.333.001.372-1.907.361-6.045 1.111-6.547 1.111-.719 0-1.301-.582-1.301-1.301 0-.512.77-5.447 1.125-7.445.034-.192.312-.181.343.014l.985 6.238 5.394 1.011z"></path></symbol></defs><defs><marker id="arrowhead" refx="7.9" refy="5" markerunits="userSpaceOnUse" markerwidth="12" markerheight="12" orient="auto-start-reverse"><path d="M -1 0 L 10 5 L 0 10 z"></path></marker></defs><defs><marker id="crosshead" markerwidth="15" markerheight="8" orient="auto" refx="4" refy="4.5"><path fill="none" stroke="#000000" stroke-width="1pt" d="M 1,2 L 6,7 M 6,2 L 1,7" style="stroke-dasharray: 0, 0;"></path></marker></defs><defs><marker id="filled-head" refx="15.5" refy="7" markerwidth="20" markerheight="28" orient="auto"><path d="M 18,7 L9,13 L14,7 L9,1 Z"></path></marker></defs><defs><marker id="sequencenumber" refx="15" refy="15" markerwidth="60" markerheight="40" orient="auto"><circle cx="15" cy="15" r="6"></circle></marker></defs><g><line x1="64" y1="255" x2="1096" y2="255" class="loopLine"></line><line x1="1096" y1="255" x2="1096" y2="779" class="loopLine"></line><line x1="64" y1="779" x2="1096" y2="779" class="loopLine"></line><line x1="64" y1="255" x2="64" y2="779" class="loopLine"></line><line x1="64" y1="395" x2="1096" y2="395" class="loopLine" style="stroke-dasharray: 3, 3;"></line><polygon points="64,255 114,255 114,268 105.6,275 64,275" class="labelBox"></polygon><text x="89" y="268" text-anchor="middle" dominant-baseline="middle" alignment-baseline="middle" class="labelText" style="font-size: 16px; font-weight: 400;">alt</text><text x="605" y="273" text-anchor="middle" class="loopText" style="font-size: 16px; font-weight: 400;"><tspan x="605">[Tile in cache]</tspan></text><text x="580" y="413" text-anchor="middle" class="loopText" style="font-size: 16px; font-weight: 400;">[Tile not in cache]</text></g><text x="178" y="80" text-anchor="middle" dominant-baseline="middle" alignment-baseline="middle" class="messageText" dy="1em" style="font-size: 16px; font-weight: 400;">GET /source_id/z/x/y</text><line x1="76" y1="111" x2="279" y2="111" class="messageLine0" stroke-width="2" stroke="none" marker-end="url(#arrowhead)" style="fill: none;"></line><text x="383" y="126" text-anchor="middle" dominant-baseline="middle" alignment-baseline="middle" class="messageText" dy="1em" style="font-size: 16px; font-weight: 400;">Resolve source_id</text><line x1="284" y1="157" x2="481" y2="157" class="messageLine0" stroke-width="2" stroke="none" marker-end="url(#arrowhead)" style="fill: none;"></line><text x="386" y="172" text-anchor="middle" dominant-baseline="middle" alignment-baseline="middle" class="messageText" dy="1em" style="font-size: 16px; font-weight: 400;">Source reference</text><line x1="484" y1="201" x2="287" y2="201" class="messageLine1" stroke-width="2" stroke="none" marker-end="url(#arrowhead)" style="stroke-dasharray: 3, 3; fill: none;"></line><text x="483" y="216" text-anchor="middle" dominant-baseline="middle" alignment-baseline="middle" class="messageText" dy="1em" style="font-size: 16px; font-weight: 400;">Check cache</text><line x1="284" y1="245" x2="681" y2="245" class="messageLine0" stroke-width="2" stroke="none" marker-end="url(#arrowhead)" style="fill: none;"></line><text x="486" y="305" text-anchor="middle" dominant-baseline="middle" alignment-baseline="middle" class="messageText" dy="1em" style="font-size: 16px; font-weight: 400;">Cached tile</text><line x1="684" y1="334" x2="287" y2="334" class="messageLine1" stroke-width="2" stroke="none" marker-end="url(#arrowhead)" style="stroke-dasharray: 3, 3; fill: none;"></line><text x="181" y="349" text-anchor="middle" dominant-baseline="middle" alignment-baseline="middle" class="messageText" dy="1em" style="font-size: 16px; font-weight: 400;">200 OK (tile data)</text><line x1="282" y1="380" x2="79" y2="380" class="messageLine1" stroke-width="2" stroke="none" marker-end="url(#arrowhead)" style="stroke-dasharray: 3, 3; fill: none;"></line><text x="583" y="440" text-anchor="middle" dominant-baseline="middle" alignment-baseline="middle" class="messageText" dy="1em" style="font-size: 16px; font-weight: 400;">Get tile(z, x, y)</text><line x1="284" y1="471" x2="881" y2="471" class="messageLine0" stroke-width="2" stroke="none" marker-end="url(#arrowhead)" style="fill: none;"></line><text x="984" y="486" text-anchor="middle" dominant-baseline="middle" alignment-baseline="middle" class="messageText" dy="1em" style="font-size: 16px; font-weight: 400;">Query data</text><line x1="886" y1="517" x2="1081" y2="517" class="messageLine0" stroke-width="2" stroke="none" marker-end="url(#arrowhead)" style="fill: none;"></line><text x="987" y="532" text-anchor="middle" dominant-baseline="middle" alignment-baseline="middle" class="messageText" dy="1em" style="font-size: 16px; font-weight: 400;">Raw data</text><line x1="1084" y1="561" x2="889" y2="561" class="messageLine1" stroke-width="2" stroke="none" marker-end="url(#arrowhead)" style="stroke-dasharray: 3, 3; fill: none;"></line><text x="886" y="576" text-anchor="middle" dominant-baseline="middle" alignment-baseline="middle" class="messageText" dy="1em" style="font-size: 16px; font-weight: 400;">Generate MVT</text><path d="M 886,605 C 946,595 946,635 886,625" class="messageLine0" stroke-width="2" stroke="none" marker-end="url(#arrowhead)" style="fill: none;"></path><text x="586" y="650" text-anchor="middle" dominant-baseline="middle" alignment-baseline="middle" class="messageText" dy="1em" style="font-size: 16px; font-weight: 400;">Tile data</text><line x1="884" y1="679" x2="287" y2="679" class="messageLine1" stroke-width="2" stroke="none" marker-end="url(#arrowhead)" style="stroke-dasharray: 3, 3; fill: none;"></line><text x="483" y="694" text-anchor="middle" dominant-baseline="middle" alignment-baseline="middle" class="messageText" dy="1em" style="font-size: 16px; font-weight: 400;">Store tile</text><line x1="284" y1="723" x2="681" y2="723" class="messageLine0" stroke-width="2" stroke="none" marker-end="url(#arrowhead)" style="fill: none;"></line><text x="181" y="738" text-anchor="middle" dominant-baseline="middle" alignment-baseline="middle" class="messageText" dy="1em" style="font-size: 16px; font-weight: 400;">200 OK (tile data)</text><line x1="282" y1="769" x2="79" y2="769" class="messageLine1" stroke-width="2" stroke="none" marker-end="url(#arrowhead)" style="stroke-dasharray: 3, 3; fill: none;"></line></svg></p>
</div>

<div class="mdbook-tab-content hidden" data-tabname="Configuration and Initialization Flow">
<p><svg id="mermaid-diagram-5874719423896527527" width="100%" xmlns="http://www.w3.org/2000/svg" style="max-width: 1106px;" viewbox="-50 -10 1106 1003" role="graphics-document document" aria-roledescription="sequence"><g><rect x="855" y="917" fill="#eaeaea" stroke="#666" width="150" height="65" name="Server" rx="3" ry="3" class="actor actor-bottom"></rect><text x="930" y="949.5" dominant-baseline="central" alignment-baseline="central" class="actor actor-box" style="text-anchor: middle; font-size: 16px; font-weight: 400;"><tspan x="930" dy="0">HTTP Server</tspan></text></g><g><rect x="655" y="917" fill="#eaeaea" stroke="#666" width="150" height="65" name="Sources" rx="3" ry="3" class="actor actor-bottom"></rect><text x="730" y="949.5" dominant-baseline="central" alignment-baseline="central" class="actor actor-box" style="text-anchor: middle; font-size: 16px; font-weight: 400;"><tspan x="730" dy="0">Tile Sources</tspan></text></g><g><rect x="422" y="917" fill="#eaeaea" stroke="#666" width="150" height="65" name="Discovery" rx="3" ry="3" class="actor actor-bottom"></rect><text x="497" y="949.5" dominant-baseline="central" alignment-baseline="central" class="actor actor-box" style="text-anchor: middle; font-size: 16px; font-weight: 400;"><tspan x="497" dy="0">Source Discovery</tspan></text></g><g><rect x="222" y="917" fill="#eaeaea" stroke="#666" width="150" height="65" name="Config" rx="3" ry="3" class="actor actor-bottom"></rect><text x="297" y="949.5" dominant-baseline="central" alignment-baseline="central" class="actor actor-box" style="text-anchor: middle; font-size: 16px; font-weight: 400;"><tspan x="297" dy="0">Config Parser</tspan></text></g><g><rect x="0" y="917" fill="#eaeaea" stroke="#666" width="150" height="65" name="CLI" rx="3" ry="3" class="actor actor-bottom"></rect><text x="75" y="949.5" dominant-baseline="central" alignment-baseline="central" class="actor actor-box" style="text-anchor: middle; font-size: 16px; font-weight: 400;"><tspan x="75" dy="0">CLI</tspan></text></g><g><line id="actor10" x1="930" y1="65" x2="930" y2="917" class="actor-line 200" stroke-width="0.5px" stroke="#999" name="Server"></line><g id="root-10"><rect x="855" y="0" fill="#eaeaea" stroke="#666" width="150" height="65" name="Server" rx="3" ry="3" class="actor actor-top"></rect><text x="930" y="32.5" dominant-baseline="central" alignment-baseline="central" class="actor actor-box" style="text-anchor: middle; font-size: 16px; font-weight: 400;"><tspan x="930" dy="0">HTTP Server</tspan></text></g></g><g><line id="actor9" x1="730" y1="65" x2="730" y2="917" class="actor-line 200" stroke-width="0.5px" stroke="#999" name="Sources"></line><g id="root-9"><rect x="655" y="0" fill="#eaeaea" stroke="#666" width="150" height="65" name="Sources" rx="3" ry="3" class="actor actor-top"></rect><text x="730" y="32.5" dominant-baseline="central" alignment-baseline="central" class="actor actor-box" style="text-anchor: middle; font-size: 16px; font-weight: 400;"><tspan x="730" dy="0">Tile Sources</tspan></text></g></g><g><line id="actor8" x1="497" y1="65" x2="497" y2="917" class="actor-line 200" stroke-width="0.5px" stroke="#999" name="Discovery"></line><g id="root-8"><rect x="422" y="0" fill="#eaeaea" stroke="#666" width="150" height="65" name="Discovery" rx="3" ry="3" class="actor actor-top"></rect><text x="497" y="32.5" dominant-baseline="central" alignment-baseline="central" class="actor actor-box" style="text-anchor: middle; font-size: 16px; font-weight: 400;"><tspan x="497" dy="0">Source Discovery</tspan></text></g></g><g><line id="actor7" x1="297" y1="65" x2="297" y2="917" class="actor-line 200" stroke-width="0.5px" stroke="#999" name="Config"></line><g id="root-7"><rect x="222" y="0" fill="#eaeaea" stroke="#666" width="150" height="65" name="Config" rx="3" ry="3" class="actor actor-top"></rect><text x="297" y="32.5" dominant-baseline="central" alignment-baseline="central" class="actor actor-box" style="text-anchor: middle; font-size: 16px; font-weight: 400;"><tspan x="297" dy="0">Config Parser</tspan></text></g></g><g><line id="actor6" x1="75" y1="65" x2="75" y2="917" class="actor-line 200" stroke-width="0.5px" stroke="#999" name="CLI"></line><g id="root-6"><rect x="0" y="0" fill="#eaeaea" stroke="#666" width="150" height="65" name="CLI" rx="3" ry="3" class="actor actor-top"></rect><text x="75" y="32.5" dominant-baseline="central" alignment-baseline="central" class="actor actor-box" style="text-anchor: middle; font-size: 16px; font-weight: 400;"><tspan x="75" dy="0">CLI</tspan></text></g></g><style>#mermaid-diagram-5874719423896527527{font-family:“trebuchet ms”,verdana,arial,sans-serif;font-size:16px;fill:#333;}@keyframes edge-animation-frame{from{stroke-dashoffset:0;}}@keyframes dash{to{stroke-dashoffset:0;}}#mermaid-diagram-5874719423896527527 .edge-animation-slow{stroke-dasharray:9,5!important;stroke-dashoffset:900;animation:dash 50s linear infinite;stroke-linecap:round;}#mermaid-diagram-5874719423896527527 .edge-animation-fast{stroke-dasharray:9,5!important;stroke-dashoffset:900;animation:dash 20s linear infinite;stroke-linecap:round;}#mermaid-diagram-5874719423896527527 .error-icon{fill:#552222;}#mermaid-diagram-5874719423896527527 .error-text{fill:#552222;stroke:#552222;}#mermaid-diagram-5874719423896527527 .edge-thickness-normal{stroke-width:1px;}#mermaid-diagram-5874719423896527527 .edge-thickness-thick{stroke-width:3.5px;}#mermaid-diagram-5874719423896527527 .edge-pattern-solid{stroke-dasharray:0;}#mermaid-diagram-5874719423896527527 .edge-thickness-invisible{stroke-width:0;fill:none;}#mermaid-diagram-5874719423896527527 .edge-pattern-dashed{stroke-dasharray:3;}#mermaid-diagram-5874719423896527527 .edge-pattern-dotted{stroke-dasharray:2;}#mermaid-diagram-5874719423896527527 .marker{fill:#333333;stroke:#333333;}#mermaid-diagram-5874719423896527527 .marker.cross{stroke:#333333;}#mermaid-diagram-5874719423896527527 svg{font-family:“trebuchet ms”,verdana,arial,sans-serif;font-size:16px;}#mermaid-diagram-5874719423896527527 p{margin:0;}#mermaid-diagram-5874719423896527527 .actor{stroke:hsl(259.6261682243, 59.7765363128%, 87.9019607843%);fill:#ECECFF;}#mermaid-diagram-5874719423896527527 text.actor&gt;tspan{fill:black;stroke:none;}#mermaid-diagram-5874719423896527527 .actor-line{stroke:hsl(259.6261682243, 59.7765363128%, 87.9019607843%);}#mermaid-diagram-5874719423896527527 .innerArc{stroke-width:1.5;stroke-dasharray:none;}#mermaid-diagram-5874719423896527527 .messageLine0{stroke-width:1.5;stroke-dasharray:none;stroke:#333;}#mermaid-diagram-5874719423896527527 .messageLine1{stroke-width:1.5;stroke-dasharray:2,2;stroke:#333;}#mermaid-diagram-5874719423896527527 #arrowhead path{fill:#333;stroke:#333;}#mermaid-diagram-5874719423896527527 .sequenceNumber{fill:white;}#mermaid-diagram-5874719423896527527 #sequencenumber{fill:#333;}#mermaid-diagram-5874719423896527527 #crosshead path{fill:#333;stroke:#333;}#mermaid-diagram-5874719423896527527 .messageText{fill:#333;stroke:none;}#mermaid-diagram-5874719423896527527 .labelBox{stroke:hsl(259.6261682243, 59.7765363128%, 87.9019607843%);fill:#ECECFF;}#mermaid-diagram-5874719423896527527 .labelText,#mermaid-diagram-5874719423896527527 .labelText&gt;tspan{fill:black;stroke:none;}#mermaid-diagram-5874719423896527527 .loopText,#mermaid-diagram-5874719423896527527 .loopText&gt;tspan{fill:black;stroke:none;}#mermaid-diagram-5874719423896527527 .loopLine{stroke-width:2px;stroke-dasharray:2,2;stroke:hsl(259.6261682243, 59.7765363128%, 87.9019607843%);fill:hsl(259.6261682243, 59.7765363128%, 87.9019607843%);}#mermaid-diagram-5874719423896527527 .note{stroke:#aaaa33;fill:#fff5ad;}#mermaid-diagram-5874719423896527527 .noteText,#mermaid-diagram-5874719423896527527 .noteText&gt;tspan{fill:black;stroke:none;}#mermaid-diagram-5874719423896527527 .activation0{fill:#f4f4f4;stroke:#666;}#mermaid-diagram-5874719423896527527 .activation1{fill:#f4f4f4;stroke:#666;}#mermaid-diagram-5874719423896527527 .activation2{fill:#f4f4f4;stroke:#666;}#mermaid-diagram-5874719423896527527 .actorPopupMenu{position:absolute;}#mermaid-diagram-5874719423896527527 .actorPopupMenuPanel{position:absolute;fill:#ECECFF;box-shadow:0px 8px 16px 0px rgba(0,0,0,0.2);filter:drop-shadow(3px 5px 2px rgb(0 0 0 / 0.4));}#mermaid-diagram-5874719423896527527 .actor-man line{stroke:hsl(259.6261682243, 59.7765363128%, 87.9019607843%);fill:#ECECFF;}#mermaid-diagram-5874719423896527527 .actor-man circle,#mermaid-diagram-5874719423896527527 line{stroke:hsl(259.6261682243, 59.7765363128%, 87.9019607843%);fill:#ECECFF;stroke-width:2px;}#mermaid-diagram-5874719423896527527 :root{–mermaid-font-family:“trebuchet ms”,verdana,arial,sans-serif;}</style><g></g><defs><symbol id="computer-1" width="24" height="24"><path transform="scale(.5)" d="M2 2v13h20v-13h-20zm18 11h-16v-9h16v9zm-10.228 6l.466-1h3.524l.467 1h-4.457zm14.228 3h-24l2-6h2.104l-1.33 4h18.45l-1.297-4h2.073l2 6zm-5-10h-14v-7h14v7z"></path></symbol></defs><defs><symbol id="database-1" fill-rule="evenodd" clip-rule="evenodd"><path transform="scale(.5)" d="M12.258.001l.256.004.255.005.253.008.251.01.249.012.247.015.246.016.242.019.241.02.239.023.236.024.233.027.231.028.229.031.225.032.223.034.22.036.217.038.214.04.211.041.208.043.205.045.201.046.198.048.194.05.191.051.187.053.183.054.18.056.175.057.172.059.168.06.163.061.16.063.155.064.15.066.074.033.073.033.071.034.07.034.069.035.068.035.067.035.066.035.064.036.064.036.062.036.06.036.06.037.058.037.058.037.055.038.055.038.053.038.052.038.051.039.05.039.048.039.047.039.045.04.044.04.043.04.041.04.04.041.039.041.037.041.036.041.034.041.033.042.032.042.03.042.029.042.027.042.026.043.024.043.023.043.021.043.02.043.018.044.017.043.015.044.013.044.012.044.011.045.009.044.007.045.006.045.004.045.002.045.001.045v17l-.001.045-.002.045-.004.045-.006.045-.007.045-.009.044-.011.045-.012.044-.013.044-.015.044-.017.043-.018.044-.02.043-.021.043-.023.043-.024.043-.026.043-.027.042-.029.042-.03.042-.032.042-.033.042-.034.041-.036.041-.037.041-.039.041-.04.041-.041.04-.043.04-.044.04-.045.04-.047.039-.048.039-.05.039-.051.039-.052.038-.053.038-.055.038-.055.038-.058.037-.058.037-.06.037-.06.036-.062.036-.064.036-.064.036-.066.035-.067.035-.068.035-.069.035-.07.034-.071.034-.073.033-.074.033-.15.066-.155.064-.16.063-.163.061-.168.06-.172.059-.175.057-.18.056-.183.054-.187.053-.191.051-.194.05-.198.048-.201.046-.205.045-.208.043-.211.041-.214.04-.217.038-.22.036-.223.034-.225.032-.229.031-.231.028-.233.027-.236.024-.239.023-.241.02-.242.019-.246.016-.247.015-.249.012-.251.01-.253.008-.255.005-.256.004-.258.001-.258-.001-.256-.004-.255-.005-.253-.008-.251-.01-.249-.012-.247-.015-.245-.016-.243-.019-.241-.02-.238-.023-.236-.024-.234-.027-.231-.028-.228-.031-.226-.032-.223-.034-.22-.036-.217-.038-.214-.04-.211-.041-.208-.043-.204-.045-.201-.046-.198-.048-.195-.05-.19-.051-.187-.053-.184-.054-.179-.056-.176-.057-.172-.059-.167-.06-.164-.061-.159-.063-.155-.064-.151-.066-.074-.033-.072-.033-.072-.034-.07-.034-.069-.035-.068-.035-.067-.035-.066-.035-.064-.036-.063-.036-.062-.036-.061-.036-.06-.037-.058-.037-.057-.037-.056-.038-.055-.038-.053-.038-.052-.038-.051-.039-.049-.039-.049-.039-.046-.039-.046-.04-.044-.04-.043-.04-.041-.04-.04-.041-.039-.041-.037-.041-.036-.041-.034-.041-.033-.042-.032-.042-.03-.042-.029-.042-.027-.042-.026-.043-.024-.043-.023-.043-.021-.043-.02-.043-.018-.044-.017-.043-.015-.044-.013-.044-.012-.044-.011-.045-.009-.044-.007-.045-.006-.045-.004-.045-.002-.045-.001-.045v-17l.001-.045.002-.045.004-.045.006-.045.007-.045.009-.044.011-.045.012-.044.013-.044.015-.044.017-.043.018-.044.02-.043.021-.043.023-.043.024-.043.026-.043.027-.042.029-.042.03-.042.032-.042.033-.042.034-.041.036-.041.037-.041.039-.041.04-.041.041-.04.043-.04.044-.04.046-.04.046-.039.049-.039.049-.039.051-.039.052-.038.053-.038.055-.038.056-.038.057-.037.058-.037.06-.037.061-.036.062-.036.063-.036.064-.036.066-.035.067-.035.068-.035.069-.035.07-.034.072-.034.072-.033.074-.033.151-.066.155-.064.159-.063.164-.061.167-.06.172-.059.176-.057.179-.056.184-.054.187-.053.19-.051.195-.05.198-.048.201-.046.204-.045.208-.043.211-.041.214-.04.217-.038.22-.036.223-.034.226-.032.228-.031.231-.028.234-.027.236-.024.238-.023.241-.02.243-.019.245-.016.247-.015.249-.012.251-.01.253-.008.255-.005.256-.004.258-.001.258.001zm-9.258 20.499v.01l.001.021.003.021.004.022.005.021.006.022.007.022.009.023.01.022.011.023.012.023.013.023.015.023.016.024.017.023.018.024.019.024.021.024.022.025.023.024.024.025.052.049.056.05.061.051.066.051.07.051.075.051.079.052.084.052.088.052.092.052.097.052.102.051.105.052.11.052.114.051.119.051.123.051.127.05.131.05.135.05.139.048.144.049.147.047.152.047.155.047.16.045.163.045.167.043.171.043.176.041.178.041.183.039.187.039.19.037.194.035.197.035.202.033.204.031.209.03.212.029.216.027.219.025.222.024.226.021.23.02.233.018.236.016.24.015.243.012.246.01.249.008.253.005.256.004.259.001.26-.001.257-.004.254-.005.25-.008.247-.011.244-.012.241-.014.237-.016.233-.018.231-.021.226-.021.224-.024.22-.026.216-.027.212-.028.21-.031.205-.031.202-.034.198-.034.194-.036.191-.037.187-.039.183-.04.179-.04.175-.042.172-.043.168-.044.163-.045.16-.046.155-.046.152-.047.148-.048.143-.049.139-.049.136-.05.131-.05.126-.05.123-.051.118-.052.114-.051.11-.052.106-.052.101-.052.096-.052.092-.052.088-.053.083-.051.079-.052.074-.052.07-.051.065-.051.06-.051.056-.05.051-.05.023-.024.023-.025.021-.024.02-.024.019-.024.018-.024.017-.024.015-.023.014-.024.013-.023.012-.023.01-.023.01-.022.008-.022.006-.022.006-.022.004-.022.004-.021.001-.021.001-.021v-4.127l-.077.055-.08.053-.083.054-.085.053-.087.052-.09.052-.093.051-.095.05-.097.05-.1.049-.102.049-.105.048-.106.047-.109.047-.111.046-.114.045-.115.045-.118.044-.12.043-.122.042-.124.042-.126.041-.128.04-.13.04-.132.038-.134.038-.135.037-.138.037-.139.035-.142.035-.143.034-.144.033-.147.032-.148.031-.15.03-.151.03-.153.029-.154.027-.156.027-.158.026-.159.025-.161.024-.162.023-.163.022-.165.021-.166.02-.167.019-.169.018-.169.017-.171.016-.173.015-.173.014-.175.013-.175.012-.177.011-.178.01-.179.008-.179.008-.181.006-.182.005-.182.004-.184.003-.184.002h-.37l-.184-.002-.184-.003-.182-.004-.182-.005-.181-.006-.179-.008-.179-.008-.178-.01-.176-.011-.176-.012-.175-.013-.173-.014-.172-.015-.171-.016-.17-.017-.169-.018-.167-.019-.166-.02-.165-.021-.163-.022-.162-.023-.161-.024-.159-.025-.157-.026-.156-.027-.155-.027-.153-.029-.151-.03-.15-.03-.148-.031-.146-.032-.145-.033-.143-.034-.141-.035-.14-.035-.137-.037-.136-.037-.134-.038-.132-.038-.13-.04-.128-.04-.126-.041-.124-.042-.122-.042-.12-.044-.117-.043-.116-.045-.113-.045-.112-.046-.109-.047-.106-.047-.105-.048-.102-.049-.1-.049-.097-.05-.095-.05-.093-.052-.09-.051-.087-.052-.085-.053-.083-.054-.08-.054-.077-.054v4.127zm0-5.654v.011l.001.021.003.021.004.021.005.022.006.022.007.022.009.022.01.022.011.023.012.023.013.023.015.024.016.023.017.024.018.024.019.024.021.024.022.024.023.025.024.024.052.05.056.05.061.05.066.051.07.051.075.052.079.051.084.052.088.052.092.052.097.052.102.052.105.052.11.051.114.051.119.052.123.05.127.051.131.05.135.049.139.049.144.048.147.048.152.047.155.046.16.045.163.045.167.044.171.042.176.042.178.04.183.04.187.038.19.037.194.036.197.034.202.033.204.032.209.03.212.028.216.027.219.025.222.024.226.022.23.02.233.018.236.016.24.014.243.012.246.01.249.008.253.006.256.003.259.001.26-.001.257-.003.254-.006.25-.008.247-.01.244-.012.241-.015.237-.016.233-.018.231-.02.226-.022.224-.024.22-.025.216-.027.212-.029.21-.03.205-.032.202-.033.198-.035.194-.036.191-.037.187-.039.183-.039.179-.041.175-.042.172-.043.168-.044.163-.045.16-.045.155-.047.152-.047.148-.048.143-.048.139-.05.136-.049.131-.05.126-.051.123-.051.118-.051.114-.052.11-.052.106-.052.101-.052.096-.052.092-.052.088-.052.083-.052.079-.052.074-.051.07-.052.065-.051.06-.05.056-.051.051-.049.023-.025.023-.024.021-.025.02-.024.019-.024.018-.024.017-.024.015-.023.014-.023.013-.024.012-.022.01-.023.01-.023.008-.022.006-.022.006-.022.004-.021.004-.022.001-.021.001-.021v-4.139l-.077.054-.08.054-.083.054-.085.052-.087.053-.09.051-.093.051-.095.051-.097.05-.1.049-.102.049-.105.048-.106.047-.109.047-.111.046-.114.045-.115.044-.118.044-.12.044-.122.042-.124.042-.126.041-.128.04-.13.039-.132.039-.134.038-.135.037-.138.036-.139.036-.142.035-.143.033-.144.033-.147.033-.148.031-.15.03-.151.03-.153.028-.154.028-.156.027-.158.026-.159.025-.161.024-.162.023-.163.022-.165.021-.166.02-.167.019-.169.018-.169.017-.171.016-.173.015-.173.014-.175.013-.175.012-.177.011-.178.009-.179.009-.179.007-.181.007-.182.005-.182.004-.184.003-.184.002h-.37l-.184-.002-.184-.003-.182-.004-.182-.005-.181-.007-.179-.007-.179-.009-.178-.009-.176-.011-.176-.012-.175-.013-.173-.014-.172-.015-.171-.016-.17-.017-.169-.018-.167-.019-.166-.02-.165-.021-.163-.022-.162-.023-.161-.024-.159-.025-.157-.026-.156-.027-.155-.028-.153-.028-.151-.03-.15-.03-.148-.031-.146-.033-.145-.033-.143-.033-.141-.035-.14-.036-.137-.036-.136-.037-.134-.038-.132-.039-.13-.039-.128-.04-.126-.041-.124-.042-.122-.043-.12-.043-.117-.044-.116-.044-.113-.046-.112-.046-.109-.046-.106-.047-.105-.048-.102-.049-.1-.049-.097-.05-.095-.051-.093-.051-.09-.051-.087-.053-.085-.052-.083-.054-.08-.054-.077-.054v4.139zm0-5.666v.011l.001.02.003.022.004.021.005.022.006.021.007.022.009.023.01.022.011.023.012.023.013.023.015.023.016.024.017.024.018.023.019.024.021.025.022.024.023.024.024.025.052.05.056.05.061.05.066.051.07.051.075.052.079.051.084.052.088.052.092.052.097.052.102.052.105.051.11.052.114.051.119.051.123.051.127.05.131.05.135.05.139.049.144.048.147.048.152.047.155.046.16.045.163.045.167.043.171.043.176.042.178.04.183.04.187.038.19.037.194.036.197.034.202.033.204.032.209.03.212.028.216.027.219.025.222.024.226.021.23.02.233.018.236.017.24.014.243.012.246.01.249.008.253.006.256.003.259.001.26-.001.257-.003.254-.006.25-.008.247-.01.244-.013.241-.014.237-.016.233-.018.231-.02.226-.022.224-.024.22-.025.216-.027.212-.029.21-.03.205-.032.202-.033.198-.035.194-.036.191-.037.187-.039.183-.039.179-.041.175-.042.172-.043.168-.044.163-.045.16-.045.155-.047.152-.047.148-.048.143-.049.139-.049.136-.049.131-.051.126-.05.123-.051.118-.052.114-.051.11-.052.106-.052.101-.052.096-.052.092-.052.088-.052.083-.052.079-.052.074-.052.07-.051.065-.051.06-.051.056-.05.051-.049.023-.025.023-.025.021-.024.02-.024.019-.024.018-.024.017-.024.015-.023.014-.024.013-.023.012-.023.01-.022.01-.023.008-.022.006-.022.006-.022.004-.022.004-.021.001-.021.001-.021v-4.153l-.077.054-.08.054-.083.053-.085.053-.087.053-.09.051-.093.051-.095.051-.097.05-.1.049-.102.048-.105.048-.106.048-.109.046-.111.046-.114.046-.115.044-.118.044-.12.043-.122.043-.124.042-.126.041-.128.04-.13.039-.132.039-.134.038-.135.037-.138.036-.139.036-.142.034-.143.034-.144.033-.147.032-.148.032-.15.03-.151.03-.153.028-.154.028-.156.027-.158.026-.159.024-.161.024-.162.023-.163.023-.165.021-.166.02-.167.019-.169.018-.169.017-.171.016-.173.015-.173.014-.175.013-.175.012-.177.01-.178.01-.179.009-.179.007-.181.006-.182.006-.182.004-.184.003-.184.001-.185.001-.185-.001-.184-.001-.184-.003-.182-.004-.182-.006-.181-.006-.179-.007-.179-.009-.178-.01-.176-.01-.176-.012-.175-.013-.173-.014-.172-.015-.171-.016-.17-.017-.169-.018-.167-.019-.166-.02-.165-.021-.163-.023-.162-.023-.161-.024-.159-.024-.157-.026-.156-.027-.155-.028-.153-.028-.151-.03-.15-.03-.148-.032-.146-.032-.145-.033-.143-.034-.141-.034-.14-.036-.137-.036-.136-.037-.134-.038-.132-.039-.13-.039-.128-.041-.126-.041-.124-.041-.122-.043-.12-.043-.117-.044-.116-.044-.113-.046-.112-.046-.109-.046-.106-.048-.105-.048-.102-.048-.1-.05-.097-.049-.095-.051-.093-.051-.09-.052-.087-.052-.085-.053-.083-.053-.08-.054-.077-.054v4.153zm8.74-8.179l-.257.004-.254.005-.25.008-.247.011-.244.012-.241.014-.237.016-.233.018-.231.021-.226.022-.224.023-.22.026-.216.027-.212.028-.21.031-.205.032-.202.033-.198.034-.194.036-.191.038-.187.038-.183.04-.179.041-.175.042-.172.043-.168.043-.163.045-.16.046-.155.046-.152.048-.148.048-.143.048-.139.049-.136.05-.131.05-.126.051-.123.051-.118.051-.114.052-.11.052-.106.052-.101.052-.096.052-.092.052-.088.052-.083.052-.079.052-.074.051-.07.052-.065.051-.06.05-.056.05-.051.05-.023.025-.023.024-.021.024-.02.025-.019.024-.018.024-.017.023-.015.024-.014.023-.013.023-.012.023-.01.023-.01.022-.008.022-.006.023-.006.021-.004.022-.004.021-.001.021-.001.021.001.021.001.021.004.021.004.022.006.021.006.023.008.022.01.022.01.023.012.023.013.023.014.023.015.024.017.023.018.024.019.024.02.025.021.024.023.024.023.025.051.05.056.05.06.05.065.051.07.052.074.051.079.052.083.052.088.052.092.052.096.052.101.052.106.052.11.052.114.052.118.051.123.051.126.051.131.05.136.05.139.049.143.048.148.048.152.048.155.046.16.046.163.045.168.043.172.043.175.042.179.041.183.04.187.038.191.038.194.036.198.034.202.033.205.032.21.031.212.028.216.027.22.026.224.023.226.022.231.021.233.018.237.016.241.014.244.012.247.011.25.008.254.005.257.004.26.001.26-.001.257-.004.254-.005.25-.008.247-.011.244-.012.241-.014.237-.016.233-.018.231-.021.226-.022.224-.023.22-.026.216-.027.212-.028.21-.031.205-.032.202-.033.198-.034.194-.036.191-.038.187-.038.183-.04.179-.041.175-.042.172-.043.168-.043.163-.045.16-.046.155-.046.152-.048.148-.048.143-.048.139-.049.136-.05.131-.05.126-.051.123-.051.118-.051.114-.052.11-.052.106-.052.101-.052.096-.052.092-.052.088-.052.083-.052.079-.052.074-.051.07-.052.065-.051.06-.05.056-.05.051-.05.023-.025.023-.024.021-.024.02-.025.019-.024.018-.024.017-.023.015-.024.014-.023.013-.023.012-.023.01-.023.01-.022.008-.022.006-.023.006-.021.004-.022.004-.021.001-.021.001-.021-.001-.021-.001-.021-.004-.021-.004-.022-.006-.021-.006-.023-.008-.022-.01-.022-.01-.023-.012-.023-.013-.023-.014-.023-.015-.024-.017-.023-.018-.024-.019-.024-.02-.025-.021-.024-.023-.024-.023-.025-.051-.05-.056-.05-.06-.05-.065-.051-.07-.052-.074-.051-.079-.052-.083-.052-.088-.052-.092-.052-.096-.052-.101-.052-.106-.052-.11-.052-.114-.052-.118-.051-.123-.051-.126-.051-.131-.05-.136-.05-.139-.049-.143-.048-.148-.048-.152-.048-.155-.046-.16-.046-.163-.045-.168-.043-.172-.043-.175-.042-.179-.041-.183-.04-.187-.038-.191-.038-.194-.036-.198-.034-.202-.033-.205-.032-.21-.031-.212-.028-.216-.027-.22-.026-.224-.023-.226-.022-.231-.021-.233-.018-.237-.016-.241-.014-.244-.012-.247-.011-.25-.008-.254-.005-.257-.004-.26-.001-.26.001z"></path></symbol></defs><defs><symbol id="clock-1" width="24" height="24"><path transform="scale(.5)" d="M12 2c5.514 0 10 4.486 10 10s-4.486 10-10 10-10-4.486-10-10 4.486-10 10-10zm0-2c-6.627 0-12 5.373-12 12s5.373 12 12 12 12-5.373 12-12-5.373-12-12-12zm5.848 12.459c.202.038.202.333.001.372-1.907.361-6.045 1.111-6.547 1.111-.719 0-1.301-.582-1.301-1.301 0-.512.77-5.447 1.125-7.445.034-.192.312-.181.343.014l.985 6.238 5.394 1.011z"></path></symbol></defs><defs><marker id="arrowhead-1" refx="7.9" refy="5" markerunits="userSpaceOnUse" markerwidth="12" markerheight="12" orient="auto-start-reverse"><path d="M -1 0 L 10 5 L 0 10 z"></path></marker></defs><defs><marker id="crosshead-1" markerwidth="15" markerheight="8" orient="auto" refx="4" refy="4.5"><path fill="none" stroke="#000000" stroke-width="1pt" d="M 1,2 L 6,7 M 6,2 L 1,7" style="stroke-dasharray: 0, 0;"></path></marker></defs><defs><marker id="filled-head-1" refx="15.5" refy="7" markerwidth="20" markerheight="28" orient="auto"><path d="M 18,7 L9,13 L14,7 L9,1 Z"></path></marker></defs><defs><marker id="sequencenumber-1" refx="15" refy="15" markerwidth="60" markerheight="40" orient="auto"><circle cx="15" cy="15" r="6"></circle></marker></defs><g><line x1="407.5" y1="165" x2="741" y2="165" class="loopLine"></line><line x1="741" y1="165" x2="741" y2="452" class="loopLine"></line><line x1="407.5" y1="452" x2="741" y2="452" class="loopLine"></line><line x1="407.5" y1="165" x2="407.5" y2="452" class="loopLine"></line><polygon points="407.5,165 457.5,165 457.5,178 449.1,185 407.5,185" class="labelBox"></polygon><text x="433" y="178" text-anchor="middle" dominant-baseline="middle" alignment-baseline="middle" class="labelText" style="font-size: 16px; font-weight: 400;">alt</text><text x="599.25" y="183" text-anchor="middle" class="loopText" style="font-size: 16px; font-weight: 400;"><tspan x="599.25">[PostgreSQL Source]</tspan></text></g><g><line x1="413" y1="462" x2="741" y2="462" class="loopLine"></line><line x1="741" y1="462" x2="741" y2="701" class="loopLine"></line><line x1="413" y1="701" x2="741" y2="701" class="loopLine"></line><line x1="413" y1="462" x2="413" y2="701" class="loopLine"></line><polygon points="413,462 463,462 463,475 454.6,482 413,482" class="labelBox"></polygon><text x="438" y="475" text-anchor="middle" dominant-baseline="middle" alignment-baseline="middle" class="labelText" style="font-size: 16px; font-weight: 400;">alt</text><text x="602" y="480" text-anchor="middle" class="loopText" style="font-size: 16px; font-weight: 400;"><tspan x="602">[File Sources]</tspan></text></g><text x="185" y="80" text-anchor="middle" dominant-baseline="middle" alignment-baseline="middle" class="messageText" dy="1em" style="font-size: 16px; font-weight: 400;">Parse args &amp; config file</text><line x1="76" y1="111" x2="293" y2="111" class="messageLine0" stroke-width="2" stroke="none" marker-end="url(#arrowhead)" style="fill: none;"></line><text x="396" y="126" text-anchor="middle" dominant-baseline="middle" alignment-baseline="middle" class="messageText" dy="1em" style="font-size: 16px; font-weight: 400;">Initialize sources</text><line x1="298" y1="155" x2="493" y2="155" class="messageLine0" stroke-width="2" stroke="none" marker-end="url(#arrowhead)" style="fill: none;"></line><text x="498" y="215" text-anchor="middle" dominant-baseline="middle" alignment-baseline="middle" class="messageText" dy="1em" style="font-size: 16px; font-weight: 400;">Connect to database</text><path d="M 498,244 C 558,234 558,274 498,264" class="messageLine0" stroke-width="2" stroke="none" marker-end="url(#arrowhead)" style="fill: none;"></path><text x="498" y="289" text-anchor="middle" dominant-baseline="middle" alignment-baseline="middle" class="messageText" dy="1em" style="font-size: 16px; font-weight: 400;">Query tables &amp; functions</text><path d="M 498,320 C 558,310 558,350 498,340" class="messageLine0" stroke-width="2" stroke="none" marker-end="url(#arrowhead)" style="fill: none;"></path><text x="612" y="365" text-anchor="middle" dominant-baseline="middle" alignment-baseline="middle" class="messageText" dy="1em" style="font-size: 16px; font-weight: 400;">Register table sources</text><line x1="498" y1="396" x2="726" y2="396" class="messageLine0" stroke-width="2" stroke="none" marker-end="url(#arrowhead)" style="fill: none;"></line><text x="612" y="411" text-anchor="middle" dominant-baseline="middle" alignment-baseline="middle" class="messageText" dy="1em" style="font-size: 16px; font-weight: 400;">Register function sources</text><line x1="498" y1="442" x2="726" y2="442" class="messageLine0" stroke-width="2" stroke="none" marker-end="url(#arrowhead)" style="fill: none;"></line><text x="498" y="512" text-anchor="middle" dominant-baseline="middle" alignment-baseline="middle" class="messageText" dy="1em" style="font-size: 16px; font-weight: 400;">Scan MBTiles files</text><path d="M 498,541 C 558,531 558,571 498,561" class="messageLine0" stroke-width="2" stroke="none" marker-end="url(#arrowhead)" style="fill: none;"></path><text x="498" y="586" text-anchor="middle" dominant-baseline="middle" alignment-baseline="middle" class="messageText" dy="1em" style="font-size: 16px; font-weight: 400;">Scan PMTiles files</text><path d="M 498,615 C 558,605 558,645 498,635" class="messageLine0" stroke-width="2" stroke="none" marker-end="url(#arrowhead)" style="fill: none;"></path><text x="612" y="660" text-anchor="middle" dominant-baseline="middle" alignment-baseline="middle" class="messageText" dy="1em" style="font-size: 16px; font-weight: 400;">Register file sources</text><line x1="498" y1="691" x2="726" y2="691" class="messageLine0" stroke-width="2" stroke="none" marker-end="url(#arrowhead)" style="fill: none;"></line><text x="829" y="716" text-anchor="middle" dominant-baseline="middle" alignment-baseline="middle" class="messageText" dy="1em" style="font-size: 16px; font-weight: 400;">Source catalog</text><line x1="731" y1="747" x2="926" y2="747" class="messageLine1" stroke-width="2" stroke="none" marker-end="url(#arrowhead)" style="stroke-dasharray: 3, 3; fill: none;"></line><text x="931" y="762" text-anchor="middle" dominant-baseline="middle" alignment-baseline="middle" class="messageText" dy="1em" style="font-size: 16px; font-weight: 400;">Setup routes</text><path d="M 931,793 C 991,783 991,823 931,813" class="messageLine0" stroke-width="2" stroke="none" marker-end="url(#arrowhead)" style="fill: none;"></path><text x="931" y="838" text-anchor="middle" dominant-baseline="middle" alignment-baseline="middle" class="messageText" dy="1em" style="font-size: 16px; font-weight: 400;">Start HTTP listener</text><path d="M 931,867 C 991,857 991,897 931,887" class="messageLine0" stroke-width="2" stroke="none" marker-end="url(#arrowhead)" style="fill: none;"></path></svg></p>
</div>

<div class="mdbook-tab-content hidden" data-tabname="Resource Generation Flow">
<p><svg id="mermaid-diagram-9183358952631187395" width="100%" xmlns="http://www.w3.org/2000/svg" style="max-width: 1088px;" viewbox="-50 -10 1088 1013" role="graphics-document document" aria-roledescription="sequence"><g><rect x="838" y="927" fill="#eaeaea" stroke="#666" width="150" height="65" name="FS" rx="3" ry="3" class="actor actor-bottom"></rect><text x="913" y="959.5" dominant-baseline="central" alignment-baseline="central" class="actor actor-box" style="text-anchor: middle; font-size: 16px; font-weight: 400;"><tspan x="913" dy="0">File System</tspan></text></g><g><rect x="638" y="927" fill="#eaeaea" stroke="#666" width="150" height="65" name="Font" rx="3" ry="3" class="actor actor-bottom"></rect><text x="713" y="959.5" dominant-baseline="central" alignment-baseline="central" class="actor actor-box" style="text-anchor: middle; font-size: 16px; font-weight: 400;"><tspan x="713" dy="0">Font Generator</tspan></text></g><g><rect x="438" y="927" fill="#eaeaea" stroke="#666" width="150" height="65" name="Sprite" rx="3" ry="3" class="actor actor-bottom"></rect><text x="513" y="959.5" dominant-baseline="central" alignment-baseline="central" class="actor actor-box" style="text-anchor: middle; font-size: 16px; font-weight: 400;"><tspan x="513" dy="0">Sprite Generator</tspan></text></g><g><rect x="238" y="927" fill="#eaeaea" stroke="#666" width="150" height="65" name="Server" rx="3" ry="3" class="actor actor-bottom"></rect><text x="313" y="959.5" dominant-baseline="central" alignment-baseline="central" class="actor actor-box" style="text-anchor: middle; font-size: 16px; font-weight: 400;"><tspan x="313" dy="0">Server</tspan></text></g><g><rect x="0" y="927" fill="#eaeaea" stroke="#666" width="150" height="65" name="Client" rx="3" ry="3" class="actor actor-bottom"></rect><text x="75" y="959.5" dominant-baseline="central" alignment-baseline="central" class="actor actor-box" style="text-anchor: middle; font-size: 16px; font-weight: 400;"><tspan x="75" dy="0">Client</tspan></text></g><g><line id="actor15" x1="913" y1="65" x2="913" y2="927" class="actor-line 200" stroke-width="0.5px" stroke="#999" name="FS"></line><g id="root-15"><rect x="838" y="0" fill="#eaeaea" stroke="#666" width="150" height="65" name="FS" rx="3" ry="3" class="actor actor-top"></rect><text x="913" y="32.5" dominant-baseline="central" alignment-baseline="central" class="actor actor-box" style="text-anchor: middle; font-size: 16px; font-weight: 400;"><tspan x="913" dy="0">File System</tspan></text></g></g><g><line id="actor14" x1="713" y1="65" x2="713" y2="927" class="actor-line 200" stroke-width="0.5px" stroke="#999" name="Font"></line><g id="root-14"><rect x="638" y="0" fill="#eaeaea" stroke="#666" width="150" height="65" name="Font" rx="3" ry="3" class="actor actor-top"></rect><text x="713" y="32.5" dominant-baseline="central" alignment-baseline="central" class="actor actor-box" style="text-anchor: middle; font-size: 16px; font-weight: 400;"><tspan x="713" dy="0">Font Generator</tspan></text></g></g><g><line id="actor13" x1="513" y1="65" x2="513" y2="927" class="actor-line 200" stroke-width="0.5px" stroke="#999" name="Sprite"></line><g id="root-13"><rect x="438" y="0" fill="#eaeaea" stroke="#666" width="150" height="65" name="Sprite" rx="3" ry="3" class="actor actor-top"></rect><text x="513" y="32.5" dominant-baseline="central" alignment-baseline="central" class="actor actor-box" style="text-anchor: middle; font-size: 16px; font-weight: 400;"><tspan x="513" dy="0">Sprite Generator</tspan></text></g></g><g><line id="actor12" x1="313" y1="65" x2="313" y2="927" class="actor-line 200" stroke-width="0.5px" stroke="#999" name="Server"></line><g id="root-12"><rect x="238" y="0" fill="#eaeaea" stroke="#666" width="150" height="65" name="Server" rx="3" ry="3" class="actor actor-top"></rect><text x="313" y="32.5" dominant-baseline="central" alignment-baseline="central" class="actor actor-box" style="text-anchor: middle; font-size: 16px; font-weight: 400;"><tspan x="313" dy="0">Server</tspan></text></g></g><g><line id="actor11" x1="75" y1="65" x2="75" y2="927" class="actor-line 200" stroke-width="0.5px" stroke="#999" name="Client"></line><g id="root-11"><rect x="0" y="0" fill="#eaeaea" stroke="#666" width="150" height="65" name="Client" rx="3" ry="3" class="actor actor-top"></rect><text x="75" y="32.5" dominant-baseline="central" alignment-baseline="central" class="actor actor-box" style="text-anchor: middle; font-size: 16px; font-weight: 400;"><tspan x="75" dy="0">Client</tspan></text></g></g><style>#mermaid-diagram-9183358952631187395{font-family:“trebuchet ms”,verdana,arial,sans-serif;font-size:16px;fill:#333;}@keyframes edge-animation-frame{from{stroke-dashoffset:0;}}@keyframes dash{to{stroke-dashoffset:0;}}#mermaid-diagram-9183358952631187395 .edge-animation-slow{stroke-dasharray:9,5!important;stroke-dashoffset:900;animation:dash 50s linear infinite;stroke-linecap:round;}#mermaid-diagram-9183358952631187395 .edge-animation-fast{stroke-dasharray:9,5!important;stroke-dashoffset:900;animation:dash 20s linear infinite;stroke-linecap:round;}#mermaid-diagram-9183358952631187395 .error-icon{fill:#552222;}#mermaid-diagram-9183358952631187395 .error-text{fill:#552222;stroke:#552222;}#mermaid-diagram-9183358952631187395 .edge-thickness-normal{stroke-width:1px;}#mermaid-diagram-9183358952631187395 .edge-thickness-thick{stroke-width:3.5px;}#mermaid-diagram-9183358952631187395 .edge-pattern-solid{stroke-dasharray:0;}#mermaid-diagram-9183358952631187395 .edge-thickness-invisible{stroke-width:0;fill:none;}#mermaid-diagram-9183358952631187395 .edge-pattern-dashed{stroke-dasharray:3;}#mermaid-diagram-9183358952631187395 .edge-pattern-dotted{stroke-dasharray:2;}#mermaid-diagram-9183358952631187395 .marker{fill:#333333;stroke:#333333;}#mermaid-diagram-9183358952631187395 .marker.cross{stroke:#333333;}#mermaid-diagram-9183358952631187395 svg{font-family:“trebuchet ms”,verdana,arial,sans-serif;font-size:16px;}#mermaid-diagram-9183358952631187395 p{margin:0;}#mermaid-diagram-9183358952631187395 .actor{stroke:hsl(259.6261682243, 59.7765363128%, 87.9019607843%);fill:#ECECFF;}#mermaid-diagram-9183358952631187395 text.actor&gt;tspan{fill:black;stroke:none;}#mermaid-diagram-9183358952631187395 .actor-line{stroke:hsl(259.6261682243, 59.7765363128%, 87.9019607843%);}#mermaid-diagram-9183358952631187395 .innerArc{stroke-width:1.5;stroke-dasharray:none;}#mermaid-diagram-9183358952631187395 .messageLine0{stroke-width:1.5;stroke-dasharray:none;stroke:#333;}#mermaid-diagram-9183358952631187395 .messageLine1{stroke-width:1.5;stroke-dasharray:2,2;stroke:#333;}#mermaid-diagram-9183358952631187395 #arrowhead path{fill:#333;stroke:#333;}#mermaid-diagram-9183358952631187395 .sequenceNumber{fill:white;}#mermaid-diagram-9183358952631187395 #sequencenumber{fill:#333;}#mermaid-diagram-9183358952631187395 #crosshead path{fill:#333;stroke:#333;}#mermaid-diagram-9183358952631187395 .messageText{fill:#333;stroke:none;}#mermaid-diagram-9183358952631187395 .labelBox{stroke:hsl(259.6261682243, 59.7765363128%, 87.9019607843%);fill:#ECECFF;}#mermaid-diagram-9183358952631187395 .labelText,#mermaid-diagram-9183358952631187395 .labelText&gt;tspan{fill:black;stroke:none;}#mermaid-diagram-9183358952631187395 .loopText,#mermaid-diagram-9183358952631187395 .loopText&gt;tspan{fill:black;stroke:none;}#mermaid-diagram-9183358952631187395 .loopLine{stroke-width:2px;stroke-dasharray:2,2;stroke:hsl(259.6261682243, 59.7765363128%, 87.9019607843%);fill:hsl(259.6261682243, 59.7765363128%, 87.9019607843%);}#mermaid-diagram-9183358952631187395 .note{stroke:#aaaa33;fill:#fff5ad;}#mermaid-diagram-9183358952631187395 .noteText,#mermaid-diagram-9183358952631187395 .noteText&gt;tspan{fill:black;stroke:none;}#mermaid-diagram-9183358952631187395 .activation0{fill:#f4f4f4;stroke:#666;}#mermaid-diagram-9183358952631187395 .activation1{fill:#f4f4f4;stroke:#666;}#mermaid-diagram-9183358952631187395 .activation2{fill:#f4f4f4;stroke:#666;}#mermaid-diagram-9183358952631187395 .actorPopupMenu{position:absolute;}#mermaid-diagram-9183358952631187395 .actorPopupMenuPanel{position:absolute;fill:#ECECFF;box-shadow:0px 8px 16px 0px rgba(0,0,0,0.2);filter:drop-shadow(3px 5px 2px rgb(0 0 0 / 0.4));}#mermaid-diagram-9183358952631187395 .actor-man line{stroke:hsl(259.6261682243, 59.7765363128%, 87.9019607843%);fill:#ECECFF;}#mermaid-diagram-9183358952631187395 .actor-man circle,#mermaid-diagram-9183358952631187395 line{stroke:hsl(259.6261682243, 59.7765363128%, 87.9019607843%);fill:#ECECFF;stroke-width:2px;}#mermaid-diagram-9183358952631187395 :root{–mermaid-font-family:“trebuchet ms”,verdana,arial,sans-serif;}</style><g></g><defs><symbol id="computer-2" width="24" height="24"><path transform="scale(.5)" d="M2 2v13h20v-13h-20zm18 11h-16v-9h16v9zm-10.228 6l.466-1h3.524l.467 1h-4.457zm14.228 3h-24l2-6h2.104l-1.33 4h18.45l-1.297-4h2.073l2 6zm-5-10h-14v-7h14v7z"></path></symbol></defs><defs><symbol id="database-2" fill-rule="evenodd" clip-rule="evenodd"><path transform="scale(.5)" d="M12.258.001l.256.004.255.005.253.008.251.01.249.012.247.015.246.016.242.019.241.02.239.023.236.024.233.027.231.028.229.031.225.032.223.034.22.036.217.038.214.04.211.041.208.043.205.045.201.046.198.048.194.05.191.051.187.053.183.054.18.056.175.057.172.059.168.06.163.061.16.063.155.064.15.066.074.033.073.033.071.034.07.034.069.035.068.035.067.035.066.035.064.036.064.036.062.036.06.036.06.037.058.037.058.037.055.038.055.038.053.038.052.038.051.039.05.039.048.039.047.039.045.04.044.04.043.04.041.04.04.041.039.041.037.041.036.041.034.041.033.042.032.042.03.042.029.042.027.042.026.043.024.043.023.043.021.043.02.043.018.044.017.043.015.044.013.044.012.044.011.045.009.044.007.045.006.045.004.045.002.045.001.045v17l-.001.045-.002.045-.004.045-.006.045-.007.045-.009.044-.011.045-.012.044-.013.044-.015.044-.017.043-.018.044-.02.043-.021.043-.023.043-.024.043-.026.043-.027.042-.029.042-.03.042-.032.042-.033.042-.034.041-.036.041-.037.041-.039.041-.04.041-.041.04-.043.04-.044.04-.045.04-.047.039-.048.039-.05.039-.051.039-.052.038-.053.038-.055.038-.055.038-.058.037-.058.037-.06.037-.06.036-.062.036-.064.036-.064.036-.066.035-.067.035-.068.035-.069.035-.07.034-.071.034-.073.033-.074.033-.15.066-.155.064-.16.063-.163.061-.168.06-.172.059-.175.057-.18.056-.183.054-.187.053-.191.051-.194.05-.198.048-.201.046-.205.045-.208.043-.211.041-.214.04-.217.038-.22.036-.223.034-.225.032-.229.031-.231.028-.233.027-.236.024-.239.023-.241.02-.242.019-.246.016-.247.015-.249.012-.251.01-.253.008-.255.005-.256.004-.258.001-.258-.001-.256-.004-.255-.005-.253-.008-.251-.01-.249-.012-.247-.015-.245-.016-.243-.019-.241-.02-.238-.023-.236-.024-.234-.027-.231-.028-.228-.031-.226-.032-.223-.034-.22-.036-.217-.038-.214-.04-.211-.041-.208-.043-.204-.045-.201-.046-.198-.048-.195-.05-.19-.051-.187-.053-.184-.054-.179-.056-.176-.057-.172-.059-.167-.06-.164-.061-.159-.063-.155-.064-.151-.066-.074-.033-.072-.033-.072-.034-.07-.034-.069-.035-.068-.035-.067-.035-.066-.035-.064-.036-.063-.036-.062-.036-.061-.036-.06-.037-.058-.037-.057-.037-.056-.038-.055-.038-.053-.038-.052-.038-.051-.039-.049-.039-.049-.039-.046-.039-.046-.04-.044-.04-.043-.04-.041-.04-.04-.041-.039-.041-.037-.041-.036-.041-.034-.041-.033-.042-.032-.042-.03-.042-.029-.042-.027-.042-.026-.043-.024-.043-.023-.043-.021-.043-.02-.043-.018-.044-.017-.043-.015-.044-.013-.044-.012-.044-.011-.045-.009-.044-.007-.045-.006-.045-.004-.045-.002-.045-.001-.045v-17l.001-.045.002-.045.004-.045.006-.045.007-.045.009-.044.011-.045.012-.044.013-.044.015-.044.017-.043.018-.044.02-.043.021-.043.023-.043.024-.043.026-.043.027-.042.029-.042.03-.042.032-.042.033-.042.034-.041.036-.041.037-.041.039-.041.04-.041.041-.04.043-.04.044-.04.046-.04.046-.039.049-.039.049-.039.051-.039.052-.038.053-.038.055-.038.056-.038.057-.037.058-.037.06-.037.061-.036.062-.036.063-.036.064-.036.066-.035.067-.035.068-.035.069-.035.07-.034.072-.034.072-.033.074-.033.151-.066.155-.064.159-.063.164-.061.167-.06.172-.059.176-.057.179-.056.184-.054.187-.053.19-.051.195-.05.198-.048.201-.046.204-.045.208-.043.211-.041.214-.04.217-.038.22-.036.223-.034.226-.032.228-.031.231-.028.234-.027.236-.024.238-.023.241-.02.243-.019.245-.016.247-.015.249-.012.251-.01.253-.008.255-.005.256-.004.258-.001.258.001zm-9.258 20.499v.01l.001.021.003.021.004.022.005.021.006.022.007.022.009.023.01.022.011.023.012.023.013.023.015.023.016.024.017.023.018.024.019.024.021.024.022.025.023.024.024.025.052.049.056.05.061.051.066.051.07.051.075.051.079.052.084.052.088.052.092.052.097.052.102.051.105.052.11.052.114.051.119.051.123.051.127.05.131.05.135.05.139.048.144.049.147.047.152.047.155.047.16.045.163.045.167.043.171.043.176.041.178.041.183.039.187.039.19.037.194.035.197.035.202.033.204.031.209.03.212.029.216.027.219.025.222.024.226.021.23.02.233.018.236.016.24.015.243.012.246.01.249.008.253.005.256.004.259.001.26-.001.257-.004.254-.005.25-.008.247-.011.244-.012.241-.014.237-.016.233-.018.231-.021.226-.021.224-.024.22-.026.216-.027.212-.028.21-.031.205-.031.202-.034.198-.034.194-.036.191-.037.187-.039.183-.04.179-.04.175-.042.172-.043.168-.044.163-.045.16-.046.155-.046.152-.047.148-.048.143-.049.139-.049.136-.05.131-.05.126-.05.123-.051.118-.052.114-.051.11-.052.106-.052.101-.052.096-.052.092-.052.088-.053.083-.051.079-.052.074-.052.07-.051.065-.051.06-.051.056-.05.051-.05.023-.024.023-.025.021-.024.02-.024.019-.024.018-.024.017-.024.015-.023.014-.024.013-.023.012-.023.01-.023.01-.022.008-.022.006-.022.006-.022.004-.022.004-.021.001-.021.001-.021v-4.127l-.077.055-.08.053-.083.054-.085.053-.087.052-.09.052-.093.051-.095.05-.097.05-.1.049-.102.049-.105.048-.106.047-.109.047-.111.046-.114.045-.115.045-.118.044-.12.043-.122.042-.124.042-.126.041-.128.04-.13.04-.132.038-.134.038-.135.037-.138.037-.139.035-.142.035-.143.034-.144.033-.147.032-.148.031-.15.03-.151.03-.153.029-.154.027-.156.027-.158.026-.159.025-.161.024-.162.023-.163.022-.165.021-.166.02-.167.019-.169.018-.169.017-.171.016-.173.015-.173.014-.175.013-.175.012-.177.011-.178.01-.179.008-.179.008-.181.006-.182.005-.182.004-.184.003-.184.002h-.37l-.184-.002-.184-.003-.182-.004-.182-.005-.181-.006-.179-.008-.179-.008-.178-.01-.176-.011-.176-.012-.175-.013-.173-.014-.172-.015-.171-.016-.17-.017-.169-.018-.167-.019-.166-.02-.165-.021-.163-.022-.162-.023-.161-.024-.159-.025-.157-.026-.156-.027-.155-.027-.153-.029-.151-.03-.15-.03-.148-.031-.146-.032-.145-.033-.143-.034-.141-.035-.14-.035-.137-.037-.136-.037-.134-.038-.132-.038-.13-.04-.128-.04-.126-.041-.124-.042-.122-.042-.12-.044-.117-.043-.116-.045-.113-.045-.112-.046-.109-.047-.106-.047-.105-.048-.102-.049-.1-.049-.097-.05-.095-.05-.093-.052-.09-.051-.087-.052-.085-.053-.083-.054-.08-.054-.077-.054v4.127zm0-5.654v.011l.001.021.003.021.004.021.005.022.006.022.007.022.009.022.01.022.011.023.012.023.013.023.015.024.016.023.017.024.018.024.019.024.021.024.022.024.023.025.024.024.052.05.056.05.061.05.066.051.07.051.075.052.079.051.084.052.088.052.092.052.097.052.102.052.105.052.11.051.114.051.119.052.123.05.127.051.131.05.135.049.139.049.144.048.147.048.152.047.155.046.16.045.163.045.167.044.171.042.176.042.178.04.183.04.187.038.19.037.194.036.197.034.202.033.204.032.209.03.212.028.216.027.219.025.222.024.226.022.23.02.233.018.236.016.24.014.243.012.246.01.249.008.253.006.256.003.259.001.26-.001.257-.003.254-.006.25-.008.247-.01.244-.012.241-.015.237-.016.233-.018.231-.02.226-.022.224-.024.22-.025.216-.027.212-.029.21-.03.205-.032.202-.033.198-.035.194-.036.191-.037.187-.039.183-.039.179-.041.175-.042.172-.043.168-.044.163-.045.16-.045.155-.047.152-.047.148-.048.143-.048.139-.05.136-.049.131-.05.126-.051.123-.051.118-.051.114-.052.11-.052.106-.052.101-.052.096-.052.092-.052.088-.052.083-.052.079-.052.074-.051.07-.052.065-.051.06-.05.056-.051.051-.049.023-.025.023-.024.021-.025.02-.024.019-.024.018-.024.017-.024.015-.023.014-.023.013-.024.012-.022.01-.023.01-.023.008-.022.006-.022.006-.022.004-.021.004-.022.001-.021.001-.021v-4.139l-.077.054-.08.054-.083.054-.085.052-.087.053-.09.051-.093.051-.095.051-.097.05-.1.049-.102.049-.105.048-.106.047-.109.047-.111.046-.114.045-.115.044-.118.044-.12.044-.122.042-.124.042-.126.041-.128.04-.13.039-.132.039-.134.038-.135.037-.138.036-.139.036-.142.035-.143.033-.144.033-.147.033-.148.031-.15.03-.151.03-.153.028-.154.028-.156.027-.158.026-.159.025-.161.024-.162.023-.163.022-.165.021-.166.02-.167.019-.169.018-.169.017-.171.016-.173.015-.173.014-.175.013-.175.012-.177.011-.178.009-.179.009-.179.007-.181.007-.182.005-.182.004-.184.003-.184.002h-.37l-.184-.002-.184-.003-.182-.004-.182-.005-.181-.007-.179-.007-.179-.009-.178-.009-.176-.011-.176-.012-.175-.013-.173-.014-.172-.015-.171-.016-.17-.017-.169-.018-.167-.019-.166-.02-.165-.021-.163-.022-.162-.023-.161-.024-.159-.025-.157-.026-.156-.027-.155-.028-.153-.028-.151-.03-.15-.03-.148-.031-.146-.033-.145-.033-.143-.033-.141-.035-.14-.036-.137-.036-.136-.037-.134-.038-.132-.039-.13-.039-.128-.04-.126-.041-.124-.042-.122-.043-.12-.043-.117-.044-.116-.044-.113-.046-.112-.046-.109-.046-.106-.047-.105-.048-.102-.049-.1-.049-.097-.05-.095-.051-.093-.051-.09-.051-.087-.053-.085-.052-.083-.054-.08-.054-.077-.054v4.139zm0-5.666v.011l.001.02.003.022.004.021.005.022.006.021.007.022.009.023.01.022.011.023.012.023.013.023.015.023.016.024.017.024.018.023.019.024.021.025.022.024.023.024.024.025.052.05.056.05.061.05.066.051.07.051.075.052.079.051.084.052.088.052.092.052.097.052.102.052.105.051.11.052.114.051.119.051.123.051.127.05.131.05.135.05.139.049.144.048.147.048.152.047.155.046.16.045.163.045.167.043.171.043.176.042.178.04.183.04.187.038.19.037.194.036.197.034.202.033.204.032.209.03.212.028.216.027.219.025.222.024.226.021.23.02.233.018.236.017.24.014.243.012.246.01.249.008.253.006.256.003.259.001.26-.001.257-.003.254-.006.25-.008.247-.01.244-.013.241-.014.237-.016.233-.018.231-.02.226-.022.224-.024.22-.025.216-.027.212-.029.21-.03.205-.032.202-.033.198-.035.194-.036.191-.037.187-.039.183-.039.179-.041.175-.042.172-.043.168-.044.163-.045.16-.045.155-.047.152-.047.148-.048.143-.049.139-.049.136-.049.131-.051.126-.05.123-.051.118-.052.114-.051.11-.052.106-.052.101-.052.096-.052.092-.052.088-.052.083-.052.079-.052.074-.052.07-.051.065-.051.06-.051.056-.05.051-.049.023-.025.023-.025.021-.024.02-.024.019-.024.018-.024.017-.024.015-.023.014-.024.013-.023.012-.023.01-.022.01-.023.008-.022.006-.022.006-.022.004-.022.004-.021.001-.021.001-.021v-4.153l-.077.054-.08.054-.083.053-.085.053-.087.053-.09.051-.093.051-.095.051-.097.05-.1.049-.102.048-.105.048-.106.048-.109.046-.111.046-.114.046-.115.044-.118.044-.12.043-.122.043-.124.042-.126.041-.128.04-.13.039-.132.039-.134.038-.135.037-.138.036-.139.036-.142.034-.143.034-.144.033-.147.032-.148.032-.15.03-.151.03-.153.028-.154.028-.156.027-.158.026-.159.024-.161.024-.162.023-.163.023-.165.021-.166.02-.167.019-.169.018-.169.017-.171.016-.173.015-.173.014-.175.013-.175.012-.177.01-.178.01-.179.009-.179.007-.181.006-.182.006-.182.004-.184.003-.184.001-.185.001-.185-.001-.184-.001-.184-.003-.182-.004-.182-.006-.181-.006-.179-.007-.179-.009-.178-.01-.176-.01-.176-.012-.175-.013-.173-.014-.172-.015-.171-.016-.17-.017-.169-.018-.167-.019-.166-.02-.165-.021-.163-.023-.162-.023-.161-.024-.159-.024-.157-.026-.156-.027-.155-.028-.153-.028-.151-.03-.15-.03-.148-.032-.146-.032-.145-.033-.143-.034-.141-.034-.14-.036-.137-.036-.136-.037-.134-.038-.132-.039-.13-.039-.128-.041-.126-.041-.124-.041-.122-.043-.12-.043-.117-.044-.116-.044-.113-.046-.112-.046-.109-.046-.106-.048-.105-.048-.102-.048-.1-.05-.097-.049-.095-.051-.093-.051-.09-.052-.087-.052-.085-.053-.083-.053-.08-.054-.077-.054v4.153zm8.74-8.179l-.257.004-.254.005-.25.008-.247.011-.244.012-.241.014-.237.016-.233.018-.231.021-.226.022-.224.023-.22.026-.216.027-.212.028-.21.031-.205.032-.202.033-.198.034-.194.036-.191.038-.187.038-.183.04-.179.041-.175.042-.172.043-.168.043-.163.045-.16.046-.155.046-.152.048-.148.048-.143.048-.139.049-.136.05-.131.05-.126.051-.123.051-.118.051-.114.052-.11.052-.106.052-.101.052-.096.052-.092.052-.088.052-.083.052-.079.052-.074.051-.07.052-.065.051-.06.05-.056.05-.051.05-.023.025-.023.024-.021.024-.02.025-.019.024-.018.024-.017.023-.015.024-.014.023-.013.023-.012.023-.01.023-.01.022-.008.022-.006.023-.006.021-.004.022-.004.021-.001.021-.001.021.001.021.001.021.004.021.004.022.006.021.006.023.008.022.01.022.01.023.012.023.013.023.014.023.015.024.017.023.018.024.019.024.02.025.021.024.023.024.023.025.051.05.056.05.06.05.065.051.07.052.074.051.079.052.083.052.088.052.092.052.096.052.101.052.106.052.11.052.114.052.118.051.123.051.126.051.131.05.136.05.139.049.143.048.148.048.152.048.155.046.16.046.163.045.168.043.172.043.175.042.179.041.183.04.187.038.191.038.194.036.198.034.202.033.205.032.21.031.212.028.216.027.22.026.224.023.226.022.231.021.233.018.237.016.241.014.244.012.247.011.25.008.254.005.257.004.26.001.26-.001.257-.004.254-.005.25-.008.247-.011.244-.012.241-.014.237-.016.233-.018.231-.021.226-.022.224-.023.22-.026.216-.027.212-.028.21-.031.205-.032.202-.033.198-.034.194-.036.191-.038.187-.038.183-.04.179-.041.175-.042.172-.043.168-.043.163-.045.16-.046.155-.046.152-.048.148-.048.143-.048.139-.049.136-.05.131-.05.126-.051.123-.051.118-.051.114-.052.11-.052.106-.052.101-.052.096-.052.092-.052.088-.052.083-.052.079-.052.074-.051.07-.052.065-.051.06-.05.056-.05.051-.05.023-.025.023-.024.021-.024.02-.025.019-.024.018-.024.017-.023.015-.024.014-.023.013-.023.012-.023.01-.023.01-.022.008-.022.006-.023.006-.021.004-.022.004-.021.001-.021.001-.021-.001-.021-.001-.021-.004-.021-.004-.022-.006-.021-.006-.023-.008-.022-.01-.022-.01-.023-.012-.023-.013-.023-.014-.023-.015-.024-.017-.023-.018-.024-.019-.024-.02-.025-.021-.024-.023-.024-.023-.025-.051-.05-.056-.05-.06-.05-.065-.051-.07-.052-.074-.051-.079-.052-.083-.052-.088-.052-.092-.052-.096-.052-.101-.052-.106-.052-.11-.052-.114-.052-.118-.051-.123-.051-.126-.051-.131-.05-.136-.05-.139-.049-.143-.048-.148-.048-.152-.048-.155-.046-.16-.046-.163-.045-.168-.043-.172-.043-.175-.042-.179-.041-.183-.04-.187-.038-.191-.038-.194-.036-.198-.034-.202-.033-.205-.032-.21-.031-.212-.028-.216-.027-.22-.026-.224-.023-.226-.022-.231-.021-.233-.018-.237-.016-.241-.014-.244-.012-.247-.011-.25-.008-.254-.005-.257-.004-.26-.001-.26.001z"></path></symbol></defs><defs><symbol id="clock-2" width="24" height="24"><path transform="scale(.5)" d="M12 2c5.514 0 10 4.486 10 10s-4.486 10-10 10-10-4.486-10-10 4.486-10 10-10zm0-2c-6.627 0-12 5.373-12 12s5.373 12 12 12 12-5.373 12-12-5.373-12-12-12zm5.848 12.459c.202.038.202.333.001.372-1.907.361-6.045 1.111-6.547 1.111-.719 0-1.301-.582-1.301-1.301 0-.512.77-5.447 1.125-7.445.034-.192.312-.181.343.014l.985 6.238 5.394 1.011z"></path></symbol></defs><defs><marker id="arrowhead-2" refx="7.9" refy="5" markerunits="userSpaceOnUse" markerwidth="12" markerheight="12" orient="auto-start-reverse"><path d="M -1 0 L 10 5 L 0 10 z"></path></marker></defs><defs><marker id="crosshead-2" markerwidth="15" markerheight="8" orient="auto" refx="4" refy="4.5"><path fill="none" stroke="#000000" stroke-width="1pt" d="M 1,2 L 6,7 M 6,2 L 1,7" style="stroke-dasharray: 0, 0;"></path></marker></defs><defs><marker id="filled-head-2" refx="15.5" refy="7" markerwidth="20" markerheight="28" orient="auto"><path d="M 18,7 L9,13 L14,7 L9,1 Z"></path></marker></defs><defs><marker id="sequencenumber-2" refx="15" refy="15" markerwidth="60" markerheight="40" orient="auto"><circle cx="15" cy="15" r="6"></circle></marker></defs><text x="193" y="80" text-anchor="middle" dominant-baseline="middle" alignment-baseline="middle" class="messageText" dy="1em" style="font-size: 16px; font-weight: 400;">GET /sprite/sprite_id</text><line x1="76" y1="111" x2="309" y2="111" class="messageLine0" stroke-width="2" stroke="none" marker-end="url(#arrowhead)" style="fill: none;"></line><text x="412" y="126" text-anchor="middle" dominant-baseline="middle" alignment-baseline="middle" class="messageText" dy="1em" style="font-size: 16px; font-weight: 400;">Generate sprite</text><line x1="314" y1="157" x2="509" y2="157" class="messageLine0" stroke-width="2" stroke="none" marker-end="url(#arrowhead)" style="fill: none;"></line><text x="712" y="172" text-anchor="middle" dominant-baseline="middle" alignment-baseline="middle" class="messageText" dy="1em" style="font-size: 16px; font-weight: 400;">Read SVG files</text><line x1="514" y1="201" x2="909" y2="201" class="messageLine0" stroke-width="2" stroke="none" marker-end="url(#arrowhead)" style="fill: none;"></line><text x="715" y="216" text-anchor="middle" dominant-baseline="middle" alignment-baseline="middle" class="messageText" dy="1em" style="font-size: 16px; font-weight: 400;">SVG data</text><line x1="912" y1="245" x2="517" y2="245" class="messageLine1" stroke-width="2" stroke="none" marker-end="url(#arrowhead)" style="stroke-dasharray: 3, 3; fill: none;"></line><text x="514" y="260" text-anchor="middle" dominant-baseline="middle" alignment-baseline="middle" class="messageText" dy="1em" style="font-size: 16px; font-weight: 400;">Render to PNG</text><path d="M 514,289 C 574,279 574,319 514,309" class="messageLine0" stroke-width="2" stroke="none" marker-end="url(#arrowhead)" style="fill: none;"></path><text x="514" y="334" text-anchor="middle" dominant-baseline="middle" alignment-baseline="middle" class="messageText" dy="1em" style="font-size: 16px; font-weight: 400;">Generate JSON index</text><path d="M 514,363 C 574,353 574,393 514,383" class="messageLine0" stroke-width="2" stroke="none" marker-end="url(#arrowhead)" style="fill: none;"></path><text x="415" y="408" text-anchor="middle" dominant-baseline="middle" alignment-baseline="middle" class="messageText" dy="1em" style="font-size: 16px; font-weight: 400;">Sprite sheet</text><line x1="512" y1="439" x2="317" y2="439" class="messageLine1" stroke-width="2" stroke="none" marker-end="url(#arrowhead)" style="stroke-dasharray: 3, 3; fill: none;"></line><text x="196" y="454" text-anchor="middle" dominant-baseline="middle" alignment-baseline="middle" class="messageText" dy="1em" style="font-size: 16px; font-weight: 400;">PNG/JSON response</text><line x1="312" y1="485" x2="79" y2="485" class="messageLine1" stroke-width="2" stroke="none" marker-end="url(#arrowhead)" style="stroke-dasharray: 3, 3; fill: none;"></line><text x="193" y="500" text-anchor="middle" dominant-baseline="middle" alignment-baseline="middle" class="messageText" dy="1em" style="font-size: 16px; font-weight: 400;">GET /font/fontstack/range</text><line x1="76" y1="531" x2="309" y2="531" class="messageLine0" stroke-width="2" stroke="none" marker-end="url(#arrowhead)" style="fill: none;"></line><text x="512" y="546" text-anchor="middle" dominant-baseline="middle" alignment-baseline="middle" class="messageText" dy="1em" style="font-size: 16px; font-weight: 400;">Generate glyphs</text><line x1="314" y1="577" x2="709" y2="577" class="messageLine0" stroke-width="2" stroke="none" marker-end="url(#arrowhead)" style="fill: none;"></line><text x="812" y="592" text-anchor="middle" dominant-baseline="middle" alignment-baseline="middle" class="messageText" dy="1em" style="font-size: 16px; font-weight: 400;">Read font files</text><line x1="714" y1="621" x2="909" y2="621" class="messageLine0" stroke-width="2" stroke="none" marker-end="url(#arrowhead)" style="fill: none;"></line><text x="815" y="636" text-anchor="middle" dominant-baseline="middle" alignment-baseline="middle" class="messageText" dy="1em" style="font-size: 16px; font-weight: 400;">Font data</text><line x1="912" y1="665" x2="717" y2="665" class="messageLine1" stroke-width="2" stroke="none" marker-end="url(#arrowhead)" style="stroke-dasharray: 3, 3; fill: none;"></line><text x="714" y="680" text-anchor="middle" dominant-baseline="middle" alignment-baseline="middle" class="messageText" dy="1em" style="font-size: 16px; font-weight: 400;">Rasterize glyphs</text><path d="M 714,711 C 774,701 774,741 714,731" class="messageLine0" stroke-width="2" stroke="none" marker-end="url(#arrowhead)" style="fill: none;"></path><text x="714" y="756" text-anchor="middle" dominant-baseline="middle" alignment-baseline="middle" class="messageText" dy="1em" style="font-size: 16px; font-weight: 400;">Encode as PBF</text><path d="M 714,785 C 774,775 774,815 714,805" class="messageLine0" stroke-width="2" stroke="none" marker-end="url(#arrowhead)" style="fill: none;"></path><text x="515" y="830" text-anchor="middle" dominant-baseline="middle" alignment-baseline="middle" class="messageText" dy="1em" style="font-size: 16px; font-weight: 400;">Glyph data</text><line x1="712" y1="861" x2="317" y2="861" class="messageLine1" stroke-width="2" stroke="none" marker-end="url(#arrowhead)" style="stroke-dasharray: 3, 3; fill: none;"></line><text x="196" y="876" text-anchor="middle" dominant-baseline="middle" alignment-baseline="middle" class="messageText" dy="1em" style="font-size: 16px; font-weight: 400;">PBF response</text><line x1="312" y1="907" x2="79" y2="907" class="messageLine1" stroke-width="2" stroke="none" marker-end="url(#arrowhead)" style="stroke-dasharray: 3, 3; fill: none;"></line></svg></p>
</div>

</div>

<h2 id="key-design-decisions"><a class="header" href="#key-design-decisions">Key Design Decisions</a></h2>
<blockquote class="blockquote-tag blockquote-tag-note">
<p class="blockquote-tag-title"><svg viewbox="0 0 16 16" width="18" height="18"><path d="M0 8a8 8 0 1 1 16 0A8 8 0 0 1 0 8Zm8-6.5a6.5 6.5 0 1 0 0 13 6.5 6.5 0 0 0 0-13ZM6.5 7.75A.75.75 0 0 1 7.25 7h1a.75.75 0 0 1 .75.75v2.75h.25a.75.75 0 0 1 0 1.5h-2a.75.75 0 0 1 0-1.5h.25v-2h-.25a.75.75 0 0 1-.75-.75ZM8 6a1 1 0 1 1 0-2 1 1 0 0 1 0 2Z"></path></svg>Note</p>
<p>🧠 This section provides <strong>background and context</strong>, not required knowledge.
You don’t need to understand or remember all of this to use or contribute to Martin.
Read it when you’re curious <em>why</em> certain choices were made.</p>
</blockquote>
<h3 id="rust-for-performance-and-safety"><a class="header" href="#rust-for-performance-and-safety">Rust for Performance and Safety</a></h3>
<details>
<summary>
<b>Why Rust</b>: Martin is written in Rust to balance high performance with strong safety guarantees.
<i>(click to expand)</i>
</summary>
<ul>
<li>Near-C performance without manual memory management</li>
<li>Memory safety (no null pointers or buffer overflows)</li>
<li>Safe concurrency without data races</li>
<li>Zero-cost abstractions that compile to efficient code</li>
</ul>
</details>
<h3 id="actix-web-framework"><a class="header" href="#actix-web-framework">Actix-Web Framework</a></h3>
<details>
<summary>
<b>Why Actix-Web</b>: It offers a fast, production-ready async HTTP stack.
<i>(click to expand)</i>
</summary>
<ul>
<li>High-performance async request handling</li>
<li>Mature middleware ecosystem</li>
<li>Built-in compression and caching headers</li>
<li>Easy Prometheus metrics integration</li>
</ul>
</details>
<h3 id="asyncawait-throughout"><a class="header" href="#asyncawait-throughout">Async/Await Throughout</a></h3>
<details>
<summary>
<b>Why async/await</b>: Allows Martin to handle many concurrent requests efficiently.
<i>(click to expand)</i>
</summary>
<ul>
<li>Handles thousands of concurrent connections</li>
<li>Avoids blocking database queries</li>
<li>Enables efficient file and network I/O</li>
<li>Keeps thread usage low under load</li>
</ul>
</details>
<h3 id="crate-separation"><a class="header" href="#crate-separation">Crate Separation</a></h3>
<details>
<summary>
<b>Why multiple crates</b>: The codebase is split into crates with clear responsibilities.
<i>(click to expand)</i>
</summary>
<ul>
<li><strong>martin-core</strong> — reusable core logic and tile sources</li>
<li><strong>mbtiles</strong> — standalone MBTiles tooling</li>
<li><strong>martin</strong> — HTTP server, configuration, and runtime wiring</li>
<li><strong>martin-tile-utils</strong> — shared low-level tile utilities</li>
</ul>
<p>This makes it easier to:</p>
<ul>
<li>Embed Martin as a library in other Rust projects</li>
<li>Use MBTiles tools independently</li>
<li>Maintain clear API boundaries and versioning</li>
</ul>
</details>
<h3 id="postgresql-connection-pooling"><a class="header" href="#postgresql-connection-pooling">PostgreSQL Connection Pooling</a></h3>
<details>
<summary>
<b>Why connection pooling</b>: Reuse database connections instead of reconnecting per request.
<i>(click to expand)</i>
</summary>
<ul>
<li>Uses <code>deadpool-postgres</code></li>
<li>Avoids per-request connection overhead</li>
<li>Configurable pool sizing</li>
<li>Automatic connection health checks</li>
</ul>
</details>
<h3 id="in-memory-tile-caching"><a class="header" href="#in-memory-tile-caching">In-Memory Tile Caching</a></h3>
<details>
<summary>
<b>Why caching</b>: Avoid regenerating frequently requested tiles.
<i>(click to expand)</i>
</summary>
<ul>
<li>Fast LRU cache with optional TTLs</li>
<li>Automatic eviction of least-used entries</li>
<li>Configurable memory limits (default: 512 MB)</li>
<li>Thread-safe concurrent access</li>
<li>Significant performance improvements for repeated requests</li>
</ul>
</details>
<h3 id="automatic-source-discovery"><a class="header" href="#automatic-source-discovery">Automatic Source Discovery</a></h3>
<details>
<summary>
<b>Why auto-discovery</b>: Martin tries to work out of the box with minimal configuration.
<i>(click to expand)</i>
</summary>
<p>It can currently automatically detect:</p>
<ul>
<li>PostgreSQL tables with geometry columns</li>
<li>PostgreSQL functions that return MVT</li>
<li>MBTiles and PMTiles files in configured directories</li>
</ul>
<p>This keeps common setups close to zero-config.</p>
</details>
<h3 id="multi-protocol-tile-support"><a class="header" href="#multi-protocol-tile-support">Multi-Protocol Tile Support</a></h3>
<p><strong>Why multiple formats</strong>: Different workloads benefit from different storage models. This lets operators pick the best format for their use case:</p>
<div class="mdbook-tabs-container">
<nav class="mdbook-tabs">
<button class="mdbook-tab active" data-tabname="PostgreSQL">PostgreSQL</button>
<button class="mdbook-tab" data-tabname="MBTiles">MBTiles</button>
<button class="mdbook-tab" data-tabname="PMTiles">PMTiles</button>
<button class="mdbook-tab" data-tabname="COG">COG</button>
</nav>
<div class="mdbook-tab-content" data-tabname="PostgreSQL">
<p>Dynamic tiles generated from live data. Best for frequently changing datasets.</p>
</div>

<div class="mdbook-tab-content hidden" data-tabname="MBTiles">
<p>Pre-generated tile archives. Simple and fast for static datasets.</p>
</div>

<div class="mdbook-tab-content hidden" data-tabname="PMTiles">
<p>Single-file, cloud-native archives optimized for HTTP range requests.</p>
</div>

<div class="mdbook-tab-content hidden" data-tabname="COG">
<p>Direct tile serving from Cloud Optimized GeoTIFFs.</p>
</div>

</div>

<h3 id="on-the-fly-resource-generation"><a class="header" href="#on-the-fly-resource-generation">On-the-Fly Resource Generation</a></h3>
<details>
<summary>
<b>Why generate resources dynamically</b>: Sprites, fonts, and styles are created on demand.
<i>(click to expand)</i>
</summary>
<ul>
<li>No pre-processing step required</li>
<li>Simpler deployments (just provide source files)</li>
<li>URL-based customization</li>
<li>Less storage overhead</li>
</ul>
</details>
<h3 id="modular-configuration"><a class="header" href="#modular-configuration">Modular Configuration</a></h3>
<details>
<summary>
<b>Why layered configuration</b>: Martin supports multiple configuration sources.
<i>(click to expand)</i>
</summary>
<ul>
<li>CLI flags for quick testing and overrides</li>
<li>Environment variables for containerized deployments</li>
<li>Config files for larger or more complex setups</li>
<li>Clear precedence between configuration layers</li>
</ul>
</details>
<h2 id="component-interactions"><a class="header" href="#component-interactions">Component Interactions</a></h2>
<div class="mdbook-tabs-container">
<nav class="mdbook-tabs">
<button class="mdbook-tab active" data-tabname="PostgreSQL Integration">PostgreSQL Integration</button>
<button class="mdbook-tab" data-tabname="File Source Integration">File Source Integration</button>
</nav>
<div class="mdbook-tab-content" data-tabname="PostgreSQL Integration">
<p><svg id="mermaid-diagram-5360636795560580540" width="100%" xmlns="http://www.w3.org/2000/svg" class="flowchart" style="max-width: 507.875px;" viewbox="0 0 507.875 480" role="graphics-document document" aria-roledescription="flowchart-v2"><style>#mermaid-diagram-5360636795560580540{font-family:“trebuchet ms”,verdana,arial,sans-serif;font-size:16px;fill:#333;}@keyframes edge-animation-frame{from{stroke-dashoffset:0;}}@keyframes dash{to{stroke-dashoffset:0;}}#mermaid-diagram-5360636795560580540 .edge-animation-slow{stroke-dasharray:9,5!important;stroke-dashoffset:900;animation:dash 50s linear infinite;stroke-linecap:round;}#mermaid-diagram-5360636795560580540 .edge-animation-fast{stroke-dasharray:9,5!important;stroke-dashoffset:900;animation:dash 20s linear infinite;stroke-linecap:round;}#mermaid-diagram-5360636795560580540 .error-icon{fill:#552222;}#mermaid-diagram-5360636795560580540 .error-text{fill:#552222;stroke:#552222;}#mermaid-diagram-5360636795560580540 .edge-thickness-normal{stroke-width:1px;}#mermaid-diagram-5360636795560580540 .edge-thickness-thick{stroke-width:3.5px;}#mermaid-diagram-5360636795560580540 .edge-pattern-solid{stroke-dasharray:0;}#mermaid-diagram-5360636795560580540 .edge-thickness-invisible{stroke-width:0;fill:none;}#mermaid-diagram-5360636795560580540 .edge-pattern-dashed{stroke-dasharray:3;}#mermaid-diagram-5360636795560580540 .edge-pattern-dotted{stroke-dasharray:2;}#mermaid-diagram-5360636795560580540 .marker{fill:#333333;stroke:#333333;}#mermaid-diagram-5360636795560580540 .marker.cross{stroke:#333333;}#mermaid-diagram-5360636795560580540 svg{font-family:“trebuchet ms”,verdana,arial,sans-serif;font-size:16px;}#mermaid-diagram-5360636795560580540 p{margin:0;}#mermaid-diagram-5360636795560580540 .label{font-family:“trebuchet ms”,verdana,arial,sans-serif;color:#333;}#mermaid-diagram-5360636795560580540 .cluster-label text{fill:#333;}#mermaid-diagram-5360636795560580540 .cluster-label span{color:#333;}#mermaid-diagram-5360636795560580540 .cluster-label span p{background-color:transparent;}#mermaid-diagram-5360636795560580540 .label text,#mermaid-diagram-5360636795560580540 span{fill:#333;color:#333;}#mermaid-diagram-5360636795560580540 .node rect,#mermaid-diagram-5360636795560580540 .node circle,#mermaid-diagram-5360636795560580540 .node ellipse,#mermaid-diagram-5360636795560580540 .node polygon,#mermaid-diagram-5360636795560580540 .node path{fill:#ECECFF;stroke:#9370DB;stroke-width:1px;}#mermaid-diagram-5360636795560580540 .rough-node .label text,#mermaid-diagram-5360636795560580540 .node .label text,#mermaid-diagram-5360636795560580540 .image-shape .label,#mermaid-diagram-5360636795560580540 .icon-shape .label{text-anchor:middle;}#mermaid-diagram-5360636795560580540 .node .katex path{fill:#000;stroke:#000;stroke-width:1px;}#mermaid-diagram-5360636795560580540 .rough-node .label,#mermaid-diagram-5360636795560580540 .node .label,#mermaid-diagram-5360636795560580540 .image-shape .label,#mermaid-diagram-5360636795560580540 .icon-shape .label{text-align:center;}#mermaid-diagram-5360636795560580540 .node.clickable{cursor:pointer;}#mermaid-diagram-5360636795560580540 .root .anchor path{fill:#333333!important;stroke-width:0;stroke:#333333;}#mermaid-diagram-5360636795560580540 .arrowheadPath{fill:#333333;}#mermaid-diagram-5360636795560580540 .edgePath .path{stroke:#333333;stroke-width:2.0px;}#mermaid-diagram-5360636795560580540 .flowchart-link{stroke:#333333;fill:none;}#mermaid-diagram-5360636795560580540 .edgeLabel{background-color:rgba(232,232,232, 0.8);text-align:center;}#mermaid-diagram-5360636795560580540 .edgeLabel p{background-color:rgba(232,232,232, 0.8);}#mermaid-diagram-5360636795560580540 .edgeLabel rect{opacity:0.5;background-color:rgba(232,232,232, 0.8);fill:rgba(232,232,232, 0.8);}#mermaid-diagram-5360636795560580540 .labelBkg{background-color:rgba(232, 232, 232, 0.5);}#mermaid-diagram-5360636795560580540 .cluster rect{fill:#ffffde;stroke:#aaaa33;stroke-width:1px;}#mermaid-diagram-5360636795560580540 .cluster text{fill:#333;}#mermaid-diagram-5360636795560580540 .cluster span{color:#333;}#mermaid-diagram-5360636795560580540 div.mermaidTooltip{position:absolute;text-align:center;max-width:200px;padding:2px;font-family:“trebuchet ms”,verdana,arial,sans-serif;font-size:12px;background:hsl(80, 100%, 96.2745098039%);border:1px solid #aaaa33;border-radius:2px;pointer-events:none;z-index:100;}#mermaid-diagram-5360636795560580540 .flowchartTitleText{text-anchor:middle;font-size:18px;fill:#333;}#mermaid-diagram-5360636795560580540 rect.text{fill:none;stroke-width:0;}#mermaid-diagram-5360636795560580540 .icon-shape,#mermaid-diagram-5360636795560580540 .image-shape{background-color:rgba(232,232,232, 0.8);text-align:center;}#mermaid-diagram-5360636795560580540 .icon-shape p,#mermaid-diagram-5360636795560580540 .image-shape p{background-color:rgba(232,232,232, 0.8);padding:2px;}#mermaid-diagram-5360636795560580540 .icon-shape rect,#mermaid-diagram-5360636795560580540 .image-shape rect{opacity:0.5;background-color:rgba(232,232,232, 0.8);fill:rgba(232,232,232, 0.8);}#mermaid-diagram-5360636795560580540 .label-icon{display:inline-block;height:1em;overflow:visible;vertical-align:-0.125em;}#mermaid-diagram-5360636795560580540 .node .label-icon path{fill:currentColor;stroke:revert;stroke-width:revert;}#mermaid-diagram-5360636795560580540 :root{–mermaid-font-family:“trebuchet ms”,verdana,arial,sans-serif;}</style><g><marker id="mermaid-diagram-5360636795560580540_flowchart-v2-pointEnd" class="marker flowchart-v2" viewbox="0 0 10 10" refx="5" refy="5" markerunits="userSpaceOnUse" markerwidth="8" markerheight="8" orient="auto"><path d="M 0 0 L 10 5 L 0 10 z" class="arrowMarkerPath" style="stroke-width: 1; stroke-dasharray: 1, 0;"></path></marker><marker id="mermaid-diagram-5360636795560580540_flowchart-v2-pointStart" class="marker flowchart-v2" viewbox="0 0 10 10" refx="4.5" refy="5" markerunits="userSpaceOnUse" markerwidth="8" markerheight="8" orient="auto"><path d="M 0 5 L 10 10 L 10 0 z" class="arrowMarkerPath" style="stroke-width: 1; stroke-dasharray: 1, 0;"></path></marker><marker id="mermaid-diagram-5360636795560580540_flowchart-v2-circleEnd" class="marker flowchart-v2" viewbox="0 0 10 10" refx="11" refy="5" markerunits="userSpaceOnUse" markerwidth="11" markerheight="11" orient="auto"><circle cx="5" cy="5" r="5" class="arrowMarkerPath" style="stroke-width: 1; stroke-dasharray: 1, 0;"></circle></marker><marker id="mermaid-diagram-5360636795560580540_flowchart-v2-circleStart" class="marker flowchart-v2" viewbox="0 0 10 10" refx="-1" refy="5" markerunits="userSpaceOnUse" markerwidth="11" markerheight="11" orient="auto"><circle cx="5" cy="5" r="5" class="arrowMarkerPath" style="stroke-width: 1; stroke-dasharray: 1, 0;"></circle></marker><marker id="mermaid-diagram-5360636795560580540_flowchart-v2-crossEnd" class="marker cross flowchart-v2" viewbox="0 0 11 11" refx="12" refy="5.2" markerunits="userSpaceOnUse" markerwidth="11" markerheight="11" orient="auto"><path d="M 1,1 l 9,9 M 10,1 l -9,9" class="arrowMarkerPath" style="stroke-width: 2; stroke-dasharray: 1, 0;"></path></marker><marker id="mermaid-diagram-5360636795560580540_flowchart-v2-crossStart" class="marker cross flowchart-v2" viewbox="0 0 11 11" refx="-1" refy="5.2" markerunits="userSpaceOnUse" markerwidth="11" markerheight="11" orient="auto"><path d="M 1,1 l 9,9 M 10,1 l -9,9" class="arrowMarkerPath" style="stroke-width: 2; stroke-dasharray: 1, 0;"></path></marker><g class="root"><g class="clusters"><g class="cluster" id="PostgreSQL" data-look="classic"><rect style="" x="8" y="240" width="491.875" height="232"></rect><g class="cluster-label" transform="translate(210.359375, 240)"><foreignobject width="87.15625" height="24">
<div xmlns="http://www.w3.org/1999/xhtml" style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;"><span class="nodeLabel">
<p>PostgreSQL</p>
</span></div>
</foreignobject></g></g></g><g class="edgePaths"><path d="M258.195,62L258.195,66.167C258.195,70.333,258.195,78.667,258.195,86.333C258.195,94,258.195,101,258.195,104.5L258.195,108" id="L_Martin_Pool_0" class="edge-thickness-normal edge-pattern-solid edge-thickness-normal edge-pattern-solid flowchart-link" style=";" data-edge="true" data-et="edge" data-id="L_Martin_Pool_0" data-points="W3sieCI6MjU4LjE5NTMxMjUsInkiOjYyfSx7IngiOjI1OC4xOTUzMTI1LCJ5Ijo4N30seyJ4IjoyNTguMTk1MzEyNSwieSI6MTEyfV0=" marker-end="url(#mermaid-diagram-5360636795560580540_flowchart-v2-pointEnd)"></path><path d="M187.336,190L179.766,194.167C172.196,198.333,157.055,206.667,149.484,215C141.914,223.333,141.914,231.667,141.914,239.333C141.914,247,141.914,254,141.914,257.5L141.914,261" id="L_Pool_Tables_0" class="edge-thickness-normal edge-pattern-solid edge-thickness-normal edge-pattern-solid flowchart-link" style=";" data-edge="true" data-et="edge" data-id="L_Pool_Tables_0" data-points="W3sieCI6MTg3LjMzNjQyNTc4MTI1LCJ5IjoxOTB9LHsieCI6MTQxLjkxNDA2MjUsInkiOjIxNX0seyJ4IjoxNDEuOTE0MDYyNSwieSI6MjQwfSx7IngiOjE0MS45MTQwNjI1LCJ5IjoyNjV9XQ==" marker-end="url(#mermaid-diagram-5360636795560580540_flowchart-v2-pointEnd)"></path><path d="M329.054,190L336.625,194.167C344.195,198.333,359.336,206.667,366.906,215C374.477,223.333,374.477,231.667,374.477,241.333C374.477,251,374.477,262,374.477,267.5L374.477,273" id="L_Pool_Functions_0" class="edge-thickness-normal edge-pattern-solid edge-thickness-normal edge-pattern-solid flowchart-link" style=";" data-edge="true" data-et="edge" data-id="L_Pool_Functions_0" data-points="W3sieCI6MzI5LjA1NDE5OTIxODc1LCJ5IjoxOTB9LHsieCI6Mzc0LjQ3NjU2MjUsInkiOjIxNX0seyJ4IjozNzQuNDc2NTYyNSwieSI6MjQwfSx7IngiOjM3NC40NzY1NjI1LCJ5IjoyNzd9XQ==" marker-end="url(#mermaid-diagram-5360636795560580540_flowchart-v2-pointEnd)"></path><path d="M141.914,343L141.914,347.167C141.914,351.333,141.914,359.667,150.623,367.728C159.332,375.789,176.749,383.578,185.458,387.473L194.167,391.367" id="L_Tables_PostGIS_0" class="edge-thickness-normal edge-pattern-solid edge-thickness-normal edge-pattern-solid flowchart-link" style=";" data-edge="true" data-et="edge" data-id="L_Tables_PostGIS_0" data-points="W3sieCI6MTQxLjkxNDA2MjUsInkiOjM0M30seyJ4IjoxNDEuOTE0MDYyNSwieSI6MzY4fSx7IngiOjE5Ny44MTg1MDk2MTUzODQ2LCJ5IjozOTN9XQ==" marker-end="url(#mermaid-diagram-5360636795560580540_flowchart-v2-pointEnd)"></path><path d="M374.477,331L374.477,337.167C374.477,343.333,374.477,355.667,365.768,365.728C357.059,375.789,339.641,383.578,330.932,387.473L322.224,391.367" id="L_Functions_PostGIS_0" class="edge-thickness-normal edge-pattern-solid edge-thickness-normal edge-pattern-solid flowchart-link" style=";" data-edge="true" data-et="edge" data-id="L_Functions_PostGIS_0" data-points="W3sieCI6Mzc0LjQ3NjU2MjUsInkiOjMzMX0seyJ4IjozNzQuNDc2NTYyNSwieSI6MzY4fSx7IngiOjMxOC41NzIxMTUzODQ2MTUzNiwieSI6MzkzfV0=" marker-end="url(#mermaid-diagram-5360636795560580540_flowchart-v2-pointEnd)"></path></g><g class="edgeLabels"><g class="edgeLabel"><g class="label" data-id="L_Martin_Pool_0" transform="translate(0, 0)"><foreignobject width="0" height="0">
<div xmlns="http://www.w3.org/1999/xhtml" class="labelBkg" style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;"><span class="edgeLabel"></span></div>
</foreignobject></g></g><g class="edgeLabel"><g class="label" data-id="L_Pool_Tables_0" transform="translate(0, 0)"><foreignobject width="0" height="0">
<div xmlns="http://www.w3.org/1999/xhtml" class="labelBkg" style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;"><span class="edgeLabel"></span></div>
</foreignobject></g></g><g class="edgeLabel"><g class="label" data-id="L_Pool_Functions_0" transform="translate(0, 0)"><foreignobject width="0" height="0">
<div xmlns="http://www.w3.org/1999/xhtml" class="labelBkg" style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;"><span class="edgeLabel"></span></div>
</foreignobject></g></g><g class="edgeLabel"><g class="label" data-id="L_Tables_PostGIS_0" transform="translate(0, 0)"><foreignobject width="0" height="0">
<div xmlns="http://www.w3.org/1999/xhtml" class="labelBkg" style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;"><span class="edgeLabel"></span></div>
</foreignobject></g></g><g class="edgeLabel"><g class="label" data-id="L_Functions_PostGIS_0" transform="translate(0, 0)"><foreignobject width="0" height="0">
<div xmlns="http://www.w3.org/1999/xhtml" class="labelBkg" style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;"><span class="edgeLabel"></span></div>
</foreignobject></g></g></g><g class="nodes"><g class="node default" id="flowchart-Martin-0" transform="translate(258.1953125, 35)"><rect class="basic label-container" style="" x="-78.015625" y="-27" width="156.03125" height="54"></rect><g class="label" style="" transform="translate(-48.015625, -12)"><rect></rect><foreignobject width="96.03125" height="24">
<div xmlns="http://www.w3.org/1999/xhtml" style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;"><span class="nodeLabel">
<p>Martin Server</p>
</span></div>
</foreignobject></g></g><g class="node default" id="flowchart-Pool-1" transform="translate(258.1953125, 151)"><rect class="basic label-container" style="" x="-96.2734375" y="-39" width="192.546875" height="78"></rect><g class="label" style="" transform="translate(-66.2734375, -24)"><rect></rect><foreignobject width="132.546875" height="48">
<div xmlns="http://www.w3.org/1999/xhtml" style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;"><span class="nodeLabel">
<p>Connection Pool<br>deadpool-postgres</p>
</span></div>
</foreignobject></g></g><g class="node default" id="flowchart-Tables-2" transform="translate(141.9140625, 304)"><rect class="basic label-container" style="" x="-98.9140625" y="-39" width="197.828125" height="78"></rect><g class="label" style="" transform="translate(-68.9140625, -24)"><rect></rect><foreignobject width="137.828125" height="48">
<div xmlns="http://www.w3.org/1999/xhtml" style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;"><span class="nodeLabel">
<p>Tables with<br>Geometry Columns</p>
</span></div>
</foreignobject></g></g><g class="node default" id="flowchart-Functions-3" transform="translate(374.4765625, 304)"><rect class="basic label-container" style="" x="-83.6484375" y="-27" width="167.296875" height="54"></rect><g class="label" style="" transform="translate(-53.6484375, -12)"><rect></rect><foreignobject width="107.296875" height="24">
<div xmlns="http://www.w3.org/1999/xhtml" style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;"><span class="nodeLabel">
<p>MVT Functions</p>
</span></div>
</foreignobject></g></g><g class="node default" id="flowchart-PostGIS-4" transform="translate(258.1953125, 420)"><rect class="basic label-container" style="" x="-97.1484375" y="-27" width="194.296875" height="54"></rect><g class="label" style="" transform="translate(-67.1484375, -12)"><rect></rect><foreignobject width="134.296875" height="24">
<div xmlns="http://www.w3.org/1999/xhtml" style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;"><span class="nodeLabel">
<p>PostGIS Extension</p>
</span></div>
</foreignobject></g></g></g></g></g></svg></p>
<p><strong>How it works</strong>:</p>
<ol>
<li>Martin connects to PostgreSQL using connection string</li>
<li>Queries <code>geometry_columns</code> view to discover tables</li>
<li>Queries <code>pg_proc</code> to discover MVT-returning functions</li>
<li>Maintains connection pool for efficient query execution</li>
<li>Generates tile SQL queries with bbox parameters</li>
<li>Returns results as MVT tiles</li>
</ol>
</div>

<div class="mdbook-tab-content hidden" data-tabname="File Source Integration">
<p><svg id="mermaid-diagram-13933127761491169726" width="100%" xmlns="http://www.w3.org/2000/svg" class="flowchart" style="max-width: 1326.75px;" viewbox="0 0 1326.75 248" role="graphics-document document" aria-roledescription="flowchart-v2"><style>#mermaid-diagram-13933127761491169726{font-family:“trebuchet ms”,verdana,arial,sans-serif;font-size:16px;fill:#333;}@keyframes edge-animation-frame{from{stroke-dashoffset:0;}}@keyframes dash{to{stroke-dashoffset:0;}}#mermaid-diagram-13933127761491169726 .edge-animation-slow{stroke-dasharray:9,5!important;stroke-dashoffset:900;animation:dash 50s linear infinite;stroke-linecap:round;}#mermaid-diagram-13933127761491169726 .edge-animation-fast{stroke-dasharray:9,5!important;stroke-dashoffset:900;animation:dash 20s linear infinite;stroke-linecap:round;}#mermaid-diagram-13933127761491169726 .error-icon{fill:#552222;}#mermaid-diagram-13933127761491169726 .error-text{fill:#552222;stroke:#552222;}#mermaid-diagram-13933127761491169726 .edge-thickness-normal{stroke-width:1px;}#mermaid-diagram-13933127761491169726 .edge-thickness-thick{stroke-width:3.5px;}#mermaid-diagram-13933127761491169726 .edge-pattern-solid{stroke-dasharray:0;}#mermaid-diagram-13933127761491169726 .edge-thickness-invisible{stroke-width:0;fill:none;}#mermaid-diagram-13933127761491169726 .edge-pattern-dashed{stroke-dasharray:3;}#mermaid-diagram-13933127761491169726 .edge-pattern-dotted{stroke-dasharray:2;}#mermaid-diagram-13933127761491169726 .marker{fill:#333333;stroke:#333333;}#mermaid-diagram-13933127761491169726 .marker.cross{stroke:#333333;}#mermaid-diagram-13933127761491169726 svg{font-family:“trebuchet ms”,verdana,arial,sans-serif;font-size:16px;}#mermaid-diagram-13933127761491169726 p{margin:0;}#mermaid-diagram-13933127761491169726 .label{font-family:“trebuchet ms”,verdana,arial,sans-serif;color:#333;}#mermaid-diagram-13933127761491169726 .cluster-label text{fill:#333;}#mermaid-diagram-13933127761491169726 .cluster-label span{color:#333;}#mermaid-diagram-13933127761491169726 .cluster-label span p{background-color:transparent;}#mermaid-diagram-13933127761491169726 .label text,#mermaid-diagram-13933127761491169726 span{fill:#333;color:#333;}#mermaid-diagram-13933127761491169726 .node rect,#mermaid-diagram-13933127761491169726 .node circle,#mermaid-diagram-13933127761491169726 .node ellipse,#mermaid-diagram-13933127761491169726 .node polygon,#mermaid-diagram-13933127761491169726 .node path{fill:#ECECFF;stroke:#9370DB;stroke-width:1px;}#mermaid-diagram-13933127761491169726 .rough-node .label text,#mermaid-diagram-13933127761491169726 .node .label text,#mermaid-diagram-13933127761491169726 .image-shape .label,#mermaid-diagram-13933127761491169726 .icon-shape .label{text-anchor:middle;}#mermaid-diagram-13933127761491169726 .node .katex path{fill:#000;stroke:#000;stroke-width:1px;}#mermaid-diagram-13933127761491169726 .rough-node .label,#mermaid-diagram-13933127761491169726 .node .label,#mermaid-diagram-13933127761491169726 .image-shape .label,#mermaid-diagram-13933127761491169726 .icon-shape .label{text-align:center;}#mermaid-diagram-13933127761491169726 .node.clickable{cursor:pointer;}#mermaid-diagram-13933127761491169726 .root .anchor path{fill:#333333!important;stroke-width:0;stroke:#333333;}#mermaid-diagram-13933127761491169726 .arrowheadPath{fill:#333333;}#mermaid-diagram-13933127761491169726 .edgePath .path{stroke:#333333;stroke-width:2.0px;}#mermaid-diagram-13933127761491169726 .flowchart-link{stroke:#333333;fill:none;}#mermaid-diagram-13933127761491169726 .edgeLabel{background-color:rgba(232,232,232, 0.8);text-align:center;}#mermaid-diagram-13933127761491169726 .edgeLabel p{background-color:rgba(232,232,232, 0.8);}#mermaid-diagram-13933127761491169726 .edgeLabel rect{opacity:0.5;background-color:rgba(232,232,232, 0.8);fill:rgba(232,232,232, 0.8);}#mermaid-diagram-13933127761491169726 .labelBkg{background-color:rgba(232, 232, 232, 0.5);}#mermaid-diagram-13933127761491169726 .cluster rect{fill:#ffffde;stroke:#aaaa33;stroke-width:1px;}#mermaid-diagram-13933127761491169726 .cluster text{fill:#333;}#mermaid-diagram-13933127761491169726 .cluster span{color:#333;}#mermaid-diagram-13933127761491169726 div.mermaidTooltip{position:absolute;text-align:center;max-width:200px;padding:2px;font-family:“trebuchet ms”,verdana,arial,sans-serif;font-size:12px;background:hsl(80, 100%, 96.2745098039%);border:1px solid #aaaa33;border-radius:2px;pointer-events:none;z-index:100;}#mermaid-diagram-13933127761491169726 .flowchartTitleText{text-anchor:middle;font-size:18px;fill:#333;}#mermaid-diagram-13933127761491169726 rect.text{fill:none;stroke-width:0;}#mermaid-diagram-13933127761491169726 .icon-shape,#mermaid-diagram-13933127761491169726 .image-shape{background-color:rgba(232,232,232, 0.8);text-align:center;}#mermaid-diagram-13933127761491169726 .icon-shape p,#mermaid-diagram-13933127761491169726 .image-shape p{background-color:rgba(232,232,232, 0.8);padding:2px;}#mermaid-diagram-13933127761491169726 .icon-shape rect,#mermaid-diagram-13933127761491169726 .image-shape rect{opacity:0.5;background-color:rgba(232,232,232, 0.8);fill:rgba(232,232,232, 0.8);}#mermaid-diagram-13933127761491169726 .label-icon{display:inline-block;height:1em;overflow:visible;vertical-align:-0.125em;}#mermaid-diagram-13933127761491169726 .node .label-icon path{fill:currentColor;stroke:revert;stroke-width:revert;}#mermaid-diagram-13933127761491169726 :root{–mermaid-font-family:“trebuchet ms”,verdana,arial,sans-serif;}</style><g><marker id="mermaid-diagram-13933127761491169726_flowchart-v2-pointEnd" class="marker flowchart-v2" viewbox="0 0 10 10" refx="5" refy="5" markerunits="userSpaceOnUse" markerwidth="8" markerheight="8" orient="auto"><path d="M 0 0 L 10 5 L 0 10 z" class="arrowMarkerPath" style="stroke-width: 1; stroke-dasharray: 1, 0;"></path></marker><marker id="mermaid-diagram-13933127761491169726_flowchart-v2-pointStart" class="marker flowchart-v2" viewbox="0 0 10 10" refx="4.5" refy="5" markerunits="userSpaceOnUse" markerwidth="8" markerheight="8" orient="auto"><path d="M 0 5 L 10 10 L 10 0 z" class="arrowMarkerPath" style="stroke-width: 1; stroke-dasharray: 1, 0;"></path></marker><marker id="mermaid-diagram-13933127761491169726_flowchart-v2-circleEnd" class="marker flowchart-v2" viewbox="0 0 10 10" refx="11" refy="5" markerunits="userSpaceOnUse" markerwidth="11" markerheight="11" orient="auto"><circle cx="5" cy="5" r="5" class="arrowMarkerPath" style="stroke-width: 1; stroke-dasharray: 1, 0;"></circle></marker><marker id="mermaid-diagram-13933127761491169726_flowchart-v2-circleStart" class="marker flowchart-v2" viewbox="0 0 10 10" refx="-1" refy="5" markerunits="userSpaceOnUse" markerwidth="11" markerheight="11" orient="auto"><circle cx="5" cy="5" r="5" class="arrowMarkerPath" style="stroke-width: 1; stroke-dasharray: 1, 0;"></circle></marker><marker id="mermaid-diagram-13933127761491169726_flowchart-v2-crossEnd" class="marker cross flowchart-v2" viewbox="0 0 11 11" refx="12" refy="5.2" markerunits="userSpaceOnUse" markerwidth="11" markerheight="11" orient="auto"><path d="M 1,1 l 9,9 M 10,1 l -9,9" class="arrowMarkerPath" style="stroke-width: 2; stroke-dasharray: 1, 0;"></path></marker><marker id="mermaid-diagram-13933127761491169726_flowchart-v2-crossStart" class="marker cross flowchart-v2" viewbox="0 0 11 11" refx="-1" refy="5.2" markerunits="userSpaceOnUse" markerwidth="11" markerheight="11" orient="auto"><path d="M 1,1 l 9,9 M 10,1 l -9,9" class="arrowMarkerPath" style="stroke-width: 2; stroke-dasharray: 1, 0;"></path></marker><g class="root"><g class="clusters"><g class="cluster" id="subGraph1" data-look="classic"><rect style="" x="8" y="112" width="664.8125" height="128"></rect><g class="cluster-label" transform="translate(293.28125, 112)"><foreignobject width="94.25" height="24">
<div xmlns="http://www.w3.org/1999/xhtml" style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;"><span class="nodeLabel">
<p>Remote Files</p>
</span></div>
</foreignobject></g></g><g class="cluster" id="subGraph0" data-look="classic"><rect style="" x="692.8125" y="112" width="625.9375" height="128"></rect><g class="cluster-label" transform="translate(967.5390625, 112)"><foreignobject width="76.484375" height="24">
<div xmlns="http://www.w3.org/1999/xhtml" style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;"><span class="nodeLabel">
<p>Local Files</p>
</span></div>
</foreignobject></g></g></g><g class="edgePaths"><path d="M730.862,62L740.12,66.167C749.377,70.333,767.892,78.667,777.149,87C786.406,95.333,786.406,103.667,786.406,111.333C786.406,119,786.406,126,786.406,129.5L786.406,133" id="L_Martin_MBT_0" class="edge-thickness-normal edge-pattern-solid edge-thickness-normal edge-pattern-solid flowchart-link" style=";" data-edge="true" data-et="edge" data-id="L_Martin_MBT_0" data-points="W3sieCI6NzMwLjg2MjM3OTgwNzY5MjMsInkiOjYyfSx7IngiOjc4Ni40MDYyNSwieSI6ODd9LHsieCI6Nzg2LjQwNjI1LCJ5IjoxMTJ9LHsieCI6Nzg2LjQwNjI1LCJ5IjoxMzd9XQ==" marker-end="url(#mermaid-diagram-13933127761491169726_flowchart-v2-pointEnd)"></path><path d="M748.891,48.329L786.615,54.774C824.339,61.219,899.786,74.11,937.51,84.722C975.234,95.333,975.234,103.667,975.234,111.333C975.234,119,975.234,126,975.234,129.5L975.234,133" id="L_Martin_PMT_0" class="edge-thickness-normal edge-pattern-solid edge-thickness-normal edge-pattern-solid flowchart-link" style=";" data-edge="true" data-et="edge" data-id="L_Martin_PMT_0" data-points="W3sieCI6NzQ4Ljg5MDYyNSwieSI6NDguMzI5MDIwOTk2OTcxMDk2fSx7IngiOjk3NS4yMzQzNzUsInkiOjg3fSx7IngiOjk3NS4yMzQzNzUsInkiOjExMn0seyJ4Ijo5NzUuMjM0Mzc1LCJ5IjoxMzd9XQ==" marker-end="url(#mermaid-diagram-13933127761491169726_flowchart-v2-pointEnd)"></path><path d="M748.891,42.746L823.177,50.122C897.464,57.497,1046.036,72.249,1120.323,83.791C1194.609,95.333,1194.609,103.667,1194.609,111.333C1194.609,119,1194.609,126,1194.609,129.5L1194.609,133" id="L_Martin_COG_0" class="edge-thickness-normal edge-pattern-solid edge-thickness-normal edge-pattern-solid flowchart-link" style=";" data-edge="true" data-et="edge" data-id="L_Martin_COG_0" data-points="W3sieCI6NzQ4Ljg5MDYyNSwieSI6NDIuNzQ1OTM1MTQxMjYzMTZ9LHsieCI6MTE5NC42MDkzNzUsInkiOjg3fSx7IngiOjExOTQuNjA5Mzc1LCJ5IjoxMTJ9LHsieCI6MTE5NC42MDkzNzUsInkiOjEzN31d" marker-end="url(#mermaid-diagram-13933127761491169726_flowchart-v2-pointEnd)"></path><path d="M592.859,42.438L514.961,49.865C437.063,57.292,281.266,72.146,203.367,83.74C125.469,95.333,125.469,103.667,125.469,111.333C125.469,119,125.469,126,125.469,129.5L125.469,133" id="L_Martin_S3MBT_0" class="edge-thickness-normal edge-pattern-solid edge-thickness-normal edge-pattern-solid flowchart-link" style=";" data-edge="true" data-et="edge" data-id="L_Martin_S3MBT_0" data-points="W3sieCI6NTkyLjg1OTM3NSwieSI6NDIuNDM4MTQ4MTY5MzY5MTY0fSx7IngiOjEyNS40Njg3NSwieSI6ODd9LHsieCI6MTI1LjQ2ODc1LCJ5IjoxMTJ9LHsieCI6MTI1LjQ2ODc1LCJ5IjoxMzd9XQ==" marker-end="url(#mermaid-diagram-13933127761491169726_flowchart-v2-pointEnd)"></path><path d="M592.859,47.276L550.784,53.897C508.708,60.517,424.557,73.759,382.482,84.546C340.406,95.333,340.406,103.667,340.406,111.333C340.406,119,340.406,126,340.406,129.5L340.406,133" id="L_Martin_S3PMT_0" class="edge-thickness-normal edge-pattern-solid edge-thickness-normal edge-pattern-solid flowchart-link" style=";" data-edge="true" data-et="edge" data-id="L_Martin_S3PMT_0" data-points="W3sieCI6NTkyLjg1OTM3NSwieSI6NDcuMjc1OTMzODA2MTQ2NTd9LHsieCI6MzQwLjQwNjI1LCJ5Ijo4N30seyJ4IjozNDAuNDA2MjUsInkiOjExMn0seyJ4IjozNDAuNDA2MjUsInkiOjEzN31d" marker-end="url(#mermaid-diagram-13933127761491169726_flowchart-v2-pointEnd)"></path><path d="M610.888,62L601.63,66.167C592.373,70.333,573.858,78.667,564.601,87C555.344,95.333,555.344,103.667,555.344,111.333C555.344,119,555.344,126,555.344,129.5L555.344,133" id="L_Martin_S3COG_0" class="edge-thickness-normal edge-pattern-solid edge-thickness-normal edge-pattern-solid flowchart-link" style=";" data-edge="true" data-et="edge" data-id="L_Martin_S3COG_0" data-points="W3sieCI6NjEwLjg4NzYyMDE5MjMwNzcsInkiOjYyfSx7IngiOjU1NS4zNDM3NSwieSI6ODd9LHsieCI6NTU1LjM0Mzc1LCJ5IjoxMTJ9LHsieCI6NTU1LjM0Mzc1LCJ5IjoxMzd9XQ==" marker-end="url(#mermaid-diagram-13933127761491169726_flowchart-v2-pointEnd)"></path></g><g class="edgeLabels"><g class="edgeLabel"><g class="label" data-id="L_Martin_MBT_0" transform="translate(0, 0)"><foreignobject width="0" height="0">
<div xmlns="http://www.w3.org/1999/xhtml" class="labelBkg" style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;"><span class="edgeLabel"></span></div>
</foreignobject></g></g><g class="edgeLabel"><g class="label" data-id="L_Martin_PMT_0" transform="translate(0, 0)"><foreignobject width="0" height="0">
<div xmlns="http://www.w3.org/1999/xhtml" class="labelBkg" style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;"><span class="edgeLabel"></span></div>
</foreignobject></g></g><g class="edgeLabel"><g class="label" data-id="L_Martin_COG_0" transform="translate(0, 0)"><foreignobject width="0" height="0">
<div xmlns="http://www.w3.org/1999/xhtml" class="labelBkg" style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;"><span class="edgeLabel"></span></div>
</foreignobject></g></g><g class="edgeLabel"><g class="label" data-id="L_Martin_S3MBT_0" transform="translate(0, 0)"><foreignobject width="0" height="0">
<div xmlns="http://www.w3.org/1999/xhtml" class="labelBkg" style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;"><span class="edgeLabel"></span></div>
</foreignobject></g></g><g class="edgeLabel"><g class="label" data-id="L_Martin_S3PMT_0" transform="translate(0, 0)"><foreignobject width="0" height="0">
<div xmlns="http://www.w3.org/1999/xhtml" class="labelBkg" style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;"><span class="edgeLabel"></span></div>
</foreignobject></g></g><g class="edgeLabel"><g class="label" data-id="L_Martin_S3COG_0" transform="translate(0, 0)"><foreignobject width="0" height="0">
<div xmlns="http://www.w3.org/1999/xhtml" class="labelBkg" style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;"><span class="edgeLabel"></span></div>
</foreignobject></g></g></g><g class="nodes"><g class="node default" id="flowchart-Martin-0-1" transform="translate(670.875, 35)"><rect class="basic label-container" style="" x="-78.015625" y="-27" width="156.03125" height="54"></rect><g class="label" style="" transform="translate(-48.015625, -12)"><rect></rect><foreignobject width="96.03125" height="24">
<div xmlns="http://www.w3.org/1999/xhtml" style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;"><span class="nodeLabel">
<p>Martin Server</p>
</span></div>
</foreignobject></g></g><g class="node default" id="flowchart-MBT-1" transform="translate(786.40625, 176)"><rect class="basic label-container" style="" x="-58.59375" y="-39" width="117.1875" height="78"></rect><g class="label" style="" transform="translate(-28.59375, -24)"><rect></rect><foreignobject width="57.1875" height="48">
<div xmlns="http://www.w3.org/1999/xhtml" style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;"><span class="nodeLabel">
<p>MBTiles<br>SQLite</p>
</span></div>
</foreignobject></g></g><g class="node default" id="flowchart-PMT-2" transform="translate(975.234375, 176)"><rect class="basic label-container" style="" x="-80.234375" y="-39" width="160.46875" height="78"></rect><g class="label" style="" transform="translate(-50.234375, -24)"><rect></rect><foreignobject width="100.46875" height="48">
<div xmlns="http://www.w3.org/1999/xhtml" style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;"><span class="nodeLabel">
<p>PMTiles<br>Binary Format</p>
</span></div>
</foreignobject></g></g><g class="node default" id="flowchart-COG-3" transform="translate(1194.609375, 176)"><rect class="basic label-container" style="" x="-89.140625" y="-39" width="178.28125" height="78"></rect><g class="label" style="" transform="translate(-59.140625, -24)"><rect></rect><foreignobject width="118.28125" height="48">
<div xmlns="http://www.w3.org/1999/xhtml" style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;"><span class="nodeLabel">
<p>GeoTIFF<br>Cloud Optimized</p>
</span></div>
</foreignobject></g></g><g class="node default" id="flowchart-S3MBT-4" transform="translate(125.46875, 176)"><rect class="basic label-container" style="" x="-82.46875" y="-39" width="164.9375" height="78"></rect><g class="label" style="" transform="translate(-52.46875, -24)"><rect></rect><foreignobject width="104.9375" height="48">
<div xmlns="http://www.w3.org/1999/xhtml" style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;"><span class="nodeLabel">
<p>S3/Azure/GCP<br>MBTiles</p>
</span></div>
</foreignobject></g></g><g class="node default" id="flowchart-S3PMT-5" transform="translate(340.40625, 176)"><rect class="basic label-container" style="" x="-82.46875" y="-39" width="164.9375" height="78"></rect><g class="label" style="" transform="translate(-52.46875, -24)"><rect></rect><foreignobject width="104.9375" height="48">
<div xmlns="http://www.w3.org/1999/xhtml" style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;"><span class="nodeLabel">
<p>S3/Azure/GCP<br>PMTiles</p>
</span></div>
</foreignobject></g></g><g class="node default" id="flowchart-S3COG-6" transform="translate(555.34375, 176)"><rect class="basic label-container" style="" x="-82.46875" y="-39" width="164.9375" height="78"></rect><g class="label" style="" transform="translate(-52.46875, -24)"><rect></rect><foreignobject width="104.9375" height="48">
<div xmlns="http://www.w3.org/1999/xhtml" style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;"><span class="nodeLabel">
<p>S3/Azure/GCP<br>GeoTIFF</p>
</span></div>
</foreignobject></g></g></g></g></g></svg></p>
<p><strong>How it works</strong>:</p>
<ol>
<li>Martin scans configured directories for tile files</li>
<li>Opens MBTiles with SQLite (using <code>sqlx</code>)</li>
<li>Opens PMTiles with custom parser (HTTP range requests for remote)</li>
<li>Opens COG with TIFF parser (HTTP range requests for remote)</li>
<li>Uses <code>object_store</code> crate for S3/Azure/GCP access</li>
<li>Serves tiles directly from file format</li>
</ol>
</div>

</div>

<h2 id="deployment-patterns"><a class="header" href="#deployment-patterns">Deployment Patterns</a></h2>
<p>Martin supports multiple deployment patterns:</p>
<div class="mdbook-tabs-container">
<nav class="mdbook-tabs">
<button class="mdbook-tab active" data-tabname="Standalone Server">Standalone Server</button>
<button class="mdbook-tab" data-tabname="Container Deployment">Container Deployment</button>
<button class="mdbook-tab" data-tabname="Serverless (AWS Lambda)">Serverless (AWS Lambda)</button>
<button class="mdbook-tab" data-tabname="Behind Reverse Proxy">Behind Reverse Proxy</button>
</nav>
<div class="mdbook-tab-content" data-tabname="Standalone Server">
<ul>
<li>Single binary with embedded WebUI</li>
<li>Direct PostgreSQL connection</li>
<li>Local file serving</li>
<li>Suitable for small to medium deployments</li>
</ul>
</div>

<div class="mdbook-tab-content hidden" data-tabname="Container Deployment">
<ul>
<li>Docker image with all dependencies</li>
<li>Configuration via environment variables</li>
<li>Health check endpoints</li>
<li>Suitable for Kubernetes and container orchestrators</li>
</ul>
</div>

<div class="mdbook-tab-content hidden" data-tabname="Serverless (AWS Lambda)">
<ul>
<li>Lambda adapter for Actix-Web</li>
<li>Cold start optimization</li>
<li>Stateless operation</li>
<li>Suitable for sporadic traffic</li>
</ul>
</div>

<div class="mdbook-tab-content hidden" data-tabname="Behind Reverse Proxy">
<ul>
<li>NGINX or Apache fronting Martin</li>
<li>Additional caching layer</li>
<li>SSL termination</li>
<li>Load balancing across multiple Martin instances</li>
</ul>
</div>

</div>

<h2 id="performance-characteristics"><a class="header" href="#performance-characteristics">Performance Characteristics</a></h2>
<div class="mdbook-tabs-container">
<nav class="mdbook-tabs">
<button class="mdbook-tab active" data-tabname="PostgreSQL Queries">PostgreSQL Queries</button>
<button class="mdbook-tab" data-tabname="Tile Encoding">Tile Encoding</button>
<button class="mdbook-tab" data-tabname="Network I/O">Network I/O</button>
<button class="mdbook-tab" data-tabname="Memory">Memory</button>
</nav>
<div class="mdbook-tab-content" data-tabname="PostgreSQL Queries">
<ul>
<li><strong>Bottleneck</strong>: Complex geometry queries on large tables</li>
<li><strong>Optimization</strong>: Spatial indexes (GIST), connection pooling, query tuning</li>
</ul>
</div>

<div class="mdbook-tab-content hidden" data-tabname="Tile Encoding">
<ul>
<li><strong>Bottleneck</strong>: MVT encoding CPU time</li>
<li><strong>Optimization</strong>: Tile caching, pre-generated MBTiles for static data</li>
</ul>
</div>

<div class="mdbook-tab-content hidden" data-tabname="Network I/O">
<ul>
<li><strong>Bottleneck</strong>: High tile request rate</li>
<li><strong>Optimization</strong>: Async I/O, connection keep-alive, compression</li>
</ul>
</div>

<div class="mdbook-tab-content hidden" data-tabname="Memory">
<ul>
<li><strong>Bottleneck</strong>: Large tile cache size</li>
<li><strong>Optimization</strong>: LRU eviction, configurable cache size, streaming responses</li>
</ul>
</div>

</div>

<div class="mdbook-tabs-container">
<nav class="mdbook-tabs">
<button class="mdbook-tab active" data-tabname="Vertical Scaling">Vertical Scaling</button>
<button class="mdbook-tab" data-tabname="Horizontal Scaling">Horizontal Scaling</button>
</nav>
<div class="mdbook-tab-content" data-tabname="Vertical Scaling">
<ul>
<li>Increase CPU for faster tile generation</li>
<li>Increase memory for larger tile cache</li>
<li>Faster disk I/O for file sources</li>
</ul>
</div>

<div class="mdbook-tab-content hidden" data-tabname="Horizontal Scaling">
<ul>
<li>Run multiple Martin instances behind load balancer</li>
<li>Each instance maintains its own cache</li>
<li>Shared PostgreSQL database with connection pooling</li>
<li>CDN for tile distribution</li>
</ul>
</div>

</div>

<div class="mdbook-tabs-container">
<nav class="mdbook-tabs">
<button class="mdbook-tab active" data-tabname="Input Validation">Input Validation</button>
<button class="mdbook-tab" data-tabname="Database Access">Database Access</button>
<button class="mdbook-tab" data-tabname="Network Security">Network Security</button>
</nav>
<div class="mdbook-tab-content" data-tabname="Input Validation">
<ul>
<li>All tile coordinates validated (z/x/y bounds)</li>
<li>SQL injection prevention through parameterized queries</li>
<li>Path traversal prevention for file sources</li>
<li>URL parsing with strict validation</li>
</ul>
</div>

<div class="mdbook-tab-content hidden" data-tabname="Database Access">
<ul>
<li>Read-only database user recommended</li>
<li>Connection string security (avoid logging)</li>
<li>SSL/TLS support for PostgreSQL connections</li>
<li>Certificate validation for secure connections</li>
</ul>
</div>

<div class="mdbook-tab-content hidden" data-tabname="Network Security">
<ul>
<li>CORS configuration for cross-origin requests</li>
<li>Rate limiting (via reverse proxy)</li>
<li>Authentication/authorization (via reverse proxy)</li>
<li>HTTPS termination (via reverse proxy)</li>
</ul>
</div>

</div>

<h2 id="extensibility-points"><a class="header" href="#extensibility-points">Extensibility Points</a></h2>
<h3 id="adding-new-tile-sources"><a class="header" href="#adding-new-tile-sources">Adding New Tile Sources</a></h3>
<p>To add a new tile source type:</p>
<ol>
<li>Implement the <code>Source</code> trait in <code>martin-core</code></li>
<li>Add configuration parsing in <code>martin</code></li>
<li>Register source in the catalog</li>
<li>Add integration tests</li>
</ol>
<p>Example source types that could be added:</p>
<ul>
<li>Direct GeoJSON file serving</li>
<li>Vector tile rendering from raster data</li>
<li>Integration with other spatial databases</li>
</ul>
<h3 id="adding-new-resource-types"><a class="header" href="#adding-new-resource-types">Adding New Resource Types</a></h3>
<p>To add new resource endpoints:</p>
<ol>
<li>Implement resource generator in <code>martin-core</code></li>
<li>Add HTTP handler in <code>martin/src/srv/</code></li>
<li>Add configuration support</li>
<li>Update catalog/discovery</li>
</ol>
<h3 id="custom-authenticationauthorization"><a class="header" href="#custom-authenticationauthorization">Custom Authentication/Authorization</a></h3>
<p>Martin doesn’t include built-in auth, but supports:</p>
<ul>
<li>Reverse proxy authentication (recommended)</li>
<li>Custom Actix-Web middleware</li>
<li>Token-based access control via proxy</li>
</ul>
<h2 id="monitoring-and-observability"><a class="header" href="#monitoring-and-observability">Monitoring and Observability</a></h2>
<div class="mdbook-tabs-container">
<nav class="mdbook-tabs">
<button class="mdbook-tab active" data-tabname="Metrics">Metrics</button>
<button class="mdbook-tab" data-tabname="Health Checks">Health Checks</button>
<button class="mdbook-tab" data-tabname="Logging">Logging</button>
</nav>
<div class="mdbook-tab-content" data-tabname="Metrics">
<p>Martin exposes Prometheus metrics via <code>/metrics</code>:</p>
<ul>
<li>HTTP request counters and histograms</li>
<li>Tile generation time histograms</li>
<li>Cache hit/miss rates</li>
<li>Database connection pool stats</li>
<li>Error rates by type</li>
</ul>
</div>

<div class="mdbook-tab-content hidden" data-tabname="Health Checks">
<p>We allow health checks via <code>/health</code> and <code>/catalog</code> endpoints:</p>
<ul>
<li><code>/health</code> - Basic health check (HTTP 200)</li>
<li><code>/catalog</code> - Source availability check</li>
</ul>
</div>

<div class="mdbook-tab-content hidden" data-tabname="Logging">
<ul>
<li>logging via <code>env_logger</code></li>
<li>Configurable log levels</li>
<li>Request/response logging</li>
</ul>
</div>

</div>

<h2 id="related-documentation"><a class="header" href="#related-documentation">Related Documentation</a></h2>
<ul>
<li><a href="#development">Development Guide</a> - Contributing to Martin</li>
<li><a href="#configuration-file">Configuration File</a> - Detailed configuration options</li>
<li><a href="#available-api-endpoints">API Documentation</a> - HTTP API reference</li>
<li><a href="#tile-sources">Sources Documentation</a> - Tile source configuration</li>
</ul>
<div style="break-before: page; page-break-before: always;"></div>
<h1 id="development"><a class="header" href="#development">Development</a></h1>
<h2 id="docker-1"><a class="header" href="#docker-1">docker</a></h2>
<p>Install <a href="https://docs.docker.com/get-docker/">docker</a> and <a href="https://docs.docker.com/compose/">docker-compose</a></p>
<blockquote class="blockquote-tag blockquote-tag-tip">
<p class="blockquote-tag-title"><svg viewbox="0 0 16 16" width="18" height="18"><path d="M8 1.5c-2.363 0-4 1.69-4 3.75 0 .984.424 1.625.984 2.304l.214.253c.223.264.47.556.673.848.284.411.537.896.621 1.49a.75.75 0 0 1-1.484.211c-.04-.282-.163-.547-.37-.847a8.456 8.456 0 0 0-.542-.68c-.084-.1-.173-.205-.268-.32C3.201 7.75 2.5 6.766 2.5 5.25 2.5 2.31 4.863 0 8 0s5.5 2.31 5.5 5.25c0 1.516-.701 2.5-1.328 3.259-.095.115-.184.22-.268.319-.207.245-.383.453-.541.681-.208.3-.33.565-.37.847a.751.751 0 0 1-1.485-.212c.084-.593.337-1.078.621-1.489.203-.292.45-.584.673-.848.075-.088.147-.173.213-.253.561-.679.985-1.32.985-2.304 0-2.06-1.637-3.75-4-3.75ZM5.75 12h4.5a.75.75 0 0 1 0 1.5h-4.5a.75.75 0 0 1 0-1.5ZM6 15.25a.75.75 0 0 1 .75-.75h2.5a.75.75 0 0 1 0 1.5h-2.5a.75.75 0 0 1-.75-.75Z"></path></svg>Tip</p>
<p>Alternative container hosts/runtimes work, but you need to set the <code>DOCKER_HOST</code> environment variable to let <a href="https://docs.rs/testcontainers/latest/testcontainers/index.html#docker-host-resolution">the testcontainers module</a> detect your container.
For example, <a href="https://github.com/abiosoft/colima/blob/main/docs/FAQ.md#cannot-connect-to-the-docker-daemon-at-unixvarrundockersock-is-the-docker-daemon-running">Colima uses a different socket location</a>.</p>
</blockquote>
<h2 id="just"><a class="header" href="#just">just</a></h2>
<p>Install <a href="https://github.com/casey/just#readme">Just</a>:</p>
<pre><code class="language-bash ignore">cargo install just --locked
just validate-tools  # verify setup
</code></pre>
<h2 id="other-required-tools"><a class="header" href="#other-required-tools">Other Required tools</a></h2>
<p>We provide a simple command to check that all requirements are setup</p>
<pre><code class="language-bash ignore">just validate-tools
</code></pre>
<h2 id="git-setup"><a class="header" href="#git-setup">Git setup</a></h2>
<p>The recommended setup for both core and casual contributors is to <strong>always</strong> create a fork
of the primary repo under their own account. The local repo should have two remotes: <code>upstream</code> pointing to the primary <code>maplibre/martin</code> repo, and <code>origin</code> pointing to the user’s own fork. The <code>main</code> branch should track <code>upstream/main</code>, but all new work will be pushed to <code>origin</code> and PRs will be created from there.</p>
<details><summary>Rationale for this setup (click to expand)</summary>
<p><small>This rationale was copied from <a href="https://gist.github.com/nyurik/4e299ad832fd2dd43d2b27191ed3ec30">a post</a> by Yuri</small></p>
<p>Open source contribution is both a technical and a social phenomenon.
Any FOSS project naturally has a “caste system” - a group
of contributors with extensive rights vs everyone else. Some of this separation
is necessary - core contributors have deeper knowledge of the code, share vision,
and trust each other.</p>
<p>Core contributors have one more right that others do not – they can create repository branches.
Thus, they can contribute “locally” - by pushing proposed changes to the primary repository’s work branches,
and create “local” pull requests inside the same repo.  This is different from others,
who can contribute only from their own forks.</p>
<p>There is little difference between creating pull requests from one’s own fork and from the primary repo,
and there are a few reasons why core contributors should <strong>never</strong> do it from the primary repo:</p>
<ul>
<li>it ensures that casual contributors always run the same CI as core contributors. If contribution process breaks, it will affect everyone, and will get fixed faster.</li>
<li>it puts everyone on the same leveled playing field, reducing the “caste system” effect, making the project feel more welcoming to new contributors</li>
<li>it ensures that the primary repo only has maintained branches (e.g. <code>main</code> and <code>v1.x</code>),
not a bunch of PR branches whose ownership and work status is unclear to everyone</li>
</ul>
<p>In the martin repository, we follow this and have a branch protection rule that prevents core contributors from creating pull requests from the primary repo.</p>
</details>
<pre><code class="language-bash"># clone the primary fork to your local machine, naming the remote "upstream"
# make sure to replace the URL with the correct one
git clone -o upstream https://github.com/maplibre/martin.git
cd martin

# add your own fork as a remote, naming it "origin"
git remote add origin https://github.com/nyurik/martin.git
</code></pre>
<p>For further setup instructions for IDEs, please see the <a href="#getting-involved">Getting Involved</a> step after you have installed the necessary tools below.</p>
<details><summary>If you have already cloned the repo locally, use this guide to update your setup (click to expand)</summary>
<p>If you already cloned the repo locally, you can update it to use the new setup. This assumes you have a local clone of the repo, the remote name is <code>origin</code>, and you have already forked the repo on GitHub.</p>
<pre><code class="language-bash"># Getting a quick glance about your remotes: git remote -v
git remote -v
# Rename the existing remote to "upstream". Your "main" branch will now track "upstream/main"
git remote rename origin upstream

# Add your own fork as a remote, naming it "origin" (adjust the URL)
git remote add origin https://github.com/nyurik/martin.git
</code></pre>
</details>
<h2 id="contributing-new-code"><a class="header" href="#contributing-new-code">Contributing New Code</a></h2>
<pre><code class="language-bash"># switch to main branch (tracking upstream/main), and pull the latest changes
git switch main
git fetch upstream

# create a new branch for your work
git switch -c my-new-feature

# edit files, and commit changes
# '-a' will add all modified files
# `-m` allows you to add a short commit message
git commit -a -m "My new feature"

# push the changes to your own fork
# '-u' will track your local branch with the remote
git push -u origin my-new-feature

# Click the link shown by `git push` in the terminal to create a pull request
# from your fork using the GitHub web interface
</code></pre>
<blockquote class="blockquote-tag blockquote-tag-tip">
<p class="blockquote-tag-title"><svg viewbox="0 0 16 16" width="18" height="18"><path d="M8 1.5c-2.363 0-4 1.69-4 3.75 0 .984.424 1.625.984 2.304l.214.253c.223.264.47.556.673.848.284.411.537.896.621 1.49a.75.75 0 0 1-1.484.211c-.04-.282-.163-.547-.37-.847a8.456 8.456 0 0 0-.542-.68c-.084-.1-.173-.205-.268-.32C3.201 7.75 2.5 6.766 2.5 5.25 2.5 2.31 4.863 0 8 0s5.5 2.31 5.5 5.25c0 1.516-.701 2.5-1.328 3.259-.095.115-.184.22-.268.319-.207.245-.383.453-.541.681-.208.3-.33.565-.37.847a.751.751 0 0 1-1.485-.212c.084-.593.337-1.078.621-1.489.203-.292.45-.584.673-.848.075-.088.147-.173.213-.253.561-.679.985-1.32.985-2.304 0-2.06-1.637-3.75-4-3.75ZM5.75 12h4.5a.75.75 0 0 1 0 1.5h-4.5a.75.75 0 0 1 0-1.5ZM6 15.25a.75.75 0 0 1 .75-.75h2.5a.75.75 0 0 1 0 1.5h-2.5a.75.75 0 0 1-.75-.75Z"></path></svg>Tip</p>
<p>When developing MBTiles SQL code, you may need to use <code>just prepare-sqlite</code> whenever SQL queries are modified.</p>
</blockquote>
<h2 id="quick-start"><a class="header" href="#quick-start">Quick Start</a></h2>
<pre><code class="language-bash"># Install tools
cargo install just --locked
just validate-tools

# Start development
just start  # test database
just run    # Martin server
just test   # verify setup
</code></pre>
<h2 id="working-with-just"><a class="header" href="#working-with-just">Working with Just</a></h2>
<pre><code class="language-bash">just help        # common commands
just --list      # all commands
just validate-tools  # check setup
</code></pre>
<h3 id="development-workflow"><a class="header" href="#development-workflow">Development workflow</a></h3>
<pre><code class="language-bash">just start       # start test database
just run         # start Martin server
just test        # run all tests
just fmt         # format code
just clippy      # lint code
just book        # build documentation
just stop        # stop test database
</code></pre>
<h3 id="pass-arguments-to-commands"><a class="header" href="#pass-arguments-to-commands">Pass arguments to commands</a></h3>
<pre><code class="language-bash">just test-cargo -- --test integration_test
just run --config /path/to/config.yaml
</code></pre>
<div style="break-before: page; page-break-before: always;"></div>
<h1 id="getting-involved"><a class="header" href="#getting-involved">Getting involved</a></h1>
<p>It’s time to get involved once you have the <a href="#development">fork and all required software</a>.
This guide covers IDE setup and debugging.
While we use Visual Studio Code as an example, Martin can be developed with any editor that supports Rust.</p>
<details>
<summary>Editor-specific Guides (click to expand)</summary>
<h3 id="visual-studio-code"><a class="header" href="#visual-studio-code">Visual Studio Code</a></h3>
<p>Install these essential extensions:</p>
<ul>
<li><a href="https://marketplace.visualstudio.com/items?itemName=rust-lang.rust-analyzer">rust-analyzer</a> - Rust language server</li>
<li><a href="https://marketplace.visualstudio.com/items?itemName=vadimcn.vscode-lldb">CodeLLDB</a> - Debugger for Rust</li>
<li><a href="https://marketplace.visualstudio.com/items?itemName=tamasfe.even-better-toml">Even Better TOML</a> - TOML syntax highlighting</li>
<li><a href="https://marketplace.visualstudio.com/items?itemName=eamodio.gitlens">GitLens</a> - Git integration (optional)</li>
</ul>
<h3 id="vimneovim"><a class="header" href="#vimneovim">Vim/Neovim</a></h3>
<p>Use <a href="https://github.com/mrcjkb/rustaceanvim">rustaceanvim</a></p>
<h3 id="emacs"><a class="header" href="#emacs">Emacs</a></h3>
<p>Use either</p>
<ul>
<li><a href="https://github.com/brotzeit/rustic">rustic</a> or</li>
<li><a href="https://github.com/rust-lang/rust-mode">rust-mode</a></li>
</ul>
<h3 id="rustrover"><a class="header" href="#rustrover">RustRover</a></h3>
<p><a href="https://jetbrains.com/rust/">RustRover</a> supports rust out of the box</p>
<h3 id="zed"><a class="header" href="#zed">Zed</a></h3>
<p><a href="https://zed.dev/">Zed</a> supports rust out of the box</p>
</details>
<h2 id="quick-development-setup"><a class="header" href="#quick-development-setup">Quick Development Setup</a></h2>
<p>Before diving into IDE configuration, make sure your development environment is ready:</p>
<pre><code class="language-bash"># Validate all required tools are installed
just validate-tools

# Start the development environment
just start  # starts test database
just help   # shows common commands
</code></pre>
<h2 id="debugging-with-launchjson"><a class="header" href="#debugging-with-launchjson">Debugging with <code>launch.json</code></a></h2>
<p>Generally, you need to debug martin with specific arguments or a config file to fix issues or add features.</p>
<p>The most convenient way is to generate a launch.json and modify it.</p>
<h2 id="generate"><a class="header" href="#generate">Generate</a></h2>
<p>Press <code>F1</code> on your keyboard, and input “Generate Launch Configurations from Cargo.toml”. Execute it and save it to your <code>.vscode</code> directory.</p>
<h2 id="modify"><a class="header" href="#modify">Modify</a></h2>
<p>Let’s say you want to debug Martin with this command:</p>
<pre><code class="language-shell">martin postgres://postgres:postgres@localhost:5411/db
</code></pre>
<p>You could find <code>Debug executable 'martin'</code> in your <code>launch.json</code>, like below:</p>
<pre><code class="language-json">{
    "type": "lldb",
    "request": "launch",
    "name": "Debug executable 'martin'",
    "cargo": {
        "args": [
            "build",
            "--bin=martin",
            "--package=martin"
        ],
        "filter": {
            "name": "martin",
            "kind": "bin"
        }
    },
    "args": [],
    "cwd": "${workspaceFolder}"
},
</code></pre>
<p>Just copy and paste after it, and modify your pasted like this:</p>
<pre><code class="language-javascript">{
    "type": "lldb",
    "request": "launch",
    "name": "my first debug", // name it any as you like
    "cargo": {
        "args": [
            "build",
            "--bin=martin",
            "--package=martin"
        ],
        "filter": {
            "name": "martin",
            "kind": "bin"
        }
    },
    "args": ["postgres://postgres:postgres@localhost:5411/db"], // add your arguments here
     "env": {
         "DEFAULT_SRID": 4490, // add your env here
     },
    "cwd": "${workspaceFolder}"
},
</code></pre>
<h3 id="add-a-breakpoint"><a class="header" href="#add-a-breakpoint">Add a breakpoint</a></h3>
<p>Go to any part you’re interested in of martin code and add a breakpoint.</p>
<p>We add a breakpoint here in the <a href="https://github.com/maplibre/martin/blob/e628c3973f193a432d3d1282c5893e2339e806b6/martin/src/bin/martin.rs#L10">start of martin</a>.</p>
<pre><code class="language-rust ignore">use clap::Parser;
use tracing::{error, info};
use martin::args::{Args, OsEnv};
use martin::srv::new_server;
use martin::{read_config, Config, MartinResult};

const VERSION: &amp;str = env!("CARGO_PKG_VERSION");

async fn start(args: Args) -&gt; MartinResult&lt;()&gt; {
    info!("Starting Martin v{VERSION}");</code></pre>
<h3 id="debugging"><a class="header" href="#debugging">Debugging</a></h3>
<p>Click <code>Run and Debug</code> on the left panel of <code>Visual Studio Code</code>. Choose <code>my first debug</code> and press <code>F5</code> on your keyboard.</p>
<p>Wait for the breakpoint to be hit.</p>
<div style="break-before: page; page-break-before: always;"></div>
<h1 id="provided-tools"><a class="header" href="#provided-tools">Provided Tools</a></h1>
<p>In addition to the <code>martin</code> tile server, we provide a set of tools to help build and manage maps. These tools are designed to work seamlessly with the <code>martin</code> server and can be used to generate tiles, manage data, and perform various operations on maps.</p>
<h2 id="cli-tools"><a class="header" href="#cli-tools">CLI Tools</a></h2>
<p>Martin project contains additional tooling to help manage the data servable with Martin tile server.</p>
<h3 id="martin-cp"><a class="header" href="#martin-cp"><code>martin-cp</code></a></h3>
<p><code>martin-cp</code> is a tool for generating tiles in bulk, and save retrieved tiles into a new or an existing MBTiles file. It can be used to generate tiles for a large area or multiple areas.
If multiple areas overlap, it will generate tiles only once.
<code>martin-cp</code> supports the same configuration file and CLI arguments as Martin server, so it can support all sources and even combining sources.</p>
<p>See <a href="#generating-tiles-in-bulk">this article</a> for more information.</p>
<h3 id="mbtiles"><a class="header" href="#mbtiles"><code>mbtiles</code></a></h3>
<p><code>mbtiles</code> is a small utility to interact with the <code>*.mbtiles</code> files from the command line.
It allows users to <a href="#mbtiles-information-and-metadata">examine</a>, <a href="#copying-diffing-and-patching-mbtiles">copy</a>, <a href="#mbtiles-validation">validate</a> or <a href="#diffing-mbtiles">compare and apply diffs between them</a>.</p>
<p>See <a href="#working-with-mbtiles-archives">this article</a> for more information.</p>
<h2 id="supporting-crates"><a class="header" href="#supporting-crates">Supporting crates</a></h2>
<p>Next to these tools, we also have a set of supporting crates for supporting the <code>martin</code> server and its ecosystem.
Example of this is <code>martin-tile-utils</code> which is used in <code>martin</code>, <code>mbtiles</code> and <code>martin-cp</code>.</p>
<div style="break-before: page; page-break-before: always;"></div>
<h1 id="martin-as-a-library"><a class="header" href="#martin-as-a-library">Martin as a library</a></h1>
<p>Martin can be used as a standalone server, or as a library in your own Rust application. When used as a library, you can use the following features:</p>
<ul>
<li><code>webui</code> - enable web UI</li>
<li>tile sources
<ul>
<li><code>mbtiles</code> - enable MBTile tile sources</li>
<li><code>pmtiles</code> - enable PMTile tile sources</li>
<li><code>postgres</code> - enable PostgreSQL/PostGIS tile sources</li>
</ul>
</li>
<li>supporting resources
<ul>
<li><code>fonts</code> - enable font sources</li>
<li><code>sprites</code> - enable sprite sources</li>
<li><code>styles</code> - enable style sources</li>
</ul>
</li>
<li><code>lambda</code> - add specialised support for running in serverless functions</li>
</ul>
<p>If you are missing a part of Martin functionality in the <a href="https://docs.rs/martin">public <code>martin</code> API</a>, we would love to hear from you.
Please open an issue on our GitHub repository or directly open a pull request.</p>

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->


                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">

            </nav>

        </div>

        <template id=fa-eye><span class=fa-svg><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 576 512"><!--! Font Awesome Free 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc. --><path d="M288 32c-80.8 0-145.5 36.8-192.6 80.6C48.6 156 17.3 208 2.5 243.7c-3.3 7.9-3.3 16.7 0 24.6C17.3 304 48.6 356 95.4 399.4C142.5 443.2 207.2 480 288 480s145.5-36.8 192.6-80.6c46.8-43.5 78.1-95.4 93-131.1c3.3-7.9 3.3-16.7 0-24.6c-14.9-35.7-46.2-87.7-93-131.1C433.5 68.8 368.8 32 288 32zM432 256c0 79.5-64.5 144-144 144s-144-64.5-144-144s64.5-144 144-144s144 64.5 144 144zM288 192c0 35.3-28.7 64-64 64c-11.5 0-22.3-3-31.6-8.4c-.2 2.8-.4 5.5-.4 8.4c0 53 43 96 96 96s96-43 96-96s-43-96-96-96c-2.8 0-5.6 .1-8.4 .4c5.3 9.3 8.4 20.1 8.4 31.6z"/></svg></span></template>
        <template id=fa-eye-slash><span class=fa-svg><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 640 512"><!--! Font Awesome Free 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc. --><path d="M38.8 5.1C28.4-3.1 13.3-1.2 5.1 9.2S-1.2 34.7 9.2 42.9l592 464c10.4 8.2 25.5 6.3 33.7-4.1s6.3-25.5-4.1-33.7L525.6 386.7c39.6-40.6 66.4-86.1 79.9-118.4c3.3-7.9 3.3-16.7 0-24.6c-14.9-35.7-46.2-87.7-93-131.1C465.5 68.8 400.8 32 320 32c-68.2 0-125 26.3-169.3 60.8L38.8 5.1zM223.1 149.5C248.6 126.2 282.7 112 320 112c79.5 0 144 64.5 144 144c0 24.9-6.3 48.3-17.4 68.7L408 294.5c5.2-11.8 8-24.8 8-38.5c0-53-43-96-96-96c-2.8 0-5.6 .1-8.4 .4c5.3 9.3 8.4 20.1 8.4 31.6c0 10.2-2.4 19.8-6.6 28.3l-90.3-70.8zm223.1 298L373 389.9c-16.4 6.5-34.3 10.1-53 10.1c-79.5 0-144-64.5-144-144c0-6.9 .5-13.6 1.4-20.2L83.1 161.5C60.3 191.2 44 220.8 34.5 243.7c-3.3 7.9-3.3 16.7 0 24.6c14.9 35.7 46.2 87.7 93 131.1C174.5 443.2 239.2 480 320 480c47.8 0 89.9-12.9 126.2-32.5z"/></svg></span></template>
        <template id=fa-copy><span class=fa-svg><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!--! Font Awesome Free 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc. --><path d="M502.6 70.63l-61.25-61.25C435.4 3.371 427.2 0 418.7 0H255.1c-35.35 0-64 28.66-64 64l.0195 256C192 355.4 220.7 384 256 384h192c35.2 0 64-28.8 64-64V93.25C512 84.77 508.6 76.63 502.6 70.63zM464 320c0 8.836-7.164 16-16 16H255.1c-8.838 0-16-7.164-16-16L239.1 64.13c0-8.836 7.164-16 16-16h128L384 96c0 17.67 14.33 32 32 32h47.1V320zM272 448c0 8.836-7.164 16-16 16H63.1c-8.838 0-16-7.164-16-16L47.98 192.1c0-8.836 7.164-16 16-16H160V128H63.99c-35.35 0-64 28.65-64 64l.0098 256C.002 483.3 28.66 512 64 512h192c35.2 0 64-28.8 64-64v-32h-47.1L272 448z"/></svg></span></template>
        <template id=fa-play><span class=fa-svg><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 384 512"><!--! Font Awesome Free 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc. --><path d="M73 39c-14.8-9.1-33.4-9.4-48.5-.9S0 62.6 0 80V432c0 17.4 9.4 33.4 24.5 41.9s33.7 8.1 48.5-.9L361 297c14.3-8.7 23-24.2 23-41s-8.7-32.2-23-41L73 39z"/></svg></span></template>
        <template id=fa-clock-rotate-left><span class=fa-svg><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!--! Font Awesome Free 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc. --><path d="M75 75L41 41C25.9 25.9 0 36.6 0 57.9V168c0 13.3 10.7 24 24 24H134.1c21.4 0 32.1-25.9 17-41l-30.8-30.8C155 85.5 203 64 256 64c106 0 192 86 192 192s-86 192-192 192c-40.8 0-78.6-12.7-109.7-34.4c-14.5-10.1-34.4-6.6-44.6 7.9s-6.6 34.4 7.9 44.6C151.2 495 201.7 512 256 512c141.4 0 256-114.6 256-256S397.4 0 256 0C185.3 0 121.3 28.7 75 75zm181 53c-13.3 0-24 10.7-24 24V256c0 6.4 2.5 12.5 7 17l72 72c9.4 9.4 24.6 9.4 33.9 0s9.4-24.6 0-33.9l-65-65V152c0-13.3-10.7-24-24-24z"/></svg></span></template>



        <script>
            window.playground_copyable = true;
        </script>


        <script src="elasticlunr-ef4e11c1.min.js"></script>
        <script src="mark-09e88c2c.min.js"></script>
        <script src="searcher-c2a407aa.js"></script>

        <script src="clipboard-1626706a.min.js"></script>
        <script src="highlight-abc7f01d.js"></script>
        <script src="book-a0b12cfe.js"></script>

        <!-- Custom JS scripts -->
        <script src="theme/tabs-4258a7db.js"></script>

        <script>
        window.addEventListener('load', function() {
            window.setTimeout(window.print, 100);
        });
        </script>


    </div>
    </body>
</html>
